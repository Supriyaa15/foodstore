(window.webpackJsonptheoWebApp=window.webpackJsonptheoWebApp||[]).push([[107,84,95],{"4pbt":function(e,t,o){var n,a;function r(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function i(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?r(Object(o),!0).forEach((function(t){s(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):r(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}function s(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}const{debounce:d}=o("YLtl"),{PixiJSRenderer:l}=o("wHG3");n=[o("xeH2"),o("UFvF"),o("YLtl"),o("Uwho"),o("gBAB"),o("2ofD"),o("Na8G"),o("zTjw"),o("bBG2"),o("MGCh"),o("l+ZV"),o("+Ltv"),o("ZLL8"),o("qcxC"),o("3xdQ"),o("3xm6"),o("Avqh"),o("KFmL"),o("+VG/"),o("2Fsf"),o("0VUy"),o("5eso"),o("TW0n"),o("W1Jy"),o("M1RA"),o("tpS0"),o("0gXD"),o("1pXj"),o("0do5"),o("Enpp"),o("7LIx"),o("/Elb"),o("dIqn"),o("KQv+"),o("zeFu"),o("OI2j"),o("UzQk"),o("lulf"),o("dcsN"),o("ys7E"),o("rJP3"),o("K7z8"),o("YYuT"),o("a8ov"),o("TdwW"),o("1geK"),o("WpJZ"),o("I/Z9"),o("2PxR"),o("8Jtx"),o("ibPQ"),o("5d+0"),o("mwMu"),o("qnb0"),o("b2xK"),o("hSNs"),o("Pbp+"),o("GSfz"),o("L4yB"),o("Ww1C"),o("rjtT"),o("tQ0N"),o("LGQi"),o("njsh"),o("UNP3"),o("XR60"),o("BQ0V"),o("Pv/z"),o("rx2z"),o("4AtL"),o("3cgi"),o("iXON"),o("GiJK"),o("rquo"),o("HetE"),o("ooew"),o("OMxe"),o("/TxD"),o("Omfs"),o("sjIh"),o("Mvsy"),o("bDzb"),o("CSmQ"),o("YC27"),o("9RDl"),o("JoFX"),o("EbV1"),o("+Mhg"),o("uzEs"),o("INJi"),o("rCSV"),o("Gklz"),o("el3O"),o("GKed"),o("CXs4"),o("8rMV"),o("lQk0"),o("EQmB"),o("GVGo"),o("RhVb"),o("7gWt"),o("LU24")],void 0===(a=function(e,t,o,n,a,r,s,l,c,u,p,g,m,h,f,b,S,I,w,B,v,C,P,U,k,T,x,y,E,D,A,F,M,R,L,z,O,W,N,j,V,H,K,G,_,X,Y,Z,Q,$,{KeyboardShortcuts:q},J,ee,te,oe,ne,ae,re,ie,se,de,le,ce,ue,pe,ge,me,he,fe,be,Se,Ie,we,Be,ve,Ce,Pe,Ue,ke,Te,xe,ye,Ee,De,Ae,Fe,Me,Re,Le,ze,Oe,We,Ne,je,Ve,He,Ke,Ge,_e,Xe,Ye,Ze){!Promise.prototype.finally&&window.NativePromise.prototype.finally&&(Promise.prototype.finally=window.NativePromise.prototype.finally),void 0===Promise.allSettled&&window.NativePromise.allSettled&&(Promise.allSettled=window.NativePromise.allSettled);const Qe=Ge.default,$e=V.default,qe=K.default,Je=G.default,et=c.default,tt=ce.default,ot=ue.default,nt=W.default,at=N.default,rt=j.default,it=M.default,st=ge.default,dt=X.default,lt=me.default,ct=p.default,ut=fe.default,{resolvePromiseOrTimeout:pt}=$,gt=Se.default,{addNewImage:mt}=he,{addNewLogo:ht}=be,{checkWebGLSupport:ft}=Ie,{initBrandKit:bt}=we,{checkWatermarkRemovalGrandfatherStatus:St,initWatermark:It}=Be,{EditingModes:wt,RejectReason:Bt,WebAnimationEnabled:vt}=ve,Ct=Ce.default,Pt=Ue.default,Ut=ke.default,{StartupPerformance:kt,publishEditorDisplayed:Tt}=Pe,xt=Te.default,{validateRemix:yt,validatePremiumRemix:Et}=xe,{initDesign:Dt,repairDesign:At}=ye,Ft=Ee.default,Mt=H.default,Rt=Ve.default,Lt=He.default,zt=Oe.default,Ot=De.default,Wt=Ae.default,Nt=Fe.default,jt=ze.default,Vt=We.default,Ht=J.ShortcutConstants,Kt=Ke.default,Gt=y.default,_t=h.default,Xt=Ye.SparkPerformanceTracker,{PERFORMANCE_MARKERS:Yt}=Ze;let Zt;const Qt=Me.default;var $t,qt;let Jt;const eo=Ne.default,to=je.default;ae.init();const oo=new zt;var no,ao,ro,io,so,lo=u.channel("controller"),co={},uo=!1,po=!1,go={errorDialogs:{}},mo=[],ho=-1,fo=t.defer();const bo=new nt,So=new at(bo);let Io,wo,Bo;var vo,Co,Po,Uo,ko,To=new q,xo=!1,yo=["showFacebookUploadButton","showImageModalPanelOnload","showShareButton","showDownloadButton"],Eo={default:{isDefault:!0,showShareButton:!0,showDownloadButton:!0},"facebook-cover-image-design":{showFacebookUpdateCoverButton:!0,showNoProfilePic:!1,showImageModalPanelOnload:!0},"facebook-holiday-ad-design":{showFacebookUploadButton:!0,showImageModalPanelOnload:!0},"twitter-design":{showTwitterUpload:!0}},Do=!1,Ao=!1,Fo="",Mo="",Ro="";let Lo=[],zo=!1;co.enabled=!1;let Oo=!1;if(window.newrelic&&window.newrelic.setCustomAttribute){const e=window.adobeIMS.getUserProfile().userId;window.newrelic.setCustomAttribute("adobeId",e)}function Wo(e){go&&go.topBarUI&&go.topBarUI.collabStatusButton&&go.topBarUI.collabStatusButton.$el.toggleClass("shared-document",!!e)}function No(e){ja(e.authContext).then(()=>{go.postSideBarUI.brandIndicator.events.publish("brand-switch-complete")})}function jo(){if(ao.canUndo()&&!Oo){var e=ao.getUndoDescription();et.publish("undoApplied",{actionDescription:e}),ao.undo()}}function Vo(){if(ao.canRedo()&&!Oo){var e=ao.getRedoDescription();et.publish("redoApplied",{actionDescription:e}),ao.redo()}}oo.subscribe("ui:handleAddImageButtonPress",Kn),oo.subscribe("ui:onTextTabButtonsShown",(function(){ao.ensureLockupSelected(),Ia()})),oo.subscribe("ui:onSwitchToAnyLocalTabSet",Ia),oo.subscribe("ui:onCropTabButtonsHidden",(function(){go.topBarUI.undo.show(),go.topBarUI.redo.show(),go.postSideBarUI.sidebarCrop.hide()})),oo.subscribe("ui:updateBrandKitLogoComponents",Ra),oo.subscribe("ui:handleAddLogoButtonPress",Xn),oo.subscribe("ui:handleNavTabSelected",(function(){!function(){const e=go.postAppSection.getPanelById("PostRightSidebar");e&&e.update({width:320});const t=go.legacyRightSidebar.getPanelById("PostLegacySidebarContents");t&&t.show()}()})),oo.subscribe("ui:handleNavTabClosed",Ya),oo.subscribe("ui:handleAssetRailPanelOpened",(function(){go.topBarUI.savingIndicator.el.classList.add("showing-asset-rail-panel"),go.designSurface.handleAssetRailOpen()})),oo.subscribe("ui:handleAssetRailPanelClosed",(function(){go.topBarUI.savingIndicator.el.classList.remove("showing-asset-rail-panel"),go.designSurface.handleAssetRailClose()})),oo.subscribe("ui:handleAssetRailShowUpgradePopover",(function(e,t){"logos"===e&&s.showMerchPopover({position:"auto",anchorLocation:t.getBoundingClientRect(),width:320,positionOffset:-4,touchpointName:"postLogoButton"})})),oo.subscribe("ui:exitReplaceMode",()=>{$t.handleLeaveReplaceMode()}),oo.subscribe("ui:returnToSpark",({skipSave:e,pathType:t})=>Ha(e,t)),oo.subscribe("ui:handleAddTextButtonPress",vn),oo.subscribe("ui:returnToGlobalSidebarState",Ea),oo.subscribe("ui:closeIsFromReturnToSpark",e=>{Ao=e}),oo.subscribe("ui:previousSelectedFormaId",e=>{Ro=e}),oo.subscribe("ui:saveTemplateChanges",(function(){go.designSurface.posterAdornments.hideSelectionBox(),Bo.waitForSaveToFinish().then((function(){marvel.navigate("/branding/"+Co.contextId,{trigger:!0})}))})),oo.subscribe("ui:cancelTemplateChanges",(function(){var e=t.defer();go.designSurface.disable(),ao.undoToInitialState(),Mt.setTemplateName(vo,so.templateName),o.delay((function(){go.designSurface.poster.update({core:ao}),go.designSurface.poster.enable(),e.resolve()}),250),e.promise.done((function(){Bo.requestSave(),Bo.waitForSaveToFinish("Please wait...").then((function(){marvel.navigate("/branding/"+Co.contextId,{trigger:!0})}))}))})),oo.subscribe("ui:handleUndo",jo),oo.subscribe("ui:handleRedo",Vo),oo.subscribe("ui:handleDebugMenuButtonPress",(function(){go.debugView&&go.debugView.show()})),oo.subscribe("ui:handleHideLibrariesNewFlag",(function(){e("#sectionTabLibraries div.tab-new-tag").addClass("hide")}));var Ho={dragStartX:0,dragStartY:0,dragX:0,dragY:0,dragDX:0,dragDY:0,dragging:!1,zoomingIn:!1,zoomingOut:!1,pointers:[]};function Ko(e){e.preventDefault(),Ho.zoomingIn||Ho.zoomingOut?(e.currentTarget.addEventListener("mouseup",_o),qo(e)):(e.currentTarget.addEventListener("mouseup",_o),e.currentTarget.addEventListener("mousemove",Go),on(e.clientX,e.clientY))}function Go(e){Ho.dragging&&nn(e.clientX,e.clientY)}function _o(e){e.currentTarget.removeEventListener("mouseup",_o),e.currentTarget.removeEventListener("mousemove",Go),e.preventDefault(),an()}function Xo(e){e.preventDefault(),1===e.touches.length&&(on(e.touches[0].clientX,e.touches[0].clientY),document.addEventListener("touchmove",Yo),document.addEventListener("touchend",Zo),document.addEventListener("touchcancel",Zo))}function Yo(e){e.preventDefault(),1===e.touches.length&&Ho.dragging&&nn(e.touches[0].clientX,e.touches[0].clientY)}function Zo(e){e.preventDefault(),0===e.touches.length&&(an(),document.removeEventListener("touchmove",Yo),document.removeEventListener("touchend",Zo),document.removeEventListener("touchcancel",Zo))}function Qo(e){for(var t=0;t<Ho.pointers.length;t++)if(Ho.pointers[t].pointerId===e)return t;return-1}function $o(e){if(null==document.getElementById("PostCursorDiv")||!Ho.zoomingIn&&!Ho.zoomingOut){var t=Qo(e.pointerId);t<0?Ho.pointers.push(e):Ho.pointers[t]=e,1===Ho.pointers.length&&(on(Ho.pointers[0].clientX,Ho.pointers[0].clientY),window.addEventListener("pointermove",en,!1),window.addEventListener("pointerup",tn,!1))}else qo(e)}function qo(e){if(Ho.zoomingIn||Ho.zoomingOut){const t=ao.getNextZoomLevel(Ho.zoomingIn),o=xa(e.pageX,e.pageY);go.designSurface.posterAdornments.handleZoomToPoint(t,o),To.logShortcut(Ho.zoomingIn?Ht.kZoomInKey:Ht.kZoomOutKey);const n=Ho.zoomingIn?"in":"out";go.designSurface.posterAdornments.logZoomMethod("gesture",n)}}function Jo(){go.cutoutCursor.handleZoom(),$t.forceUiStateUpdate()}function en(e){var t=Qo(e.pointerId);t<0?Ho.pointers.push(e):Ho.pointers[t]=e,1===Ho.pointers.length&&nn(Ho.pointers[0].clientX,Ho.pointers[0].clientY)}function tn(e){var t=Qo(e.pointerId);t>=0&&Ho.pointers.splice(t,1),0===Ho.pointers.length&&Ho.dragging&&(an(),window.removeEventListener("pointermove",en,!1),window.removeEventListener("pointerup",tn,!1))}function on(e,t){Ho.dragging=!0,Ho.dragStartX=Ho.dragX=e,Ho.dragStartY=Ho.dragY=t;null!=document.getElementById("PostCursorDiv")&&Ho.dragging&&dn()}function nn(e,t){Ho.dragging&&(Ho.dragDX=Ho.dragX-e,Ho.dragDY=Ho.dragY-t,Ho.dragX=e,Ho.dragY=t,go.designSurface.posterAdornments.handlePanBy(new O.TheoPoint(Ho.dragDX,Ho.dragDY)))}function an(){Ho.dragging&&(Ho.dragging=!1,Ho.dragDX=0,Ho.dragDY=0),Ho.zoomIn=!1,Ho.zoomOut=!1,To.logShortcut(Ht.kPanKey),go.designSurface.posterAdornments.logZoomMethod("gesture","pan"),Sn()}function rn(e){const t=window.navigator.platform.includes("Mac"),o=e.altKey,n=e.ctrlKey&&!t||e.metaKey&&t;if(!1===Ho.dragging||o||n){if(null==document.getElementById("PostCursorDiv")){var a=document.createElement("div");a.setAttribute("class","PostCursorDiv"),a.id="PostCursorDiv",window.PointerEvent?a.addEventListener("pointerdown",$o,!1):(a.addEventListener("touchstart",Xo),a.addEventListener("mousedown",Ko)),a.addEventListener("selectstart",(function(e){return e.preventDefault(),!1})),document.body.appendChild(a)}else o||n?(Ho.zoomingIn=!o,Ho.zoomingOut=o):(Ho.zoomingIn=!1,Ho.zoomingOut=!1);dn()}}function sn(e){if(Ho.zoomingIn||Ho.zoomingOut){const t=window.navigator.platform.includes("Mac");"Meta"===e.key&&t||"Control"===e.key&&!t?Ho.zoomingIn=!1:"Alt"===e.key&&(Ho.zoomingOut=!1)}!1===Ho.dragging&&" "===e.key&&Sn()}function dn(){const e=document.getElementById("PostCursorDiv");e&&(Ho.zoomingIn?e.style.cursor="zoom-in":Ho.zoomingOut?e.style.cursor="zoom-out":Ho.dragging?e.style.cursor="grabbing":e.style.cursor="grab")}function ln(){go.designSurface.posterAdornments.handleZoomInShortcut()}function cn(){go.designSurface.posterAdornments.handleZoomOutShortcut()}function un(){go.designSurface.posterAdornments.handleZoomFitShortcut()}function pn(){go.designSurface.posterAdornments.handleZoomFillShortcut()}function gn(){go.designSurface.posterAdornments.handleZoomActualSizeShortcut()}function mn(e,t){go.designSurface.posterAdornments.handlePanViewShortcut(e,t)}function hn(){return!ao.refineCutoutGestureInProgress()}function fn(){return!ao.inRefineCutoutMode()}function bn(){return!ao.refineCutoutGestureInProgress()}function Sn(){const e=document.getElementById("PostCursorDiv");null!=e&&(window.PointerEvent?e.removeEventListener("pointerdown",$o,!1):(e.removeEventListener("touchstart",Xo),e.removeEventListener("mousedown",Ko)),document.body.removeChild(e))}function In(){}function wn(){}function Bn(e,t,o){return ao.updateCharStyleRanges(e,t,o)}function vn(){ao.downloadNewLockupRandomFontsAsync();const e=b.translate("app.textPanel.addNewText"),t=e.length.toString();et.publish("editor:textCustomAdded",{contextualData7:"lengthOfText:"+t}),ao.addNewLockup(e,{select:!0}).done((function(){go.designSurface.posterAdornments.showSelectionBox(),Nt.handleDoubleTapToEditText(!0)}))}function Cn(){var e,t=ao.getAllSelectedFormas();t&&(e=t,ao.canDuplicateFormae(e)?ao.duplicateFormae(e).done():Vn())}function Pn(e){xn(),ao.enterCropMode().then((function(){go.postSideBarUI.sidebarCrop.show(),go.postSideBarUI.sidebarCrop.moveToSection(e)}))}function Un(e){ao.applyAspectRatioCropToImage(e).done()}function kn(e){ao.applyShapeMaskToImage(e).done()}function Tn(){yn(),ao.exitCropMode().then((function(){go.navStripUI.tabButtonBackgroundImage.select(),go.postSideBarUI.sidebarBackground.show()}))}function xn(){e("#PostApp").addClass("crop-scrim"),e("#PostTopBar").addClass("crop-scrim").append('<div class="full-scrim"></div>'),e("#PostTopBar").find(".full-scrim").on("click",(function(e){Tn()}))}function yn(){go.layerStack.exitCropOrRefineCutoutMode(),e("#PostApp").removeClass("crop-scrim"),e("#PostTopBar").removeClass("crop-scrim"),e("#PostTopBar").find(".full-scrim").remove()}function En({messageType:e,messageObj:t}){go.errorDialogs.actionFeedbackModal&&go.errorDialogs.actionFeedbackModal.hide();let o=t.message,n=null;if(e===O.ActionFeedbackMessageType.Error)if(t instanceof O.HostNetworkError)t.type===O.HostNetworkErrorType.NoInternetConnection?(o=b.translate("dialogs.networkError.kOfflineErrorTitle"),n=b.translate("dialogs.networkError.kOfflineErrorText")):(o=b.translate("dialogs.networkError.kGenericErrorTitle"),n=b.translate("dialogs.networkError.kGenericErrorText",{errorMessage:t.message||"Unknown error"}));else if(t instanceof O.HostCutoutMaskError)switch(o=b.translate("dialogs.networkError.kGenericErrorTitle"),t.type){case O.HostCutoutMaskErrorType.NoForegroundObjectImage:n=b.translate("dialogs.networkError.kCutoutMaskErrorText");break;case O.HostCutoutMaskErrorType.ImageTooLarge:n=b.translate("dialogs.networkError.kCutoutLargeImageErrorText");break;case O.HostCutoutMaskErrorType.ImageTooSmall:n=b.translate("dialogs.networkError.kCutoutSmallImageErrorText");break;case O.HostCutoutMaskErrorType.UnsupportedImageFormat:n=b.translate("dialogs.networkError.kCutoutUnsupportedImageErrorText");break;case O.HostCutoutMaskErrorType.InvalidImageUploaded:n=b.translate("dialogs.networkError.kCutoutInvalidImageErrorText");break;default:n=b.translate("dialogs.networkError.kGenericErrorText",{errorMessage:t.message||"Unknown error"})}else t instanceof O.CoreStringError&&(t.errorMessage===O.ErrorMessageConstants.kAddTextMissingFontError?(o=b.translate("dialogs.addTextFailedMissingFonts.kTitle"),n=b.translate("dialogs.addTextFailedMissingFonts.kMessage")):lo.warn("Unhandled core string error "+t.id));o&&n&&(go.errorDialogs.actionFeedbackModal=new T({headerText:o,contentText:n,dismissable:!0,buttons:[{class:"pill pill-primary-on-light",label:"OK",onClick:function(){go.errorDialogs.actionFeedbackModal.hide()}}]}),go.errorDialogs.actionFeedbackModal.show())}function Dn(){et.publish("editor:image:pinToBackgroundDisabled"),ao.setImageAsForeground().done()}function An(){et.publish("editor:image:pinToBackgroundEnabled"),ao.setImageAsBackground().done()}var Fn=!1;function Mn(){bo.featureEnabled("is-paid-user")||(Fn&&Xe.getPostTabRecoveryStatus()&&(Fn=!1,Xe.setPostTabRecoveryStatus(!1)),Fn||(Xe.startWatchPostTabVisibility(),window.marvel.events.trigger("show-app-toast-message",{message:b.translate("dialogs.removeBackground"),variant:"info",timeout:0,closable:!0,onClose:function(){et.publish("editor:limitedTimePopupDismissed")}}),Fn=!0,Xe.setPostTabRecoveryStatus(!1)))}function Rn(){var e=ao.getAllSelectedFormas();if(e){var t=ao.getDeleteInfo(e);if(t.isDeleteable&&t.isBackgroundImage)var o=new T({headerText:"i18n.dialogs.delete.kHeaderText",contentText:"i18n.dialogs.delete.kContentText",dismissable:!0,buttons:[{class:"pill pill-primary-on-light",label:"i18n.dialogs.delete.kDeleteContentButtonLabel",onClick:function(){ao.replaceImagesWithColors(null,[]).done(),o.hide()}},{class:"pill pill-primary-on-light",label:"i18n.dialogs.delete.kDeletePhotoSectionLabel",onClick:function(){On(e),o.hide()}},{class:"pill pill-secondary-on-light",label:"i18n.common.kCancel",onClick:function(){o.hide()}}]});else t.isBackgroundImage?ao.replaceImagesWithColors(null,[]).done():t.isDeleteable&&On(e)}}function Ln(e){const t=ao.getAllSelectedFormas();ao.groupItems(t,!0,e.method)}function zn(e){const t=ao.getAllSelectedFormas();ao.ungroupItems(t,!0,e.method)}function On(e){e=e||ao.getAllSelectedFormas(),ao.deleteFormae(e).done()}function Wn(t,o){const n=ao.getViewToDocMatrix().inverse.transformPoint(o),a=go.designSurface.poster.$el.offset(),r=n.add(new O.TheoPoint(a.left,a.top));var i=e("#swapCellThumbnail");if(i.length)i.css({top:r.y+5+"px",left:r.x-50+"px"});else{var s=e('<div id="swapCellThumbnail"></div>').css({position:"absolute",top:r.y+5+"px",left:r.x-50+"px",opacity:.5,"box-shadow":"0px 0px 4px 0px"});if(e("body").append(s),t.isBackgroundImage()){var d=ao.getImagePreviewData(t),l=e('<img src="'+d.url+'">').css({"max-height":"100px","max-width":"100px"});s.append(l)}else{var c=t.style.colors.fieldPrimary;if(c){var u=_.rgb2hex(_.solidColor2Rgba(c)),p=t.frame.width>t.frame.height;s.css({background:"#"+u,height:p?t.frame.height/t.frame.width*100+"px":"100px",width:p?"100px":t.frame.width/t.frame.height*100+"px"})}}}}function Nn(){e("#swapCellThumbnail").remove()}function jn(){go.postSideBarUI.sidebarCrop.recordFormaResize()}function Vn(){var e=new T({headerText:"i18n.dialogs.tooManyImages.kHeaderText",contentText:"i18n.dialogs.tooManyImages.kContentText",dismissable:!0,buttons:[{class:"pill pill-primary-on-light",label:"OK",onClick:function(){e.hide()}}]});e.show()}function Hn(e){if(e.length){const o=t.defer();return window.marvel.events.trigger("missing-brand-fonts-ux",{doc:r.currentDoc,missingFonts:e,defer:o}),o.promise.then(e=>e?t.resolve():t.reject({brandFontsVerificationFailed:!0}))}return t.resolve()}function Kn(e){e=e||{},ao.canAddMoreImages(1)?(go.designSurface.posterAdornments.hideSelectionBox(),oo.publish("ui:previousSelectedFormaId",ao.getSelectedFormaId()||""),ao.deselect({silent:!0}),go.navStripUI.tabButtonBackgroundImage.hide({silent:!0,preventSelection:!0}),e.setHome=!0,e.label="Add photo",e.disallowClose=!1,oo.publish("ui:showImagePicker",e),go.navStripUI.tabButtonBackgroundImage.select(),go.postSideBarUI.changeIconModalPanel.hide()):Vn()}function Gn(e){if(e=e||{},$t.model._state.isReplaceMode)$t.handleLeaveReplaceMode();else{var t=ao.getSelectedForma();if(t)if($t.handleEnterReplaceMode(),"logo"===ao.getSelectedFormaType())oo.publish("ui:handleSelectLogoTab"),_n(!0);else if(ao.isIcon(t))go.navStripUI.tabButtonIcon.select(),e.label="Replace icon","dooplo"===t.contentNode.mediaMetadata.searchSource&&(e.context=e.context||{},e.context.class_name="DooploImagePickerContext",e.context.search_string=t.contentNode.mediaMetadata.searchTerm),function(e){e=e||{},oo.publish("ui:showIconPicker",e)}(e);else{go.navStripUI.tabButtonBackgroundImage.select(),e.label="Replace photo";var o=t.isImage()&&t.childCount>0&&t.childAt(0).contentNode.mediaMetadata,n="ui:showImagePicker";o&&("cclight"===o.searchSource?(e.context=e.context||{},e.context.class_name="CCLightDesignAssetsImagePickerContext",e.context.search_string=o.searchTerm,e.context.search_props=o.searchProps,n="ui:showADesignAssetsPicker"):"dooplo"===o.searchSource&&(e.context=e.context||{},e.context.class_name="DooploImagePickerContext",e.context.search_string=t.childAt(0).contentNode.mediaMetadata.searchTerm)),oo.publish(n,e)}}}function _n(e){$t.handleLogoPanelChanged({isLogoReplaceMode:e})}function Xn(){bo.featureEnabled("entitle-brand-kit")?(go.navStripUI.tabButtonLogo.select(),go.postSideBarUI.changeImageModalPanel.hide(),go.postSideBarUI.changeIconModalPanel.hide()):s.showMerchPopover({$element:go.navStripUI.tabButtonTheme.$el,position:"bottom-left",width:320,positionOffset:-4,touchpointName:"postLogoButton"})}var Yn=o.throttle((function(e,t){ao.applyGridStyle(e,t).done(),et.publish("layoutSelected",{layoutID:e.gridStyle.name})}),40);function Zn(e){if("Original"===e.id){var t=ao.getOriginalImageSize();if(!t)return;e=O.DesignSizeLibrary.getOriginalSize(t.width,t.height)}return go.designSurface.disable(),go.designSurface.watermarkUI.updateWatermarkCoachmarkVisibility(!1),ao.setPageSizeFromDesignSize(e).then((function(){go.designSurface.imageWrapper.update({aspect:e.aspectRatio||1}),go.postSideBarUI.sidebarBackground.updateFilters({tileAspect:e.aspectRatio||1}),o.delay((function(){go.designSurface.enable()}),50),go.designSurface.watermarkUI.handleWatermarkFootprintChanged(),et.publish("canvasSizeSelected",{aspectRatio:e.aspectRatio||1,targetId:e.id})}))}var Qn=o.throttle((function(e){"Custom"===e.id?function(){var e=ao.getPageExportData(),t=e.pixelDimensions,o=ao.getDocumentSizeId(),n=e.format,a=e.ppi;"Custom"===o&&(n=ao.getPageCustomSizeFormat(),a=ao.getPageCustomSizePPI());var r=new x({currentExportSize:t,currentFormat:n,currentPPI:a});r.events.subscribe("submit",(function(e){e.exportData.format===n&&t.width===e.exportData.pixelWidth&&t.height===e.exportData.pixelHeight||(Zn(O.DesignSizeLibrary.getCustomSize(e.exportData.width,e.exportData.height,e.exportData.format,e.exportData.ppi)),et.publish("customSizeSet",{dimensions:e.exportData.width+"x"+e.exportData.height+" "+e.exportData.format}))})),r.events.subscribe("cancel",(function(){go.postSideBarUI.sidebarResize.selectDocumentSizeWithId(ao.getDocumentSizeId(),{silent:!0}),et.publish("customSizeCancelled")}))}():Zn(e)}),40);function $n(t,o,n){n.silent||!e(n.target).closest("[class*='tile-shuffle-button']").length&&0!==o||(0===o?ao.setColorPalette(t,{shuffle:!0}).done():ao.shuffleColorPalette().done())}function qn(){const e=$t.model.state;go.sidebarItemProperties.update({state:e,panelName:e.selectedItemType}),go.actionBar.update({state:e}),go.cutoutCursor.update({state:e}),go.layerStack.update({state:e}),go.assetRailUI.assetRail.update({state:e})}function Jn(e){e=e||{};var t,o=ao.getDocumentSizeId();o===Fo&&"Custom"!==o||(Fo=o,go.postSideBarUI.sidebarResize.selectDocumentSizeWithId(ao.getDocumentSizeId(),{silent:!0})),go.navStripUI.tabButtonPalette&&go.navStripUI.tabButtonPalette.isSelected()?(oo.publish("ui:updateCurrentPalette"),go.layerStack.forceUpdateThumbnails(!0)):go.layerStack.forceUpdateThumbnails(e.undoRedo),go.navStripUI.tabButtonTheme&&(t=ao.getThemeId())!==Mo&&(go.postSideBarUI.sidebarTheme.selectThemeWithid(t,{silent:!0}),Mo=t),e.formaAdded&&ia(),go.postSideBarUI.sidebarAnimation&&oo.publish("ui:updateSidebarAnimation"),go.animationPlayButton&&go.animationPlayButton.update({hidden:!ao.hasAnimationStyle()}),$t.handleDocumentUpdated(),Do=!0}function ea(e){Nt.active&&!e.immediate?(Uo||(Uo=d(e=>{Jn(e)},2500)),Uo(e)):Jn(e)}var ta=o.throttle((e,t,o)=>{var n=Date.now();ao.applyDesignTheme(e.docPromise(bo.featureEnabled("post-use-cp-cdn")),e.filterFormae,t,o).then((function(){et.publish("post:designVariationEnd",{contextualData1:"cpId:"+e.cpAssetId,contextualData2:"timeElapsedMs:"+(Date.now()-n),contextualData3:"isShuffle:"+(t>0?"true":"false")})}))},40),oa=o.throttle((e,t,o)=>{e.premium&&!So.isEntitledToFeature("postTypeTemplate")?s.showMerchMessagingModal({workflow:"postTextLockup",asset:i({},e),totalAssets:o,analyticsPage:"editor:post"}):function(e){et.publish("editor:textLockupAdded",{contextualData1:"textLockupType:"+(e.premium?"paid":"free"),contextualData2:"textLockupId:"+e.assetId}),go.designSurface.beginBadgeLoading(),e.manifestPromise().done((function(t){ao.addBadge(t,e.assetId).catch(e=>{lo.error("Ran into error with addBadge",e)}).finally(()=>{go.designSurface.endBadgeLoading()})}))}(e)},40);function na(e){e.data.forma.isTypeLockup()&&go.navStripUI.tabButtonTheme&&go.navStripUI.tabButtonTheme.isSelected()&&go.postSideBarUI.sidebarTheme.setDesigns(ao.getRetargetInfo()),e.selected&&!go.postSideBarUI.sidebarBackground.isHidden()&&go.postSideBarUI.sidebarBackground.updateFilters({whilePanelVisibleOnly:!0,image:ao.getImagePreviewData(ao.getSelectedForma())})}function aa(e){e.duplicatedImage&&ao.updateConstrainedImages(),ia()}function ra(e){sa(),e.deletedImage&&ao.updateConstrainedImages()}function ia(){$t.handleLeaveReplaceMode(),sa()}function sa(){go.navStripUI.tabButtonTheme&&go.navStripUI.tabButtonTheme.isSelected()&&oo.publish("ui:updateListOfDesigns")}function da(){if(_n(!1),$t.handleLeaveReplaceMode(),go.navStripUI.tabButtonPalette&&go.navStripUI.tabButtonPalette.isSelected()){ao.getAllSelectedFormas().length?go.postSideBarUI.sidebarPalette.unbindColorPicker({hidePicker:!0}):go.postSideBarUI.sidebarPalette.rebindColorPicker()}"no-selection"===ao.getSelectedFormaType()&&Ya(),Nt.handleSelectionChanged()}function la(){qt.handleAnnotationsChanged(ao.getFirstAnnotation())}function ca(e){const t=Array.isArray(e.forma)?e.forma[0]:e.forma;go.topBarUI.downloadButton&&go.topBarUI.downloadButton.el.hideDownloadList(),go.sharePostButton&&go.sharePostButton.el.hideMenuDropdown(),go.postSideBarUI.changeImageModalPanel.hide(),go.postSideBarUI.changeIconModalPanel.hide(),go.layerStack.show(),t?(go.legacyRightSidebar.hide(),go.sidebarItemProperties.show(),go.firstMileTour&&go.firstMileTour.rightSidebarOpened(),go.actionBar.show(),ao.inRefineCutoutMode()||ao.inCropMode()?go.layerStack.toggleOff():go.layerStack.toggleOn()):(Ya(),go.sidebarItemProperties.hide(),go.actionBar.hide(),go.layerStack.toggleOff(),Ea())}function ua(){if(!ao.isMultiSelect()){var e=ao.getSelectedForma();e&&(e.isTypeLockup()?Nt.handleDoubleTapToEditText(!0):(e.isImage()&&!e.isLogo()||ao.isIcon(e))&&Gn())}}function pa({backgroundColor:e}){go.errorDialogs.imageCorruptedModal||(go.errorDialogs.imageCorruptedModal=new T({headerText:'\n            <span class="error-modal-header">\n              <span>i18n.dialogs.corruptedDocument.kHeaderText</span>\n              <i class="error-modal-header__icon"></i>\n            </span>\n          ',contentText:`<div class="error-modal-content">\n                <span>i18n.dialogs.corruptedDocument.kContentText</span>\n                <span class="error-modal-content_placeholder-indicator" style="background-color: #${e};"></span>\n              </div>`,dismissable:!0,buttons:[{class:"pill pill-primary-on-light",label:"i18n.dialogs.corruptedDocument.kButtonLabel",onClick:function(){go.errorDialogs.imageCorruptedModal.hide()}}]})),go.errorDialogs.imageCorruptedModal.show()}function ga(){if(go.postSideBarUI.sidebarLayout){var e=go.postSideBarUI.sidebarResize.getSelected(),t=ao.getDocumentSize(),o=ao.getImageSizeIfFullBleed(),n=o&&o.width&&o.height&&Math.atan(o.height/o.width)*(4/Math.PI),a=t&&t.width&&t.height&&Math.atan(t.height/t.width)*(4/Math.PI),r=Math.abs(n-a)<=.01;e&&e.item&&"original"===e.item.data.aspect&&!r&&go.postSideBarUI.sidebarResize.deselectSelected()}}function ma(e){var t,o=b.toLocaleKey(ao.getUndoDescription());o?(t="i18n.actions."+o,go.topBarUI.undo.context&&go.topBarUI.undo.isEnabled()&&go.topBarUI.undo.context["action-name"]===t||go.topBarUI.undo.update({hoverLabel:"i18n.app.kActionLabel",context:{"action-type":"i18n.app.kUndo","action-name":t}}),go.topBarUI.undo.enable()):(go.topBarUI.undo.update({hoverLabel:"i18n.app.kUndo"}),go.topBarUI.undo.disable());var n=b.toLocaleKey(ao.getRedoDescription());n?(t="i18n.actions."+n,go.topBarUI.redo.context&&go.topBarUI.redo.isEnabled()&&go.topBarUI.redo.context["action-name"]===t||go.topBarUI.redo.update({hoverLabel:"i18n.app.kActionLabel",context:{"action-type":"i18n.app.kRedo","action-name":t}}),go.topBarUI.redo.enable()):(go.topBarUI.redo.update({hoverLabel:"i18n.app.kRedo"}),go.topBarUI.redo.disable());const a=ao.getWatermarkEnabledForDoc();go.designSurface.watermarkUI.updateWatermarkStatus(a),function(e){(function(){if(!go.topBarUI.downloadButton)return;const{downloadOptionsList:e,selectedOption:t}=go.topBarUI.getDownloadOptions();go.topBarUI.downloadButton.update({selectedOption:t,optionsList:e})})(),go.designSurface.updatePlaybackButton(e)}(e),bo.featureEnabled("post-pgm-visualizer-messages")&&function(){if(ao){const e=ao.documentSize();window.postMessage({type:"PGM_UPDATED",graphContent:ao.getGraph(!0).encode(),documentId:ao.documentId(),cpServiceDomain:Je.cpServiceDomain,documentSize:{width:e.width,height:e.height}},"*")}}()}function ha(){Sa(),ao.updateConstrainedImages(),ao.validateDoc("undo")}function fa(){Sa(),ao.updateConstrainedImages(),ao.validateDoc("redo")}function ba(e){Oo=!!e.value,Oo?(go.topBarUI.undo.hide(),go.topBarUI.redo.hide(),go.topBarUI.debugMenu&&go.topBarUI.debugMenu.hide()):(go.topBarUI.undo.show(),go.topBarUI.redo.show(),go.topBarUI.debugMenu&&go.topBarUI.debugMenu.show())}function Sa(){go.postSideBarUI.sidebarBackground&&!go.postSideBarUI.sidebarBackground.isHidden()&&go.postSideBarUI.sidebarBackground.selectCurrentColor({silent:!0}),go.postSideBarUI.sidebarIcon&&!go.postSideBarUI.sidebarIcon.isHidden()&&go.postSideBarUI.sidebarIcon.selectCurrentColor({silent:!0}),go.postSideBarUI.sidebarText&&!go.postSideBarUI.sidebarText.isHidden()&&go.postSideBarUI.sidebarText.selectCurrentColor({silent:!0}),go.postSideBarUI.sidebarPalette&&!go.postSideBarUI.sidebarPalette.isHidden()&&go.postSideBarUI.sidebarPalette.selectCurrentPalette({silent:!0})}function Ia(){go.navStripUI.tabButtonPalette.isSelected()&&go.postSideBarUI.sidebarPalette.unbindColorPicker()}function wa(e){var t,o=Q.getImageMediaMetadata(e.info);$t.model._state.isReplaceMode&&(!(t=ao.getSelectedForma())||t.isShape()&&!t.isGridCell()||(t=null)),ao.createFormaFromSVG(e.files[0],o,t),et.publish("editor:iconAdded",{contextualData1:"keyword:"+(e.info.searchText||""),contextualData2:"isReplacing:"+!!t})}function Ba(e){let t,o="null";var n=e.replacementForma&&e.replacementForma.isBackgroundImage();if(e.info){const n=e.files&&e.files[0];n&&n.source?t=n.source:e.info.source?t=e.info.source.name:(lo.debug("unknown source in handleImagePickerItemSelected analytics",e),t="unknown"),void 0!==e.info.searchText&&(o=e.info.searchText)}else t="upload";et.publish("editor:photoAdded",{contextualData1:"source:"+t,contextualData2:"imageLayer:"+(n?"background":"floating"),contextualData3:"keyword:"+o,contextualData4:"isReplacing:"+!!e.replacementForma})}function va(e){var t,o=!!e.replacementForma,n=e.info.searchText,a=e.info.searchFiltersStr,r=e.replacementForma&&e.replacementForma.isBackgroundImage();t="backgrounds"===e.designAssetsPanelId?"editor:backgroundAdded":"editor:assetAdded",n||a||(n="null",a="null");var i={contextualData1:"assetPath:"+e.info.design_intent,contextualData2:"filters:"+a,contextualData3:"isPremium:"+("premium"===e.info.licensingCategory),contextualData4:"keyword:"+n,contextualData5:"assetID:"+e.info.id,contextualData6:"parentPath:"+e.info.directory,contextualData7:"imageLayer:"+(r?"background":"floating"),contextualData8:"isReplacing:"+o};et.publish(t,i)}function Ca(e,t=mt,o=!1,n=!1){let a=$t.model._state.isReplaceMode;if(a||ao.canAddMoreImages(1)){const r=ao.getSelectedForma();if(r&&r.isShape()&&!r.isGridCell()&&(a=!1),a&&(e.replacementForma=r,e.replacementForma&&(e.replacementForma.isLogo()&&!o||o&&!e.replacementForma.isLogo()||e.replacementForma.isTypeLockup()||"Root"===e.replacementForma.kind?e.replacementForma=null:e.replacementFrame=e.replacementForma.finalFrame),!e.replacementForma&&!ao.canAddMoreImages(1)))return void Vn();if(o&&(e.floatingImageStrategy=O.FloatingImageStrategy.IfHasAlphaOrIsLogo),o||null!=e.replacementForma)e.designAssetsPanelId?va(e):o||Ba(e),Pa(e,t);else{if(e.designAssetsPanelId?va(e):Ba(e),!bo.featureEnabled("post-pgm-poster"))return e.floatingImageStrategy=O.FloatingImageStrategy.IfHasAlphaOrIsLogo,void Pa(e,t);e.floatingImageStrategy=n?O.FloatingImageStrategy.Never:O.FloatingImageStrategy.Always,Pa(e,t)}}else Vn()}function Pa(e,t){const o=_t();Lo.push(o.promise);const n=$t.model._state.isReplaceMode;t({coreWrapper:ao,uiStateController:$t,data:e,docSavedDfd:o,component:go,isReplaceMode:n,refreshCurrentBrandElements:Na}).catch(e=>lo.error("Failed to add image",e)),o.promise.then(()=>{if(!zo){const e=Lo.indexOf(o);e>-1&&Lo.splice(e,1)}})}function Ua(e){var t={files:[{source:"adobestock",mimeType:e.newItemInfo.mimeType,original:{link:e.newItemInfo.href,height:e.newItemInfo.height,width:e.newItemInfo.width},preview:{link:e.newItemInfo.href,height:e.newItemInfo.height,width:e.newItemInfo.width},thumbnail:{link:e.newItemInfo.thumb.url,height:e.newItemInfo.thumb.height,width:e.newItemInfo.thumb.width},licenseInfo:e.newItemInfo.info}],info:e.newItemInfo.info};$t.handleEnterReplaceMode(),Ca(t,mt)}function ka(e){if(e&&e.id&&0===e.id.indexOf("bk_")){var t=$e.currentBrandKit(),o=t?t.getTypeForAnalytics():null;et.publish("usedBrandKitPalette",{contextualData3:o})}et.publish("paletteSelected")}function Ta(e,t,o){mo.push(e.events.subscribe(t,o))}function xa(e,t){var o=go.designSurface.poster.$el.offset();return{x:e-o.left,y:t-o.top}}function ya(e,t){const o=xa(e.pageX,e.pageY),n=ao.getViewToDocMatrix().transformPoint(o),a=O.TheoRect.fromSize(ao.getDocumentSize()).locatePoint(n);a.x>=0&&a.x<=1&&a.y>=0&&a.y<=1?go.designSurface.poster.getColorAtPoint({x:Math.round(n.x),y:Math.round(n.y)}).then((function(o){var n=_.rgb2hex(o);"click"===e.type?t.handleEyeDropperClicked(n):t.handleEyeDropperMoved(n,e)})):"click"===e.type?t.handleEyeDropperClicked(!1):t.handleEyeDropperMoved(!1,e)}function Ea(e){(e=e||{}).silent="boolean"==typeof e.silent&&e.silent,$t&&$t.handleLeaveReplaceMode(),go.navStripUI&&go.navStripUI.globalTabsWrapper&&!go.navStripUI.globalTabsWrapper.isActive()&&go.navStripUI.globalTabsWrapper.show(),go.postSideBarUI&&go.navStripUI&&go.navStripUI.tabButtonLayout&&go.navStripUI.tabButtonLayout.isSelected()&&go.postSideBarUI.sidebarLayout.returnFromSelectionState(),go.postSideBarUI&&go.navStripUI&&go.navStripUI.tabButtonPalette&&go.navStripUI.tabButtonPalette.isSelected()&&go.postSideBarUI.sidebarPalette.rebindColorPicker()}async function Da(t){$t=new Qt(ao,$e,bo),po&&ro===io?(go.topBarUI&&go.topBarUI.updateCoreWrapper(ao),go.navStripUI&&go.navStripUI.updateCoreWrapper(ao),go.postSideBarUI&&go.postSideBarUI.updateCoreWrapper(ao),go.sidebarItemProperties&&go.sidebarItemProperties.updateCoreWrapper(ao),go.actionBar&&go.actionBar.updateCoreWrapper(ao),go.cutoutCursor&&go.cutoutCursor.setCoreWrapper(ao),go.layerStack&&(go.layerStack.updateCoreWrapper(ao),go.layerStack.close()),go.firstMileTour&&go.firstMileTour.updateReferences(ao,oo,bo)):await async function(){po=!0;var t=ro===wt.TEMPLATE?"template-mode main-toolbar toolbar":"main-toolbar toolbar";const o=ro===wt.TEMPLATE?"template-mode tutorial-toolbar toolbar":"tutorial-toolbar toolbar";go.postEditorView=new U({id:"PostEditorContent",layout:"rows",parent:go.windowPanel,panels:[{id:"PostTopBar",class:t,size:"66px"},{id:"PostApp",size:"auto"},{id:"PostBottomBar",class:o,size:"0px"}]}),go.topBarUI=new Pt({editingMode:ro,coreWrapper:ao,postFeatureController:bo,events:oo,templateNode:vo,waitForSaveToFinish:Bo.waitForSaveToFinish,waitForQuietSaveToFinish:Bo.waitForQuietSaveToFinish,includesPaidAdobeFonts:co.includesPaidAdobeFonts,templatePublisherModalParent:go.postEditorView,assetSubmitterModalParent:go.postEditorView,getDocumentRendition:e=>go.designSurface.poster.getRendition(e)}),go.postAppSection=new U({layout:"columns",panels:[{id:"PostLeftSidebar",size:"80px"},{id:"PostCanvasSection",size:"auto"},{id:"PostRightSidebar",size:"80px"}],parent:"PostApp"}),go.bottomBarUI=new Ut,go.legacyRightSidebar=new U({layout:"columns",panels:[{id:"PostLegacySidebarContents",size:"280px"},{id:"PostNavStrip",size:"80px"}],parent:"PostRightSidebar"}),go.assetRailSidebar=new U({layout:"columns",panels:[{id:"PostAssetRailStrip",size:"80px"}],parent:"PostLeftSidebar"}),wt.TEMPLATE,go.designSurface=new lt(ao,uo,vt,bo,Po),go.sidebarItemProperties=new L({id:"sidebarItemProperties",parent:"PostRightSidebar",coreWrapper:ao,controller:co,hidden:!0}),go.cutoutCursor=new Gt({id:"cutoutCursor",parent:"PostSelectionFrame",hidden:!0,coreWrapper:ao,controller:co}),go.actionBar=new E({id:"actionBarPopUp",parent:"PostActionLayer",hidden:!0,coreWrapper:ao,controller:co}),go.layerStack=new D({id:"layerStack",parent:"PostActionLayer",hidden:!1,coreWrapper:ao,controller:co}),go.colorPicker=new A({id:"colorPicker",parent:go.postEditorView,top:180,left:10,width:250,height:350,hideBrandkit:!bo.featureEnabled("entitle-brand-kit")}),Zt=new Vt(go.colorPicker,e("#PostEditorContent"),ya),go.postSideBarUI=new Rt({editingMode:ro,previousSelectedFormaId:Ro,events:oo,postFeatureController:bo,coreWrapper:ao,waitForSaveToFinish:Bo.waitForSaveToFinish,waitForQuietSaveToFinish:Bo.waitForQuietSaveToFinish,colorPicker:go.colorPicker,designSurface:go.designSurface}),bo.featureEnabled("post-enable-debug-menu")&&(go.debugView=new F({id:"PostDebugView",parent:"PostCanvasSection"})),go.navStripUI=new eo({events:oo,coreWrapper:ao,postFeatureController:bo,entitlementController:So,ExperimentEngine:ae,editingMode:ro,postEditorView:go.postEditorView}),go.assetRailUI=new to({events:oo,previousSelectedFormaId:Ro,coreWrapper:ao,uiStateController:$t,postFeatureController:bo,entitlementController:So,ExperimentEngine:ae,editingMode:ro,waitForSaveToFinish:Bo.waitForSaveToFinish,waitForQuietSaveToFinish:Bo.waitForQuietSaveToFinish,controller:co,postEditorView:go.postEditorView,designSurface:go.designSurface,userIsPremium:bo.featureEnabled("is-paid-user"),premiumBadgeVariant:"diamond",dragAndDropEnabled:!1}),go.textCapture=new R({parent:go.windowPanel,hidden:!0,updateCharStyleRangesCallback:Bn})}().catch(lo.error),Bo.setComponents({poster:go.designSurface.poster,topBarUI:go.topBarUI}),Io=new tt({doc:ao.getDocument(),am:wo,poster:go.designSurface.poster}),ae.run("preCCXExperiment*",{preCCXExperimentVariant:()=>{go.firstMileTour=new Lt(ao,oo,bo,[go.postAppSection.getPanelById("PostLeftSidebar").el,go.sidebarItemProperties.el],go.bottomBarUI.tourWrapper.el,go.designSurface.posterAdornments.components.zoomPopUp.el,go.designSurface.actionLayer.el,go.topBarUI.helpButton)},control:()=>{}}).done(),go.topBarUI&&go.topBarUI.setExportController(Io),go.assetRailUI&&go.assetRailUI.addContentLogoButton&&go.assetRailUI.updateAddContentLogoButtonEnabledState(),qt=new rt($t),Ta($t,"ui-state-updated",qn),Ta(ao,"design-updated",ea),Ta(ao,"force-ui-state-update",$t.forceUiStateUpdate.bind($t)),Ta(ao,"zoom",Jo),Ta(ao,"forma-updated",na),Ta(ao,"formae-duplicated",aa),Ta(ao,"formae-deleted",ra),Ta(ao,"forma-added",ia),Ta(ao,"forma-selected",ca),Ta(ao,"selection-changed",da),Ta(ao,"selection-changed",$t.handleSelectionChanged.bind($t)),Ta(ao,"update-annotations",la),Ta(ao,"undo-redo-state-changed",ma),Ta(ao,"undo-finished",ha),Ta(ao,"redo-finished",fa),Ta(ao,"ui:disableUndoButtons",ba),Ta(ao,"layer-double-tapped",ua),Ta(ao,"show-image-forma-corrupted-modal",pa),Ta(ao,"current-brand-changed",Va),Ta(ao,"exit-crop-mode",yn),Ta(ao,"show-actionfeedback-message-modal",En),Ta(ao,"enter-char-style-mode",In),Ta(ao,"exit-char-style-mode",wn),Ta(ao,"exit-refine-cutout-mode",$a),Ta(ao,"force-reload-editor",Bo.handleForceReloadRequest),Ta(ao,"update-save-promise",Bo.handleUpdateSaveRequest),Ta(ao,"clean-up-after-save",Bo.cleanUpAfterSave),Ta(ao,"trigger-save",Bo.handlePlatformSaveTriggered),Ta(ao,"show-remove-background-toast",Mn),ao.bindToSaveManager(),Ta(ao,"close-all-panels",(function(){oo.publish("ui:closeActiveAssetPanel"),Ya()})),Ta(go.actionBar,"buttonpress-change-photo",co.handleReplaceImageButtonPress),Ta(go.actionBar,"buttonpress-duplicate",Cn),Ta(go.actionBar,"buttonpress-delete",Rn),Ta(go.actionBar,"buttonpress-group",Ln),Ta(go.actionBar,"buttonpress-ungroup",zn),Ta(go.actionBar,"stock-image-licensed",Ua),Ta(go.designSurface.posterAdornments,"buttonpress-duplicate",Cn),Ta(go.designSurface.posterAdornments,"buttonpress-delete",Rn),Ta(go.designSurface.posterAdornments,"buttonpress-group",Ln),Ta(go.designSurface.posterAdornments,"buttonpress-ungroup",zn),Ta(go.designSurface.posterAdornments,"buttonpress-addText",vn),Ta(go.designSurface.posterAdornments,"buttonpress-change-photo",Gn),Ta(go.designSurface.posterAdornments,"buttonpress-logo",Xn),Ta(go.designSurface.posterAdornments,"update-swap-thumbnail",Wn),Ta(go.designSurface.posterAdornments,"remove-swap-thumbnail",Nn),Ta(go.designSurface.posterAdornments,"handle-drag",jn),Ta(go.designSurface.posterAdornments,"handle-double-tap",ua),Ta(go.designSurface.posterAdornments,"stock-image-licensed",Ua),Ta(go.designSurface.posterAdornments,"post-interaction-layer-clicked",(function(){go.topBarUI.docNameInput.$el.is(":focus")&&go.topBarUI.docNameInput.blur(),go.topBarUI.downloadButton&&go.topBarUI.downloadButton.el.hideDownloadList(),go.topBarUI.helpButton&&go.topBarUI.helpButton.closeMenu(),go.topBarUI.sharePostButton&&go.topBarUI.sharePostButton.el.hideMenuDropdown(),go.designSurface.posterAdornments&&go.designSurface.posterAdornments.closeZoomComboBox(),go.fontPicker&&!go.fontPicker.isHidden()&&go.fontPicker.hide(),Zt.hide()})),Ta(go.postSideBarUI.sidebarText,"buttonpress-delete",Rn),Ta(go.postSideBarUI.sidebarText,"buttonpress-addText",vn),Ta(go.postSideBarUI.sidebarText,"get-new-brandkit-colors",za),Ta(go.postSideBarUI.sidebarText,"eyedropper-changed",(function(e){ya(e,go.postSideBarUI.sidebarText)})),Ta(go.postSideBarUI.sidebarText,"buttonpress-close",Ea),Ta(go.postSideBarUI.sidebarText,"size-slide-start",go.designSurface.posterAdornments.hideSelectionBox),Ta(go.postSideBarUI.sidebarText,"size-slide-end",go.designSurface.posterAdornments.showSelectionBox),Ta(go.designSurface.poster,"rendered-image-layer-url-changed",ga),Ta(go.postSideBarUI.sidebarTheme,"item-selected",ta),Ta(go.postSideBarUI.sidebarTheme,"brand-button-pressed",Fa),Ta(go.postSideBarUI.sidebarTheme,"theme-panel-title-bar-close",Ya),Ta(go.postSideBarUI.sidebarBackground,"buttonpress-change-photo",Gn),Ta(go.postSideBarUI.sidebarBackground,"buttonpress-add-photo",Kn),Ta(go.postSideBarUI.sidebarBackground,"filter-selected",(function(e,t,o){ao.setImageFilterForSelection(e,t,o).done()})),Ta(go.postSideBarUI.sidebarBackground,"bg-color-selected",(function(e){ao.setColorForSelection(e).done()})),Ta(go.postSideBarUI.sidebarBackground,"image-forma-replace-with-color",ao.updateConstrainedImages),Ta(go.postSideBarUI.sidebarBackground,"eyedropper-changed",(function(e){ya(e,go.postSideBarUI.sidebarBackground)})),Ta(go.postSideBarUI.sidebarBackground,"buttonpress-close",Ea),Ta(go.postSideBarUI.sidebarBackground,"buttonpress-set-foreground",Dn),Ta(go.postSideBarUI.sidebarBackground,"buttonpress-set-background",An),Ta(go.postSideBarUI.sidebarBackground,"buttonpress-crop",Pn),Ta(go.postSideBarUI.sidebarLayout,"grid-item-selected",Yn),Ta(go.postSideBarUI.sidebarLayout,"layout-panel-title-bar-close",Ya),Ta(go.postSideBarUI.sidebarResize,"size-item-selected",Qn),Ta(go.postSideBarUI.sidebarResize,"resize-panel-title-bar-close",Ya),Ta(go.postSideBarUI.sidebarPalette,"item-selected",$n),Ta(go.postSideBarUI.sidebarPalette,"item-selected",ka),Ta(go.postSideBarUI.sidebarPalette,"eyedropper-changed",(function(e){ya(e,go.postSideBarUI.sidebarPalette)})),Ta(go.postSideBarUI.sidebarPalette,"update-palette-color",(function(e,t){ao.updateColorInTheme(e,t).done()})),Ta(go.postSideBarUI.sidebarPalette,"color-panel-title-bar-close",Ya),Ta(go.postSideBarUI.sidebarIcon,"buttonpress-replace-icon",Gn),Ta(go.postSideBarUI.sidebarIcon,"icon-color-selected",(function(e,t){ao.setColorForSelection(e,t).done()})),Ta(go.postSideBarUI.sidebarIcon,"hide-icon-picker",(function(){go.postSideBarUI.changeIconModalPanel.hide()})),Ta(go.postSideBarUI.sidebarIcon,"eyedropper-changed",(function(e){ya(e,go.postSideBarUI.sidebarIcon)})),Ta(go.postSideBarUI.sidebarCrop,"crop-shape-selected",kn),Ta(go.postSideBarUI.sidebarCrop,"crop-aspect-ratio-selected",Un),Ta(go.postSideBarUI.sidebarCrop,"close-crop-picker",Tn),Ta(go.postSideBarUI.sidebarBackground,"hide-image-picker",(function(){go.postSideBarUI.changeImageModalPanel.hide()})),Ta(go.assetRailUI.iconPicker,"item-selected",wa),Ta(go.assetRailUI.libImagePicker,"item-selected",Ca),Ta(go.assetRailUI.imagePicker,"item-selected",Ca),Ta(go.assetRailUI.designAssetsControllers.designAssets,"item-selected",Ca),Ta(go.assetRailUI.designAssetsControllers.backgrounds,"item-selected",Ca),Ta(go.assetRailUI.addTextSidebar,"badge-selected",oa),Ta(go.assetRailUI.addTextSidebar,"close-buttonpress",Ea),Ta(go.colorPicker,"brand-color-added",za),Ta(go.colorPicker,"colorChangeModal",(function(e){"begin"===e.type&&(xo?(ao.endBranch(!0),ao.beginBranch()):(xo=!0,ao.beginBranch()))})),Ta(go.designSurface.posterAdornments,"post-interaction-layer-pointer-down",(function(){xo&&(ao.endBranch(!0),xo=!1)})),go.postSideBarUI.brandIndicator&&Ta(go.postSideBarUI.brandIndicator,"switch-brand",No),go.postSideBarUI.sidebarAnimation&&(Ta(go.postSideBarUI.sidebarAnimation,"animation-loading-begin",go.designSurface.handleAnimationLoadingBegin),Ta(go.postSideBarUI.sidebarAnimation,"animation-loading-end",go.designSurface.handleAnimationLoadingEnd),Ta(go.postSideBarUI.sidebarAnimation,"animation-panel-title-bar-close",Ya)),go.postAppSection&&Ta(go.postAppSection,"change:size",Za),Ta(go.navStripUI.tabButtonPalette,"deselect",Qa),po&&(ca({forma:null}),go.navStripUI.globalTabsWrapper.hide(),$t.handleSelectionChanged()),Bo.resumeSave();const{operation:n}=Co;if("new"!==n&&"remix"!==n&&"new-from-template"!==n&&"new-template-from-template"!==n||Bo.requestSave(!1,!0),go.postSideBarUI.imagePicker&&go.postSideBarUI.imagePicker.home(),ro===wt.TEMPLATE?go.topBarUI.topColorStrip.$el.css({background:"#ffffff"}):go.topBarUI.topColorStrip.$el.css({background:"#10c459"}),go.topBarUI.collabStatusButton){var i=r.currentDoc.getCollaboration()&&"NONE"!==r.currentDoc.getCollaboration();go.topBarUI.updateCollabStatusButton(i)}Ct(ao,vt),ro!==wt.TEMPLATE&&(t.showShareButton?go.topBarUI.sharePostButton.show():go.topBarUI.sharePostButton.hide(),t.showDownloadButton?go.topBarUI.downloadButton.show():go.topBarUI.downloadButton.hide()),go.postSideBarUI.sidebarTheme.setCoreWrapper(ao),go.postSideBarUI.sidebarText.setCoreWrapper(ao),go.postSideBarUI.sidebarBackground.setCoreWrapper(ao),go.postSideBarUI.sidebarIcon.setCoreWrapper(ao),go.postSideBarUI.sidebarMultiselect.setCoreWrapper(ao),go.postSideBarUI.sidebarGroup.setCoreWrapper(ao),go.postSideBarUI.sidebarLayout.setCoreWrapper(ao),go.postSideBarUI.sidebarLayout.deselectSelected(),go.postSideBarUI.sidebarCrop.setCoreWrapper(ao),go.postSideBarUI.sidebarResize.setCoreWrapper(ao),go.cutoutCursor.setCoreWrapper(ao),go.postSideBarUI.sidebarResize.deselectSelected(),go.postSideBarUI.sidebarAnimation&&go.postSideBarUI.sidebarAnimation.setCoreWrapper(ao),go.debugView&&go.debugView.setCoreWrapper(ao),Nt.initialize(ao,$t),jt.setCoreWrapper(ao),jt.setAdvancedTextLayoutEnabled(!0),jt.setAdvancedTextLayoutEnableBoundingBoxArea(bo.featureEnabled("post-enable-bounding-box-area")),go.postEditorView.show(),go.windowPanel.resize(),go.assetRailUI.setUiStateController($t),go.assetRailUI.sidebarTemplates&&(Co.projectContext||(Co.projectContext=r.getProjectContexts()),go.assetRailUI.sidebarTemplates.setupSessionData(Co,r.currentDoc,ko,wo.remixParentAnalyticsMetadata,bo.featureEnabled("is-paid-user")),go.assetRailUI.sidebarTemplates.setCoreWrapper(ao)),Xt.mark(Yt.initialPosterRenderStart);var s=t.startingMenu,d=go.assetRailUI.ifValidPanelId(s);const l=go.designSurface.poster.events.subscribe("rendered",(function(){const e=ao.imageFormas().length;"new"===n?Xt.measure(Yt.startFromScratchComplete,{detail:{numImages:e},start:Yt.startFromScratch}):"remix"===n&&Xt.measure(Yt.templateRemixComplete,Yt.templateRemix),Xt.measure(Yt.initialPosterRenderComplete,{start:Yt.initialPosterRenderStart,detail:{numImages:e,editorOperation:n}}),go.assetRailUI.sidebarTemplates&&go.assetRailUI.sidebarTemplates.events.publish("poster-initial-render-end"),d&&go.assetRailUI.openPanel({appConfig:Co,id:s}),l.remove()}));go.designSurface.initializeComponents(ao,uo);const c=go.designSurface.posterAdornments.getRefineCutoutGestureVisualizationCanvas();var u,p;c&&(Jt=new Wt(c,ao)),go.postSideBarUI.brandIndicator&&go.postSideBarUI.brandIndicator.update({collaborationStatus:r.currentDoc.getCollaboration()||"NONE",isEntitled:bo.featureEnabled("entitle-brand-kit"),getAllSharedBrands:a.getAllSharedBrands}),go.postSideBarUI.sidebarBackground.update(),go.designSurface.watermarkUI.updateWatermarkStatus(uo,!0),d&&delete t.startingMenu,ro===wt.TEMPLATE?(go.navStripUI.tabButtonResize.select(),u=Mt.getTemplateName(vo),p=b.translate("app.kDefaultTemplateName")):(t.startingMenu?"colors"===t.startingMenu?go.navStripUI.tabButtonPalette.select():"layout"===t.startingMenu?go.navStripUI.tabButtonLayout.select():"resize"===t.startingMenu?go.navStripUI.tabButtonResize.select():go.navStripUI.tabButtonTheme.select():t.showImageModalPanelOnload?(go.navStripUI.tabButtonBackgroundImage.select(),go.postSideBarUI.changeImageModalPanel.show()):"remix"===Co.operation||"new-from-template"===Co.operation?go.navStripUI.tabButtonLayout.select():go.navStripUI.tabButtonTheme.select(),u=ao.getDocument().documentName,p=b.translate("app.kDefaultDocName")),go.topBarUI.docNameInput&&((u=u||p)===p?(go.topBarUI.docNameInput.$el.addClass("placeholder"),go.topBarUI.docNameInput.$el.removeClass("named")):(go.topBarUI.docNameInput.$el.removeClass("placeholder"),go.topBarUI.docNameInput.$el.addClass("named")),go.topBarUI.docNameInput.setText(u));(parseInt(window.marvel.features.getFeature("post-libraries-usage-count"),10)||0)>2&&o.delay((function(){oo.publish("ui:handleHideLibrariesNewFlag")}),1),window.addEventListener("resize",(function(e){go.designSurface.posterAdornments.handleWindowResize(),go.designSurface.watermarkUI.updateWatermarkDiscoverabilityComponents()})),ma({atShowEditor:!0}),go.topBarUI.resetTemplatePublisherForm()}function Aa(e){const o=$e.getCurrentBrandElements();if(!o||!o.activated)return t.resolve(null);e||o.coreBrand||Ma(o),go.designSurface&&go.designSurface.beginImageLoading();let n;return(e?qe.getLiteCoreBrand(o):Promise.resolve(o.coreBrand)).then(e=>{n=e;return o.belongsToUser||o.isSharedWithUser?$e.checkForRestrictedFonts():t.resolve([])}).then(Hn).then(()=>n?ao.brandDocument(n):t.resolve()).then(()=>{go.designSurface&&go.designSurface.endImageLoading()}).catch(e=>{if(go.designSurface&&go.designSurface.endImageLoading(),e&&e.brandFontsVerificationFailed)return t.resolve();const o=e&&e.message?": "+e.message:"";return lo.error("brandDocument error "+o,e),t.resolve()})}function Fa(e){const t=$e.getCurrentBrandElements();"INCOMING"!==r.currentDoc.getCollaboration()||t&&(!t||!1!==t.showBrandInUI)?t&&t.activated?(Aa(),et.publish("brandifyApplied")):window.marvel.events.trigger("spark-post-show-brandify-onboarding",{element:e.$element}):de.showAlert(b.translate("dialogs.brandifySharedProjectAlert.kHeaderText"),b.translate("dialogs.brandifySharedProjectAlert.kContentText"),{okText:b.translate("dialogs.brandifySharedProjectAlert.kButtonLabel")})}function Ma(e){if(e&&e.coreBrand)return O.Host.setAuthoringContext(e.coreBrand),e.coreBrand;O.Host.setAuthoringContext(null)}function Ra(e){go.assetRailUI&&(e&&e.primaryLogoPromise?go.assetRailUI.updateListOfBrandKitLogos(e):go.assetRailUI.updateListOfBrandKitLogos([]))}function La(e){var t=e&&e.activated?e:null;go.postSideBarUI.sidebarPalette&&go.postSideBarUI.sidebarPalette.setListOfBrandKitPalettes(t),go.postSideBarUI.sidebarText&&go.postSideBarUI.sidebarText.setBrandKitColors(ao.getBrandKitColorsPalettesForSelectedLockup(t)),go.postSideBarUI.sidebarBackground&&go.postSideBarUI.sidebarBackground.setBrandKitColors(t),go.postSideBarUI.sidebarIcon&&go.postSideBarUI.sidebarIcon.setBrandKitColors(t),go.colorPicker&&go.colorPicker.update({authoringContext:$e.currentBrandKit(),brandColors:t&&t.colors||[]})}function za(){!function(e){const o=$e.getCurrentBrandElements();!bo.featureEnabled("entitle-brand-kit")||o&&!1===o.showBrandInUI?t():$e.refreshBrandColors().then((function(t){Ma(t),e&&La(t)}))}(!0)}function Oa(e){e=e||$e.getCurrentBrandElements();const t=$e.currentBrandKit();let o=e;e&&!1===e.showBrandInUI&&(o=null),Ra(o),La(o),go.postSideBarUI.sidebarText&&go.postSideBarUI.sidebarText.setBrandkit(e&&!1!==e.showBrandInUI?t:null),go.postSideBarUI.sidebarTheme&&go.postSideBarUI.sidebarTheme.setBrandKitThemes(o),go.postSideBarUI.brandIndicator&&go.postSideBarUI.brandIndicator.setBrand(e,t);bo.featureEnabled("entitle-brand-kit")?go.colorPicker.setEntitlement(!0):go.colorPicker.setEntitlement(!1)}function Wa(e,t){Ma(e),t&&Oa(e)}function Na(e,o){return $e.refreshCachedCurrentBrandElements().then(_a(o,t=>{Wa(t,e)})).catch(e=>{if(e&&e.message===Bt.STALE_SESSION)return t.reject(e);lo.error("refreshCurrentBrandElements: "+e)})}function ja(e,o=!0){const n=$e.switchCurrentAuthoringContext(e).then(e=>{if(Wa(e,!0),o){return(e.belongsToUser||e.isSharedWithUser?$e.checkForRestrictedFonts():t.resolve([])).then(Hn).then(()=>(de.showWaitView(b.translate("dialogs.brandLoadSpinner.kHeaderText"),b.translate("dialogs.brandLoadSpinner.kContentText")),ao.changeBranding(e.coreBrand)))}});return pt(n,3e5).catch(e=>{const o=e?e.message:"";return de.showAlert(b.translate("dialogs.switchBrandFailureAlert.kHeaderText"),b.translate("dialogs.switchBrandFailureAlert.kContentText"),{okText:b.translate("dialogs.switchBrandFailureAlert.kButtonLabel")}),lo.error("switchBrand error: "+o,e),t.reject()})}function Va(e){e!==($e.getCurrentBrandElements()&&$e.getCurrentBrandElements().id)&&ja(e,!1)}function Ha(e,t){var o="/";if("organizer"===t?o+="projects":"create_brand"===t&&(o+="branding/create"),xo=!1,!Bo)return void window.marvel.navigate(o,{trigger:!0});if(Ao=!0,e="boolean"==typeof e&&e)Bo.cancelPendingCoreSaves(),Bo.resolveSaveDeferred();else{if(Ka())return Bo.cancelPendingCoreSaves(),void Ga({returnPath:o});Bo.executePendingCoreSaves()}zo=!0;const n=Lo.length>0;let a=null;if(n){const e="i18n.dialogs.waitImageLoading.kHeaderText",t=Lo.length>1?"i18n.dialogs.waitImageLoading.kMultipleImagesMessage":"i18n.dialogs.waitImageLoading.kOneImageMessage";a=new T({id:"WaitForSaveOverlay",headerText:e,contentText:`<div><p>${t}</p><div class="postspinner postspinner-small"></div></div>`,dismissable:!1}),a.show()}Promise.allSettled(Lo).then(()=>{Lo=[],zo=!1,a&&a.hide(),Bo.waitForSaveToFinish().then((function(){ao&&ao.willCloseDocument(),window.marvel.navigate(o,{trigger:!0})}))})}function Ka(){return"new"===Co.operation&&"blank"===Co.workflow&&!Do}function Ga(e){e=e||{};const o=t.defer(),n=new T({headerText:"i18n.dialogs.saveNonDirtyNewBlank.kHeaderText",contentText:"i18n.dialogs.saveNonDirtyNewBlank.kContentText",dismissable:!0,onDismissed:function(){o.resolve({dismissed:!0})},buttons:[{class:"pill pill-primary-on-dark",label:"i18n.dialogs.saveNonDirtyNewBlank.kDontSave",onClick:function(){n.hide(),o.resolve(!1)}},{class:"pill pill-secondary-on-light",label:"i18n.dialogs.saveNonDirtyNewBlank.kSaveProject",onClick:function(){n.hide(),o.resolve(!0)}}]});o.promise.then((function(o){if(!o.dismissed)if(Bo.requestSave(!0),o)Bo.waitForQuietSaveToFinish().then((function(){e.returnPath?window.marvel.navigate(e.returnPath,{trigger:!0}):e.defer&&e.defer.resolve()}));else{const o=new T({headerText:"i18n.dialogs.saveNonDirtyNewBlank.kDeleteProgress",contentText:'<div class="postspinner postspinner-small"></div>',dismissable:!1});o.show();const n=function(){o.hide()};window.marvel.events.once("design-view-unloading",n),Bo.waitForQuietSaveToFinish().then((function(){const o=t.defer();window.marvel.events.trigger("delete-current-doc",{doc:r.currentDoc,defer:o}),o.promise.then((function(){e.returnPath?window.marvel.navigate(e.returnPath,{trigger:!0}):e.defer&&e.defer.resolve()}))}))}}))}function _a(e,o){var n=this;return function(){if(!co.enabled||"number"==typeof e&&e!==ho)return t.reject(new Error(Bt.STALE_SESSION));var a=[].slice.apply(arguments);try{var r=o.apply(n,a);return r}catch(e){return t.reject(e)}}}function Xa(e){if("new"===Co.operation?Xt.measure(Yt.startFromScratchComplete,Yt.startFromScratch):"remix"===Co.operation&&Xt.measure(Yt.templateRemixComplete,Yt.templateRemix),e&&e.message===Bt.STALE_SESSION)return lo.warn("Abandoning stale session. May be benign."),void(co.enabled||window.marvel.events.trigger("hide-interstitial"));window.marvel.events.trigger("hide-interstitial"),!e||e.userCanceledNPW||e.doNotLog||e.isWebGLUnavailable?(e&&e.isWebGLUnavailable&&lo.warn("Failed to enable Post editor due to WebGL unavailability"),Ha(!0)):(e.url=window.location.href,lo.error("error enabling Post editor",e),go.windowPanel.show(),go.errorDialogs.enableEditorErrorModal=se(e,()=>{Ha(!0)}))}function Ya(){go.legacyRightSidebar.show(),go.navStripUI.deselectSelectedTabs();const e=go.legacyRightSidebar.getPanelById("PostLegacySidebarContents");e&&e.hide();const t=go.postAppSection.getPanelById("PostRightSidebar");t&&t.update({width:80}),go.sidebarItemProperties.hide()}function Za(){const e=go.legacyRightSidebar.getPanelById("PostLegacySidebarContents");if(e){e.isHidden()||(e.hide(),this.windowResizeTimout&&clearTimeout(this.windowResizeTimeout),this.windowResizeTimeout=setTimeout(()=>{const t=go.postAppSection.getPanelById("PostRightSidebar");t&&t.update({width:320}),e&&e.show()},200))}}function Qa(){go.navStripUI.tabButtonPalette&&!go.navStripUI.tabButtonPalette.isSelected()&&go.postSideBarUI.sidebarPalette.unbindColorPicker({hidePicker:!0})}function $a(){qa(!1)}function qa(e){go.topBarUI.onRefineCutoutModeChanged(e);const t=go.postAppSection.getPanelById("PostLeftSidebar");t&&t.$el.toggleClass("hidden",e),e?(go.layerStack.enterCropOrRefineCutoutMode(),oo.publish("ui:closeActiveAssetPanel")):go.layerStack.exitCropOrRefineCutoutMode(),go.designSurface.updatePlaybackButton({})}return co.handleAnnotationClicked=()=>{const e=ao.getFirstAnnotation();e?qt.handleAnnotationClicked(e):lo.warn("Annotation clicked when none exists")},co.enable=function(e,n){"remix"===n.operation&&Xt.mark(Yt.templateRemix),"keys=collage"===n.search&&go.firstMileTour&&go.postEditorView.hide(),"keys=collage"===n.search&&go.firstMileTour&&go.postEditorView.hide(),wo=new ot;var a=++ho;function i(e=!1){if(a!==ho||!0===e||!co.enabled)throw new Error(Bt.STALE_SESSION)}if(!e)return;go.errorDialogs.fontMissingNoticeModal&&go.errorDialogs.fontMissingNoticeModal.hide(),no=e,go.windowPanel?go.windowPanel.update({parentDomElement:no,hidden:!0}):go.windowPanel=new C({id:"PostWindowPanel",parentDomElement:no,hidden:!0});const s=new kt;s.start();var d,l=0,c="new"===(Co=n).operation;io=ro,ro=wt.DOCUMENT,"edit-template"===Co.operation&&(ro=wt.TEMPLATE),co.enabled=!0;var u=St(bo);Xt.mark(Yt.startup);var p=t.allSettled([Bo?Bo.saveDocumentDeferred:t.resolve(),bo.loadFeatures()]);m.doSerial([p,function(){return b.initLocalization(b.sparkSelectedLocale)}]).then(_a(a,(function(){const e=bo.featureEnabled("entitle-brand-kit");return xt.listenToMarvelEvents(Co,go,e,Wo),O.Host.setFeatureController(bo),Je.useCpCdn=bo.featureEnabled("post-use-cp-cdn"),Co.projectContext&&!Co.projectContextSection&&n.section&&(Co.projectContext.section=n.section),Et(go,Co,e,Co.projectContext||r.getProjectContexts(),wo,i)}))).then(_a(a,()=>ft(go))).then(_a(a,(function(){if(!c)return t.resolve();go.newPostWorkflow||(go.newPostWorkflow=new it({parent:go.windowPanel})),et.publish("newProjectWorkflowLoaded");var e=Date.now(),o=go.newPostWorkflow.prompt(n);return go.windowPanel.show(),o.then((function(t){c&&Xt.mark(Yt.startFromScratch),ko=d=t,l=Date.now()-e,window.marvel.events.trigger("show-interstitial",{typeName:"post"})}))}))).then(_a(a,(function(){return bt(Co,bo,i)}))).then(_a(a,(function(){const[e,t]=Ft(go,fo.promise);return t.then(e=>{e?ao&&ao.replaceMissingFonts():Ha(!0)}),e}))).then(_a(a,()=>Na(!1,a))).then(_a(a,async()=>{({coreWrapper:ao,templateNode:vo}=await Ot({appConfig:Co,templateNode:vo,validateSession:i,useCpCdn:bo.featureEnabled("post-use-cp-cdn")})),Bo=new ut(ao,ro,Co.operation,bo,vo),O.Host.setCoreWrapper(ao),O.FormaToPGMUtils.cpEnv=Co.cpServiceDomain===window.marvel.settings.cpsStage?"stage":"prod",ao.validateDoc("open"),wo.setDocument(ao.getDocument()),fo.resolve(ao)})).then(_a(a,async()=>{const e=!!$t&&$t.model._state.isReplaceMode;await Dt({appConfig:Co,newPostParams:d,queryParams:n,isReplaceMode:e,coreWrapper:ao,component:go,addNewImage:mt,brandDocument:Aa,validateSession:i})&&(Do=!0)})).then(_a(a,(function(){var e="remix"===Co.operation,o="new-from-template"===Co.operation,n=Co.cpServiceDomain||"cc-api-cp.adobe.io",i=ao.getRemixParentsCpIds(),s=Co.cpAssetId||(i?i[i.length-1]:null),d=o?Co.templateId:ao.getAuthoringContextThemeId();return o&&ao.setAuthoringContextThemeId(Co.templateId),wo.getRemixParentCPMetadata(s,n,!!d).then(_a(a,(function(t){e&&(r.currentDoc.name="",ao.setRemixParentCpId(t.templateId))}))).catch((function(o){return o&&o.message===Bt.STALE_SESSION||e?t.reject(o):(lo.warn("Failed to get parent CP metadata for a non-remix flow",o),t.resolve())}))}))).then(_a(a,()=>yt(go,Co,ao))).then(_a(a,(async function(){({isWatermarkEnabled:uo,dismissedWatermarkCoachmark:Po}=await It(u,Co,bo,ao,i))}))).then(_a(a,(function(){ao.resetUserActions(),ao.monitorTransactions(),Da(function(e){e=e||{};var t=Eo.default;if(e.workflow&&Eo.hasOwnProperty(e.workflow)&&(t=o.clone(Eo[e.workflow])),e.startingMenu&&e.workflow!==_e.WorkflowType.QUICKACTION&&(t.startingMenu=e.startingMenu),!t.isDefault&&e.buttons){var n=e.buttons;n.indexOf("facebook_upload")>=0&&(t.showFacebookUploadButton=!0),n.indexOf("share")>=0&&(t.showShareButton=!0),n.indexOf("download")>=0&&(t.showDownloadButton=!0)}return o.each(yo,(function(n){var a;o.isUndefined(e[n])||(a="true"===e[n]||"false"!==e[n]&&e[n],t[n]=a)})),t}(n)).then(_a(a,()=>{const{workflow:e,assetStorageKey:t}=n,{operation:o}=Co;if(t&&c&&e===_e.WorkflowType.START_FROM_ASSET&&function(e){const t=Qe.getUserSelectedAsset(e,bo.featureEnabled("is-paid-user"));t&&Ca(t,mt,!1,!0)}(t),ro===wt.TEMPLATE&&(so={templateName:Mt.getTemplateName(vo)}),go.windowPanel.show(),window.marvel.events.trigger("hide-interstitial"),go.firstMileTour&&!window.marvel.features.hasFeature("first-mile-tour-completed")&&go.firstMileTour.startTour(),Oa($e.getCurrentBrandElements()),e===_e.WorkflowType.QUICKACTION||"remix"!==o&&"new-from-template"!==o&&"new"!==o||(go.navStripUI&&go.navStripUI.globalTabsWrapper.show({silent:!0,noSelect:!0}),Ya()),e===_e.WorkflowType.QUICKACTION){const e=ao.imageFormas();e&&e.length&&ao.selectForma({forma:e[0]})}})).catch(lo.error)}))).then(_a(a,(function(){Tt(Co,wo,ao),window.marvel.events.trigger("editor-displayed",{appName:"post"}),s.end(Co,l,po),st.startListening({handleSelectAll:ao.selectAll,handleDeselectAll:ao.deselectAll,handleUndo:jo,handleRedo:Vo,handlePanOn:rn,handlePanOff:sn,handleZoomIn:ln,handleZoomOut:cn,handleZoomFit:un,handleZoomFill:pn,handleZoomActualSize:gn,handlePanView:mn,canHandleUndo:hn,canUpdateSelection:fn,canUpdateZoom:bn}),At(Co,go,ao)}))).catch(Xa).done()},co.getMetadataForExportAnalytics=function(e,t){return wo.getMetadataForExportAnalytics(e,t,Co.projectContext||r.getProjectContexts())},co.disable=function(){co.enabled=!1,$e.resetBrandCaches(),vo=null,so=null,Do=!1,ko=null,Object.keys(go.errorDialogs).forEach(e=>go.errorDialogs[e].hide()),Ea({silent:!0}),go.windowPanel&&go.windowPanel.hide(),$t&&($t.destroy(),$t=null),fo=t.defer();(Bo?t(Bo.waitForSaveToFinish(!1)):t()).then(()=>{go.designSurface&&go.designSurface.poster.update({core:null}),go.designSurface&&go.designSurface.posterAdornments.disable(),Jt&&(Jt.destroy(),Jt=void 0),go.postEditorView&&go.postEditorView.hide(),go.newPostWorkflow&&go.newPostWorkflow.hide(),xt.unlistenToMarvelEvents(),function(){for(var e=0;e<mo.length;e++)mo[e].remove();mo=[]}(),st.stopListening()})},co.handleUnload=function(){if(!ao)return t();const e=ao.getDocument();if(!e)return t();const o=Y.getAllStringForFormaUsedWheelSuggestions(e);return o.length>0&&et.publish("lockupStyleCaptured",{contextualData1:"styleString:"+o,contextualData2:"location:EditorClose"}),ao.exitSpecialSelectionMode(!1).then(()=>{if(!Ao&&Ka()){var e=t.defer();return Ga({defer:e}),e.promise}return Ao=!1,Fn=!1,Xe.endWatchTabVisibility(),Bo?t(Bo.waitForSaveToFinish()):t()})},co.getCurrentDocumentSynthesizedName=function(){return ao.getCurrentDocumentSynthesizedName()},co.getCurrentDocumentDescription=function(){return ao.getCurrentDocumentDescription()},co.getRemixAncestorsIntoMachineTags=function(e){return ao.getRemixAncestorsIntoMachineTags(e)},co.getDocumentSize=function(){return ao.getDocumentSize()},co.getCoreWrapperPromise=function(){return fo.promise},co.saveAsCopyToTemplate=function(){var e,t;return go.designSurface.poster.getRendition({width:500,imageQuality:.75}).then((function(e){return t=e,a.getController()})).then((function(e){return e.getDefaultBrand()})).then((function(t){if(!(e=t))throw new Error("No current BrandKit.");return Mt.createEmptyPostTemplate(e)})).then((function(o){var n=te.toTemplateExternal(e,o,te.CommitChanges.AUTO);return ao.saveCopyWithRenditions(n,null,t)}))},co.getDownloadImageBlobPromise=function(e,t,o){return co.enabled?Io.generateImageBlob(t,o):tt.generateImageBlobHeadless(t,e,n)},co.getPgmGraphForPublish=function(){return dt.getPgmGraphForPublish(ao)},co.hasAnimationStyle=function(){return!!ao&&ao.hasAnimationStyle()},co.webAnimationEnabled=function(){return vt},co.getCompositeSynthesizedDescription=function(e,t){var o;return Kt.getHeadless({authoringContextId:t.getAuthoringContextId(e)}).then((function(){var t=ee.fromDocument(e),n=new oe;return(o=new f({persistSource:t,persistSave:n})).whenInitialized()})).then((function(){return o.getCurrentDocumentDescription()}))},co.getCompositeImageFiles=function(e){var o;return Kt.getHeadless().then((function(){var t=ee.fromDocument(e),n=new oe;return(o=new f({persistSource:t,persistSave:n})).whenInitialized()})).then((function(){var e=o.imageFormas(),n=[];e.forEach((function(e){n.push(ct.load(Je.decodeUrl(e.contentNode.url)))}));var a=[];return t.all(n).then((function(){for(var e=[],o=[],n=0;n<arguments[0].length;n++){var r=arguments[0][n];if(r instanceof HTMLImageElement){o.push(r.src);var i=r.src.substring(r.src.lastIndexOf("=")+1),s=Z.createCanvas(r);e.push(Z.canvasToBlob(s,i))}}return t.all(e).then((function(){for(var e=0;e<arguments[0].length;e++){var t=arguments[0][e],n=new RegExp(/asset_id=([^&]*)/),r=n.exec(o[e])[1],i=o[e].substring(o[e].lastIndexOf("/")+1);a.push({name:r+"."+i,assetId:r,blob:t})}return a})).catch((function(e){lo.error("getCompositeImageFiles fail-1",e)}))})).catch((function(e){lo.error("getCompositeImageFiles fail-2",e)}))}))},co.includesUploadedFonts=function(){return!!ao&&ao.includesUploadedFonts()},co.includesPaidAdobeFonts=function(){return ao?ao.getDocFontSourceUsage().indexOf(O.describeFontSource(O.FontSource.TYPEKIT_PREMIUM))>-1:(lo.warn("includesPaidAdobeFonts: Unable to get font usage info from doc - coreWrapper unavailable"),"unknown")},co.getRemixParentsCpIds=function(){return ao?ao.getRemixParentsCpIds():(lo.warn("getRemixParentsCpIds: Unable to get remix parent ids from doc - coreWrapper unavailable"),null)},co.getConstrainedImages=function(){return ao?ao.getConstrainedImages():(lo.warn("getConstrainedImages: Unable to get constrained images info from doc - coreWrapper unavailable"),null)},co.getFontsUsed=function(){var e=t.defer();return fo.promise.done((function(){ao?e.resolve(ao.getFontsUsed()):e.reject("coreWrapper is undefined")}),(function(){e.reject("could not load coreWrapper")})),e.promise},co.setCPProjectId=function(e){ao&&ao.setCPProjectID(e)},co.setCPAlias=function(e){ao&&ao.setCommunityPlatformAlias(e)},co.setCPAssetId=function(e){ao&&ao.setCommunityPlatformAssetID(e)},co.setPublishedContentEtag=function(e){ao&&ao.setPublishedEtag(e)},co.showColorPicker=function(e){const t=i(i({},e),{},{coreWrapper:ao,containingElement:go.sidebarItemProperties.el});go.colorPicker.setRole(e.role),Zt.show(t)},co.handleReplaceImageButtonPress=function(e){Gn(e)},co.handleTextInputRendered=function(e){Nt.handleTextInputRendered(e)},co.handleTextChange=function(e,t,o,n){Nt.handleTextChange(e,t,o,n)},co.onFocusTextRequestHandled=function(){const e=window.localStorage.getItem("text-area-focused-count")?Number(window.localStorage.getItem("text-area-focused-count")):0;e<3&&window.localStorage.setItem("text-area-focused-count",e+1),Nt.onFocusTextRequestHandled()},co.handleTextControlFocusedIn=function(e){Nt.handleTextControlFocusedIn(e)},co.handleTextControlFocusedOut=function(e,t){Nt.handleTextControlFocusedOut(e,t)},co.enterCropMode=function(){go.layerStack.enterCropOrRefineCutoutMode(),xn(),ao.enterCropMode().done()},co.exitCropMode=function(e){yn(),ao.exitCropMode(!e).done()},co.enterRefineCutoutMode=function(){ao.enterRefineCutoutMode(So).then(()=>{ao.inRefineCutoutMode()&&qa(!0)})},co.exitRefineCutoutMode=function(e){ao.exitRefineCutoutMode(e)},co.getPosterRelativePoint=function(e,t){return xa(e,t)},co.addExistingLogo=function(e){const t=$e.getCurrentBrandElements(),o=t&&t.logos&&t.logos.find(t=>t.id===e);if(o)if($t.model._state.isReplaceMode){const e=ao.getSelectedForma();gt({component:go,logoData:o,coreWrapper:ao,replacementForma:e})}else gt({component:go,logoData:o,coreWrapper:ao})},co.addNewLogo=function(){const e=new Re({parent:go.postEditorView,type:"image",hidden:!0});e.events.subscribe("item-selected",(function(t){Ca(t,ht,!0),e.remove()})),e.click(),et.publish("uploadNewLogoSelected"),go.designSurface.posterAdornments.hideSelectionBox()},co.showFontPicker=function(t){const o=e(t);go.fontPicker?(go.fontPicker.setAnchorElement(o),go.fontPicker.setContainingElement(o)):(go.fontPicker=new Le({anchorEl:o,hidden:!0}),go.fontPicker.setContainingElement(o),go.fontPicker.events.subscribe("add-custom-fonts-attempted",(function(){s.showMerchPopover({anchorLocation:t.getBoundingClientRect(),touchpointName:"postCustomFontsButton"})}))),go.fontPicker.setCoreWrapper(ao);const n=$e.getCurrentBrandElements();n&&!1!==n.showBrandInUI?go.fontPicker.update({authoringContext:$e.currentBrandKit()}):go.fontPicker.update({authoringContext:null}),go.fontPicker.isHidden()?go.fontPicker.show():go.fontPicker.hide()},co.handleShuffleStyleButtonClicked=function(){jt.handleStyleSliderValueChange()},co.getFeatureController=function(){return bo},co}.apply(t,n))||(e.exports=a)}}]);
//# sourceMappingURL=theo-web-view_e27cd5be-3bf9d314.js.map