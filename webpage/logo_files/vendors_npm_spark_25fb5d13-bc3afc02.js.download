(window.webpackJsonptheoWebApp=window.webpackJsonptheoWebApp||[]).push([[14],{"2wfq":function(e,t,r){r("oAGj")},"3v9D":function(e,t,r){var n,o,a,i,l=t,u=r("oAGj"),s=r("CaSj"),c=r("FNB+"),h=r("6ZWm"),g=r("tQF8"),f=r("TP4q"),m=r("v/sv"),d=r("bSZx"),p=r("4mVB"),v=r("iCxV"),F=r("fNpk"),_=r("Dq5S"),I=r("uxH+"),T=r("8t9B"),y=r("ThKb"),S=r("sIWg");l.LayoutSuggester=(n=function(){this.scoringWeights_=null,this.layoutTypeModel_=null,this.group_=null},u.defineClass({name:"LayoutSuggester",ctor:n,superName:"CoreObject",statics:{KIND:{get:function(){return"LayoutSuggester"}},createContentAwareSuggestions:function(e){var t;return(t=u.opt(u.as(e.controller,I.RootController),(function(e){return e.getGridController()})))?n.init_abc1(t.gridForma).createSuggestions(!0,!1,!1):[]}},props:{init_abc1:function(e,t){void 0===t&&(t=null);var r=u.clone(e.filterWithCallback((function(e){return e.isBackgroundImage()}),c.FormaTraversal.JustChildren)),n=u.clone(e.filterWithCallback((function(e){return null!=e.controller&&e.controller.floating}),c.FormaTraversal.JustChildren));this.layoutItems_=r.map((function(e){return[_.LayoutItem.init_b14a(e)]}),this),this.imageCount_=this.layoutItems_.length;var o=n.map((function(e){return _.LayoutItem.init_b14a(e)}),this);this.layoutItems_.push(o),this.floatingCount_=o.length,F.LegacyCoreAssert.isTrue(null!=e.parent,"group to suggest layout for does not have a parent",void 0,"LayoutSuggester.init","LayoutSuggester.swift",40),this.scoringWeights_=u.clone(t),this.gridFrame_=e.frame,this.group_=e},init_cb42:function(e,t){void 0===t&&(t=null),this.layoutItems_=[];for(var r=[],n=u.iter(e.layoutItems);!n.done;n.next()){var o=n.value;o.type==_.ItemContentType.Image&&this.layoutItems_.push([o]),o.type==_.ItemContentType.Floating&&r.push(o)}this.imageCount_=this.layoutItems_.length,this.floatingCount_=r.length,this.layoutItems_.push(r),this.scoringWeights_=u.clone(t),this.gridFrame_=e.gridFrame},layoutTypeModel:{get:function(){return this.layoutTypeModel_},set:function(e){this.layoutTypeModel_=e}},createSuggestions:function(e,t,r,n,o){if(void 0===e&&(e=!0),void 0===t&&(t=!1),void 0===r&&(r=!0),void 0===n&&(n=!1),void 0===o&&(o=1),this.imageCount_<1)return[];var a=[];return e&&u.append(a,this.createContentAwareSuggestions(r,o,n)),t&&u.append(a,this.createFixedGridSuggestions(r,o)),u.sortInPlace(a,(function(e,t){return e.score>t.score})),a},createEqualSizeSuggestions:function(e,t){return void 0===e&&(e=!0),void 0===t&&(t=1),this.imageCount_<1?[]:this.getEqualSizeGridSuggestions(e,t)},createFixedGridSuggestions:function(e,t){void 0===t&&(t=1);var r=this;if(this.imageCount_<1)return[];for(var n=u.clone(e&&this.floatingCount_>=1?this.layoutItems_:this.layoutItems_.slice(0,this.imageCount_)),o=n.length,a=u.clone(s.DesignSuggester.getPermutations(o,350)),i=null,l=-1e6,c=u.toArray(u.range(1,o,!0)).map((function(e){return r.getFixedGrids(o,e,!1)}),this),h=u.toArray(u.range(1,o,!0)).map((function(e){return r.getFixedGrids(o,e,!0)}),this),g=u.iter(a);!g.done;g.next()){var f=g.value.map((function(e){return n[e]}),this),m=this.fillFixedGrids(o,[c,h],f);m.score>l&&(i=m.suggestion,l=m.score)}return[i]},getEqualSizeGridSuggestions:function(e,t){void 0===t&&(t=1);for(var r=u.clone(e&&this.floatingCount_>=1?this.layoutItems_:this.layoutItems_.slice(0,this.imageCount_)),n=r.length,o=[],a=u.iter(u.range(1,n,!0));!a.done;a.next()){var i=a.value,l=i;if(n%i==0){var c=u.toInt(n/i),h=u.clone(this.getGrids(l,c)),g=u.clone(s.DesignSuggester.getPermutations(n,1))[0].map((function(e){return r[e]}),this),m=g.map((function(e){return e[0]}),this),p=this.createGridStyle(h,g,"equal_size_layout_"+l+"_"+c),v=new f.GridScore(p,this.gridFrame_,m,null,!1,this.scoringWeights_),F=new d.GridSuggestion(void 0,p,v);o.push(F)}}return u.sortInPlace(o,(function(e,t){return e.score>t.score})),o.slice(0,Math.min(o.length,t))},getGrids:function(e,t){for(var r=1/u.toDouble(e),n=1/u.toDouble(t),o=[],a=u.iter(u.range(0,e,!1));!a.done;a.next())for(var i=a.value,l=u.iter(u.range(0,t,!1));!l.done;l.next()){var s=l.value,c=u.toDouble(i)*r,h=u.toDouble(s)*n,f=u.toDouble(i+1)*r,m=u.toDouble(s+1)*n;o.push(new g.GridCell(new S.TheoRect(c,h,f,m)))}return o},createContentAwareSuggestions:function(e,t,r){if(void 0===t&&(t=1),void 0===r&&(r=!1),this.imageCount_<1)return[];for(var n=u.clone(e&&this.floatingCount_>=1?this.layoutItems_:this.layoutItems_.slice(0,this.imageCount_)),o=n.length,a=this.gridFrame_.aspectRatio,i=[],l=Math.max(200-25*o,25),c=u.clone(s.DesignSuggester.getPermutations(o,l)),h=[],g=[],f=[],m=[],d=[],p=[],v=u.iter(u.toSequence(c));!v.done;v.next()){var F=v.value,_=F.offset,I=F.element.map((function(e){return n[e]}),this),T=this.generateContentAwareGrids(o,I,a,r);u.append(h,T.heights),u.append(g,T.widths),u.append(f,T.scores),u.append(m,T.orders),u.append(d,T.flipDimensions);for(var y=u.iter(u.range(0,T.scores.length,!1));!y.done;y.next())p.push(_)}for(var S=u.sort(f),C=0;i.length<t&&C<S.length;){for(var D=S[S.length-1-C],b=u.indexOf(f,D),x=u.clone(c[p[b]]).map((function(e){return n[e]}),this),R=u.clone(h[b]),E=u.clone(m[b]),G=u.clone(g[b]),L=d[b],k=R.map((function(e){return 1/e}),this),A=this.buildBestContentAwareGrid(x,G,a,E,L,k,r),M=1,N=u.iter(i);!N.done;N.next()){var O=N.value;if((M=Math.min(M,O.gridStyle.similarity(A.gridStyle)))<.05)break}M>.05&&i.push(A),C+=1}return i},createGridStyle:function(e,t,r){var n=p.GridStyle.init_bf40(r,void 0,e),o=u.clone(this.getGridCellFormaMapping(e,t));return n.forma=this.group_,n.setFormaMapping(o),n},getGridCellFormaMapping:function(e,t){for(var r={},n=u.iter(u.toSequence(t));!n.done;n.next())for(var o=n.value,a=o.offset,i=o.element,l=u.iter(i);!l.done;l.next())r[l.value.id]=e[a];return r},fillFixedGrids:function(e,t,r){for(var n=null,o=-1e6,a=r.map((function(e){return e[0]}),this),i=u.iter(u.stride(0,e,1));!i.done;i.next())for(var l=i.value,s=u.iter(t);!s.done;s.next())for(var c=s.value,h=u.iter(c[l]);!h.done;h.next()){var g=h.value,m=this.createGridStyle(g,r,"Test Layout"),p=new f.GridScore(m,this.gridFrame_,a,null,!1,this.scoringWeights_),v=p.score;v>o&&(n=new d.GridSuggestion(void 0,m,p),o=v)}return{score:o,suggestion:n}},generateContentAwareGrids:function(e,t,r,n){for(var o=[],a=[],i=[],l=[],s=[],c=u.iter([!1,!0]);!c.done;c.next())for(var h=c.value,g=u.iter(u.stride(1,Math.min(6,e+1),1));!g.done;g.next()){for(var m=g.value,d=u.toArray(u.range(1,m,!0)).map((function(e){return u.toDouble(e)/u.toDouble(m)}),this),p=this.buildCellArray(d,t,h?1/r:r,void 0,h,void 0,n),v=u.clone(p.heights),F=u.clone(p.order),_=[],I=u.repeat(0,m),T=0;T<10;){var y=u.toArray(u.range(0,m,!1)).map((function(e){return 1/(u.toDouble(m)*u.toDouble(v[e]))+I[e]}),this),S=1/y.reduce((function(e,t){return e+t}),0);_=y.map((function(e){return e*S}),this);for(var C=!1,D=u.iter(u.range(0,_.length,!1));!D.done;D.next()){var b=D.value;_[b]<.1&&(I[b]+=.1,C=!0)}for(var x=0,R=u.iter(u.range(0,_.length,!1));!R.done;R.next()){var E=R.value;_[E]+=x,x=_[E]}if(_[_.length-1]=1,!C)break;T+=1}for(var G=this.buildCellArray(_,t,h?1/r:r,F,h,void 0,n),L=u.clone(G.heights),k=L.map((function(e){return 1/e}),this),A=this.buildCellArray(_,t,h?1/r:r,F,h,k,n),M=[],N=u.iter(t);!N.done;N.next()){var O=N.value;u.append(M,O)}var P=u.clone(this.getGridCellFormaMapping(A.cells,t)),W=new f.GridScore(void 0,this.gridFrame_,M,null,!0,this.scoringWeights_,P,A.cells);a.push(_),o.push(L),i.push(W.score),l.push(F),s.push(h)}var w=u.sort(i);return{widths:a,heights:o,orders:l,scores:i,flipDimensions:s,maxScore:w[w.length-1]}},buildBestContentAwareGrid:function(e,t,r,n,o,a,i){var l=this.buildCellArray(t,e,o?1/r:r,n,o,a,i),s=u.clone(l.cells),c=u.clone(this.snapBounds(s,this.gridFrame_.size,o)),g=this.createGridStyle(c,e,p.GridStyle.BALANCED_LAYOUT_NAME);g.cropType=i?h.CropType.FillFocus:h.CropType.FitBorder;for(var m=[],v=u.iter(e);!v.done;v.next()){var F=v.value;u.append(m,F)}var _=new f.GridScore(g,this.gridFrame_,m,null,!0,this.scoringWeights_);return new d.GridSuggestion(this.group_,g,_)},buildCellArray:function(e,t,r,n,o,a,i){var l,s,c;void 0===n&&(n=null),void 0===o&&(o=!1),void 0===a&&(a=null),void 0===i&&(i=!1);var h=null;null==n&&(h=[]);for(var f,m=u.repeat(0,e.length),d=[],p=0,v=u.iter(u.toSequence(t));!v.done;v.next()){var F=v.value,I=F.offset,T=F.element;if(null==n){var y=u.sort(m);f=u.indexOf(m,y[0]),h.push(f)}else f=n[I];var C,D,b=e[f];if(p=0==f?0:e[f-1],1==T.length&&T[0].type==_.ItemContentType.Image){var x=i&&null!=T[0].focusRegion?T[0].focusRegion.width:(l=T[0].width)||null!=l?l:1,R=i&&null!=T[0].focusRegion?T[0].focusRegion.height:(s=T[0].height)||null!=s?s:1;C=1/(o?u.toDouble(R)/u.toDouble(x):u.toDouble(x)/u.toDouble(R))*(b-p)*r}else{var E,G;if(null!=(E=u.opt(u.opt(u.opt(T[0].forma,(function(e){return e.parent})),(function(e){return e.bounds})),(function(e){return e.width})))&&null!=(G=u.opt(u.opt(u.opt(T[0].forma,(function(e){return e.parent})),(function(e){return e.bounds})),(function(e){return e.height})))){for(var L=0,k=u.iter(T);!k.done;k.next()){var A=k.value;L+=(c=u.opt(A.textInfo,(function(e){return e.textLength})))||null!=c?c:0}(C=this.getTextCellHeight(T.length,u.toDouble(L),p*E,b*E,E,G)/G)<.15&&(C=.15)}else C=(b-p)*r}null!=(D=u.opt(a,(function(e){return e[f]})))&&1-(C*=D)<.001&&(C=1);var M=null;M=o?new g.GridCell(new S.TheoRect(m[f],p,C+m[f],b)):new g.GridCell(new S.TheoRect(p,m[f],b,C+m[f])),d.push(M),m[f]=C+m[f]}return{cells:d,heights:m,order:null==h?n:h}},snapBounds:function(e,t,r,n){void 0===n&&(n=60);var o=e.map((function(e){return e.clone()}),this),a=[];e.forEach((function(e){return a.push(e)}));var i=[];if(r)for(var l=u.iter(u.range(0,a.length,!1));!l.done;l.next()){g=l.value,f=a[g],i.push(f);var s=f.bounds.maxX;if(s<1)for(var c=u.iter(u.range(g+1,a.length,!1));!c.done;c.next())if(v=c.value,F=(p=e[g]).bounds,Math.abs(p.bounds.maxX-s)*t.width<n&&1!=p.bounds.maxX&&p.bounds.maxX!=s&&(p=p.copyTo(new S.TheoRect(F.minX,F.minY,s,F.maxY)),a[v]=p),Math.abs(p.bounds.minX-s)*t.width<n&&0!=p.bounds.minX&&p.bounds.minX!=s&&(p=p.copyTo(new S.TheoRect(s,F.minY,F.maxX,F.maxY)),a[v]=p),p.bounds.width<.05)return o}else for(var h=u.iter(u.range(0,a.length,!1));!h.done;h.next()){var g=h.value,f=a[g];i.push(f);var m=f.bounds.maxY;if(m<1)for(var d=u.iter(u.range(g+1,a.length,!1));!d.done;d.next()){var p,v=d.value,F=(p=a[v]).bounds;if(Math.abs(p.bounds.maxY-m)*t.height<n&&1!=p.bounds.maxY&&p.bounds.maxY!=m&&(p=p.copyTo(new S.TheoRect(F.minX,F.minY,F.maxX,m)),a[v]=p),Math.abs(p.bounds.minY-m)*t.height<n&&0!=p.bounds.minY&&p.bounds.minY!=m&&(p=p.copyTo(new S.TheoRect(F.minX,m,F.maxX,F.maxY)),a[v]=p),p.bounds.height<.05)return o}}return i},getTextCellHeight:function(e,t,r,n,o,a){var i=.13358679,l=-.0261477,s=-.11470111,c=.03862264,h=-.02888805,g=.00561106,f=.03671017,m=.13522773,d=-.0499348,p=.02618676,v=1043.48108,F=3.14978552,_=1.15001079,I=167.10292,T=.639915899,y=.0844010175,S=.0901829377,C=.517425544,D=.44141582,b=78.7709665,x=248.39949567,R=2.99889961,E=1.20115851,G=260.27180508,L=.48002452,k=.27798828,A=.28644367,M=.49969626,N=.49655603,O=117.5756354,P=u.toDouble(this.floatingCount_),W=r,w=n,B=.6568033208493654;return B+=(a-v)/x*i,B+=(P-F)/R*l,B+=(u.toDouble(this.imageCount_)-_)/E*s,B+=(W-I)/G*c,B+=((1==e?1:0)-T)/L*h,B+=((3==e?1:0)-y)/k*g,B+=((e>3?1:0)-S)/A*f,B+=(u.toDouble(e)/P-C)/M*m,B+=((w-W)/o-D)/N*d,B+=(t-b)/O*p,B*=1e3},getFixedGrids:function(e,t,r){if(t>e)return[];for(var n=u.toArray(u.range(0,t,!0)).map((function(e){return u.toDouble(e+1)/u.toDouble(t)}),this),o=[u.repeat(1,t)],a=u.iter(u.range(t,e,!1));!a.done;a.next()){for(var i=[],l=u.iter(o);!l.done;l.next())for(var s=l.value,c=u.iter(u.range(0,t,!1));!c.done;c.next()){var h=c.value,f=s.concat();f[h]+=1,i.push(f)}o=u.clone(i)}u.shuffleInPlace(o),o=o.slice(0,Math.min(350,o.length));for(var m=[],d=u.iter(o);!d.done;d.next()){for(var p=d.value,v=[],F=u.iter(u.toSequence(p));!F.done;F.next())for(var _=F.value,I=_.offset,T=_.element,y=0==I?0:n[I-1],C=n[I],D=0,b=u.iter(u.stride(1,u.toDouble(T+1),1));!b.done;b.next()){var x=b.value;r?v.push(new g.GridCell(new S.TheoRect(D,y,x/u.toDouble(T),C))):v.push(new g.GridCell(new S.TheoRect(y,D,C,x/u.toDouble(T)))),D=x/u.toDouble(T)}m.push(v)}return m},createLayoutIdFeatures:function(e,t,r,n,o){var a=1==n?1:0,i=2==n?1:0,l=3==n?1:0,s=n>3?1:0,c=1==r?1:0,h=2==r?1:0,g=3==r?1:0,f=r>3?1:0,m=Math.atan2(t,e),d=e*t,p=0,v=0,F=0;if(o.length>0){p=o.reduce((function(e,t){return e+t}),0)/u.toDouble(o.length);var _=u.sort(o);F=_[_.length-1],v=_[0]}var I=[e,t,u.toDouble(r),u.toDouble(n),a,i,l,s,c,h,g,f,p,v,F,d,m];return new y.TheoMatrix([I])},predictLayoutIds:function(e,t){var r=u.opt(this.group_,(function(e){return e.root}));if(this.layoutTypeModel_=u.opt(r,(function(e){return e.page.layoutLibrary.layoutSuggestionModel})),null==r||null==this.layoutTypeModel_)return[];for(var n=r.filterWithCallback((function(e){return e.isBackgroundImage()})).length,o=u.clone(r.filterWithCallback((function(e){return e.isTypeLockup()}))),a=[],i=u.iter(o);!i.done;i.next()){var l,s=i.value;(l=u.as(s.controller,T.TypeLockupController))&&a.push(u.toDouble(l.text.length))}for(var c=r.page.pageSize.width,h=r.page.pageSize.height,g=Math.atan2(h,c),f=this.createLayoutIdFeatures(c,h,o.length,n,a),d=this.layoutTypeModel_.featureScalingMean,p=this.layoutTypeModel_.featureScalingStd,F=u.clone(this.layoutTypeModel_.layoutIDs),_=f.subtract(d).divide(p),I=u.repeat(0,this.layoutTypeModel_.models[0].intercepts.asFlatArray.length),y=u.iter(this.layoutTypeModel_.models);!y.done;y.next()){var S=y.value;if(S.minAngle<g&&g<=S.maxAngle){var C=_.matrixMultiply(S.coefficients.transpose()).sumDim(0);I=u.clone(S.intercepts.add(C).asFlatArray)}}if(I.length!=F.length)return u.opt(v.Host.logging,(function(e){return e.error("model scores don't match class labels")})),[];for(var D=u.sort(I,(function(e,t){return e>t})),b=[],x=u.clone(r.page.layoutLibrary.getAllGrids()),R=!1,E=!1,G=u.iter(u.range(0,F.length,!1));!G.done;G.next()){var L=G.value;if(b.length>=e)break;for(var k=F[u.indexOf(I,D[L])],A=u.iter(x);!A.done;A.next()){var M=A.value;if(M.name==k){var N=M.nonOverlappingCells().length;if(N>=n){if(N==n){if(R)continue;R=!0}if(2==N){if(E)continue;E=!0}var O=M;if(M.gridCells.length<=3){var P=M.flipRegion(),W=u.clone(new m.GridSuggester(this.group_,M).createSuggestions()),w=u.clone(new m.GridSuggester(this.group_,P).createSuggestions());W.length>0&&w.length>0&&(O=W[0].score>w[0].score?M:P)}for(var B=!1,U=u.iter(t);!U.done;U.next())if(U.value.similarity(O)<.02){B=!0;break}B||b.includes(O.name)||b.push(O.name)}}}}return b}}}),n),l.GridDocument=(o=function(){},u.defineClass({name:"GridDocument",ctor:o,props:{init_d4b4:function(e,t,r,n,o,a){this.docID=e,this.userID=t,this.database=r,this.gridFrame=n,this.gridStyle=o,this.layoutItems=u.clone(a)},init_implicit:function(e,t,r,n,o,a){this.gridFrame=e,this.gridStyle=t,this.layoutItems=u.clone(r),this.docID=n,this.userID=o,this.database=a},clone:function(){return o.init_implicit(this.gridFrame,this.gridStyle,this.layoutItems,this.docID,this.userID,this.database)}}}),o),l.RangedLayoutLinearModel=(a=function(e,t,r,n){this.minAngle=e,this.maxAngle=t,this.coefficients=r,this.intercepts=n},u.defineClass({name:"RangedLayoutLinearModel",ctor:a,props:{clone:function(){return new a(this.minAngle,this.maxAngle,this.coefficients,this.intercepts)}}}),a),l.LayoutSuggestionsLinearModel=(i=function(e,t,r,n){this.featureScalingMean=e,this.featureScalingStd=t,this.layoutIDs=u.clone(r),this.models=u.clone(n)},u.defineClass({name:"LayoutSuggestionsLinearModel",ctor:i,superName:"CoreObject"}),i)},"6vbT":function(e,t,r){r("oAGj")},Dq5S:function(e,t,r){var n,o,a=t,i=r("oAGj"),l=r("lmwz"),u=r("fNpk"),s=r("8t9B");a.ItemContentType=i.defineEnum("ItemContentType",{Image:0,Floating:1}),a.TextInfo=(n=function(){},i.defineClass({name:"TextInfo",ctor:n,props:{init_91e2:function(e,t,r){this.textLength=e,this.font=t,this.backingShape=r},init_implicit:function(e,t,r){this.textLength=e,this.font=t,this.backingShape=r},clone:function(){return n.init_implicit(this.textLength,this.font,this.backingShape)}}}),n),a.LayoutItem=(o=function(){this.aspectRatios_=null,this.importance_=null,this.focus_=null},i.defineClass({name:"LayoutItem",ctor:o,props:{init_b14a:function(e){this.id_=e.formaID,this.forma_=e;var t,r,n=this.forma_.controller.floating,o=l.ImageFacade.getImageFormaForForma(e);if(n||null==o){if(u.LegacyCoreAssert.isTrue(this.forma_.controller.floating,"Layout item does not support non-floating formae other than background images",void 0,"LayoutItem.init","LayoutItem.swift",66),this.type_=a.ItemContentType.Floating,t=i.as(e.controller,s.TypeLockupController)){var c=t.text.length,h=i.opt(i.opt(t.lockupStyle,(function(e){return e.font})),(function(e){return e.fontData.postScriptName})),g=i.opt(t.lockupStyle,(function(e){return e.backingShapeID}));this.textInfo_=i.clone(a.TextInfo.init_91e2(c,h,g))}}else this.type_=a.ItemContentType.Image,(r=o.contentNode)&&(this.width_=i.toDouble(r.pixelWidth),this.height_=i.toDouble(r.pixelHeight),this.focus_=r.focusRegion)},init_e2cb:function(e,t,r,n,o,a,l){void 0===a&&(a=null),void 0===l&&(l=null),this.id_=e,this.type_=t,this.width_=r,this.height_=n,this.textInfo_=i.clone(o),this.aspectRatios_=i.clone(a),this.importance_=l,this.forma_=null},id:{get:function(){return this.id_}},forma:{get:function(){return this.forma_}},type:{get:function(){return this.type_}},width:{get:function(){return this.width_}},height:{get:function(){return this.height_}},textInfo:{get:function(){return this.textInfo_}},focusRegion:{get:function(){return this.focus_}},aspectRatios:{get:function(){return this.aspectRatios_},set:function(e){this.aspectRatios_=i.clone(e)}},importance:{get:function(){return this.importance_},set:function(e){this.importance_=e}}}}),o)},LqGn:function(e,t,r){var n,o=t,a=r("oAGj"),i=r("CWW7"),l=r("yGNn"),u=r("ascj"),s=r("FNB+"),c=r("6ZWm"),h=r("cmoc"),g=r("G1DZ"),f=r("P83h"),m=r("9Lk3"),d=r("ZK0l"),p=r("/afT"),v=r("pnSN"),F=r("iCxV"),_=r("lmwz"),I=r("fNpk"),T=r("MYNe"),y=r("c+uM"),S=r("tGKA"),C=r("JFv5"),D=r("uxH+"),b=r("AxS/"),x=r("ODYV"),R=r("K0Rh"),E=r("MZST"),G=r("iSwi"),L=r("djAF"),k=r("35Q0"),A=r("T6jX"),M=r("fAXt"),N=r("8t9B"),O=r("oKlP"),P=r("oKI3"),W=r("sIWg");o.RetargetSuggestion=(n=function(e,t,r,n,o,i){this.correspondence_=a.clone(o),this.modelDoc_=n,this.forma_=e,this.modelForma_=r,this.score_=new E.RetargetScore(t,r,o),this.layoutUpdate_=i,this.disableFallback_=!1},a.defineClass({name:"RetargetSuggestion",ctor:n,superName:"CoreObject",statics:{_implements:function(e){return"IDesignSuggestion"==e}},props:{score:{get:function(){return a.opt(this.score_,(function(e){return e.score}))}},weightedScore:{get:function(){return this.score_}},forma:{get:function(){return this.forma_}},layoutUpdate:{get:function(){return this.layoutUpdate_}},modelDoc:{get:function(){return this.modelDoc_}},disableFallback:{get:function(){return this.disableFallback_},set:function(e){this.disableFallback_=e}},distanceTo:function(e){return I.LegacyCoreAssert.fail("no distance",void 0,"RetargetSuggestion.distanceTo","RetargetSuggestion.swift",49),0},getGroupCorrespondences:function(){for(var e=this.forma_,t=[],r=a.iter(this.correspondence_);!r.done;r.next()){for(var n=r.value,o=[],i=a.iter(n.a);!i.done;i.next()){var l=i.value;e.visitAll(s.FormaTraversal.PreOrder,(function(e){e.originalID==l.originalID&&o.push(e)}))}t.push({a:o,b:n.b})}return t},matchGroupStyle:function(e,t){var r,n,o,i,l=this;if(0!=e.length&&0!=t.length){var u,c,h=e.filter((function(e){return e.kind==R.RootForma.KIND}),this),g=t.filter((function(e){return e.kind==R.RootForma.KIND}),this);h.length>0&&g.length>0&&(u=a.opt(a.as(h[0].controller,D.RootController),(function(e){return e.getGridController()})))&&(c=a.opt(a.as(g[0].controller,D.RootController),(function(e){return e.getGridController()})))&&(h[0].matchColors(g[0]),u.matchStyle(c));for(var f=[],m=[],d=a.iter(e);!d.done;d.next()){var p=d.value,v=a.clone(p.controller.userGroup?p.visitAsArray(s.FormaTraversal.PreOrder):[p]);a.append(f,v.filter((function(e){return l.considerFormaForRestyle(e)}),this))}for(var F=a.iter(t);!F.done;F.next())p=F.value,v=a.clone(p.controller.userGroup?p.visitAsArray(s.FormaTraversal.PreOrder):[p]),a.append(m,v.filter((function(e){return l.considerFormaForRestyle(e)}),this));if(0!=f.length){f=a.sort(f,(function(e,t){return((r=e.controller.currentHeightScale)||null!=r?r:0)>((n=t.controller.currentHeightScale)||null!=n?n:0)})),m=a.sort(m,(function(e,t){return((o=e.controller.currentHeightScale)||null!=o?o:0)>((i=t.controller.currentHeightScale)||null!=i?i:0)}));for(var _=a.clone(this.getUniqueStyles(m)),I=a.clone(this.getUniqueStyles(f)),T=a.iter(a.range(0,Math.min(_.length,I.length),!1));!T.done;T.next())for(var S=T.value,C=_[S],b=I[S].clone(),x=a.clone(this.styleMatchedForma(f,b)),E=a.clone(this.styleMatchedForma(m,C)),G=a.iter(x);!G.done;G.next()){var L,k=G.value;(w=a.as(k.controller,N.TypeLockupController))&&(B=w.lockupStyle)&&(L=a.as(C.clone(),y.LockupStyle))&&(L.layout=B.layout,L.alignment=B.alignment,L.pathID=B.pathID,L.spacing=Math.min(L.spacing,1),B.layout==y.LockupLayout.Standard&&B.pathID==P.TextPathID.UNSET||(L.backing=B.backing,L.backing==y.LockupBacking.SVGBackground&&null==L.backingArtworkID&&(L.backing=y.LockupBacking.None)),w.addLineBreakConstraints(!0),k.applyStyle(L),w.removeLineBreakConstraints(),y.LockupStyle.isKnockoutLook(C.textLook)&&(C.backing=y.LockupBacking.None,y.LockupStyle.isKnockoutLook(C.textLook)&&(C.textLook=y.LockupTextLook.Fill)),x.length>1&&E.length<=1&&C.backing==y.LockupBacking.SVGBackground&&!y.LockupStyle.isKnockoutLook(C.textLook)&&(C.backing=y.LockupBacking.None))}if(I.length>_.length)for(var A=a.iter(a.range(_.length,I.length,!1));!A.done;A.next())for(var M=A.value,O=y.LockupStyle.createDefault(),W=(b=I[M],a.iter(f));!W.done;W.next()){var w,B;k=W.value,(w=a.as(k.controller,N.TypeLockupController))&&(B=w.lockupStyle)&&this.styleMatch(b,B)&&(w.addLineBreakConstraints(!0),B.colors.match(O.colors),B.font=O.font,w.removeLineBreakConstraints())}}}},considerFormaForRestyle:function(e){var t;return!!(t=a.as(e.controller,N.TypeLockupController))&&t.text.length>1},getUniqueStyles:function(e){for(var t=this,r=[],n=a.iter(e);!n.done;n.next()){var o,i,l=n.value;(o=a.as(l.controller,N.TypeLockupController))&&(i=o.lockupStyle)&&(r.filter((function(e){return t.styleMatch(i,e)}),this).length>0||r.push(i.clone()))}return r},styleMatchedForma:function(e,t){for(var r=[],n=a.iter(e);!n.done;n.next()){var o,i,l=n.value;(o=a.as(l.controller,N.TypeLockupController))&&(i=o.lockupStyle)&&this.styleMatch(i,t)&&r.push(l)}return r},styleMatch:function(e,t){return a.opt(e.font,(function(e){return e.fontData.postScriptName==a.opt(t.font,(function(e){return e.fontData.postScriptName}))}))},getParentExpansionFrame:function(e){for(var t=null,r=a.iter(a.range(0,e.length,!1));!r.done;r.next()){var n=e[r.value].controller.visualParentExpansionFrame;t=null==t?n:t.unionWith(n)}return t},getUnionFrame:function(e){for(var t=null,r=a.iter(a.range(0,e.length,!1));!r.done;r.next()){var n=e[r.value].finalFrame;t=null==t?n:t.unionWith(n)}return t},matchGroupLayout:function(e,t){if(0==e.length||0==t.length)return!1;var r=a.clone(t),n=a.clone(T.LayerFacade.sortInZOrder(e)),o=a.clone(p.GroupDetector.detectProximityGroups(n,null,!1)),i=t[0].root.finalFrame,l=a.opt(this.getParentExpansionFrame(r),(function(e){return e.intersectionWith(i)})),u=a.opt(this.getUnionFrame(r),(function(e){return e.intersectionWith(i)}));if(I.LegacyCoreAssert.isTrue(i.equalWithAccuracy(e[0].root.finalFrame,1),"after resizing the model, the frames should match",void 0,"RetargetSuggestion.matchGroupLayout","RetargetSuggestion.swift",308),1==o.length){var s=a.opt(this.getUnionFrame(n),(function(e){return e.intersectionWith(i)}));v=(v=W.TheoRect.fromSize(u.fitAspectRatioWithin(s.aspectRatio))).moveToPoint(u.center,new O.TheoPoint(.5,.5));var c,h=Math.sqrt(s.area/v.area);if((F=v.scale(h).intersectionWith(l.insetRel(.1,.1,.1,.1)))&&(v=F),c=v.intersectionWith(s)){var g=c.area/Math.max(v.area,s.area),f=v.area/i.area;if(g>.6&&f>.5)return!1}this.moveFormaToRegion(n,s,v)}else{var m=o.map((function(e){return A.TheoDocumentUtils.unionFinalFrame(e)}),this),d=m.reduce((function(e,t){return e+t.area}),0),v=u;if((h=Math.sqrt(d/v.area))>1){var F,_=l.insetRel(.1,.1,.1,.1);(F=v.scaleXY(1,h).intersectionWith(_))&&(v=F),h=Math.sqrt(d/v.area),(F=v.scaleXY(h,1).intersectionWith(_))&&(v=F)}for(var S=a.clone(v.insetRel(.1,.1,0,0).split(o.length,!0)),C=m.map((function(e){return e.height/i.height+.1}),this),D=a.clone(v.insetRel(0,0,.1,.1).split(o.length,!1,C)),b=0,x=0,R=a.iter(a.range(0,m.length,!1));!R.done;R.next())b+=m[k=R.value].similarity(S[k]),x+=m[k].similarity(D[k]);for(var E=a.clone(b<x?S:D),G=a.iter(a.range(0,o.length,!1));!G.done;G.next()){var L,k=G.value;if(L=this.getUnionFrame(o[k])){var M=E[k].insetRel(0,0,0==k?0:.1,k==o.length-1?0:.1);this.moveFormaToRegion(o[k],L,M)}}for(var P=a.iter(e);!P.done;P.next()){var w,B,U=P.value;(w=a.as(U.controller,N.TypeLockupController))&&(B=w.lockupStyle)&&(B.alignment!=y.LockupAlignment.Left&&B.alignment!=y.LockupAlignment.Right||(B.alignment=y.LockupAlignment.Center),w.snapSizeToBounds())}}return!0},moveFormaToRegion:function(e,t,r){if(0!=e.length){var n=e[0].parent,o=n.page.createFormaWithController(v.GroupForma.KIND,d.GroupController.KIND);o.allowUserMove=!1,o.isModel=!0,o.controller.preferredResizeType=C.ResizeLayoutType.Proportional,n.appendChild(o),o.placement=S.Matrix2D.translationXY(t.minX,t.minY),o.bounds=W.TheoRect.fromSize(t.size);for(var i=a.iter(e);!i.done;i.next()){var l=i.value;o.appendChild(l,!0)}o.bounds=W.TheoRect.fromSize(r.size),o.move(S.Matrix2D.translation(o.finalFrame.evalXY(.5,.5).multiply(-1)).translate(r.center));for(var u=a.iter(e);!u.done;u.next())l=u.value,n.appendChild(l,!0);o.removeFromParent()}},apply:function(){this.applyWithPromise()},applyWithPromise:function(e){void 0===e&&(e=!1);var t=this,r=l.CorePromise.resolve(null),n=this.forma_;(h=new f.FormaAnimationTransactionEvent(n)).duration=0,n.beginUpdate(h),G.RetargetSuggester.cleanupRoot(n),this.layoutUpdate_&&G.RetargetSuggester.removeDesignVariationFormae(n);for(var o=this.modelDoc_.beginTransaction("adjust_template"),u=a.clone(n.filterWithCallback((function(e){return e.isTypeLockup()&&e.frame.area>1}))),s=a.iter(u);!s.done;s.next()){var c=s.value;a.opt(a.as(c.controller,N.TypeLockupController),(function(e){return e.updateGroup()}))}n.page.colorLibraryController.restoreUndoState(a.as(this.modelDoc_.firstPage.colorLibrary.state.allProperties,"AnyObject"));for(var h,g=!this.disableFallback_&&this.layoutUpdate_?new x.RelayoutEvaluationScore(n):null,m=!this.disableFallback_&&this.layoutUpdate_?n.page.database.beginTransaction("try_resize",null):null,d=!0,p=!1,v=a.iter(a.range(0,2,!1));!v.done;v.next()){for(var _,I,T=v.value,y=a.clone(this.getGroupCorrespondences()),S=a.iter(y);!S.done;S.next()){var C=S.value;if(0!=C.a.length)if(0!=C.b.length){var D=C.a.filter((function(e){return null!=e.controller&&e.isTypeLockup()}),this).length>0;!this.layoutUpdate_||p&&D?this.matchGroupStyle(C.a,C.b):1==C.a.length?this.matchFormaToGroup(C.a[0],C.b):(this.matchGroupStyle(C.a,C.b),d=d&&this.matchGroupLayout(C.a,C.b))}else this.layoutUpdate_&&i.CreationFacade.deleteFormae(C.a,(function(){}));else if(this.layoutUpdate_){function R(e){return r.then((function(r){return t.transferForma(n,e,t.modelDoc_.uuid)}))}r=R(C.b)}}if(!((_=g)&&(I=m)&&(_.evaluateDocument(),_.reject()&&0==T))){a.opt(m,(function(e){return e.end()}));break}I.rollback(),p=!0,r=l.CorePromise.resolve(null),m=null}o.rollback(),a.opt(n.page.document,(function(e){return e.content.root.setTag(b.RootContentNode.THEME_ID_TAG,t.modelDoc_.uuid)})),this.cleanupForma(n),n.page.colorLibraryController.enteredPalettePicker(),e&&n.page.colorLibraryController.shuffleColorAssignments(),n.endUpdate(h),F.Host.platform.isAndroid&&p&&((h=new f.FormaHierarchyChangedEvent(n)).duration=.1,n.beginUpdate(h),n.endUpdate(h));for(var E=a.iter(u);!E.done;E.next())c=E.value,a.opt(a.as(c.controller,N.TypeLockupController),(function(e){return e.updateGroup()}));return r},matchZOrder:function(e,t){var r,n,o,i;if(0!=e.length&&0!=t.length)for(var l=this.modelDoc_.uuid,u=a.clone(e[0].root.filterWithCallback((function(e){return!(!(r=a.opt(e.controller,(function(e){return e.floating})))&&null==r)&&r}))),c=a.clone(t[0].root.filterWithCallback((function(e){return!(!(n=a.opt(e.controller,(function(e){return e.floating})))&&null==n)&&n}))),h=a.clone(this.getGroupCorrespondences()),g=a.iter(a.toSequence(e));!g.done;g.next()){for(var f=g.value,m=f.offset,d=f.element,p=t[m],v=null,F=null,_=!1,I=a.iter(c);!I.done;I.next()){var y=I.value,S=this.makeSourceDescriptor(l,y.formaID);if(a.eq(s._equality_Forma_Forma,y,p))_=!0;else if(y.parent==p.parent&&y.finalFrame.intersects(p.finalFrame))if(_){for(var C=a.iter(h);!C.done;C.next())if(R=C.value,a.containsEq(R.b,y,s._equality_Forma_Forma)&&(L=(G=a.clone(T.LayerFacade.sortInZOrder(R.a))).length>0?G[0]:a.first(u.filter((function(e){return e.source==S}),this)),E=L))if(null==F)F=E;else{var D=(o=a.opt(E.parent,(function(e){return e.indexOfChild(E)})))||null!=o?o:0,b=(i=a.opt(F.parent,(function(e){return e.indexOfChild(F)})))||null!=i?i:0;E.parent==F.parent&&b>D&&(F=E)}}else for(var x=a.iter(h);!x.done;x.next()){var R=x.value;if(a.containsEq(R.b,y,s._equality_Forma_Forma)){var E,G=a.clone(T.LayerFacade.sortInZOrder(R.a)),L=(G=a.reverse(G)).length>0?G[0]:a.first(u.filter((function(e){return e.source==S}),this));(E=L)&&(v=E)}}}var k,A,M,N,O,P=a.opt(d.parent,(function(e){return e.indexOfChild(d)}));(k=v)&&(N=k.parent)&&null!=(A=N.indexOfChild(k))&&null!=(m=P)&&m<A&&(d.removeFromParent(),N.insertChildAt(d,A,!0)),(M=F)&&(N=M.parent)&&null!=(O=N.indexOfChild(M))&&null!=(m=P)&&m>=O&&(d.removeFromParent(),N.insertBefore(d,M))}},transferForma:function(e,t,r){var n=this;if(t.length>0){for(var o=a.iter(t);!o.done;o.next())if(!(u=o.value).hasIntent(s.Forma.INTENT_ICON)&&!_.ImageFacade.isFloatingImage(u))return l.CorePromise.resolve(null);var u,c;return 1==t.length&&null!=(c=(u=t[0]).getTag(G.RetargetSuggester.FORMA_TYPE_TAG))&&c==G.RetargetSuggester.FORMA_TYPE_CONTENT_IMAGE?_.ImageFacade.addPlaceholderImage(e.page.document).then((function(e){var o,i;return(o=a.as(e,h.FrameForma))&&(i=_.ImageFacade.getImageFormaForForma(o))?(o.match(u),i.moveCenterToPoint(o.bounds.center),n.recordSources(r,t,[o]),n.matchZOrder([o],t),l.CorePromise.resolve(o)):l.CorePromise.resolve(null)})):i.CreationFacade.copyItems(t,e.page).then((function(e){for(var o=a.clone(e),u=a.iter(a.range(0,o.length,!1));!u.done;u.next()){var s=u.value;o[s].style.match(t[s].style);for(var c=a.iter(a.range(s,o.length,!1));!c.done;c.next()){var h,g,f,m=c.value;t[s].contentID==t[m].contentID&&o[s].contentID!=o[m].contentID&&(h=a.as(o[s],L.ShapeForma))&&(g=a.as(o[m],L.ShapeForma))&&(f=g.contentNode)&&(g.contentID=h.contentID,i.CreationFacade.removeContentNodeFromDocument(f,g.page.document))}}for(var d=a.iter(a.toSequence(o));!d.done;d.next()){var p=d.value,v=p.offset;p.element.style.match(t[v].style)}return n.recordSources(r,t,o),n.matchZOrder(o,t),l.CorePromise.resolve(null)}))}return l.CorePromise.resolve(null)},recordSources:function(e,t,r){for(var n=a.iter(a.toSequence(r));!n.done;n.next()){var o=n.value,i=o.offset;o.element.source=this.makeSourceDescriptor(e,t[i].formaID)}},makeSourceDescriptor:function(e,t){var r;return null!=(r=t)?g.FormaSourceNamespace.DesignVariation+e+":"+r:g.FormaSourceNamespace.DesignVariation+e},matchFormaToGroup:function(e,t){var r,n,o;if(1!=t.length||e.controller.userGroup){if(e.isTypeLockup()){var i=a.sort(t,(function(e,t){return((n=e.controller.currentHeightScale)||null!=n?n:0)>((o=t.controller.currentHeightScale)||null!=o?o:0)})).filter((function(t){return t.controller.kind==e.controller.kind}),this);if(i.length>0)return void e.match(i[0])}this.matchGroupStyle([e],t),this.matchGroupLayout([e],t)}else{var l,u,s,h,g,f,d,p,v=M.TransformFacade.isFormaFlipped(e,!0),F=M.TransformFacade.isFormaFlipped(e,!1),I=null;if((l=_.ImageFacade.getFrameFormaForForma(t[0]))&&(u=_.ImageFacade.getImageFormaForForma(e))&&(s=_.ImageFacade.getFrameFormaForForma(e))&&(d=a.as(s.controller,c.FrameController))){var T=l.rotationInRadians();if(Math.abs(T)>=Math.PI/2){var y=a.toInt(T/(Math.PI/2));I=-a.toDouble(y)*(Math.PI/2)}var S=s.rotationInRadians(),C=u.rotationInRadians();Math.abs(S)>=Math.PI/2&&Math.abs(C)>=Math.PI/2&&(I=((r=I)||null!=r?r:0)+0);var D=u.placement.extractedScale.scale;d.setBoundsWithCropType(l.bounds,c.CropType.PreserveFocus),u.placement.extractedScale.scale.x>2*D.x&&d.setBoundsWithCropType(l.bounds,c.CropType.FitBorder)}(h=a.as(e.controller,m.GridController))&&h.beginBlockedUpdate(),e.match(t[0]),(h=a.as(e.controller,m.GridController))&&h.endBlockedUpdate(),e.controller.moveable&&this.matchZOrder([e],t),(g=_.ImageFacade.getImageFormaForForma(e))&&(f=_.ImageFacade.getFrameFormaForForma(e))&&(d=a.as(f.controller,c.FrameController))&&(null!=(p=I)&&a.opt(g.controller,(function(e){return e.rotate(-g.rotationInRadians()+p)})),M.TransformFacade.isFormaFlipped(e,!1)!=F&&M.TransformFacade.flipForma(e,!1),M.TransformFacade.isFormaFlipped(e,!0)!=v&&M.TransformFacade.flipForma(e,!0))}},cleanupForma:function(e){for(var t,r=a.iter(e.filterByControllerKind(m.GridController.KIND));!r.done;r.next()){var n,o=r.value;if(n=a.as(o.controller,m.GridController)){n.updateGridAssignments();for(var i=a.iter(n.gridStyle.gridCells);!i.done;i.next()){var l,c=i.value;if(null!=(l=c.colorID)&&null==e.page.colorLibrary.color(l)){var h=a.clone(e.page.colorLibraryController.unusedColorKeys(null,!0));h.length>0&&n.gridStyle.updateCell(c,null,h[0],null)}}n.updateGroup();for(var f=a.clone(o.filterWithCallback((function(e){return null!=e.controller&&e.controller.floating&&!g.FormaSourceUtils.isDesignVariation(e.source)}),s.FormaTraversal.JustChildren)),d=!1,p=a.iter(this.correspondence_);!p.done;p.next()){var v=p.value;d=d||v.b.filter((function(e){return e.isTypeLockup()}),this).length>0,f=f.filter((function(e){return!a.containsEq(v.a,e,s._equality_Forma_Forma)}),this)}var F=a.clone(o.filterWithCallback((function(e){return g.FormaSourceUtils.isDesignVariation(e.source)}),s.FormaTraversal.JustChildren));if(!d&&F.length>0&&f.length>0){F=a.clone(T.LayerFacade.sortInZOrder(F)),f=a.clone(T.LayerFacade.sortInZOrder(f)),f=a.reverse(f);for(var _=F[F.length-1],I=a.iter(f);!I.done;I.next()){var S=I.value;null!=(pe=n.gridForma.indexOfChild(_))&&n.gridForma.insertChildAt(S,pe)}}}}for(var C=a.clone(e.page.colorLibraryController.getThemeColorKeys()),D=a.iter(e.visitAsArray(s.FormaTraversal.PreOrder));!D.done;D.next())for(var b=D.value,x=[u.ColorRole.FieldPrimary,u.ColorRole.FieldSecondary,u.ColorRole.Border],R=a.iter(x);!R.done;R.next()){var E=R.value;if(null==b.style.colors.color(E))for(var G=a.iter(a.range(0,x.length,!1));!G.done;G.next()){var L,A=G.value;if(null!=(L=b.style.colors.colorID(E))){var M,O=a.replaceAll(L,"themeColor","");if(null!=(M=a.toInt(O))){for(var P=C[(M+A)%C.length],W=!1,w=a.iter(x);!w.done;w.next()){var B,U=w.value;E!=U&&null!=(B=b.style.colors.colorID(U))&&B==P&&(W=!0)}if(!W){b.style.colors.setColorId(E,P);break}}}}}for(var Y=a.clone(e.filterWithCallback((function(e){return(!(t=a.opt(e.source,(function(e){return e.includes(g.FormaSourceNamespace.DesignVariation)})))&&null==t||!t)&&e.hasIntent(s.Forma.INTENT_ICON)}))),q=a.iter(Y);!q.done;q.next()){var H,z,X=q.value;if((H=X.style.colors.fieldPrimary)&&(z=a.opt(X.controller,(function(e){return e.getBackgroundColor()})))){for(var j=[],Z=a.iter(Y);!Z.done;Z.next()){var K,V=Z.value;a.eq(s._equality_Forma_Forma,X,V)||(K=V.style.colors.fieldPrimary)&&H.distanceTo(K)<1&&j.push(V)}var J=j.length>0;if((J&&H.distanceTo(z)<10||!J&&!H.contrasts(z,!1))&&(a.opt(X.controller,(function(e){return e.shuffleColorAssignment()})),J))for(var Q=a.iter(j);!Q.done;Q.next())Q.value.style.colors.setColor(u.ColorRole.FieldPrimary,X.style.colors.fieldPrimary)}}var $=a.clone(e.filterWithCallback((function(e){return e.isTypeLockup()&&e.frame.area>1})));a.sortInPlace($,(function(e,t){var r,n,o,i;if((r=a.as(e.controller,N.TypeLockupController))&&(n=a.as(e.controller,N.TypeLockupController))&&(o=a.opt(r.lockupForma,(function(e){return e.childrenFinalFrame})))&&(i=a.opt(n.lockupForma,(function(e){return e.childrenFinalFrame})))){var l=r.lockupStyle.backing==y.LockupBacking.Knockout&&y.LockupStyle.isKnockoutLook(r.lockupStyle.textLook),u=n.lockupStyle.backing==y.LockupBacking.Knockout&&y.LockupStyle.isKnockoutLook(n.lockupStyle.textLook);return o.area+(l?1e5:0)>i.area+(u?1e5:0)}return!1}));for(var ee=a.iter($);!ee.done;ee.next()){var te,re=ee.value;if(te=a.as(re.controller,N.TypeLockupController)){var ne,oe;te.snapSizeToBounds(),null!=(ne=a.opt(te.lockupStyle,(function(e){return e.backingShapeID})))&&(oe=k.ShapeLibraryDataStructures.init_d41d().DisplayOrderForShapesByCategory[k.ShapeLibrary.CategorySocial])&&oe.includes(ne)&&te.styleController.applyBacking(y.LockupBacking.None,null),y.LockupStyle.isShadowLook(te.lockupStyle.textLook)||te.lockupStyle.textBacked||te.contrastCheck(!1);var ae=re.parent,ie=te.lockupStyle.backing==y.LockupBacking.Knockout&&y.LockupStyle.isKnockoutLook(te.lockupStyle.textLook);if(null!=ae&&ie){for(var le=re.parent.indexOfChild(re),ue=le,se=a.iter($);!se.done;se.next()){var ce=se.value;a.eq(s._equality_Forma_Forma,re,ce)||re.parent!=ce.parent||(ue=Math.min(ue,ce.parent.indexOfChild(ce)))}ue<le&&ae.insertChildAt(re,ue)}}for(var he=a.iter($);!he.done;he.next()){var ge,fe,me,de,pe;ce=he.value,a.eq(s._equality_Forma_Forma,re,ce)||(ge=a.as(ce.controller,N.TypeLockupController))&&(fe=a.opt(ge.lockupForma,(function(e){return e.childrenFinalFrame})))&&(me=re.finalFrame)&&(de=ge.lockupStyle)&&null!=(pe=a.opt(ce.parent,(function(e){return e.indexOfChild(ce)})))&&"banner"==de.backingShapeID&&fe.contains(me)&&re.parent==ce.parent&&re.parent.insertChildAt(re,pe,!0)}}},dummy:function(e){}}}),n)},LwcA:function(e,t,r){var n,o=t,a=r("oAGj"),i=r("gXiO"),l=r("wc1n"),u=r("WlyK"),s=r("jV/A"),c=r("sIWg"),h=r("1NAc");o.RetargetCompatibilitySuggester=(n=function(){i.CoreObject.call(this)},a.defineClass({name:"RetargetCompatibilitySuggester",ctor:n,superName:"CoreObject",statics:{sortDocuments:function(e,t){for(var r=n.createRetargetDocumentData(e),o=a.clone(n.scoreDocuments(r,e.frame,t)),i=[],l=a.iter(o);!l.done;l.next()){var u=l.value;i.push(u.data)}return i},scoreDocuments:function(e,t,r){for(var n=a.clone(e.lockupStrings),o=[],i=a.iter(r);!i.done;i.next()){var l=i.value,s=a.clone(l.lockupStrings),c=s.length,h=!1;if(n.length==c)for(var g=a.iter(a.range(0,c,!1));!g.done;g.next()){var f=g.value;if(s[f]!=n[f])break;f+1==c&&(h=!0)}if(!h){var m=new u.RetargetCompatibilityScore(t,e,l);o.push({data:l,score:m})}}return a.sort(o,(function(e,t){return e.score.score>t.score.score}))},createRetargetDocumentData:function(e,t){void 0===t&&(t=!1);var r,n=l.FeatureExtractorFactory.getFeatureExtractor(t?l.FeatureExtractorType.RetargetTemplate:l.FeatureExtractorType.Retarget,e),o=a.clone(n.allFeatures_),i=a.as(o.Focus,"AnyObject"),u=i.length,g={};return(r=a.as(o.VisualGroupInfo,["Dictionary","String","AnyObject"]))&&(g=a.clone(r)),new s.RetargetDocumentExemplar("","","","","",h.TheoSize.decodeJson(a.as(o.Size,"AnyObject"))||h.TheoSize.Zero,2,2,"","",o.LockupStrings,null!=i&&u>0?c.TheoRect.decodeJson(i):null,o.NumImages,a.as(o.Edges,["Array","Double"]),o.LayoutId,o.NumGridsCells,o.NumMoveable,o.NumShapes,a.as(o.NumRetargetableBackgroundImages,"Double"),a.as(o.NumRetargetableFloatingImages,"Double"),g,o.TextRoles,o.ShapeRoles,o.SalientCoverage,o.GifsCount,null)}}}),n)},MZST:function(e,t,r){var n,o,a=t,i=r("oAGj"),l=r("FNB+"),u=r("c+uM"),s=r("8t9B"),c=r("9BFu");a.RetargetScore=(n=function e(t,r,n){this.rejectThreshold=-1e3,this.root_=t,this.model_=r,this.correspondence_=i.clone(n),c.WeightedScore.call(this,e.Features.NUM_FEAT),this.setWeight(e.Features.MIN_TEXT_SIZE,0),this.setWeight(e.Features.LENGTH_TEXT_DIFF,-30),this.setWeight(e.Features.WEIGHT_DIFF,0),this.setWeight(e.Features.RELATIVE_WEIGHT,-20),this.setWeight(e.Features.RELATIVE_LOCATION,-10),this.setWeight(e.Features.GROUP_SIZE_DIFF,-100),this.setWeight(e.Features.GROUP_COUNT_DIFF,-40),this.setWeight(e.Features.MISSING_TEXT,-5e3),this.setWeight(e.Features.TYPE_MISMATCH,-80),this.setWeight(e.Features.STYLE_MISMATCH,-80),this.setFeatureName(e.Features.MIN_TEXT_SIZE,"Min Text Size"),this.setFeatureName(e.Features.LENGTH_TEXT_DIFF,"Text Length Difference"),this.setFeatureName(e.Features.WEIGHT_DIFF,"Weight Difference"),this.setFeatureName(e.Features.RELATIVE_WEIGHT,"Relative Weight"),this.setFeatureName(e.Features.RELATIVE_LOCATION,"Relative Location"),this.setFeatureName(e.Features.GROUP_SIZE_DIFF,"Group Size Diff"),this.setFeatureName(e.Features.GROUP_COUNT_DIFF,"Group Count Diff"),this.setFeatureName(e.Features.MISSING_TEXT,"Missing Text"),this.setFeatureName(e.Features.TYPE_MISMATCH,"Type Mismatch"),this.setFeatureName(e.Features.STYLE_MISMATCH,"Style Mismatch"),this.setFeature(e.Features.MIN_TEXT_SIZE,0),this.setFeature(e.Features.LENGTH_TEXT_DIFF,0),this.setFeature(e.Features.WEIGHT_DIFF,0),this.setFeature(e.Features.RELATIVE_WEIGHT,0),this.setFeature(e.Features.RELATIVE_LOCATION,0),this.setFeature(e.Features.GROUP_SIZE_DIFF,0),this.setFeature(e.Features.GROUP_COUNT_DIFF,0),this.setFeature(e.Features.MISSING_TEXT,0),this.setFeature(e.Features.TYPE_MISMATCH,0),this.setFeature(e.Features.STYLE_MISMATCH,0),this.evaluateLayout()},o={},i.defineClass({name:"RetargetScore",ctor:n,superName:"WeightedScore",statics:{Features:{get:function(){return void 0===o.Features&&(o.Features=i.defineEnum("Features",{MIN_TEXT_SIZE:0,WEIGHT_DIFF:1,LENGTH_TEXT_DIFF:2,RELATIVE_WEIGHT:3,RELATIVE_LOCATION:4,MISSING_TEXT:5,GROUP_SIZE_DIFF:6,GROUP_COUNT_DIFF:7,TYPE_MISMATCH:8,STYLE_MISMATCH:9,ROLES_MISMATCH:10,NUM_FEAT:11})),o.Features}}},props:{evaluateLayout:function(){var e,t,r=this;this.setFeature(n.Features.MIN_TEXT_SIZE,0);for(var o=[],a={},c={},h=0,g=0,f=i.iter(this.correspondence_);!f.done;f.next()){var m=f.value;g+=i.toDouble(Math.abs(m.a.length-m.b.length));for(var d=0,p=0,v=i.iter(m.a);!v.done;v.next())d+=(_=v.value).frame.area/_.root.frame.area;for(var F=i.iter(m.b);!F.done;F.next()){var _;p+=(_=F.value).frame.area/_.root.frame.area}var I=d-p;h+=i.toDouble(I*I);for(var T=i.iter(i.range(0,Math.min(m.a.length,m.b.length),!1));!T.done;T.next()){var y=T.value,S=m.a[y],C=m.b[y];o.push({forma:S,placed:C}),a[S.formaID]={forma:S,length:0,size:(e=S.controller.currentHeightScale)||null!=e?e:S.finalFrame.height,center:S.frame.center},c[C.formaID]={forma:C,length:0,size:(t=C.controller.currentHeightScale)||null!=t?t:C.finalFrame.height,center:C.frame.center}}}this.setFeature(n.Features.GROUP_SIZE_DIFF,h),this.setFeature(n.Features.GROUP_COUNT_DIFF,g/i.toDouble(this.correspondence_.length));for(var D=0,b=0,x=0,R=0,E=0,G=this.root_.frame.area,L=i.iter(o);!L.done;L.next()){var k,A,M,N,O=L.value;if((O.forma.isTypeLockup()&&O.placed.isGraphic()||O.forma.isGraphic()&&O.placed.isTypeLockup())&&(R+=1,(k=i.as(O.placed.controller,s.TypeLockupController))&&(k.lockupStyle.backing==u.LockupBacking.None&&k.lockupStyle.textLook==u.LockupTextLook.Fill||null!=(A=k.averageLineHeight)&&(E+=A/100))),null!=(M=a[O.forma.formaID])&&null!=(N=c[O.placed.formaID])){D+=Math.abs(M.size-N.size)/G;for(var P=i.iter(o);!P.done;P.next()){var W,w,B=P.value;i.eq(l._equality_Forma_Forma,O.forma,B.forma)||i.eq(l._equality_Forma_Forma,O.placed,B.placed)||null!=(W=a[B.forma.formaID])&&null!=(w=c[B.placed.formaID])&&((M.size-W.size>5&&N.size-w.size<-5||M.size-W.size<-5&&N.size-w.size>5)&&i.opt(M.forma.controller,(function(e){return e.kind==i.opt(W.forma.controller,(function(e){return e.kind}))}))&&i.opt(N.forma.controller,(function(e){return e.kind==i.opt(w.forma.controller,(function(e){return e.kind}))}))&&(b+=1),(M.center.x-W.center.x>20&&N.center.x-w.center.x<-20||M.center.x-W.center.x<-20&&N.center.x-w.center.x>20)&&(x+=.5),(M.center.y-W.center.y>20&&N.center.y-w.center.y<-20||M.center.y-W.center.y<-20&&N.center.y-w.center.y>20)&&(x+=1))}}}for(var U=i.iter(this.correspondence_);!U.done;U.next()){m=U.value;for(var Y=i.clone(m.a),q=i.iter(i.range(0,Y.length,!1));!q.done;q.next()){y=q.value;for(var H=i.iter(i.range(0,Y.length,!1));!H.done;H.next()){var z=H.value;y>z&&Y[y].frame.center.y>Y[z].frame.center.y&&(x+=1)}}}this.setFeature(n.Features.WEIGHT_DIFF,D/i.toDouble(o.length)),this.setFeature(n.Features.RELATIVE_WEIGHT,b/i.toDouble(o.length)),this.setFeature(n.Features.RELATIVE_LOCATION,.5*x/i.toDouble(o.length)),this.setFeature(n.Features.TYPE_MISMATCH,R/i.toDouble(o.length)),this.setFeature(n.Features.STYLE_MISMATCH,E/i.toDouble(o.length)),this.setFeature(n.Features.ROLES_MISMATCH,0/i.toDouble(o.length));var X=0;this.model_.visit(l.FormaTraversal.PreOrder,(function(e,t,n){var o;if(o=i.as(e.controller,s.TypeLockupController)){for(var a=!1,u=i.iter(r.correspondence_);!u.done;u.next())for(var c=u.value,h=i.iter(c.b);!h.done;h.next()){var g=h.value;i.eq(l._equality_Forma_Forma,e,g)&&(a=!0)}if(!a){var f=i.toDouble(o.text.length);X+=e.frame.area/f}}return!1})),this.setFeature(n.Features.MISSING_TEXT,X/this.root_.frame.area)},reject:function(){return this.score<this.rejectThreshold}}}),n)},TP4q:function(e,t,r){var n,o=t,a=r("oAGj"),i=r("pnSN"),l=r("cbNz"),u=r("9BFu");o.GridScore=(n=function(e,t,r,n,o,s,c,h){this.dataset="DefaultGridScore",this.rejectThreshold=-1e3,void 0===e&&(e=null),void 0===n&&(n=null),void 0===o&&(o=!1),void 0===s&&(s=null),void 0===c&&(c=null),void 0===h&&(h=null),this.currentGrid_=n,this.gridStyle_=e,this.gridFrame_=t,this.contentAware_=o,this.layoutItems_=a.clone(r);var g=a.clone(new l.GridStyleFeatureExtractor(a.as(n,i.GroupForma),c,h,e,t,r).features);u.WeightedScore.call(this,a.count(g)),this.writeFeatureDict(this.dataset,g),null!=s&&s.length==a.count(g)&&this.setWeights(s)},a.defineClass({name:"GridScore",ctor:n,superName:"WeightedScore",props:{gridStyle:{get:function(){return this.gridStyle_}},reject:function(){return this.score<this.rejectThreshold}}}),n)},WlyK:function(e,t,r){var n,o,a=t,i=r("oAGj"),l=r("C42b"),u=r("fNpk"),s=r("3DEm"),c=r("sIWg"),h=r("9BFu");a.RetargetCompatibilityScore=(n=function e(t,r,n){var o,a,g,f,m,d;this.rejectThreshold=-500,h.WeightedScore.call(this,e.Features.NUM_FEAT),this.setWeight(e.Features.LENGTH_TEXT_DIFF,-100),this.setWeight(e.Features.TYPE_RETARGETABLE_IMAGES_DIFF,-200),this.setWeight(e.Features.NUM_RETARGETABLE_IMAGES_DIFF,-1e3),this.setWeight(e.Features.IMAGE_SIMILARITY,-50),this.setWeight(e.Features.DESIGN_SIZE_DIFF,-2e4),this.setWeight(e.Features.GRID_DESIGN,200),this.setWeight(e.Features.FLOATING_IMAGE_DESIGN,300),this.setWeight(e.Features.SALIENT_COVERAGE_DISSIMILARITY,-100),this.setWeight(e.Features.RANDOM_NOISE,-100),this.setFeatureName(e.Features.LENGTH_TEXT_DIFF,"Text Length Difference"),this.setFeatureName(e.Features.NUM_FLOATING_IMAGE_DIFF,"Floating Image Difference"),this.setFeatureName(e.Features.TYPE_RETARGETABLE_IMAGES_DIFF,"Type Retargetable Images Difference"),this.setFeatureName(e.Features.NUM_RETARGETABLE_IMAGES_DIFF,"# Retargetable Images Difference"),this.setFeatureName(e.Features.IMAGE_SIMILARITY,"Image Similarity"),this.setFeatureName(e.Features.DESIGN_SIZE_DIFF,"Design Size Difference"),this.setFeatureName(e.Features.GRID_DESIGN,"Grid Design"),this.setFeatureName(e.Features.FLOATING_IMAGE_DESIGN,"Floating Image Design"),this.setFeatureName(e.Features.SALIENT_COVERAGE_DISSIMILARITY,"Salient Coverage Dissimilarity"),this.setFeatureName(e.Features.RANDOM_NOISE,"Random Noise");var p=i.clone(r.edgeMap),v=i.clone(n.edgeMap);if(null!=v&&null!=p)if(p.length==v.length){for(var F=1e-5,_=i.iter(i.range(0,v.length,!1));!_.done;_.next())F+=v[y=_.value];for(var I=0,T=i.iter(i.range(0,p.length,!1));!T.done;T.next()){var y=T.value;I+=Math.abs(p[y]-v[y]/F)}u.LegacyCoreAssert.isFalse(isNaN(I),"image difference evaluated to NaN",void 0,"RetargetCompatibilityScore.init","RetargetCompatibilityScore.swift",75),this.setFeature(e.Features.IMAGE_SIMILARITY,I)}else this.setFeature(e.Features.IMAGE_SIMILARITY,0);function S(e,t){return e.length>t.length}for(var C=i.sort(r.lockupStrings.concat(),S),D=i.sort(n.lockupStrings.concat(),S),b=(I=[],[]),x=i.iter(i.range(0,Math.min(C.length,D.length),!1));!x.done;x.next()){y=x.value;var R=i.toDouble(C[y].length),E=i.toDouble(D[y].length);I.push(R-E),b.push(Math.max(R,E))}var G=this.norm(I)/(this.norm(b)+.001);this.setFeature(e.Features.LENGTH_TEXT_DIFF,G);var L=i.toInt((o=r.numRetargetableFloatingImages)||null!=o?o:0),k=i.toInt((a=n.numRetargetableFloatingImages)||null!=a?a:this.getNumberOfFloatingImages(n.visualGroupInfo)),A=(g=r.numRetargetableBackgroundImages)||null!=g?g:Math.max(r.numImages-i.toDouble(L),0),M=(f=n.numRetargetableBackgroundImages)||null!=f?f:Math.max(n.numImages-i.toDouble(k),0);this.setFeature(e.Features.NUM_FLOATING_IMAGE_DIFF,i.toDouble(Math.abs(L-k)));var N=(m=r.numRetargetableFloatingImages)||null!=m?m:0,O=(d=n.numRetargetableFloatingImages)||null!=d?d:0,P=A+N,W=M+O,w=Math.abs(P-W);P>W&&(w*=10),this.setFeature(e.Features.NUM_RETARGETABLE_IMAGES_DIFF,w);var B=Math.abs(A-M)+Math.abs(N-O),U=P<4?0:B;0==P&&O>0&&(U=100),this.setFeature(e.Features.TYPE_RETARGETABLE_IMAGES_DIFF,U);var Y=O>0?1:0;this.setFeature(e.Features.FLOATING_IMAGE_DESIGN,Y);var q=c.TheoRect.fromSize(n.size),H=c.TheoRect.fromSize(r.size).similarity(q);this.setFeature(e.Features.DESIGN_SIZE_DIFF,H),this.setFeature(e.Features.GRID_DESIGN,""==n.layoutID?0:1);var z=s.MathUtils.absDouble(r.salientCoverage-n.salientCoverage);this.setFeature(e.Features.SALIENT_COVERAGE_DISSIMILARITY,z),this.setFeature(e.Features.RANDOM_NOISE,i.toDouble(l.CoreRandom.nextInt)/i.toDouble(l.CoreRandom.randMax))},o={},i.defineClass({name:"RetargetCompatibilityScore",ctor:n,superName:"WeightedScore",statics:{Features:{get:function(){return void 0===o.Features&&(o.Features=i.defineEnum("Features",{LENGTH_TEXT_DIFF:0,NUM_FLOATING_IMAGE_DIFF:1,NUM_RETARGETABLE_IMAGES_DIFF:2,TYPE_RETARGETABLE_IMAGES_DIFF:3,FLOATING_IMAGE_DESIGN:4,IMAGE_SIMILARITY:5,DESIGN_SIZE_DIFF:6,GRID_DESIGN:7,SALIENT_COVERAGE_DISSIMILARITY:8,RANDOM_NOISE:9,NUM_FEAT:10})),o.Features}}},props:{norm:function(e){for(var t=0,r=i.iter(e);!r.done;r.next()){var n=r.value;t+=n*n}return Math.sqrt(t)},getNumberOfFloatingImages:function(e){for(var t=0,r=i.iter(e);!r.done;r.next()){var n=r.key,o=r.value;if("type"==n&&"frame"==o)t+=1;else if("children"==n){var a;if(a=i.as(o,["Array",["Dictionary","String","AnyObject"]]))for(var l=i.iter(a);!l.done;l.next()){var u=l.value;t+=this.getNumberOfFloatingImages(u)}}}return t},reject:function(){return this.score<this.rejectThreshold}}}),n)},bSZx:function(e,t,r){var n,o=t,a=r("oAGj"),i=r("P83h"),l=r("9Lk3");o.GridSuggestion=(n=function(e,t,r){void 0===e&&(e=null),this.gridStyle_=t,this.forma_=e,this.score_=r},a.defineClass({name:"GridSuggestion",ctor:n,superName:"CoreObject",props:{gridStyle:{get:function(){return this.gridStyle_}},score:{get:function(){return this.score_.score}},weightedScore:{get:function(){return this.score_}},apply:function(){if(a.info("Grid score:"),a.info(this.score_.asString),null!=this.forma_){var e,t=new i.FormaTransformChangedEvent(this.forma_);this.forma_.beginUpdate(t),(e=a.as(this.forma_.controller,l.GridController))&&(this.gridStyle_.forma=this.forma_,e.applyGridStyleWithMapping(this.gridStyle_,!0)),this.forma_.endUpdate(t)}}}}),n)},hywZ:function(e,t,r){var n,o=t,a=r("oAGj"),i=r("UGKO"),l=r("cmoc"),u=r("xe42"),s=r("16hp"),c=r("9Lk3"),h=r("iCxV"),g=r("3DEm"),f=r("uxH+"),m=r("K0Rh"),d=r("sIWg");o.LogoPlacementSuggester=(n=function(e,t){this.CONTRAST_WEIGHT=-10,this.END_BORDER=.98,this.START_BORDER=.02,this.MID_CANONICAL=.5,this.MIN_LIGHTNESS_DIFF=20,this.SYMMETRIC_THRESHOLD=300,s.FormaPlacementSuggester.call(this,e,t)},a.defineClass({name:"LogoPlacementSuggester",ctor:n,superName:"FormaPlacementSuggester",statics:{KIND:{get:function(){return"LogoPlacementSuggester"}}},props:{createPlacementSuggestions:function(e,t){void 0===t&&(t=null);var r=this;if(null==this.group.frame)return[];var n=this.group.frame;if(this.group.kind==m.RootForma.KIND){var o=this.group.page.pageSize;n=d.TheoRect.fromSize(o);var l,h=0,p=this.group.root;if(null!=a.as(p.controller,f.RootController)){var v,F=a.clone(p.filterByControllerKind(c.GridController.KIND));F.length>0&&(v=a.as(F[0].controller,c.GridController))&&(h=v.margin)}(l=this.forma.finalFrame)&&h>0&&(h<l.height||h<l.width)&&(n=d.TheoRect.fromXYWH(h,h,o.width-2*h,o.height-2*h))}for(var _,I=s.FormaPlacementSuggester.createPlacementInputs(this.forma,this.group),T=a.clone(this.getSearchLocations(this.forma,n,I,e,t)),y=-1/0,S=this.initializeLogoPlacementScore(I),C=a.iter(T);!C.done;C.next()){for(var D=C.value,b=s.FormaPlacementSuggester.createPlacementSuggestion(this.forma,D,n,I,S),x=0,R=a.iter(I.backgroundRegions);!R.done;R.next()){var E=R.value;if(null!=D.intersectionWith(E.finalFrame)){var G=a.opt(this.forma.controller,(function(e){return e.getAverageColor(r.forma.finalFrame)})),L=a.opt(E.controller,(function(e){return e.getAverageColor(D)}));if(null!=G&&null!=L&&!a.opt(L,(function(e){return e.contrasts(G)}))){var k=g.MathUtils.absDouble(this.MIN_LIGHTNESS_DIFF-a.opt(L,(function(e){return e.lightnessDifference(G)})));x=g.MathUtils.maxDouble(x,k)}}}a.opt(b.weightedScore,(function(e){return e.setFeature(u.FormaPlacementScore.Features.CONTRAST,a.toDouble(x))})),b.weightedScore.reject()||(S=this.initializeLogoPlacementScore(I)),b.score>y&&(y=b.score,_=b,S=this.initializeLogoPlacementScore(I))}return[a.as(_,i.IDesignSuggestion)]},getSearchLocations:function(e,t,r,n,o){void 0===o&&(o=null),null!=o&&a.opt(h.Host.logging,(function(e){return e.warning("LogoPlacementSuggestor.getSearchLocations ignores requested aspect ratio")}));var i,l=[];if(i=e.finalFrame){var u=i.height,s=i.width,c=t.evalXY(this.END_BORDER,this.END_BORDER),g=new d.TheoRect(c.x-s,c.y-u,c.x,c.y),f=t.evalXY(this.END_BORDER,this.START_BORDER),m=new d.TheoRect(f.x-s,f.y,f.x,f.y+u);l.push(g),l.push(m);for(var p=a.iter(this.getContentAlignedLocations(t));!p.done;p.next()){var v=p.value;t.contains(v)&&l.push(v)}var F=t.evalXY(this.MID_CANONICAL,this.START_BORDER),_=new d.TheoRect(F.x-s/2,F.y,F.x+s/2,F.y+u),I=t.evalXY(this.START_BORDER,this.START_BORDER),T=new d.TheoRect(I.x,I.y,I.x+s,I.y+u),y=t.evalXY(this.START_BORDER,this.END_BORDER),S=new d.TheoRect(y.x,y.y-u,y.x+s,y.y),C=t.evalXY(this.MID_CANONICAL,this.END_BORDER),D=new d.TheoRect(C.x-s/2,C.y-u,C.x+s/2,C.y),b=this.getSymmetricContentLocations();b&&(l.push(D),l.push(S)),l.push(_),l.push(T),b||(l.push(S),l.push(D))}return l},initializeLogoPlacementScore:function(e){var t=new u.FormaPlacementScore(e);return t.setWeight(u.FormaPlacementScore.Features.XSYMM,0),t.setWeight(u.FormaPlacementScore.Features.YSYMM,0),t.setWeight(u.FormaPlacementScore.Features.EDGE,0),t.setWeight(u.FormaPlacementScore.Features.DISTANCE_TO_CENTER,0),t.setWeight(u.FormaPlacementScore.Features.ALIGNMENT,0),t.setWeight(u.FormaPlacementScore.Features.CONTRAST,a.toDouble(this.CONTRAST_WEIGHT)),t.setWeight(u.FormaPlacementScore.Features.TEXT_OVERLAP,-1e4),t.setWeight(u.FormaPlacementScore.Features.FLOATING_ELEMENT_OVERLAP,-5e3),t},getContentAlignedLocations:function(e){var t,r,n,o;if((t=a.as(this.forma,l.FrameForma))&&(r=t.root)&&(n=r.finalFrame)&&(o=this.forma.finalFrame)){var i=o.height,u=o.width,s=a.clone(r.filterWithCallback((function(e){return null!=e.controller&&e.controller.floating})));if(s.length>0){var c=a.sort(s,(function(e,t){return e.finalFrame.maxY-n.minY<t.finalFrame.maxY-n.minY})),h=a.clone(c[c.length-1].finalFrame.points),g=a.clone(c[0].finalFrame.points),f=a.opt(r.finalFrame,(function(e){return e.locate(h[1].x,h[1].y)})),m=e.evalXY(a.opt(f,(function(e){return e.x})),a.opt(f,(function(e){return e.y}))+this.START_BORDER+.03),p=new d.TheoRect(m.x,m.y,m.x+u,m.y+i),v=a.opt(r.finalFrame,(function(e){return e.locate(h[3].x,h[3].y)})),F=e.evalXY(a.opt(v,(function(e){return e.x})),a.opt(v,(function(e){return e.y}))+this.START_BORDER+.03),_=new d.TheoRect(F.x-u,F.y,F.x,F.y+i),I=a.opt(r.finalFrame,(function(e){return e.locate(g[0].x,g[0].y)})),T=e.evalXY(a.opt(I,(function(e){return e.x})),a.opt(I,(function(e){return e.y}))-this.START_BORDER-.03);return[p,_,new d.TheoRect(T.x-u/2,T.y-i,T.x+u/2,T.y)]}}return[]},getSymmetricContentLocations:function(){var e,t,r,n=this;if((e=a.as(this.forma,l.FrameForma))&&(t=e.root)&&(r=t.finalFrame)){var o=a.clone(t.filterWithCallback((function(e){return null!=e.controller&&e.controller.floating})));return!(o.filter((function(e){return g.MathUtils.absDouble(r.center.distanceTo(e.finalFrame.center))<n.SYMMETRIC_THRESHOLD}),this).length<=a.toInt(o.length/2))}return!1}}}),n)},i0RJ:function(e,t,r){r("oAGj")},iSwi:function(e,t,r){var n,o=t,a=r("oAGj"),i=r("cZuM"),l=r("Z25M"),u=r("CaSj"),s=r("FNB+"),c=r("cmoc"),h=r("G1DZ"),g=r("9Lk3"),f=r("ZK0l"),m=r("/afT"),d=r("X0GW"),p=r("iCxV"),v=r("fdtz"),F=r("lmwz"),_=r("c+uM"),I=r("JFv5"),T=r("uxH+"),y=r("LqGn"),S=r("djAF"),C=r("T6jX"),D=r("8t9B"),b=r("sIWg"),x=r("qSCS");o.RetargetSuggester=(n=function e(t,r,n,o){this.origModelSize_=n.firstPage.pageSize,this.model_=n.firstPage.root,this.modelDoc_=n,this.originalRoot_=r,this.filterFormae_=a.clone(o),e.conformModelForApplicationToRoot(n,t),u.DesignSuggester.call(this,t,t)},a.defineClass({name:"RetargetSuggester",ctor:n,superName:"DesignSuggester",statics:{KIND:{get:function(){return"RetargetSuggester"}},FORMA_TYPE_TAG:"forma:type",FORMA_TYPE_DECORATION:"type:decoration",FORMA_TYPE_CONTENT_IMAGE:"type:content-image",conformModelForApplicationToRoot:function(e,t){var r=e.beginTransaction("cleanupRoot"),o=e.firstPage.root;e.controller.setAutomaticLayoutInteractionMode(),e.firstPage.root.isModel=!0,e.firstPage.root.bounds=b.TheoRect.fromSize(e.firstPage.pageSize),e.firstPage.animationController.hasAnimation&&p.Host.logging.info("model has animation"),o.controller.createGridControllerIfNone(),n.cleanupRoot(o),n.removeDesignVariationFormae(o),a.clone(o.filterWithCallback((function(e){return e.hasIntent(s.Forma.INTENT_ICON)||F.ImageFacade.isFloatingImage(e)}))).length>0&&a.opt(a.as(e.firstPage.root.controller,T.RootController),(function(e){return e.preferredResizeType=I.ResizeLayoutType.Fit}));for(var i=a.iter(o.filterWithCallback((function(e){return e.hasIntent(s.Forma.INTENT_ICON)})));!i.done;i.next()){var u,c,h=i.value;(u=a.as(h,S.ShapeForma))&&(c=a.as(u.contentNode,x.URLBasedContentNode))&&c.setDoNotLoadURL()}e.firstPage.setPageSize(t.page.pageSize),d.GroupFacade.removeAllGroups(e.firstPage.root);for(var g=a.iter(o.filterWithCallback((function(e){return e.isBackgroundImage()})));!g.done;g.next()){var f,m=g.value;l.DesignFeatureUtils.isDecorativeTemplateBackground(m)&&(f=F.ImageFacade.getImageFormaForForma(m))&&(m.allowUserMove=!0,m.intent=s.Forma.INTENT_FLOATING_IMAGE,f.intent=s.Forma.INTENT_FLOATING_IMAGE)}r.end()},cleanupRoot:function(e){var t;(t=a.opt(a.as(e.controller,T.RootController),(function(e){return e.getGridController()})))&&t.cleanupUnusedBackgroundCellColors();for(var r=a.clone(e.filterWithCallback((function(e){return e.isTypeLockup()}))),o=a.iter(r);!o.done;o.next()){var i,l,u=o.value;if((i=a.as(u.controller,D.TypeLockupController))&&(l=i.lockupStyle)&&(i.updateGroup(),i.snapSizeToBounds(),1==i.numLines()&&!_.LockupStyle.isPath(l.layout))){l.spacing=_.LockupStyle.DEFAULT_SPACING;for(var c=a.iter(r);!c.done;c.next()){var h=c.value;if(!a.eq(s._equality_Forma_Forma,u,h)){var g=a.as(h.controller,D.TypeLockupController);g.updateGroup();var f=g.numLines(),m=a.opt(g.lockupStyle,(function(e){return e.alignment})),d=1==f||f>1&&(m==_.LockupAlignment.Center||m==_.LockupAlignment.UNSET),p=1==f||f>1&&m==_.LockupAlignment.Left,v=1==f||f>1&&m==_.LockupAlignment.Right;i.beginBlockedUpdate(),n.frameAligned(u,h,.5,null)&&d?(l.alignment=_.LockupAlignment.Center,l.layout=_.LockupLayout.Standard):n.frameAligned(u,h,0,null)&&p?(l.alignment=_.LockupAlignment.Left,l.layout=_.LockupLayout.Standard):n.frameAligned(u,h,1,null)&&v?(l.alignment=_.LockupAlignment.Right,l.layout=_.LockupLayout.Standard):(l.alignment=_.LockupAlignment.Center,l.layout=_.LockupLayout.Standard),i.endBlockedUpdate(),i.styleChanged()}}}}},removeDesignVariationFormae:function(e){for(var t,r=a.clone(e.filterWithCallback((function(e){return!(!(t=a.opt(e.controller,(function(e){return e.floating})))&&null==t)&&t}))),n=a.iter(r);!n.done;n.next()){var o,i=n.value;null!=(o=i.source)&&h.FormaSourceUtils.isDesignVariation(o)&&i.removeFromParent()}},frameAligned:function(e,t,r,n){var o=e.frame,l=t.frame;if(null==o||null==l||null==r&&null==n)return!1;var u,s=1;(u=a.opt(e.page.view,(function(e){return e.getViewportTransform()})))&&(s=Math.sqrt(Math.abs(u.determinant)));var c=i.AlignmentDetector.DISTANCE_THRESHOLD/s,h=!0;return null!=r&&(h=h&&Math.abs(o.evalXY(r,.5).x-l.evalXY(r,.5).x)<c),null!=n&&(h=h&&Math.abs(o.evalXY(.5,n).y-l.evalXY(.5,n).y)<c),h},getMoveable:function(e){var t,r,n;return(!(t=a.opt(e.controller,(function(e){return e.userGroupChild})))&&null==t||!t)&&!l.DesignFeatureUtils.isRetargetableImage(e)&&(!(!(r=a.opt(e.controller,(function(e){return e.userGroup})))&&null==r||!r)||!(!e.isTypeLockup()&&!e.hasIntent(s.Forma.INTENT_ICON))||!!(n=a.as(e,c.FrameForma))&&n.controller.moveable)},isGraphicDecoration:function(e,t){return void 0===t&&(t=!1),e.hasIntent(s.Forma.INTENT_ICON)||F.ImageFacade.isFloatingImage(e)&&!l.DesignFeatureUtils.isRetargetableFloatingImage(e,t)&&F.ImageFacade.getImageFormaForForma(e).contentUrl!=x.URLBasedContentNode.DO_NOT_LOAD_DATA_URL},isRemixedDecoration:function(e){var t;if(((t=a.opt(e.controller,(function(e){return e.userGroup})))||null!=t)&&t){var r=e;return a.clone(r.filterWithCallback(n.isRemixedDecoration,s.FormaTraversal.JustChildren)).length==r.childCount}return n.isRemixedShapeOrImageDecoration(e)},isRemixedShapeOrImageDecoration:function(e){var t,r,n;return!(!e.hasIntent(s.Forma.INTENT_ICON)&&!F.ImageFacade.isFloatingImage(e))&&(!(F.ImageFacade.isFloatingImage(e)&&((t=a.opt(e.controller,(function(e){return e.userGroupMember})))||null!=t)&&t||l.DesignFeatureUtils.isRetargetableImage(e))&&(!(((r=a.opt(a.opt(e.parent,(function(e){return e.controller})),(function(e){return e.userGroup})))||null!=r)&&r&&e.parent.childrenAsArray.filter((function(t){return!a.eq(s._equality_Forma_Forma,t,e)}),this).filter((function(e){return e.isText()}),this).length>0)&&(null!=(n=e.getTag(s.Forma.TAG_CREATED_FROM_REMIX))&&"true"==n)))},shouldAttemptLayoutSuggestion:function(e){var t,r,o=a.clone(e.filterWithCallback((function(e){return(!(t=a.opt(e.source,(function(e){return e.includes(h.FormaSourceNamespace.DesignVariation)})))&&null==t||!t)&&e.kind!=v.ImageForma.KIND&&!!(r=e.controller)&&r.floating&&!r.userGroupChild;var r}))),i=a.clone(e.filterWithCallback((function(e){return e.isTypeLockup()}))),u=a.clone(e.filterWithCallback(l.DesignFeatureUtils.isRetargetableImageFromUserDesign)),s=a.clone(e.filterWithCallback(n.isRemixedShapeOrImageDecoration)),c=a.clone(e.filterWithCallback((function(e){return(!(r=a.opt(e.source,(function(e){return e.includes(h.FormaSourceNamespace.DesignVariation)})))&&null==r||!r)&&n.isGraphicDecoration(e)}))),g=a.toInt(.5*a.toDouble(C.TheoDocumentUtils.DESIGN_COMPLEXITY_HEURISTIC_THRESHOLD));return!(0==u.length||o.length>g||i.length>g||s.length>g||c.length>g)}},props:{model:{get:function(){return this.model_}},matchDesignGroupsToModel:function(e,t){if(0==e.length||0==t.length)return[[{a:[],b:[]}]];var r=[],n=a.clone(e);t.length<n.length&&(n=a.clone(m.GroupDetector.mergeFormaGroups(n,t.length)));for(var o=a.sort(t,(function(e,t){var r,n;return!(!(r=C.TheoDocumentUtils.unionFinalFrame(e))||!(n=C.TheoDocumentUtils.unionFinalFrame(t)))&&r.area>n.area})),i=t.length-n.length,l=i>0?i+1:1,u=a.iter(a.range(0,l,!1));!u.done;u.next()){var s=u.value,c=a.clone(o);function h(e,t){var r=C.TheoDocumentUtils.unionFinalFrame(e),n=C.TheoDocumentUtils.unionFinalFrame(t),o=(r.center.y-n.center.y)/e[0].root.frame.height;return(n.area-r.area)/Math.max(n.area,r.area)+o<0}c.length>n.length&&(c=c.splice(s,n.length));for(var g,f,d=a.sort(n,h),p=[],v=a.sort(c,h).concat(),F=[],_=a.iter(a.range(0,v.length,!1));!_.done;_.next())F.push([]);for(var I=a.iter(a.range(0,d.length,!1));!I.done;I.next()){var T=I.value,y=a.clone(d[T]),S=T%v.length;a.append(F[S],y)}for(var D=a.iter(a.range(0,v.length,!1));!D.done;D.next()){var b=D.value;F[b].length>0&&p.push({a:F[b],b:v[b]})}s>0&&p.length>0&&(g=C.TheoDocumentUtils.unionFinalFrame(p[0].a))&&(f=C.TheoDocumentUtils.unionFinalFrame(p[0].b))&&g.area>5*f.area||r.push(p)}return r},createFormaMatches:function(e,t){var r,o=this,i=t.page.document.beginTransaction("tagForma"),u=a.clone(t.filterWithCallback((function(e){return n.isGraphicDecoration(e,!0)})));u=u.filter((function(e){return!o.filterFormae_.includes(e.formaID)}),this);for(var c=a.iter(u);!c.done;c.next())c.value.setTag(n.FORMA_TYPE_TAG,n.FORMA_TYPE_DECORATION);var h=a.clone(e.filterWithCallback(n.isRemixedDecoration)),g=[{a:[],b:[]}];(p.Host.platform.isWeb||this.filterFormae_.length>0)&&(g=[{a:[],b:u}]),g.push({a:h,b:[]});var f=a.clone(e.filterWithCallback(n.getMoveable)),d=a.clone(t.filterWithCallback(n.getMoveable));d=d.filter((function(e){return!a.containsEq(u,e,s._equality_Forma_Forma)&&!o.filterFormae_.includes(e.formaID)&&((r=a.opt(a.as(e.controller,D.TypeLockupController),(function(e){return e.text.length})))||null!=r?r:2)>1}),this),f=f.filter((function(e){return!a.containsEq(h,e,s._equality_Forma_Forma)}),this);for(var v=a.clone(e.filterWithCallback(l.DesignFeatureUtils.isRetargetableImageFromUserDesign)),F=a.clone(t.filterWithCallback(l.DesignFeatureUtils.isRetargetableImageFromTemplate)),_=[],I=a.iter(a.range(0,F.length,!1));!I.done;I.next()){var T=I.value;F[T].setTag(n.FORMA_TYPE_TAG,n.FORMA_TYPE_CONTENT_IMAGE),T<v.length?_.push({a:[v[T]],b:[F[T]]}):_.push({a:[],b:[F[T]]})}i.end();var y=[],S=a.clone(this.getBasicMatch(e,t));S.push({a:f,b:d}),y.push(S);for(var C=a.clone(m.GroupDetector.detectProximityGroups(f,null,!1)),b=a.clone(m.GroupDetector.detectProximityGroups(d,e.bounds.height/this.origModelSize_.height*200,!1)),x=a.iter(this.matchDesignGroupsToModel(C,b));!x.done;x.next()){var R=x.value,E=[];a.append(E,R),a.append(E,_),a.append(E,g),a.append(E,this.getBasicMatch(e,t)),y.push(E)}return y},getBasicMatch:function(e,t){var r=[];r.push({a:[a.as(e,s.Forma)],b:[a.as(t,s.Forma)]});var n=a.clone(e.filterWithCallback((function(e){return a.opt(e.controller,(function(e){return e.kind==g.GridController.KIND}))}),s.FormaTraversal.JustChildren)),o=a.clone(t.filterWithCallback((function(e){return a.opt(e.controller,(function(e){return e.kind==g.GridController.KIND}))}),s.FormaTraversal.JustChildren));return r.push({a:[n[0]],b:[o[0]]}),r},createSuggestions:function(){for(var e=a.clone(this.createFormaMatches(this.originalRoot_,this.model)),t=this.model.filterWithCallback((function(e){return e.isTypeLockup()})).concat(this.originalRoot_.filterWithCallback((function(e){return e.isTypeLockup()}))),r=a.iter(t);!r.done;r.next()){var n=r.value;a.opt(a.as(n.controller,f.GroupController),(function(e){return e.beginBlockedUpdate()}))}for(var o=[],i=a.iter(a.range(0,e.length,!1));!i.done;i.next()){var l=i.value;o.push(new y.RetargetSuggestion(this.forma,this.originalRoot_,this.model,this.modelDoc_,e[l],l>0))}for(var u=a.iter(t);!u.done;u.next())n=u.value,a.opt(a.as(n.controller,f.GroupController),(function(e){return e.endBlockedUpdate()}));return o}}}),n)},"v/sv":function(e,t,r){var n,o=t,a=r("oAGj"),i=r("CaSj"),l=r("FNB+"),u=r("tQF8"),s=r("/afT"),c=r("pnSN"),h=r("TP4q"),g=r("bSZx"),f=r("Dq5S"),m=r("oKlP");o.GridCellContent=a.defineEnum("GridCellContent",{None:0,Image:1,Text:2,Count:3}),o.GridSuggester=(n=function(e,t,r){this.gridForma_=null,void 0===r&&(r=null),this.gridStyle_=t,this.preserveMapping_=a.clone(r),this.gridForma_=e},a.defineClass({name:"GridSuggester",ctor:n,superName:"CoreObject",statics:{KIND:{get:function(){return"GridSuggester"}},defaultWeights:[-.4869963787443057,.10451788427313968,-10,.3841333333333332,.1438482857676463,.05953378239352733,-.7134725705040772,-.7,.2460712826952826,1.7685714285714302,1.7685714285714302,-1.42857142857143,-1.42857142857143,.2857180890092063,.2915071572811428,-.2857180890092063,-.2915071572811428,-.1822757614386357,-.1502170111498276,-.13002813087151563,-.16114682148449702,.28162418627853086,.2916486562661698,.3658656280531089,.31731319724602053,-.05177320346844536,-.04974606109777501,-.03389292805397268,-.021441808254260175,.14285700582863953,.961358333706472,-2.871390476190484,2.531390476190476,-.4,-.6],styleWeightMatrix:{checkerBoard:[-4,.3,-.6,.4,.3,.2,-.7,-.7,0,0,0,0,0,0,0,0,0,0,0,0,0,2,2,2,2,0,0,0,0,0,2,-100,100,-.4,-.6],imageOnTop:[0,.3,-.4,.4,.3,.2,-.7,-.7,0,-5,5,5,-5,0,0,0,0,0,-100,0,100,1,-2,1,-2,0,0,0,0,0,.3,0,0,-.4,-.6],imageOnBottom:[0,.3,-.4,.4,.3,.2,-.7,-.7,0,-5,5,5,-5,0,0,0,0,0,100,0,-100,1,-2,1,-2,0,0,0,0,0,.3,0,0,-.4,-.6],imageLeft:[0,.3,-.4,.4,.3,.2,-.7,-.7,0,5,-5,-5,5,0,0,0,0,-100,0,100,0,-2,1,-2,1,0,0,0,0,0,.3,0,0,-.4,-.6],imageRight:[0,.3,-.4,.4,.3,.2,-.7,-.7,0,5,-5,-5,5,0,0,0,0,100,0,-100,0,-2,1,-2,1,0,0,0,0,0,.3,0,0,-.4,-.6],textTowardCenter:[0,.3,-.7,.4,.3,.2,-.7,-.7,0,5,5,-5,-5,1,1,-1,-1,0,0,0,0,5,5,-1,-1,100,100,-100,-100,1,0,0,0,-.4,-.6],imageTowardCenter:[0,.3,-.7,.4,.3,.2,-.7,-.7,0,5,5,-5,-5,1,1,-1,-1,0,0,0,0,-1,-1,5,5,-100,-100,100,100,0,5,0,0,-.4,-.6]}},props:{sortCells:function(e,t){return e.bounds.minY<t.bounds.minY||!(e.bounds.minY>t.bounds.minY)&&e.bounds.minX<t.bounds.minX},createPreservedGroupMatches:function(e,t){var r=e.concat();a.sortInPlace(r,this.sortCells);for(var n=[],o=a.iter(t);!o.done;o.next()){var l=o.value;a.containsEq(n,l,u._equality_GridCell_GridCell)||n.push(l)}a.sortInPlace(n,this.sortCells);for(var s=[],c=a.iter(n);!c.done;c.next())s.push([]);for(var h=a.iter(t);!h.done;h.next()){var g=h.key;l=h.value,s[a.indexOfEq(n,l,u._equality_GridCell_GridCell)].push(g)}for(var f=Math.max(s.length,r.length),m=a.clone(i.DesignSuggester.getPermutations(f)),d=[],p=a.iter(m);!p.done;p.next()){for(var v=p.value,F=!0,_={},I=a.iter(a.range(0,f,!1));!I.done;I.next())for(var T=I.value,y=a.clone(s[T%s.length]),S=a.iter(y);!S.done;S.next()){g=S.value;var C,D=r[v[T]%r.length];if(C=a.opt(this.gridForma_,(function(e){return e.formaByID(g)}))){if(C.isBackgroundImage()&&1!=D.opacity){F=!1;break}_[g]=D}}for(var b=!1,x=a.iter(d);!x.done;x.next()){var R=x.value;this.mappingEqual(_,R)&&(b=!0)}!b&&F&&d.push(_)}return d},createFormaMatches:function(e){if(null!=this.preserveMapping_&&a.count(this.preserveMapping_)>0)return this.createPreservedGroupMatches(e,this.preserveMapping_);for(var t=this.gridForma_,r=a.clone(t.filterWithCallback((function(e){return e.isBackgroundImage()}))),n=[],o=[],c=a.iter(a.range(0,e.length-1,!0));!c.done;c.next()){for(var h=e[Z=c.value],g=!1,f=a.iter(a.range(0,Z,!0));!f.done;f.next()){var d=e[f.value];!a.eq(u._equality_GridCell_GridCell,h,d)&&h.bounds.intersects(d.bounds)&&(g=!0,o.push(d))}g||n.push(h)}for(var p=Math.max(r.length,n.length),v=Math.max(250-20*r.length,100),F=a.clone(i.DesignSuggester.getPermutations(p,v)),_=[],I=a.iter(F);!I.done;I.next()){var T=I.value,y={};if(r.length>0)for(var S=a.iter(a.range(0,p,!1));!S.done;S.next())y[r[(Z=S.value)%r.length].formaID]=e[T[Z]%e.length];for(var C=!1,D=a.iter(_);!D.done;D.next()){var b=D.value;this.mappingEqual(y,b)&&(C=!0)}C||_.push(y)}for(var x=[],R=a.iter(t.visitAsArray(l.FormaTraversal.JustChildren));!R.done;R.next()){var E=R.value;E.controller.floating&&x.push(E)}a.sortInPlace(x,(function(e,t){return e.finalFrame.center.distanceTo(m.TheoPoint.ZERO)<t.finalFrame.center.distanceTo(m.TheoPoint.ZERO)}));var G=e.length-r.length;if(this.gridStyle_.moveableShift&&x.length>0){var L=[];if(x.length<=G)for(var k=a.iter(x);!k.done;k.next()){var A=k.value;L.push([A])}else L=a.clone(s.GroupDetector.detectProximityGroups(x));G>L.length&&(L=a.clone(s.GroupDetector.splitFormaGroups(L,G)));for(var M=[],N=a.iter(_);!N.done;N.next()){b=N.value;for(var O=a.clone(o),P=a.iter(b);!P.done;P.next()){var W=P.value;O.push(W)}for(var w=[],B=a.iter(e);!B.done;B.next()){h=B.value;for(var U=!1,Y=a.iter(O);!Y.done;Y.next()){var q=Y.value;a.eq(u._equality_GridCell_GridCell,q,h)&&(U=!0)}U&&0!=G||w.push(h)}a.shuffleInPlace(w);for(var H=a.iter([!1,!0]);!H.done;H.next()){var z=H.value;if((1==G||1==L.length)&&z)break;for(var X=a.clone(b),j=a.iter(a.range(0,L.length,!1));!j.done;j.next()){var Z=j.value,K=a.clone(L[Z]);z&&(K=a.clone(L[L.length-Z-1]));for(var V=a.iter(a.range(0,K.length,!1));!V.done;V.next())X[K[V.value].formaID]=w[Math.min(Z,w.length-1)]}M.push(X)}}_=a.clone(M)}return _},mappingEqual:function(e,t){for(var r=a.iter(e);!r.done;r.next()){var n=r.key,o=r.value;if(!a.eq(u._equality_GridCell_GridCell,t[n],o))return!1}return!0},createSuggestions:function(e){void 0===e&&(e=null);for(var t=[],r=a.iter(this.gridStyle_.gridCells);!r.done;r.next()){var o=r.value;t.push(o.clone())}var i=a.clone(this.createFormaMatches(t));if(0==i.length)return[];var l,u=[];if(l=this.gridForma_.root)for(var s=a.iter(i[0]);!s.done;s.next()){var m,d=s.key;o=s.value,(m=l.formaByID(d))&&(m.controller.floating||m.isBackgroundImage())&&u.push(f.LayoutItem.init_b14a(m))}var p=a.clone(null!=e?e:n.defaultWeights);t.length>5&&(p=a.clone(n.styleWeightMatrix.checkerBoard));for(var v=[],F=a.iter(i);!F.done;F.next()){var _=F.value,I=this.createGridStyle(t,_),T=new h.GridScore(I,this.gridForma_.frame,u,this.gridForma_,void 0,p);v.push(new g.GridSuggestion(a.as(this.gridForma_,c.GroupForma),I,T))}return a.sort(v,(function(e,t){return e.score>t.score}))},createGridStyle:function(e,t){for(var r=this.gridStyle_.clone(),n=[],o=a.iter(e);!o.done;o.next()){var i=o.value;n.push(i.clone())}for(var l={},u=a.iter(t);!u.done;u.next())for(var s=u.key,c=(i=u.value,a.iter(n));!c.done;c.next()){var h=c.value;if(i.bounds==h.bounds){l[s]=h;break}}return r.setGridCells(n.concat()),r.setFormaMapping(l),r.forma=this.gridForma_,r}}}),n)}}]);
//# sourceMappingURL=vendors_npm_spark_25fb5d13-bc3afc02.js.map