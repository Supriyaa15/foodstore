(window.webpackJsonptheoWebApp=window.webpackJsonptheoWebApp||[]).push([[54],{"2ofD":function(t,e,r){var o,n;o=[r("YLtl"),r("UFvF"),r("MOGj"),r("vw5A"),r("Uwho"),r("EQbI"),r("chD/"),r("rJP3"),r("+Ltv"),r("QX4k")],void 0===(n=function(t,e,r,o,n,a,i,s,c,l){const d=new a({name:"Post"}),u=l.default,h=s.default;return new(o.extend({getConfig:()=>({syncGroup:"adobe-theo",scope:"theo",newDocName:"theo-document",doctype:"application/vnd.adobe.theo.document+dcx"}),seedNewDoc(t){this.currentDoc.attributes.name=c.newPostNameCode},createDocFromConfig(t,e,n){switch(e.operation){case"new-from-template":this._createDocNew(t,e,n);break;case"edit-template":case"new-template-from-template":h.loadBrandKit(e.contextId).then(function(t){this.currentDoc=t.composite,r.setSyncMode(r.MODE_EDITOR,this.currentDoc),n.resolve(this.currentDoc)}.bind(this));break;case"remix":this._createDocNew(t,e,n);break;default:o.prototype.createDocFromConfig.apply(this,arguments)}},_remixCPAsset(t,o){const a=e.defer();o=o||n.cps;const s=new u({cpServiceDomain:o});return s.trackRepeatableActivity(t,"remix_count").catch(t=>{d.error("[Post] failed to update remix count",t)}),s.getAssetMetadataWithRetry(t).then((function(t){const e=t._links.dcx_base.href,o=r.AdobeDCXUtil.generateUuid(),n="/assets/adobe-theo/"+o,s=new Date;r.dcx.compositeXfer.remixComposite(e,"",n,o,"Spark Post",r.dcxSession,(function(t,r){if(t)d.error("[Post] remixComposite failed",{error:t,cpCompositeHref:e}),a.reject("[Post] remixComposite failed "+t);else{const t=new Date-s;i.trackEvent("PostRemixApiCall",{duration:t,contextData:["remixableAssetId","contextString"]},"post:remix"),a.resolve(o)}}))})).catch((function(e){d.error("[Post] getAssetMetadata failed",{error:e,assetId:t}),a.reject("[Post] getAssetMetadata failed "+e)})),a.promise},doRemix(t,e,r){return this._remixCPAsset(e,r).then(function(e){return this.createDocument({assetType:t,assetId:e})}.bind(this))},community:window.marvel.settings.theoc,communityCategory:"theos",avatarComponentPath:"/avatar",getData(t,e,r){if(!(e=e||this.currentDoc))return void console.error("no doc for getData");const o=e.getDCXRoot().getValue("doc#data");return o?r?o[r]&&o[r][t]:o[t]:void 0},setData(t,e,r,o){if(!(r=r||this.currentDoc))return void console.error("no doc for setData");const n=r.getDCXRoot(),a=n.getValue("doc#data")||{};let i=a;if(o&&(i=a[o],i||(i={},a[o]=i)),"object"==typeof t)for(const e in t)t.hasOwnProperty(e)&&(i[e]=t[e]);else i[t]=e;n.setValue("doc#data",a)}}))}.apply(e,o))||(t.exports=n)},"9KYx":function(t,e,r){"use strict";r.r(e);var o=r("UzQk"),n=r("7gWt"),a=r("ndZK"),i=r.n(a),s=r("Fb2u"),c=r.n(s),l=r("bBG2"),d=r("5XZq"),u=r("MGCh"),h=r.n(u),p=r("lulf"),f=r("LU24");const m={fetchJSON:function(t,e={}){return fetch(t,e).then(e=>{if(e.ok)return e.json();const r=`Fetch failed. ${e.status} with fetching ${t}.`;throw new Error(r)}).catch(t=>{throw t})},loadExternalScript:function(t,e=!0,r=!0){const o=new Promise((o,n)=>{const a=document.createElement("script");document.head.appendChild(a),a.onload=o,a.onerror=n,a.async=e,a.defer=r,a.src=t});return n.SparkPerformanceTracker.measurePromise(`${f.PERFORMANCE_MARKERS.loadExternalScript}:${t}`,o),o}},g={"CantataOne-Regular":"aF0f6cca952aef533",JollyLodger:"aF041dc2af59baf86","Monoton-Regular":"af89910b1459fd19e","SeaweedScript-Regular":"aFbcd779453b3d53b","VastShadow-Regular":"aF7cbbb58cdb60144",Voltaire:"afb0eb289e8a87050"},b=Object.keys(g),y={pyo5wti:["SourceSansPro-Black"],dby4kvp:["AmaticSC-Regular","Economica-Regular","GermaniaOne-Regular","JosefinSlab"],cdy0pnu:["CabinSketch-Bold","Pacifico-Regular","PTMono-Regular","Quicksand-Bold","SirinStencil-Regular"],gyu7rsa:["Graduate-Regular","KaushanScript-Regular","StintUltraExpanded-Regular","Ultra","Yellowtail"],ldd2ebb:["Lora-Regular","Megrim","Montserrat-Regular","PlayfairDisplay-Regular","PermanentMarker"],uvq6mwm:b},C=["Local Brewery","Voltage","Wanderlust","Bellfort Script"],F={"source-sans-pro":["n9"],"amatic-sc":["n4"],"cabin-sketch":["n7"],"cantata-one":[],economica:["n4"],"germania-one":[],graduate:[],"jolly-lodger":[],"josefin-slab":["n3"],"kaushan-script":[],lora:["n4"],megrim:[],monoton:[],montserrat:[],pacifico:[],"permanent-marker":[],"playfair-display":["n4"],"pt-mono":[],quicksand:["n7"],"seaweed-script":[],"sirin-stencil":[],"stint-ultra-expanded":[],ultra:[],"vast-shadow":[],voltaire:[],yellowtail:[]};function v(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,o)}return r}function S(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?v(Object(r),!0).forEach((function(e){w(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):v(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function w(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}const P=h.a.channel("util/fonts-utils.ts");function T(t){const e=document.createElement("span");return e.innerHTML="giItT1WQy@!-/#",e.setAttribute("style",`\n          position: absolute;\n          left: -10000px;\n          top: -10000px;\n          font-size: 300px;\n          font-family: ${t}\n        `),document.body.appendChild(e),e}function k(t,e="",r,o,n,a){const i=S({},t);return i.metrics=S(S(S({},i.metrics),{},{original_family:t.metrics.family,family:e},a&&{brandkitName:a}),{},{label:`${r} ${t.name}`,baseFont:r,isPublic:!0,isBKFont:!0,cssName:e,lookupKey:t.lookupKey,allCapsAllowed:!C.includes(r),acRoles:Array.isArray(o)?o:[],sparkElementId:n},t.metrics.weight>900&&{weight:900}),i}function A(t,e,r,n,a){const i=S({},t);return i.source=o.FontSource.USER_UPLOAD,i.isBKFont=!0,i.family=e,i.acRoles=Array.isArray(r)?r:[],i.sparkElementId=n,i.brandkitName=a,i.cssName=e,i}function x(t,e){return R(e,t)}function E(t){return D(t).then(t=>t["spark-provided"].subgroups).catch(t=>{P.error("Error processing brand fonts",t)})}function R(t,e){if(!t)return[];const r={name:t.getName()},o=e&&e.length?t.getFontsWithRoles(e):t.getAllFonts();return o.length?(r.fontFaces=o,[r]):[]}async function D(t){const e=[],r=await i.a.getFontRegistry(),n=[];return t&&t.forEach(t=>{t.fontFaces&&t.fontFaces.forEach(a=>{const i=a.getValue().source;if("spark-provided"===i)e.push(function(t,e,r,n){let a,i,s,c=Object.assign({},e.facesByKey[t.lookupKey()].face);return c.metrics.source=o.FontSource.SPARK_PROVIDED,a=e.facesByKey[t.lookupKey()].subgroup.name,i=Object.assign({},e.facesByKey[t.lookupKey()].subgroup),s=r.find(t=>t.name===a),s||(s={name:a,data:i},s.data.faces=[]),c=k(c,i.cssName,a,t.getRoles(),t.getId(),n),s.data.faces.push(c),s}(a,r,e,t.name));else if("user-uploaded"===i){const{subgroupFound:r,fontPromise:o}=function(t,e,r){let o,n,a,i=t.getMetrics();const s=t.cssName();o=i.familyName,i=A(i,s,t.getRoles(),t.getId(),r),n={cssName:s,name:void 0===i.preferredFamilyName?i.familyName:i.preferredFamilyName,typekitPreviewId:!1,paragraphRecommended:!1,serif:i.serif,calligraphic:i.calligraphic,faces:[]};const c=t.getCSSFontFaceAsync().then(t=>{n.cssFontFace=t}),l={metrics:i,gingerName:i.postScriptName,lookupKey:t.lookupKey(),name:t.subgroupName,path:"",typekitKey:"",getMetrics:()=>t.getMetrics(),getCSSFontFaceAsync:()=>t.getCSSFontFaceAsync(),getRoles:()=>t.getRoles(),getId:()=>t.getId(),cssName:()=>t.cssName(),isCustomFont:()=>t.isCustomFont()};return a=e.find(t=>t.name===o),a||(a={name:o,data:n},a.data.faces=[]),a.data.faces.push(l),{subgroupFound:a,fontPromise:c}}(a,e,t.name);n.push(o),e.push(r)}else"faux-font"===i||P.error("Skipping font from brandkit with invalid source: "+a.cssName())})}),await Promise.allSettled(n),{"spark-provided":{subgroups:e}}}const I={adjustSparkToPostMetrics:k,adjustUploadedToPostMetrics:A,constructEdgeWebFontString:function(t){let e="";for(const r in t)if(t.hasOwnProperty(r)){const o=t[r];e+=`${r}:${o.length?o.toString():"n4"}:all;`}return e.substr(0,e.length-1)},getBrandKitFonts:function(t,e){return E(x(t,e)).catch(t=>{P.error("Error getting spark fonts",t)})},getTestNode:T,getSparkProvidedFonts:x,parseFontsFromBK:R,processBrandKitFonts:E,sortAndDecorateBrandKitFonts:D,waitForWebfonts:function(t){const e=T("unknown-font-mci3jfoq2y"),r=e.offsetWidth,o=t.map(t=>T(t));let n,a=0;return document.body.removeChild(e),new Promise(t=>{n=window.setInterval(()=>{a+=1;for(let t=o.length-1;t>=0;t-=1)o[t].offsetWidth!==r&&(document.body.removeChild(o[t]),o.splice(t,1));(0===o.length||a>150)&&(o.length>0&&P.warn("Not all fonts were successfully loaded after 150 attempts."),clearInterval(n),t(!0))},50)})}};var N=r("ApVh"),B=r.n(N),O=r("e46Y"),U=r.n(O),L=r("Uwho"),M=r.n(L),j=r("tY4j"),K=r.n(j);const _=h.a.channel("util/typekit-fonts-utils.ts");function $(t){return B.a.getAccessToken().then(e=>{const r=M.a.cid,o=`${M.a.adobeFontsApiEndpoint}/v1/variations/${t}?include=full`,n={method:"GET",headers:{"X-Api-Key":r,Authorization:"Bearer "+e,"Content-Type":"application/json"}};return m.fetchJSON(o,n).then(t=>{if(t&&t.font&&t.font.sync&&t.font.sync.require_action)throw new Error("No access to premium font");return t}).catch(t=>{throw new Error("getTKFontVariation request encountered an error: "+t)})})}function W(t){return B.a.getAccessToken().then(e=>{const r=M.a.cid,o=M.a.adobeFontsApiEndpoint+"/v1/selections",n={method:"POST",headers:{"X-Api-Key":r,Authorization:"Bearer "+e,"Content-Type":"application/json"},body:`["${t}"]`};return m.fetchJSON(o,n).then(e=>{const r=e.find(e=>e.requested_id===t);if(!r)throw new Error("missing record");const o=r.variation;if(!o)throw new Error("missing variation property");return o}).catch(e=>(_.warn("activateTypekitFont request encountered an error",{error:e,typekitFontId:t}),Promise.reject(e)))})}function V(t){const e=`${M.a.adobeFontsMetricsService}/${t}.json`;return m.fetchJSON(e,{type:"GET",dataType:"json"}).catch(()=>{throw Error("Error getting metrics from TypeKit service.")})}function H(t){return new Promise((e,r)=>{TypekitPreview.load([t],{active:()=>{e()},inactive:()=>{r("inactive font")}})})}const G={activateTypekitFont:W,attemptToActivateTypekitFont:function(t){return t?K()(W,{maxAttempts:3,delay:200})(t):Promise.reject("Error: attempted to activate a null tkSyncFontId")},attemptToGetTKFontVariation:function(t){return t?K()($,{maxAttempts:3,delay:200})(t):Promise.reject("Attempted to get a null tkFontVariationIdOrPSName.")},attemptToGetTypekitFontMetrics:function(t,e,r={},o={}){if(!t)return Promise.reject("Attempted to get null variationId");const n=r[e]||r[o[t]];return n?Promise.resolve(n):K()(V,{maxAttempts:3,delay:200})(t).then(r=>(U.a.addPageAction("post_web_typekit_metrics",{status:"succeeded",postScriptName:e,typekitFontId:t}),o[t]||(o[t]=r.postScriptName),r)).catch(r=>{throw U.a.addPageAction("post_web_typekit_metrics",{status:"failed",postScriptName:e,typekitFontId:t}),r})},getFontMetricsFromTypekitService:V,getTKFontVariation:$,loadTypekitFontViaPreview:H,attemptToLoadTypekitFontViaPreview:function(t){return K()(H,{maxAttempts:3,delay:200})(t)}};function z(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}const X=h.a.channel("util/fonts.ts");e.default=new class{constructor(){z(this,"featureController",new p.default),z(this,"fontDataCache",{}),z(this,"typeKitIdPostScriptNameLookup",{}),z(this,"fontPromises",{}),z(this,"currentAuthoringContext",null),z(this,"loadingTimes",{edge:0,standardTypekit:0,brandkitTypekit:0,uploaded:0}),z(this,"STANDARD_FONT_FACES_DICT",d.a.fonts.reduce((t,e)=>{const r=e.postScriptName;return X.assert(!(r in t),"Did not expect to add the same key twice to STANDARD_FONT_FACES_DICT dictionary."),t[r]=Object.assign({},e),t},{})),z(this,"defaultFont",this.STANDARD_FONT_FACES_DICT["SourceSansPro-Black"]),z(this,"selectableStandardFontFaces",void 0),z(this,"edgeWebFontsDict",void 0),z(this,"subgroupForStandardFontDict",void 0)}loadEdgeFonts(t){const e=this.getEdgeWebFontsDict(),r=t.faces.reduce((t,r)=>{const o=(r&&(r.metrics||r.getMetrics&&r.getMetrics())).family.toLowerCase();return t[o]=e[o],t},{});X.info(`Start loading ${Object.keys(r).length} edge fonts.`);const o=Date.now(),a=I.constructEdgeWebFontString(r),i=`https://use.edgefonts.net/${a}.js`;return m.loadExternalScript(i).then(()=>{const t=I.waitForWebfonts(Object.keys(r)).then(()=>!0);return n.SparkPerformanceTracker.measurePromise(`${f.PERFORMANCE_MARKERS.loadEdgeFont}:${a}`,t)}).catch(t=>(X.error("getScript error loading edge web fonts",t),!1)).finally(()=>{const t=Date.now()-o;X.info(`Done loading${Object.keys(r).length} edge fonts in ${t} ms.`),this.loadingTimes.edge+=t})}loadTypekitFonts(t){const e=t.typekitSubgroupKitId;X.info("Start loading TypeKit fontID: "+e);const r=Date.now();return m.loadExternalScript("https://ajax.googleapis.com/ajax/libs/webfont/1.6.26/webfont.js").then(()=>{const t=new Promise(t=>{WebFont.load({typekit:{id:e},active:()=>{t(!0)},inactive:()=>{t(!0)}})});return n.SparkPerformanceTracker.measurePromise(`${f.PERFORMANCE_MARKERS.loadTypekitFont}:${e}`,t)}).catch(t=>(X.error("getScript error loading webfont typekit kit "+t),!1)).finally(()=>{const t=Date.now()-r;X.info(`Done loading TypeKit fontID: ${e} in ${t} ms.`),"ujm6jju"===e||y.hasOwnProperty(e||"")?this.loadingTimes.standardTypekit+=t:this.loadingTimes.brandkitTypekit+=t})}getSparkFontsSubgroupNameForPostScriptName(t){for(const e in c.a.sparkfonts)if(c.a.sparkfonts.hasOwnProperty(e)){const r=c.a.sparkfonts[e];for(const o of r.faces)if(o.metrics.postScriptName===t)return e}}getSparkFontDataForSubgroup(t){return c.a.sparkfonts[t]}loadNewUploadedFont(t){return this.processAndLoadSingleUploadedFont(t)}async loadMissingFonts(t){const e=[];for(const r of t)r in this.fontPromises||(r in this.STANDARD_FONT_FACES_DICT?this.loadStandardFont(this.STANDARD_FONT_FACES_DICT[r]):e.push(r));e.length>0&&await this.loadBrandFontsByPostScriptNameWithRoles(e,null);const r=t.map(t=>(X.assert(t in this.fontPromises,"Failed to find loading promise for font: "+t),this.fontPromises[t]));return Promise.allSettled(r)}loadCurrentBrandFonts(){return this.loadBrandFontsByPostScriptNameWithRoles()}loadAllStandardFonts(){const t=Object.keys(this.STANDARD_FONT_FACES_DICT);return this.loadMissingFonts(t)}getDefaultFont(){return this.defaultFont}getCachedFonts(){return Object.keys(this.fontDataCache)}loadFont(t){X.assert(!(!t||!t.metrics),"Invalid fontInfo instance.");const e=t.metrics.postScriptName;let r;return r=e in this.fontPromises?Promise.resolve():this.loadMissingFonts([e]),r.then(()=>(X.assert(e in this.fontPromises,"Font loading mechanism should have added pending promises for every font face."),this.fontPromises[e]))}resetLoadingTimes(){for(const t in this.loadingTimes)this.loadingTimes.hasOwnProperty(t)&&(this.loadingTimes[t]=0)}logLoadingTimes(){const{loadingTimes:t}=this;l.default.publish("post:fontsLoadEnd",{contextualData1:"edgeFontsElapsedMs: "+t.edge,contextualData2:"standardTypekitFontsElapsedMs: "+t.standardTypekit,contextualData3:"brandkitTypekitFontsElapsedMs: "+t.brandkitTypekit,contextualData4:"brandkitUploadedFontsElapsedMs: "+t.uploaded})}load(t={}){this.resetFontDataCache(),Object.keys(this.fontPromises).forEach(t=>{delete this.fontPromises[t]});const e=o.Host&&o.Host.fontProvider&&o.Host.fontProvider.getIncludedFonts(null);for(;e&&e.count>0;){const t=e.fontAt(0);t&&e.remove(t)}const r=o.Host&&o.Host.fontProvider&&o.Host.fontProvider.getSuggestableFonts(null);for(;r&&r.count>0;){const t=r.fontAt(0);t&&r.remove(t)}const n=[];return t.loadForEditor&&(n.push(this.loadDefaultFallbackFont()),n.push(this.loadBrandWithRoles(t.authoringContext))),Promise.allSettled(n)}setAuthoringContext(t){this.currentAuthoringContext=t}switchBrandContext(t){return this.resetFontDataCache(),this.loadBrandWithRoles(t,["headline-font","body-font"])}registerDownloadedTypekitFontByACFontFace(t){const e=t.tkVariationId()||"",r=t.friendlyName();return G.attemptToGetTypekitFontMetrics(e,r,this.fontDataCache,this.typeKitIdPostScriptNameLookup).then(t=>this.registerTypekitFont(t)).catch(t=>{throw new Event("registerDownloadedTypekitFontByACFontFace: failed to get typekit font metrics "+t)})}registerTypekitFont(t){const e=t&&t.postScriptName;return t&&e?(t.source=t.syncAvailability&&t.syncAvailability.trial?o.FontSource.TYPEKIT_FREE:o.FontSource.TYPEKIT_PREMIUM,o.Host.fontProvider&&o.Host.fontProvider.loadOneFont(t),this.fontDataCache[e]=t,o.Host.fontProvider?o.Host.fontProvider.descriptorForPostScriptName(e,null):null):null}getRegisteredTypekitFontPostScriptName(t){return this.typeKitIdPostScriptNameLookup[t]}getFontData(t){return this.fontDataCache[t]}updateNonStandardFontCachedData(t){t.faces.forEach(t=>{const e=t.metrics||t.getMetrics&&t.getMetrics();if(X.assert(!(!e||!e.postScriptName),"Invalid metrics instance."),e.postScriptName in this.fontDataCache){const t=this.fontDataCache[e.postScriptName];t.acRoles&&e.acRoles?(t.isBKFont=!0,t.acRoles=e.acRoles):(t.isBKFont=!0,t.brandkitName=e.brandkitName,t.acRoles=e.acRoles,t.sparkElementId=e.sparkElementId,t.baseFont=e.baseFont,t.label=e.label)}else this.fontDataCache[e.postScriptName]=e})}loadFontSubgroup(t,e){if(!t)return Promise.resolve();let r;return e||this.updateNonStandardFontCachedData(t),r=t.faces.length>0&&"function"==typeof t.faces[0].isCustomFont&&t.faces[0].isCustomFont()?this.loadUploadedFont(t):"edge"===t.deliveryMethod?this.loadEdgeFonts(t):this.loadTypekitFonts(t),t.faces&&t.faces.forEach(t=>{const n=t.metrics||t.getMetrics&&t.getMetrics();this.fontPromises[n.postScriptName]=r.then(t=>{if(t)return!n.isPostFont||n.source&&n.source!==o.FontSource.UNKNOWN_SOURCE||(n.source=o.FontSource.EMBEDDED),o.Host.fontProvider&&o.Host.fontProvider.loadOneFont(n),n;e||delete this.fontDataCache[n.postScriptName],delete this.fontPromises[n.postScriptName]})}),r}loadStandardFont(t){const e=t.postScriptName;if(t.family.toLowerCase()in this.getEdgeWebFontsDict())return this.loadFontSubgroup({deliveryMethod:"edge",faces:[{metrics:t}]},!0);const r=this.getSubgroupForStandardFontDict()[e];return this.loadFontSubgroup(r,!0)}loadDefaultFallbackFont(){return this.loadStandardFont(this.defaultFont)}useEdgeWebFonts(){return!this.featureController.featureEnabled("post-migrate-edge-web-fonts")}isStandardFontSelectable(t){return this.useEdgeWebFonts()||-1===b.indexOf(t)}getSelectableStandardFonts(){if(this.selectableStandardFontFaces)return this.selectableStandardFontFaces;const t=Object.values(this.STANDARD_FONT_FACES_DICT).filter(t=>this.isStandardFontSelectable(t.postScriptName));return this.selectableStandardFontFaces=t,t}getEdgeWebFontsDict(){if(this.edgeWebFontsDict)return this.edgeWebFontsDict;const t=this.useEdgeWebFonts()?F:{};return this.edgeWebFontsDict=t,t}getSubgroupForStandardFontDict(){if(this.subgroupForStandardFontDict)return this.subgroupForStandardFontDict;const t={},e={},r=this.getEdgeWebFontsDict();return Object.values(this.STANDARD_FONT_FACES_DICT).forEach(o=>{const n=this.getKitIdForStandardFont(o,r);if(n){const r=o.postScriptName,a=g[r];a&&(o.cssName=a);const i=t[n],s=this.addStandardTypekitFontToSubgroup(o,n,i);t[n]=s,e[o.postScriptName]=s}}),this.subgroupForStandardFontDict=e,e}getKitIdForStandardFont(t,e){if(t.family.toLowerCase()in e)return;const r=Object.entries(y).find(([,e])=>-1!==e.indexOf(t.postScriptName));return(null==r?void 0:r[0])||"ujm6jju"}addStandardTypekitFontToSubgroup(t,e,r){let o=r;return o?o.faces.push({metrics:t}):o={deliveryMethod:"typekit",typekitSubgroupKitId:e,faces:[{metrics:t}]},o}processAndLoadSingleUploadedFont(t){const e=t.getMetrics(),r=t.cssName();return t.metrics=I.adjustUploadedToPostMetrics(e,r,t.getRoles(),t.getId(),t.name),t.getCSSFontFaceAsync().then(e=>{const o={cssName:r,cssFontFace:e,faces:[t]};return this.loadFontSubgroup(o,!1)})}loadUploadedFont(t){const e=t.faces.map(t=>(t.metrics||t.getMetrics&&t.getMetrics()).fullName);X.info(`Start loading uploaded font(s): "=${e.join('", "')}"`);const r=Date.now(),o=new Promise(e=>{try{const r=t.cssName,o=t.cssFontFace,n=document.createElement("style");n.type="text/css",n.innerHTML=o,n.className=r;const a=document.head.querySelectorAll("style."+r);a&&a.forEach(t=>{t.parentNode&&t.parentNode.removeChild(t)}),document.getElementsByTagName("head")[0].appendChild(n),I.waitForWebfonts([r]).then(()=>e(!0))}catch(t){X.error("Error loading uploaded font",t),e(!1)}});return o.finally(()=>{const t=Date.now()-r;X.info(`Done loading uploaded font(s): "${e.join('", "')}" in ${t} ms.`),this.loadingTimes.uploaded+=t}),o}loadBrandFontsByPostScriptNameWithRoles(t,e){return I.getBrandKitFonts(e,this.currentAuthoringContext).then(e=>{const r={},n={};for(const t of e){const e=t.data.faces;n[t.name]=t.data;for(const t of e){r[t.metrics.postScriptName]=t}}const a={},s=[],c=t||Object.keys(r),l=[];for(const t of c){if(t in this.fontPromises){if(r[t]&&r[t].metrics){const e=r[t].metrics;this.fontDataCache[t]=e,this.fontPromises[t]=Promise.resolve(e)}else s.push(this.fontPromises[t].then(t=>{if(!this.fontDataCache[t.postScriptName])return this.fontDataCache[t.postScriptName]=t,t}));continue}const e=r[t],i=e&&e.metrics,c=i&&i.source===o.FontSource.SPARK_PROVIDED?this.getSparkFontsSubgroupNameForPostScriptName(t):void 0;void 0!==c?(c in n||(n[c]=this.getSparkFontDataForSubgroup(c)),c in a||(a[c]=!0,s.push(this.loadFontSubgroup(n[c],!1)),n[c].faces.forEach(t=>{const e=this.fontDataCache[t.metrics.postScriptName];e&&(e.acRoles&&t.metrics.acRoles?(e.isBKFont=!0,t.metrics.acRoles.forEach(t=>{e.acRoles&&-1===e.acRoles.indexOf(t)&&e.acRoles.push(t)})):(e.isBKFont=!0,e.brandkitName=t.metrics.brandkitName,e.acRoles=t.metrics.acRoles,e.sparkElementId=t.metrics.sparkElementId,e.baseFont=t.metrics.baseFont,e.label=t.metrics.label))}))):e?s.push(this.processAndLoadSingleUploadedFont(r[t])):l.push(t)}if(0===l.length)return Promise.allSettled(s);return i.a.inject().then(()=>{for(const t of l)s.push(this.loadMissingTypekitFontByPostScriptName(t));return Promise.allSettled(s)}).catch(t=>{throw X.error("SparkFonts.inject failed",t),t})})}loadBrandWithRoles(t,e=["headline-font"]){return this.setAuthoringContext(t),this.loadBrandFontsByPostScriptNameWithRoles(null,e)}resetFontDataCache(){for(const t in this.fontDataCache)this.fontDataCache[t].isBKFont&&delete this.fontDataCache[t];Object.values(this.STANDARD_FONT_FACES_DICT).forEach(t=>{t.isBKFont&&(delete t.isBKFont,delete t.acRoles),this.fontDataCache[t.postScriptName]=t})}loadMissingTypekitFontByPostScriptName(t){let e,r;const o=G.attemptToGetTKFontVariation(t).then(t=>{e=t;const r=e.font.sync.font_id||"";return G.attemptToActivateTypekitFont(r)}).then(()=>G.attemptToGetTypekitFontMetrics(e.id,t,this.fontDataCache,this.typeKitIdPostScriptNameLookup)).then(t=>{r=t;const e={id:t.familyId,variations:[t.tkVariation],css_name:t.cssName};return G.attemptToLoadTypekitFontViaPreview(e)}).then(()=>(this.registerTypekitFont(r),!0)).catch(e=>{const r=this.featureController.featureEnabled("entitle-brand-kit")?"YES":"NO";throw X.error(`Error loading missing typekit font with postScriptName ${t}  Entitled:${r}`,e),delete this.fontPromises[t],delete this.fontDataCache[t],e});return this.fontPromises[t]=o,o}}},CTED:function(t,e,r){var o,n;o=[r("MGCh")],void 0===(n=function(t){return function(e){var r=t.channel("LFUCache"),o={},n=e,a={};return o.get=function(t){return t in a?(a[t].hits+=1,a[t].value):null},o.set=function(t,e){if(Object.keys(a).length>n){var r=Number.MAX_VALUE,o=null;for(var i in a)a[i].hits<r&&(r=a[i].hits,o=i);this.remove(o)}a[t]={value:e,hits:0}},o.remove=function(t){r.assert(t in a,"Failed to remove missing key from cache."),delete a[t]},o}}.apply(e,o))||(t.exports=n)},LU24:function(t,e,r){"use strict";r.r(e),r.d(e,"PERFORMANCE_MARKERS",(function(){return o}));const o={addCompositeAsset:"add-composite-asset-start",addCompositeComplete:"add-composite-complete",addCompositeCompleteSincePreload:"add-composite-complete-since-preload",addCompositeGotManifestAndDom:"add-composite-got-manifest-and-dom",addCompositePreloadedBlobs:"add-composite-preloaded-blobs",addCompositeTempDocCreated:"add-composite-temp-doc",addImageComplete:"add-new-image-complete",addImageFullFlowComplete:"add-new-image:full:complete",addImageLoadLowResComplete:"add-new-image:load-low-res:complete",addImageLowResSave:"add-new-image-low-save",addImageStart:"add-new-image:start",addImage:"add-new-image-start",artworkFromURLComplete:"theo-artwork-from-url-complete",artworkFromURLStart:"theo-artwork-from-url-start",docSave:"save-document-start",docSaveComplete:"save-document-complete",editorDisplayed:"editor-displayed",fetchingTheoController:"fetch-theo-controller",finalizeEditorUIState:"theo-finalize-editor-ui",getRemixParent:"theo-get-remix-parent",initBrandKit:"theo-init-brand-kit",initCoreWrapper:"theo-init-core-wrapper",initDesign:"theo-init-design",initLocalization:"theo-init-localization",initWatermark:"theo-init-watermark",initialPosterRenderStart:"update-poster-start",initialPosterRenderComplete:"post:posterInitialRenderEnd",loadEdgeFont:"load-edge-font",loadExternalScript:"theo-load-external-script",loadFonts:"theo-load-fonts",loadImage:"theo-load-image",loadMissingFonts:"theo-load-missing-fonts",loadTypekitFont:"load-typekit-font",loadCPFileMark:"load-cp-file",loadCPCompositeMark:"load-cp-composite",logo:"add-new-logo-start",logoComplete:"add-new-logo-complete",preserveImageAdjustmentsForCutout:"preserve-image-adjustments-for-cutout",preserveImageAdjustmentsForCutoutComplete:"preserve-image-adjustments-for-cutout-complete",refreshCurrentBrandElements:"theo-refresh-brand-elements",saveProjectFromEditor:"saveProjectFromEditor",saveProjectFromEditorComplete:"saveProjectFromEditor:end",skeletonUIComplete:"theo-skeleton-ui-complete",skeletonUIStart:"theo-skeleton-ui-start",startFromScratch:"createStartFromScratchProject",startFromScratchComplete:"createStartFromScratchProjectComplete",startup:"theo-startup",templateRemix:"createFromTemplateProject",templateRemixComplete:"createFromTemplateProjectComplete",validateRemix:"theo-validate-remix"};e.default={PERFORMANCE_MARKERS:o}},Mn87:function(t,e,r){"use strict";r.d(e,"b",(function(){return o})),r.d(e,"c",(function(){return n})),r.d(e,"a",(function(){return a}));const o="headline-font",n="body-font",a="Brand"},QX4k:function(t,e,r){"use strict";r.r(e),r.d(e,"default",(function(){return l}));var o=r("Uwho"),n=r.n(o),a=r("tY4j"),i=r.n(a),s=r("MGCh");const c=r.n(s).a.channel("util/cp.js");class l{constructor({cpServiceDomain:t}){var e,r,o;o=void 0,(r="cpServiceDomain")in(e=this)?Object.defineProperty(e,r,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[r]=o,this.cpServiceDomain=t||n.a.cps}trackRepeatableActivity(t,e){const r={method:"POST",headers:{"Content-Type":"application/json;charset=UTF-8","X-Api-Key":n.a.cpkey},body:`{ "verb": "${e}" }`},o=`https://${this.cpServiceDomain}/api/v2/${n.a.theoc}/assets/${t}/activities`;return window.fetch(o,r).catch(t=>{const e=`trackRepeatableActivity: ${t.message} for ${o}`;c.error(e,t);const r=new Error(e);return Promise.reject(r)})}getAssetMetadata(t){const e=`https://${this.cpServiceDomain}/api/v2/${n.a.theoc}/assets/${t}`,r={method:"GET",headers:{"X-Api-Key":n.a.cpkey}};return window.fetch(e,r).then(t=>{if(!t.ok)throw new Error(`Error getting CP metadata: [${t.status}] ${t.statusText}`);return t.json()}).catch(t=>{c.error(`getAssetMetadata: ${t.message} and cpkey is ${n.a.cpkey}, cpServiceDomain is ${this.cpServiceDomain}`,t);const r=new Error(`getAssetMetadata: ${t.message} for ${e}`);return Promise.reject(r)})}getAssetMetadataWithRetry(t,e=3){return i()(this.getAssetMetadata.bind(this),{maxAttempts:e})(t)}}},TdwW:function(t,e,r){var o,n;o=[r("UzQk")],void 0===(n=function(t){var e={},r=/^([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/;function o(t){var e=(t=Math.round(t)).toString(16);return 1===e.length?"0"+e:e}e.hex2rgb=function(t){if(t){var e=r.exec(t);return{r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)}}},e.hex2rgba=function(t){var r=e.hex2rgb(t);return r.a=1,r},e.hex2hsv=function(t){return e.rgb2hsv(e.hex2rgb(t))},e.hex2SolidColor=function(r){var o=e.hex2rgba(r);return t.SolidColor.decodeJson({red:o.r/255,green:o.g/255,blue:o.b/255,alpha:o.a||1})},e.hsv2rgb=function(t){var e,r,o,n,a,i,s,c,l=t.h/360,d=t.s/100,u=t.v/100;switch(i=u*(1-d),s=u*(1-(a=6*l-(n=Math.floor(6*l)))*d),c=u*(1-(1-a)*d),n%6){case 0:e=u,r=c,o=i;break;case 1:e=s,r=u,o=i;break;case 2:e=i,r=u,o=c;break;case 3:e=i,r=s,o=u;break;case 4:e=c,r=i,o=u;break;case 5:e=u,r=i,o=s}return{r:Math.floor(255*e),g:Math.floor(255*r),b:Math.floor(255*o)}},e.hsv2hex=function(t){var r=e.hsv2rgb(t);return e.rgb2hex(r)},e.hsl2rgb=function(t){function e(t,e,r){return t>1?t-=1:t<0&&(t+=1),6*t<1?r+6*(e-r)*t:2*t<1?e:3*t<2?r+(e-r)*(2/3-t)*6:r}var r,o,n,a=t.h/360,i=t.s,s=t.l;if(0===i)r=o=n=255*s;else{var c,l,d=a,u=a-1/3;r=255*e(a+1/3,c=s<.5?s*(1+i):s+i-s*i,l=2*s-c),o=255*e(d,c,l),n=255*e(u,c,l)}return{r:r,g:o,b:n}},e.rgb2hex=function(t){return o(t.r)+o(t.g)+o(t.b)},e.rgb2hsl=function(t){var e,r,o=t.r/255,n=t.g/255,a=t.b/255,i=Math.min(o,n,a),s=Math.max(o,n,a),c=(i+s)/2;if(i===s)r=0,e=0;else{var l=s-i;r=c>.5?l/(2-s-i):l/(s+i),e=s===o?(n-a)/l:s===n?2+(a-o)/l:4+(o-n)/l,(e*=60)<0&&(e+=360)}return{h:e,s:r,l:c}},e.rgb2hsv=function(t){var e,r,o,n,a,i=t.r/255,s=t.g/255,c=t.b/255,l=Math.max(i,s,c),d=l-Math.min(i,s,c),u=function(t){return(l-t)/6/d+.5};return 0===d?n=a=0:(a=d/l,e=u(i),r=u(s),o=u(c),i===l?n=o-r:s===l?n=1/3+e-o:c===l&&(n=2/3+r-e),n<0?n+=1:n>1&&(n-=1)),{h:Math.round(360*n),s:Math.round(100*a),v:Math.round(100*l)}},e.rgb2SolidColor=function(e){return t.SolidColor.decodeJson({red:e.red/255,green:e.green/255,blue:e.blue/255,alpha:e&&e.hasOwnProperty&&e.hasOwnProperty("alpha")?e.alpha:1})},e.solidColor2Rgba=function(t){return t?{r:Math.floor(255*t.red),g:Math.floor(255*t.green),b:Math.floor(255*t.blue),a:t.alpha}:t},e.solidColor2TheoColor=function(e,r,o){return t.TheoColor.init_5344(e,r,o)},e.rgb2ValidCSSValues=function(t){return{red:Math.round(t.red),green:Math.round(t.green),blue:Math.round(t.blue),alpha:t.alpha||1}},e.toCSS=function(t){if(!t)return"#000000";if(void 0!==t.red||void 0!==t.r){var r=void 0!==t.red?t.red:t.r,o=void 0!==t.green?t.green:t.g,n=void 0!==t.blue?t.blue:t.b,a=void 0!==t.alpha?t.alpha:t.a,i=e.rgb2ValidCSSValues({red:r,green:o,blue:n,alpha:a});return"rgba("+i.red+","+i.green+","+i.blue+","+(void 0===a?1:a)+")"}return"string"==typeof t&&6===t.length?"#"+t:"#000000"},e.darken=function(t,e){var r=e/100;return t.r=t.r-t.r*r,t.g=t.g-t.g*r,t.b=t.b-t.b*r,t},e.lighten=function(t,e){var r=e/100;return t.r=t.r+(255-t.r)*r,t.g=t.g+(255-t.g)*r,t.b=t.b+(255-t.b)*r,t},e.mixRgb=function(t,e,r){r=0===r?0:r||50,t.a=t.a||1,e.a=e.a||1;var o,n=r/100,a=2*n-1,i=e.a-t.a,s=1-(o=((o=a*i==-1?a:(a+i)/(1+a*i))+1)/2);return{r:Math.floor(e.r*o+t.r*s),g:Math.floor(e.g*o+t.g*s),b:Math.floor(e.b*o+t.b*s),a:e.a*n+t.a*(1-n)}};var n=function(t,e){return 255-(255-t)*(255-e)/255};return e.blendRgb=function(t,e){return{r:n(t.r,e.r),g:n(t.g,e.g),b:n(t.b,e.b)}},e}.apply(e,o))||(t.exports=n)},WaK9:function(t,e,r){"use strict";var o=r("XKq+");function n(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}class a extends o.a{constructor(t){const{id:e,acRoles:r,rgb:o,hex:a,isBaseColor:i,isDerived:s}=t;super({id:e,acRoles:r}),n(this,"red",void 0),n(this,"green",void 0),n(this,"blue",void 0),n(this,"alpha",void 0),n(this,"hex",void 0),n(this,"isBaseColor",void 0),n(this,"isDerived",void 0),this.red=o.red||o.r||0,this.green=o.green||o.g||0,this.blue=o.blue||o.b||0,this.alpha=o.alpha||1,this.hex=a,this.isBaseColor=i,this.isDerived=s}rgb(){const{red:t,green:e,blue:r,alpha:o}=this;return{red:t,green:e,blue:r,alpha:o}}}e.a=a},"XKq+":function(t,e,r){"use strict";function o(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}e.a=class{constructor(t){o(this,"id",void 0),o(this,"acRoles",void 0);const{id:e,acRoles:r}=t;this.id=e,this.acRoles=r}getRoles(){return this.acRoles}getId(){return this.id}}},YYuT:function(t,e,r){"use strict";r.r(e);var o=r("Shoh"),n=r.n(o),a=r("ndZK"),i=r.n(a),s=r("U44B"),c=r.n(s),l=r("l+ZV"),d=r("MGCh"),u=r.n(d),h=r("WaK9"),p=r("XKq+");function f(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}class m extends p.a{constructor(t){const{id:e,acRoles:r,descriptor:o,lookupKey:n}=t;super({id:e,acRoles:r}),f(this,"descriptor",void 0),f(this,"lookupKey",void 0),this.descriptor=o,this.lookupKey=n}}var g=m;function b(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}class y extends p.a{constructor(t){const{id:e,acRoles:r,acName:o,url:n,fullResUrl:a,pixelWidth:i,pixelHeight:s,mimeType:c}=t;super({id:e,acRoles:r}),b(this,"acName",void 0),b(this,"url",void 0),b(this,"fullResUrl",void 0),b(this,"pixelWidth",void 0),b(this,"pixelHeight",void 0),b(this,"mimeType",void 0),this.acName=o,this.url=n,this.fullResUrl=a,this.pixelWidth=i,this.pixelHeight=s,this.mimeType=c}}var C=y,F=r("a8ov"),v=r("Mn87");const S=u.a.channel("brandkit-utils");class w{static async fontThingToFontInfo(t){if(!t)throw new Error("fontThingToFontInfo: no font to inspect");if("function"==typeof t.getMetrics){const e=await(t.getMetrics()||t.getMetricsAsync());return{metrics:e,id:t.getId&&t.getId(),acRoles:e.acRoles||t.getRoles&&t.getRoles()||[],lookupKey:t.lookupKey(),fontFace:t}}if("function"==typeof t.getInfo){const e=await t.getInfo(),r=await i.a.getFont(e.lookupKey);return{fontData:r,id:t.getId(),metrics:r.face.metrics,acRoles:r.face.metrics.acRoles||t.getRoles&&t.getRoles()||[],lookupKey:r.face.lookupKey}}throw new Error("fontThingToFontInfo: font is not a recognized type")}static fontInfoToCoreBrandFont(t){if(!t)return;const e=t.metrics||t;let r=e.postScriptName||"",o=c.a&&c.a.fontProvider&&c.a.fontProvider.descriptorForPostScriptName(r,null);return o&&o.postScriptName===r||(S.error("fontInfoToCoreBrandFont: did not find font with psname "+r),r="PTSans-Regular",o=c.a&&c.a.fontProvider&&c.a.fontProvider.descriptorForPostScriptName(r,null)),new g({id:t.id||t.sparkElementId,acRoles:t.acRoles||e.acRoles,descriptor:o&&o,lookupKey:t.lookupKey})}static async brandKitLogoToCoreBrandLogo(t,e){const r=await e.getHrefAsync(),o=e.getData(),n=t.composite.getDCXComposite().current.getComponentsOf(o)[0],a=F.default.encodeAuthoringContextUrl(t.getId(),n.id,n.etag.replace(/"/g,""),n.type),i=await Object(l.loadImagePromise)(r);return new C({fullResUrl:r,id:e.getId(),acRoles:e.getRoles(),acName:e.getName(),url:a,pixelWidth:i.width,pixelHeight:i.height,mimeType:n.type})}static brandKitColorToCoreBrandColor(t){return new h.a({id:t.getId(),acRoles:t.getRoles(),rgb:t.rgb(),hex:t.hex(),isBaseColor:t.isBaseColor(),isDerived:t.isDerived()})}static getCoreBrandFromAuthoringContextElements(t){const e={id:t.id,name:t.name,urn:t.urn,activated:t.activated,isDefault:t.isDefault,ownedByCurrentUser:t.belongsToUser,colors:t.colors,logos:t.logos||[],fonts:[]};return t.fonts&&(e.fonts=t.fonts.map(t=>w.fontInfoToCoreBrandFont(t))),e}static async getCoreBrandForTemplateGeneration(t){try{const e=await w.getCoreBrandColorsFromAuthoringContext(t),r=await w.getPrimaryBrandFontPairing(t),o=await w.getPrimaryBrandLogo(t);return{colors:e,fonts:r,fontCategories:await w.getFontCategories(t),id:t&&t.getId(),name:t&&t.getName(),urn:t&&t.getURN(),logos:o&&[o]||[]}}catch(t){throw t}}static async getLiteCoreBrand(t){if(!t||!t.primaryLogoPromise)return;const e=await t.primaryLogoPromise,r=Object.assign({},t);return r.logos=e?[e]:[],w.getCoreBrandFromAuthoringContextElements(r)}static async getPrimaryBrandLogo(t){if(t)try{const e=await t.getLogoWithUniqueRole("primary-logo");return w.brandKitLogoToCoreBrandLogo(t,e)}catch(t){const e=t?t.message:"";S.error("getPrimaryBrandLogo error: "+e,t)}}static toCoreBrandColors(t){return t.map(t=>w.brandKitColorToCoreBrandColor(t))}static async getCoreBrandColorsFromAuthoringContext(t){if(!t)return[];const e=await t.getColors();return w.toCoreBrandColors(e)}static async getInfoForACFontWithRole(t,e){const r=await(t.getFontWithRole(e)||t.getFontWithUniqueRole(e));return w.fontThingToFontInfo(r)}static async getPrimaryBrandFontPairing(t){if(t)return Promise.all([v.b,v.c].map(e=>w.getInfoForACFontWithRole(t,e).then(w.fontInfoToCoreBrandFont)))}static async getFontCategories(t){if(!t)return[];const e=await w.getInfoForACFontWithRole(t,v.b);for(const t of n.a){const r=t.feel;for(const o of t.fontCards)for(const t of o.fonts)if(t.lookupKey===e.lookupKey&&t.role===v.b)return[r]}return[]}}e.default=w},ZLL8:function(t,e,r){var o,n;o=[r("YLtl"),r("UFvF"),r("UzQk")],void 0===(n=function(t,e,r){var o={doSerial:function(t){var r=[];return t.forEach((function(t){e.isPromise(t)?r.push((function(){return e.promise((function(e){t.then(e)}))})):r.push(t)})),r.reduce(e.when,e([]))},delay:function(r){var o=[].slice.apply(arguments);o.shift();var n=e.defer();return t.delay((function(){n.resolve.apply(n,o)}),r),n.promise},delayThen:function(r){return function(){var o=[].slice.apply(arguments),n=e.defer();return t.delay((function(){n.resolve.apply(n,o)}),r),n.promise}},toCorePromise:function(t){return new r.CorePromise((e,r)=>{t.then(t=>e(t)).catch(t=>r(t))})},fromCorePromise:function(t){return new Promise((e,r)=>{t.then(t=>e(t)).fail(t=>r(t))})}};return o}.apply(e,o))||(t.exports=n)},a8ov:function(t,e,r){"use strict";r.r(e),r.d(e,"PREFIX",(function(){return s})),r.d(e,"default",(function(){return c}));var o=r("UzQk"),n=r("+Ltv"),a=r.n(n);function i(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}const s={COMPONENT:"component:",CP:"cp:",AUTHORING_CONTEXT:"ac:"};class c{static getImageUrl(t,e,r,o){return c.getCCUrl("adobe-theo",t,e,null,r,o)}static decodeImageUrl(t){return c.decodeCCUrl(t)}static getAuthoringContextUrl(t,e,r,o,n){return c.getCCUrl("adobe-spark-authoring-contexts",t,e,r,o,n)}static isEncodedComponentUrl(t){return!!t&&0===t.indexOf(s.COMPONENT)}static encodeComponentUrl(t,e,r){const o=r?"/"+r.replace("/","+"):"";return`${s.COMPONENT}${t}/${e}${o}`}static encodeDesignFilterComponentUrl(){return o.URLBasedContentNode.DO_NOT_LOAD_DATA_URL}static decodeComponentUrlParameters(t){const e=t.substring(s.COMPONENT.length).split("/");let r=!1;"logo"===e[2]&&(r=!0,e.splice(2,1));const o=e.length>=3?e[2].replace("+","/"):null;return{docId:e[0],componentId:e[1],mimeType:!o&&r?"image/png":o}}static isEncodedCPUrl(t){return!!t&&0===t.indexOf(s.CP)}static encodeCPUrl(t,e){o.LegacyCoreAssert.isTrue(!e||0===e.indexOf("/"),"URLBuilder.encodeCPUrl: absolute path to component must begin with a slash");let r=e;if(0===e.indexOf("/")){const t=e.split("/");"original"!==t[1]&&(t.splice(1,0,"original"),r=t.join("/"))}return`${s.CP}${t}${r}`}static decodeCPUrlParameters(t){const e=t.substring(s.CP.length),r=e.split("/");return{assetID:r[0],subPath:r.slice(1).join("/"),dcxSubPath:r.slice("original"===r[1]?2:1).join("/"),path:e,parentPath:r[r.length-2]}}static encodeAuthoringContextUrl(t,e,r,o){const n=r?"/"+r:"",a=o?"/"+o.replace("/","+"):"";return`${s.AUTHORING_CONTEXT}${t}/${e}${n}${a}`}static isEncodedAuthoringContextUrl(t){return!!t&&0===t.indexOf(s.AUTHORING_CONTEXT)}static decodeAuthoringContextUrlParameters(t){const e=t.substring(s.AUTHORING_CONTEXT.length).split("/");let r=!1;"logo"===e[2]&&(r=!0,e.splice(2,1));const o=e[2]&&!!["image+","video+","audio+","font+","application+"].find(t=>e[2].startsWith(t)),n=e.length>=3&&!o?e[2]:null;let a;return a=n?e.length>=4?e[3].replace("+","/"):null:e.length>=3?e[2].replace("+","/"):null,{etag:n,assetId:e[0],componentId:e[1],mimeType:!a&&r?"image/png":a}}static getCPUrl(t,e){if(e.length&&o.LegacyCoreAssert.isTrue(e.indexOf("original/")<0&&"/"!==e[0],'getCPUrl: path must not have "original/" or a leading slash'),c.useCpCdn)return`${a.a.CP_CDN_HOST}/content/2/dcx/${t}/content/${e}`;return`/api/post/v1/cp/${c.cpServiceDomain?`host/${c.cpServiceDomain}/`:""}dcx/${t}/${e}`}static decodeUrl(t,e){if(t){if(c.isEncodedComponentUrl(t)){const r=c.decodeComponentUrlParameters(t),o=r.docId,n=r.componentId,a=r.mimeType;return c.getImageUrl(o,n,a,e)}if(c.isEncodedCPUrl(t)){const e=c.decodeCPUrlParameters(t);return c.getCPUrl(e.assetID,e.dcxSubPath)}if(c.isEncodedAuthoringContextUrl(t)){const e=c.decodeAuthoringContextUrlParameters(t),r=e.assetId,o=e.componentId,n=e.etag,a=e.mimeType;return c.getAuthoringContextUrl(r,o,n,a)}}return t}static setCPServiceDomain(t){c.cpServiceDomain=t}static getCCUrl(t,e,r,o,n,i){let s=`/image_assets/${t}/${e}/?asset_id=${r}`;if("original"!==i){s+="&size="+(i||a.a.maxImageSizeFromStorage)}return o&&(s+="&img_etag="+o),n&&(s+="&mime="+n),s}static decodeCCUrl(t){let e=null;const[r,o]=t.split("?");if(o){const t=o.split("&"),{asset_id:n,size:a,mime:i}=t.reduce((t,e)=>{const[r,o]=e.split("=");return t[r]=o,t},{});e={assetId:n},a&&(e.size=parseInt(a,10)),i&&(e.mime=i);const s=r.split("/").filter(t=>!!t);s.length>0&&(e.docId=s[s.length-1])}return e}}i(c,"cpServiceDomain",void 0),i(c,"useCpCdn",!1)},guFN:function(t,e,r){var o,n;o=[r("TdwW"),r("UzQk")],void 0===(n=function(t,e){function r(t,e){this.ctx=t,this.colorTable=e,this.filled=!1,this.ctx.beginPath()}return r.prototype.beginGroup=function(){},r.prototype.endGroup=function(){},r.prototype.beginClipGroup=function(t){},r.prototype.endClipGroup=function(){},r.prototype.fill=function(r,o){o=o||this.colorTable.color(r),this.ctx.fillStyle=t.toCSS(t.solidColor2Rgba(o)),this.ctx.fill(this.fillRule===e.TheoPath.PATHFILL_EVENODD?"evenodd":"nonzero"),this.filled=!0},r.prototype.stroke=function(r,o,n){this.ctx.lineWidth=n,o=o||this.colorTable.color(r),this.ctx.strokeStyle=t.toCSS(t.solidColor2Rgba(o)),this.ctx.miterLimit=this.miterLimit,this.ctx.lineCap="butt",this.endCap===e.TheoPath.PATHEND_ROUND?this.ctx.lineCap="round":this.endCap===e.TheoPath.PATHEND_SQUARE&&(this.ctx.lineCap="square"),this.ctx.lineJoin="miter",this.join===e.TheoPath.PATHJOIN_ROUND?this.ctx.lineJoin="round":this.join===e.TheoPath.PATHJOIN_BEVEL&&(this.ctx.lineJoin="bevel"),this.ctx.stroke()},r.prototype.rectangle=function(t,e,r,o){this.ctx.rect(t,e,r-t,o-e)},r.prototype.ellipse=function(t,e,r,o){var n=r-t,a=o-e,i=n/2*.5522848,s=a/2*.5522848,c=t+n/2,l=e+a/2;this.ctx.moveTo(t,l),this.ctx.bezierCurveTo(t,l-s,c-i,e,c,e),this.ctx.bezierCurveTo(c+i,e,r,l-s,r,l),this.ctx.bezierCurveTo(r,l+s,c+i,o,c,o),this.ctx.bezierCurveTo(c-i,o,t,l+s,t,l),this.ctx.closePath()},r.prototype.newPath=function(t,e,r,o,n){this.ctx.beginPath(),this.fillRule=t,this.endCap=e,this.join=r,this.strokeWt=o,this.miterLimit=n},r.prototype.moveTo=function(t,e){this.ctx.moveTo(t,e)},r.prototype.lineTo=function(t,e){this.ctx.lineTo(t,e)},r.prototype.cubicBezier=function(t,e,r,o,n,a){this.ctx.bezierCurveTo(t,e,r,o,n,a)},r.prototype.quadraticBezier=function(t,e,r,o){this.ctx.quadraticCurveTo(t,e,r,o)},r.prototype.closePath=function(){this.ctx.closePath()},r.prototype.done=function(){if(this.filled||this.fillRule==e.TheoPath.PATHFILL_NONE){if(this.fillRule==e.TheoPath.PATHFILL_NONE){var t=this.colorTable.color(e.ColorRole.FieldPrimary);this.stroke(e.ColorRole.FieldPrimary,t,this.strokeWt)}}else this.fill(e.ColorRole.FieldPrimary,null)},r}.apply(e,o))||(t.exports=n)},"l+ZV":function(t,e,r){"use strict";r.r(e),r.d(e,"loadImagePromise",(function(){return F})),r.d(e,"LoadImage",(function(){return v}));var o=r("tY4j"),n=r.n(o),a=r("bBG2"),i=r("CTED"),s=r.n(i),c=r("MGCh"),l=r.n(c),d=r("UzQk"),u=r("7gWt"),h=r("LU24"),p=r("a8ov");function f(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}const m=l.a.channel("load-image"),g=new s.a(30),b=/^\s*data:/i,{loadImage:y}=h.PERFORMANCE_MARKERS;class C extends Error{constructor(...t){super(...t),f(this,"imgSrc",""),f(this,"httpStatus",0),f(this,"httpResponse",void 0)}static async create(t,e,r){const o=new C(t);if(o.imgSrc=e,r){o.httpStatus=r.status;try{o.httpResponse=await r.text()}catch(t){}}return o}}function F(t,e=new Image){const r=new Promise((r,o)=>{e.onload=()=>r(e),e.onerror=o,e.src=t});return u.SparkPerformanceTracker.measurePromise(`${y}:${v.buildPerfMarkerForURL(t)}`,r)}class v{constructor(){f(this,"_retryDelay",200),f(this,"_retryAttempts",3)}async load(t){if(!t){const t="[Post:load-image] Attempted to load null image.";throw m.error(t),new Error(t)}if(t===d.URLBasedContentNode.DO_NOT_LOAD_DATA_URL){const e=new Image;return e.dataset.src=t,e.width=1,e.height=1,e}const e=g.get(t);if(e)return e;const r=this._load(t);return g.set(t,r),r}async loadImageFromBlob(t){const e=URL.createObjectURL(t);try{return await F(e)}catch(t){throw m.error("there was an error loading the image from blob. error details: "+t,{event:t,src:e}),{event:t,message:"error loading image file",src:e}}finally{URL.revokeObjectURL(e)}}static extractAssetID(t){if(t){const e=p.default.decodeImageUrl(t);if(e)return e.assetId;try{const e=new window.URL(t).pathname.split("/");if(e.length>=5&&"assets"===e[1]&&"adobe-theo"===e[2])return e[4]}catch(t){}}return null}static buildPerfMarkerForURL(t){let e=t;if(b.test(e))v._dataUrlCount+=1,e="data-url-"+v._dataUrlCount;else{const t=v.extractAssetID(e);t&&(e=t)}return`${y}:${e}`}async _loadImageViaHTMLElement(t){const e=new Image;try{new URL(t,e.baseURI).origin!==location.origin&&(e.crossOrigin="anonymous")}catch(t){m.error("parsing url for cross-origin image loading. error details: "+t)}try{return await F(t,e)}catch(e){throw m.error("loading image via HTTP request failed. error details: "+e),await C.create(`img load error (${t} - ${e.toString()} ${e.stack})`,t)}}async _tryLoadingImageViaHTTPRequest(t){let e,r;try{e=await fetch(t)}catch(r){throw m.error("fetching image via http response: error details: "+r),await C.create("Failed to load image via AJAX.",t,e)}if(e.status>=400)throw m.error("fetching image via http response: status: "+e.status),await C.create("Attempt to load image via AJAX returned an HTTP error.",t,e);try{r=await e.blob()}catch(r){throw m.error("accessing blob from image via http response: error details: "+r),await C.create("Failed to load image via AJAX.",t,e)}return this.loadImageFromBlob(r)}async _load(t){let e,r=1;const o=n()(this._loadImageViaHTMLElement,{maxAttempts:this._retryAttempts,delay:this._retryDelay,logger:{info(){r++}}}),i=async e=>{try{return r++,await this._tryLoadingImageViaHTTPRequest(t)}catch(t){throw e}};try{try{e=await o(t)}catch(t){e=await i(t)}}catch(e){throw g.remove(t),m.error("all attempts at loading image failed. error details: "+e),e}finally{const o=b.test(t)?"data-url":t;a.default.publish("post:imageLoadAttempt",{contextualData1:"numberOfLoadAttempts:"+r,contextualData2:"src:"+o,contextualData3:"success:"+(void 0!==e)})}return e}}f(v,"_dataUrlCount",0),e.default=new v},lulf:function(t,e,r){"use strict";r.r(e),r.d(e,"default",(function(){return i}));var o=r("7mGH"),n=r.n(o);function a(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}class i{static reset(){this.featuresLoadedPromise=null,this.featuresAreLoaded=!1}loadFeatures({skipLoadingAuthenticatedFeatures:t=!1}={}){if(!i.featuresLoadedPromise){const e=t?Promise.resolve():n.a.featuresLoaded().then(()=>{});i.featuresLoadedPromise=e.then(()=>{i.featuresAreLoaded=!0})}return i.featuresLoadedPromise}featureEnabled(t){if(!i.featuresAreLoaded)throw new Error("Feature-controller flags not yet loaded. Call loadFeatures() first.");return n.a?n.a.hasFeature(t)||function(t){const e={"post-logo-enabled":["enable-brand-kit"]}[t];return!!e&&e.some(t=>n.a.hasFeature(t))}(t):"post-pgm-poster"===t}}a(i,"featuresLoadedPromise",null),a(i,"featuresAreLoaded",!1)},oWUw:function(t,e,r){var o;void 0===(o=function(){navigator.appVersion;var t,e,r,o=navigator.userAgent,n=navigator.appName,a=""+parseFloat(navigator.appVersion),i=parseInt(navigator.appVersion,10);return-1!=(e=o.indexOf("Opera"))?(n="Opera",a=o.substring(e+6),-1!=(e=o.indexOf("Version"))&&(a=o.substring(e+8))):-1!=(e=o.indexOf("MSIE"))?(n="Microsoft Internet Explorer",a=o.substring(e+5)):-1!=(e=o.indexOf("Chrome"))?(n="Chrome",a=o.substring(e+7)):-1!=(e=o.indexOf("Safari"))?(n="Safari",a=o.substring(e+7),-1!=(e=o.indexOf("Version"))&&(a=o.substring(e+8))):-1!=(e=o.indexOf("Firefox"))?(n="Firefox",a=o.substring(e+8)):(t=o.lastIndexOf(" ")+1)<(e=o.lastIndexOf("/"))&&(n=o.substring(t,e),a=o.substring(e+1),n.toLowerCase()==n.toUpperCase()&&(n=navigator.appName)),-1!=(r=a.indexOf(";"))&&(a=a.substring(0,r)),-1!=(r=a.indexOf(" "))&&(a=a.substring(0,r)),i=parseInt(""+a,10),isNaN(i)&&(a=""+parseFloat(navigator.appVersion),i=parseInt(navigator.appVersion,10)),{name:n,fullVersion:a,majorVersion:i}}.apply(e,[]))||(t.exports=o)},rJP3:function(t,e,r){"use strict";r.r(e);var o=r("gBAB"),n=r.n(o),a=r("kNaX"),i=r.n(a),s=r("9KYx"),c=r("MGCh"),l=r.n(c),d=r("WaK9"),u=r("YYuT"),h=r("Mn87"),p=r("tY4j"),f=r.n(p);function m(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}const g=l.a.channel("brandkit-wrapper");e.default=new class{constructor(){m(this,"currentAuthoringContext",null),m(this,"currentBrandElements",null),m(this,"showCurrentBrandInUI",null)}async addLogoToCurrentBrand(t,e){const{currentAuthoringContext:r}=this;if(t&&r)try{return await this.uploadLogoToAuthoringContext(r,t,e)}catch(t){const e="addLogoToCurrentBrand error: "+(t?t.message:"");throw g.error(e,t),new Error(e)}}async getBrandKitById(t){const e=await n.a.getController();return f()(e.getContextById.bind(e),{maxAttempts:3})(t)}async loadDefaultBrandKit(t){let e;e=n.a.getOrCreateDefaultBrand||n.a.getDefaultBrand;try{let r=await f()(e,{maxAttempts:3})();return r||(r=await f()(n.a.getOrCreateDefaultBrand.bind(n.a))()),this.setBrandAsCurrent(r,t)}catch(t){const e="loadDefaultBrandKitError: "+(t?t.message:"");throw g.error(e,t),new Error(e)}}async loadBrandKit(t,e={},r=(()=>{})){const{currentAuthoringContext:o,currentBrandElements:n}=this,{skipReload:a,belongsToUser:i,isSharedWithUser:s}=e,c=!!i||!!s;if(a&&o&&o.getId()===t&&n)return o;if("string"!=typeof t||t.length<=0)try{return await this.loadDefaultBrandKit(c)}catch(t){return g.warn("loadBrandKit: Error loading default brandkit. Skipping brand loading.",t),this.setBrandAsCurrent(null)}try{const e=await this.getBrandKitById(t);return null!==e?this.setBrandAsCurrent(e):(r&&r(),await this.loadDefaultBrandKit(c))}catch(t){try{return await this.loadDefaultBrandKit(c)}catch(t){return g.warn("loadBrandKit: Error loading default brandkit as fallback. Skipping brand loading.",t),this.setBrandAsCurrent(null)}}}async refreshBrandColors(){const t=await this.getColorsInCurrentBrand();return this.currentBrandKit()&&t&&t.colors.length&&(this.currentBrandElements||(this.currentBrandElements={}),this.currentBrandElements.colors=t.colors),this.currentBrandElements}async refreshCachedCurrentBrandElements(){const{currentAuthoringContext:t,showCurrentBrandInUI:e}=this;if(!t)return this.currentBrandElements=null,this.currentBrandElements;try{const r=await this.extractBrandElementsForCache(t);return r&&(r.showBrandInUI="boolean"!=typeof e||e),this.currentBrandElements=r,this.currentBrandElements&&!this.currentBrandElements.name&&(this.currentBrandElements.name=h.a),this.currentBrandElements}catch(t){const e="refreshCurrentBrandElementsCache error: "+(t?t.message:"");throw g.error(e,t),new Error(e)}}async switchCurrentAuthoringContext(t){const{currentAuthoringContext:e,currentBrandElements:r}=this;if(!t)return r;const o="string"==typeof t?t:t.getId();if(e&&e.getId()===o)return r;try{const t=await this.loadBrandKit(o);await s.default.switchBrandContext(t);return await this.refreshCachedCurrentBrandElements()}catch(t){const e="switchCurrentAuthoringContext error: "+(t?t.message:"");throw new Error(e)}}async checkForRestrictedFonts(){const{currentBrandElements:t,currentAuthoringContext:e}=this;if(!t||!e)return[];const r=t.coreBrand;if(!r)return[];const o=r.fonts||[],a=[];for(const t of o)t&&t.acRoles&&t.acRoles.includes("custom")&&t.descriptor&&t.descriptor.postScriptName&&a.push({source:"user-uploaded",postScriptName:t.descriptor.postScriptName});return a.length?n.a.verifyFontsUsed(a,e):[]}currentBrandKit(){return this.currentAuthoringContext}getCurrentBrandElements(){return this.currentBrandElements}resetBrandCaches(){this.currentBrandElements=null}uploadBlobImageToBrand(t,e,r){const o=r?"primary-logo":"secondary-logo";return t.uploadImageAsset(i()(),n.a.LOGOS_PARENT,e,o)}uploadHrefImageToBrand(t,e,r){const o=e.original||e.preview||e.thumbnail,a=r?"primary-logo":"secondary-logo";return t.updateImageAsset(i()(),n.a.LOGOS_PARENT,o.link,e.type||"image/jpeg",(t=>{let e=t.source.toLowerCase();return"creative cloud"===e&&(e="cc"),e})(e),a)}async uploadLogoToAuthoringContext(t,e,r){if(t&&e)return e instanceof Blob?this.uploadBlobImageToBrand(t,e,r):this.uploadHrefImageToBrand(t,e,r)}async getColorsInCurrentBrand(){const{currentAuthoringContext:t}=this;if(!t)return;const e={id:t.getId(),name:t.getName()};try{const r=await t.getColors();return e.colors=r.map(t=>new d.a({id:t.getId(),acRoles:t.getRoles(),rgb:t.rgb(),hex:t.hex(),isBaseColor:t.isBaseColor(),isDerived:t.isDerived()})),e}catch(t){const e="getColorsInActiveBrand error: "+(t?t.message:"");return g.error(e,t),[]}}async getLogosInCurrentBrand(){const{currentAuthoringContext:t}=this;if(!t)return;const e={name:t.getName()};try{const r=await t.getAuthoringContextLogos();return e.logos=r,e}catch(t){const e="getLogosInCurrentBrand error: "+(t?t.message:"");throw g.error(e,t),new Error(e)}}async extractBrandElementsForCache(t){const{currentAuthoringContext:e}=this,r={id:t.getId(),name:t.getName(),urn:t.getURN(),activated:t.activated(),belongsToUser:t.belongsToUser(),isSharedWithUser:t.isSharedWithUser(),isDefault:t.isDefault()};try{const t=await this.getColorsInCurrentBrand(),o=await this.getLogosInCurrentBrand();t&&(r.colors=t.colors);const n=o?o.logos:null;if(n&&n.length){const t=n.findIndex(t=>t.getRoles().includes("primary-logo")),o=n.splice(t,1)[0];r.primaryLogoPromise=u.default.brandKitLogoToCoreBrandLogo(e,o),r.secondaryLogoPromises=n.map(t=>u.default.brandKitLogoToCoreBrandLogo(e,t));const a=[r.primaryLogoPromise].concat(r.secondaryLogoPromises),i=await Promise.allSettled(a);r.logos=i.filter(t=>"fulfilled"===t.status&&t.value).map(t=>t.value)}return r.fonts=[],s.default.getCachedFonts().forEach(t=>{const e=s.default.getFontData(t);e.isBKFont&&r.fonts&&r.fonts.push(e)}),r.coreBrand=u.default.getCoreBrandFromAuthoringContextElements(r),r}catch(t){const e="extractBrandElementsForCache error: "+(t?t.message:"");return g.error(e,t),null}}setBrandAsCurrent(t,e=!0){return this.currentAuthoringContext=t,this.showCurrentBrandInUI=e,this.currentAuthoringContext}}}}]);
//# sourceMappingURL=theo-app-storage_5a11b65b-0c1ad4ca.js.map