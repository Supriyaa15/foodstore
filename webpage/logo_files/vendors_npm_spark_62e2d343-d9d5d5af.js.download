(window.webpackJsonptheoWebApp=window.webpackJsonptheoWebApp||[]).push([[28],{"6Rk9":function(e,t,r){var o,n=t,a=r("oAGj"),i=r("tGKA"),l=r("MnRR"),u=r("8t9B"),s=r("oKlP"),c=r("sIWg");n.GeometryFacade=(o=function(){},a.defineClass({name:"GeometryFacade",ctor:o,statics:{getFormaeBounds:function(e,t){void 0===t&&(t=!1);var r=c.TheoRect.Zero;if(e.length>0)if(t){var o=e.map((function(e){return e.controller.getUserPerceivedFrame()}),this);r=o.reduce((function(e,t){return e.unionWith(t)}),o[0])}else{var n=e[0];r=e.reduce((function(e,t){return e.unionWith(t.finalFrame)}),n.finalFrame)}return r},unionFrame:function(e,t){if(void 0===t&&(t=null),0==e.length)return null;for(var r=t||e[0].parent,o=null,n=a.iter(e);!n.done;n.next()){for(var i=n.value,l=i.placement,u=i.parent;null!=u&&u!=r;)l=l.concat(u.placement),u=a.opt(u,(function(e){return e.parent}));var s=i.boundsInCoordSpace(l);o=null==o?s:o.unionWith(s)}return o},polyFromFormaBounds:function(e){var t=e.bounds||c.TheoRect.Zero,r=[t.evalXY(0,0),t.evalXY(1,0),t.evalXY(1,1),t.evalXY(0,1)];return e.totalPlacement.transformPoints(r)},formaBoundsIntersect:function(e,t){var r=a.clone(o.polyFromFormaBounds(e)),n=a.clone(o.polyFromFormaBounds(t)),i=[];i.push(r),i.push(n);for(var l=a.iter(i);!l.done;l.next())for(var u=l.value,c=a.iter(a.toSequence(u));!c.done;c.next()){for(var d=c.value,g=d.offset,m=d.element,f=u[(g+1)%u.length],p=new s.TheoPoint(f.y-m.y,m.x-f.x),F=null,v=null,C=a.iter(r);!C.done;C.next()){var h=C.value,y=p.x*h.x+p.y*h.y;(null==F||y<F)&&(F=y),(null==v||y>v)&&(v=y)}for(var I=null,k=null,T=a.iter(n);!T.done;T.next()){var A=T.value,M=p.x*A.x+p.y*A.y;(null==I||M<I)&&(I=M),(null==k||M>k)&&(k=M)}if(null!=v&&null!=I&&v<I)return!1;if(null!=k&&null!=F&&k<F)return!1}return!0},getIntersectionPolygon:function(e,t,r,n){var a=[];return o.getEdgeIntersections(e,t,r,n,a),o.getCornersInsideOtherRect(e,t,r,n,a),o.getCornersInsideOtherRect(t,e,n,r,a),a},getEdgeIntersections:function(e,t,r,n,i){for(var l=[e.horizontalLine(0).transform(r),e.horizontalLine(1).transform(r),e.verticalLine(0).transform(r),e.verticalLine(1).transform(r)],u=[t.horizontalLine(0).transform(n),t.horizontalLine(1).transform(n),t.verticalLine(0).transform(n),t.verticalLine(1).transform(n)],s=a.iter(l);!s.done;s.next())for(var c=s.value,d=a.iter(u);!d.done;d.next()){var g,m=d.value;if(g=c.intersection(m)){var f=c.locate(g),p=m.locate(g);f>=-.001&&f<=1.001&&p>=-.001&&p<=1.001&&o.appendPoint(g,i)}}},getCornersInsideOtherRect:function(e,t,r,n,l){for(var u=i._asterisk_Matrix2D_Matrix2D(n,r.inverse),s=a.clone(t.points),c=a.iter(s);!c.done;c.next()){var d=c.value;e.containsPoint(u.transformPoint(d))&&o.appendPoint(n.transformPoint(d),l)}},appendPoint:function(e,t){for(var r=a.iter(t);!r.done;r.next())if(r.value.distanceTo(e)<.01)return;t.push(e)},areaOfConvexPolygon:function(e){if(e.length<3)return 0;for(var t=a.clone(o.sortConvexPolygonVertices(e)),r=0,n=0,i=a.iter(a.toSequence(t));!i.done;i.next()){var l=i.value,u=l.offset,s=l.element,c=t[(u+1)%t.length].y;r+=s.x*c;var d=t[(u+1)%t.length].x;n+=s.y*d}return(r-n)/2},centerOfPolygon:function(e){return 0==e.length?s.TheoPoint.ZERO:e.reduce((function(e,t){return s._plus_TheoPoint_TheoPoint(e,t)}),s.TheoPoint.ZERO).divide(a.toDouble(e.length))},sortConvexPolygonVertices:function(e){if(0==e.length)return e;var t=o.centerOfPolygon(e),r=new l.TheoLine(t,s._plus_TheoPoint_TheoPoint(t,new s.TheoPoint(100,0)));return a.sort(e,(function(e,o){return new l.TheoLine(t,e).angleWith(r)>new l.TheoLine(t,o).angleWith(r)}))},getClosestPin:function(e,t){for(var r,o=[[.5,.5],[.5,0],[.5,1],[0,.5],[1,.5],[0,0],[0,1],[1,0],[1,1]],n=null,i=1/0,l=a.iter(o);!l.done;l.next()){var u=l.value,c=e.evalXY(u[0],u[1]),d=t.evalXY(u[0],u[1]),g=c.distanceTo(d);g<i&&(i=g,n=u)}var m=(r=n)||null!=r?r:o[0];return new s.TheoPoint(m[0],m[1])},getScaleToFit:function(e,t,r){if(e.outsetXY(1,1).containsPoint(r)&&t.outsetXY(1,1).containsPoint(r)){var n,a,i,l,u=1/0;return null!=(n=o.getScaleToFitOneDim(e.minX,t.minX,r.x))&&(u=Math.min(u,n)),null!=(a=o.getScaleToFitOneDim(e.maxX,t.maxX,r.x))&&(u=Math.min(u,a)),null!=(i=o.getScaleToFitOneDim(e.minY,t.minY,r.y))&&(u=Math.min(u,i)),null!=(l=o.getScaleToFitOneDim(e.maxY,t.maxY,r.y))&&(u=Math.min(u,l)),u}return null},getScaleToFitOneDim:function(e,t,r){var o=Math.abs(e-r);return o<.1?null:Math.abs(t-r)/o},NEEDS_FITTING_MAX_INITIAL_RATIO:1.1,NEEDS_FITTING_MIN_NEW_RATIO:1.5,FIT_IN_PAGE_MARGIN:10,fitInPage:function(e,t,r,n,i,l){var d,g,m,f,p;if(void 0===t&&(t=null),void 0===r&&(r=s.TheoPoint.ZERO),void 0===n&&(n=o.FIT_IN_PAGE_MARGIN),void 0===i&&(i=o.NEEDS_FITTING_MAX_INITIAL_RATIO),void 0===l&&(l=o.NEEDS_FITTING_MIN_NEW_RATIO),(m=e.root)&&(f=e.controller)&&(p=e.finalFrame)){var F=c.TheoRect.fromSize(e.page.pageSize).insetXY(n,n),v=F.width,C=F.height,h=((d=a.opt(t,(function(e){return e.width})))||null!=d?d:0)<v*i,y=((g=a.opt(t,(function(e){return e.height})))||null!=g?g:0)<C*i;if(h&&p.width>v*l||y&&p.height>C*l){var I=Math.min(v/p.width,1),k=Math.min(C/p.height,1);f.maintainAspectRatio&&(I=Math.min(I,k),k=I),e.bounds=a.opt(e.bounds,(function(e){return e.scaleXY(I,k,r)})),a.opt(a.as(f,u.TypeLockupController),(function(e){return e.snapSizeToBounds()}))}f.preventOutofBounds(m,F)}}}}),o)},"6Tzw":function(e,t,r){var o,n=t,a=r("oAGj"),i=r("0wFF"),l=r("gXiO"),u=r("FNB+"),s=r("9Lk3"),c=r("iCxV"),d=r("sIWg");n.MultiSelectUIMode=a.defineEnum("MultiSelectUIMode",{ModeWithAutoDismissAfterOneTap:0,ModeRequiresExplicitDismiss:1}),n.SelectionFacade=(o=function(){l.CoreObject.call(this)},a.defineClass({name:"SelectionFacade",ctor:o,superName:"CoreObject",statics:{isMultiSelect:function(e){var t;return!(!((t=e)&&t.selectedCount>1)||t.inCharStyleMode)},isGroupSelect:function(e){var t,r;return!(!(r=e)||1!=r.selectedCount||!(t=a.opt(a.opt(r.formaAt(0),(function(e){return e.controller})),(function(e){return e.userGroupMember})))&&null==t||!t)},isCharStyleSelection:function(e){var t,r,o;return!!((t=e)&&t.selectedCount>1&&(r=t.formaAt(0))&&(o=t.formaAt(1)))&&(r.isTypeLockup()&&o.isText())},getMultiSelectUIMode:function(){return n.MultiSelectUIMode.ModeRequiresExplicitDismiss},enableAdditionalMultiSelectGestures:function(){return!1},selectFormae:function(e){var t;if(e.length>0&&(t=a.opt(a.opt(a.opt(a.first(e),(function(e){return e.page.document})),(function(e){return e.controller})),(function(e){return e.selection})))){var r=t.selectedCount;t.selectFormae(e);for(var o=a.iter(t.asFormaArray());!o.done;o.next()){var n,l=o.value;(n=a.opt(l.controller,(function(e){return e.userGroupRoot})))&&(t.deselectForma(l),t.selectForma(n))}var u=t.selectedCount;if(u>1){for(var s=a.iter(t.asFormaArray());!s.done;s.next())l=s.value,a.opt(l.controller,(function(e){return 0==e.canMultiSelect}))&&t.deselectForma(l);a.opt(c.Host.logging,(function(e){return e.logToAnalytics(i.AnalyticsConstants.kAnalyticsDataSelectionMultiple,{contextualData1:"oldSelectedCount:"+r,contextualData2:"newSelectedCount:"+u})}))}}},replaceSelectionWithFormae:function(e){var t;if(e.length>0&&(t=a.opt(a.opt(a.opt(a.first(e),(function(e){return e.page.document})),(function(e){return e.controller})),(function(e){return e.selection})))){var r=e.filter((function(e){return a.opt(e.controller,(function(e){return 1==e.canMultiSelect}))}),this);t.replaceSelectionWithFormae(r)}},deselectFormae:function(e){var t;if(e.length>0&&(t=a.opt(a.opt(a.opt(a.first(e),(function(e){return e.page.document})),(function(e){return e.controller})),(function(e){return e.selection})))){t.deselectFormae(e);for(var r=a.iter(e);!r.done;r.next()){var o,n=r.value;(o=a.opt(n.controller,(function(e){return e.userGroupRoot})))&&t.deselectForma(o)}}},canSelectParent:function(e){var t;return!!((t=a.opt(a.opt(e.document,(function(e){return e.controller})),(function(e){return e.selection})))&&t.selectedCount>=1&&t.formaAt(0))},selectParent:function(e){var t;if(t=a.opt(a.opt(e.document,(function(e){return e.controller})),(function(e){return e.selection}))){var r,n,i;if(1==t.selectedCount&&(r=t.formaAt(0))&&(n=r.parent)&&(i=n.controller)&&i.kind!=s.GridController.KIND&&i.selectable)return void t.replaceSelection(i.forma);o.deselectAllOnPage(e)}},canSelectChild:function(e){var t,r,o;if((r=a.opt(a.opt(e.document,(function(e){return e.controller})),(function(e){return e.selection})))&&1==r.selectedCount&&(o=r.formaAt(0))&&o.controller)for(var n=a.iter(o.visitAsArray(u.FormaTraversal.JustChildren));!n.done;n.next()){var i=n.value;if(((t=a.opt(i.controller,(function(e){return e.selectable})))||null!=t)&&t&&a.opt(i.controller,(function(e){return e.kind!=s.GridController.KIND})))return!0}return!1},selectChild:function(e){var t,r,o;if((r=a.opt(a.opt(e.document,(function(e){return e.controller})),(function(e){return e.selection})))&&1==r.selectedCount&&(o=r.formaAt(0))&&o.controller)for(var n=a.iter(o.visitAsArray(u.FormaTraversal.JustChildren));!n.done;n.next()){var i=n.value;((t=a.opt(i.controller,(function(e){return e.selectable})))||null!=t)&&t&&r.replaceSelection(i)}},canSelectSibling:function(e){var t,r,o,n,i=this;return!!((t=a.opt(a.opt(e.document,(function(e){return e.controller})),(function(e){return e.selection})))&&1==t.selectedCount&&(r=t.formaAt(0))&&(o=r.controller)&&(n=a.opt(o.getSiblingFormae(),(function(e){return e.filter((function(e){return a.opt(e.controller,(function(e){return 1==e.selectable}))}),i)}))))&&n.length>1},selectSibling:function(e,t){void 0===t&&(t=!0);var r,o,n,i,l,s=this;if((r=a.opt(a.opt(e.document,(function(e){return e.controller})),(function(e){return e.selection})))&&1==r.selectedCount&&(o=r.formaAt(0))&&(n=o.controller)&&(i=a.opt(n.getSiblingFormae(),(function(e){return e.filter((function(e){return a.opt(e.controller,(function(e){return 1==e.selectable}))}),s)})))&&null!=(l=a.indexOfEq(i,o,u._equality_Forma_Forma))){var c=(l+(t?1:-1))%i.length;c<0&&(c=i.length-1);var d=i[c];r.replaceSelection(d)}},marqueeSelectFormae:function(e,t){var r;if(e.length>0&&(r=a.opt(a.opt(a.opt(a.first(e),(function(e){return e.page.document})),(function(e){return e.controller})),(function(e){return e.selection})))){for(var n=!0,i=a.iter(e);!i.done;i.next()){var l=i.value;if(!r.isSelected(l)&&!r.isGroupSelected(l)){n=!1;break}}n&&(t||c.Host.platform.isMobile)?o.deselectFormae(e):t||c.Host.platform.isMobile?o.selectFormae(e):o.replaceSelectionWithFormae(e)}},deselectAllOnPage:function(e){var t;(t=a.opt(a.opt(e.document,(function(e){return e.controller})),(function(e){return e.selection})))&&t.clearSelection(!0)},selectAllOnPage:function(e){var t;if(t=a.opt(a.opt(e.document,(function(e){return e.controller})),(function(e){return e.selection}))){var r=t.selectedCount;t.clearSelectionNoUpdate();var n=a.clone(e.selectableFormaeIntersectingRect(d.TheoRect.Huge));o.selectFormae(n);var l=t.selectedCount;a.opt(c.Host.logging,(function(e){return e.logToAnalytics(i.AnalyticsConstants.kAnalyticsDataSelectionSelectAll,{contextualData1:"oldSelectedCount:"+r,contextualData2:"newSelectedCount:"+l})}))}},getSelectionBounds:function(e){var t,r=d.TheoRect.Zero;return(t=a.opt(a.opt(e.document,(function(e){return e.controller})),(function(e){return e.selection})))&&(r=t.getSelectionBounds()),r}}}),o)},"6h7+":function(e,t,r){var o,n=t,a=r("oAGj"),i=r("Tq01"),l=r("0wFF"),u=r("dHJt"),s=r("CWW7"),c=r("yGNn"),d=r("FNB+"),g=r("6ZWm"),m=r("G1DZ"),f=r("P83h"),p=r("pnSN"),F=r("X0GW"),v=r("iCxV"),C=r("c+uM"),h=r("tGKA"),y=r("jcfx"),I=r("djAF"),k=r("8t9B"),T=r("sIWg");n.BadgeType=a.defineEnum("BadgeType",{Lockup:"lockup"}),n.BadgeFacade=(o=function(){},a.defineClass({name:"BadgeFacade",ctor:o,statics:{addBadge:function(e,t,r,n){void 0===n&&(n=null);var l=[];if(o.getFormaeToCopy(e.firstPage.root,l),0==l.length)return c.CorePromise.reject("Badge is empty");var d=o.areFormaeGrayscale(l),g=new f.FormaStyleChangedEvent(r.root);return r.beginUpdate(g),s.CreationFacade.copyItems(l,r,d).then((function(e){var s=a.clone(e);return o.recordSources(t,l,s),new u.BadgeLayoutController(s).update(),o.handleReplace(n,s),o.stopColorChangeLoggingForID[t]=!0,o.onBadgeFormaePlaced(s,r,d),a.removeKey(o.stopColorChangeLoggingForID,t),r.endUpdate(g),new i.FormaActionResult(s)})).fail((function(e){return r.endUpdate(g),c.CorePromise.reject("Forma copy failed")}))},getDesignIngredientIDAndType:function(e){return{id:m.FormaSourceUtils.stripNamespace(e),type:n.BadgeType.Lockup}},stopColorChangeLoggingForID:{},logColorChange:function(e){var t;if(null!=(t=e)&&m.FormaSourceUtils.isDesignIngredient(t)){var r=o.getDesignIngredientIDAndType(t),n=r.id,i=r.type;null==o.stopColorChangeLoggingForID[n]&&(a.opt(v.Host.logging,(function(e){return e.logToAnalytics(l.AnalyticsConstants.kDesignIngredientColorChanged,{contextualData1:"designIngredientId:"+n,contextualData2:"designIngredientType:"+i})})),o.stopColorChangeLoggingForID[n]=!0)}},logFontChange:function(e,t){var r;if(null!=(r=e)&&m.FormaSourceUtils.isDesignIngredient(r)){var n=o.getDesignIngredientIDAndType(r),i=n.id,u=n.type;a.opt(v.Host.logging,(function(e){return e.logToAnalytics(l.AnalyticsConstants.kDesignIngredientFontChanged,{contextualData1:"designIngredientId:"+i,contextualData2:"designIngredientType:"+u,contextualData10:"fontName:"+t})}))}},logBackingShapeChange:function(e,t){var r;if(null!=(r=e)&&m.FormaSourceUtils.isDesignIngredient(r)){var n=o.getDesignIngredientIDAndType(r),i=n.id,u=n.type;a.opt(v.Host.logging,(function(e){return e.logToAnalytics(l.AnalyticsConstants.kDesignIngredientBackingShapeChanged,{contextualData1:"designIngredientId:"+i,contextualData2:"designIngredientType:"+u,contextualData12:"shapeName:"+t})}))}},getFormaeToCopy:function(e,t){var r;if(o.checkEligibility(e,o.isBadgeAtom))t.push(e);else if((r=a.as(e,p.GroupForma))&&a.opt(r.controller,(function(e){return 0==e.userGroup})))for(var n=a.iter(a.range(0,r.childCount,!1));!n.done;n.next()){var i=n.value;o.getFormaeToCopy(r.childAt(i),t)}},isBadgeAtom:function(e,t){return!(e.kind!=I.ShapeForma.KIND||!e.hasIntent(d.Forma.INTENT_ICON))||t.kind==k.TypeLockupController.KIND||t.kind==g.FrameController.KIND&&t.duplicatable},handleReplace:function(e,t){var r,o,n,i,l,u,s,c,d=!1;if(a.opt(e,(function(e){return 1==e.isBackgroundImage()}))){if(t.length>1||a.opt(a.opt(a.first(t),(function(e){return e.controller})),(function(e){return 1==e.userGroup})))return;d=!0}if((o=e)&&(n=o.parent)&&null!=(i=n.indexOfChild(o))&&(l=o.controller)&&(u=o.frame)&&(s=1==t.length?a.first(t):F.GroupFacade.createGroupFromFormae(t))&&(c=s.controller)){if(n.insertChildAt(s,i),d)s.allowUserMove=!1,c.fit(u);else{var g=o.rotationInRadians();l.rotate(-g),s.placement=h.Matrix2D.Identity,s.bounds=T.TheoRect.fromSize(u.fitAspectRatioWithin((r=a.opt(s.bounds,(function(e){return e.aspectRatio})))||null!=r?r:1)),s.moveCenterToPoint(u.center),c.rotate(g)}o.removeFromParent(),t.length>1&&F.GroupFacade.ungroupItems(t)}},onBadgeFormaePlaced:function(e,t,r){for(var n=!!r&&null,i=a.iter(e);!i.done;i.next()){var l,u=i.value;(l=a.as(u.controller,k.TypeLockupController))&&l.updateScoring(),null!=n||o.checkContrast(u)||(n=!0)}if(1==n){(new y.ProfilingColorMap).updateCurrentColorIndices();for(var s=a.iter(e);!s.done;s.next())u=s.value,o.forEachBadgeAtom(u,(function(e,t){return t.shuffleColorAssignment()}))}},areFormaeGrayscale:function(e){for(var t=a.iter(e);!t.done;t.next()){var r=t.value;if(!o.checkEligibility(r,o.isFormaGrayscale))return!1}return!0},isFormaGrayscale:function(e,t){if(t.kind==g.FrameController.KIND)return!1;var r,n,i,l=e.style;return!(!o.isStyleGrayscale(l)||(r=a.as(l,C.LockupStyle))&&(n=r.characterStyles[k.TypeLockupController.HIGHLIGHT_STYLE])&&(i=a.opt(a.as(t,k.TypeLockupController),(function(e){return e.charStyleRanges})))&&0==!i.length&&!o.isStyleGrayscale(n))},isStyleGrayscale:function(e){var t,r,o,n;return(n=e.colorLibrary)&&e.colors.forEachColor((function(e,r,i){if(null==o){var l=null==i?a.opt(n.color((t=r)||null!=t?t:""),(function(e){return e.rgbColor})):i;a.opt(l,(function(e){return 0==e.isGrayscale()}))&&(o=!1)}})),!(r=o)&&null==r||r},checkContrast:function(e){return o.checkEligibility(e,(function(e,t){return t.doesContrast()}))},recordSources:function(e,t,r){for(var n=r.length>1,i=a.iter(a.toSequence(r));!i.done;i.next()){var l=i.value,u=l.offset;l.element.source=o.makeSourceDescriptor(e,n?t[u].formaID:null)}},makeSourceDescriptor:function(e,t){var r;return null!=(r=t)?m.FormaSourceNamespace.DesignIngredient+e+":"+r:m.FormaSourceNamespace.DesignIngredient+e},checkEligibility:function(e,t){var r;if(r=e.controller){if(!r.userGroup)return t(e,r);var n;if(n=a.as(e,p.GroupForma)){for(var i=a.iter(a.range(0,n.childCount,!1));!i.done;i.next()){var l=i.value;if(!o.checkEligibility(n.childAt(l),t))return!1}return!0}}return!1},forEachBadgeAtom:function(e,t){var r,n;if(r=e.controller)if(r.userGroup){if(n=a.as(e,p.GroupForma))for(var i=a.iter(a.range(0,n.childCount,!1));!i.done;i.next()){var l=i.value;o.forEachBadgeAtom(n.childAt(l),t)}}else t(e,r)}}}),o)},CWW7:function(e,t,r){var o,n,a,i=t,l=r("oAGj"),u=r("Tq01"),s=r("KSe6"),c=r("kYI4"),d=r("SpAV"),g=r("yvDn"),m=r("vYM0"),f=r("gXiO"),p=r("yGNn"),F=r("T9pj"),v=r("FNB+"),C=r("QgZx"),h=r("cmoc"),y=r("V3yt"),I=r("ZK0l"),k=r("pnSN"),T=r("X0GW"),A=r("iCxV"),M=r("2rlr"),D=r("8vXU"),S=r("U010"),b=r("q5zr"),L=r("fdtz"),E=r("lmwz"),B=r("fNpk"),N=r("MYNe"),x=r("c+uM"),P=r("tGKA"),_=r("VkKB"),R=r("K17h"),O=r("uxH+"),w=r("K0Rh"),G=r("JO5d"),U=r("djAF"),H=r("35Q0"),W=r("lJxM"),Y=r("T6jX"),X=r("8t9B"),j=r("1NAc"),K=r("LGJg"),V=r("sW6f"),z=r("WWR6"),q=r("zjod"),Z=r("QTen");i.FloatingImageStrategy=l.defineEnum("FloatingImageStrategy",{IfHasAlphaOrIsLogo:0,Always:1,Never:2}),i.AddFormaParentingHint=l.defineEnum("AddFormaParentingHint",{defaultHandling:0,addToRoot:1,doNotAddFormaForContentToTree:2}),i.AddFormaParams=(o=function(e,t,r,o,n){void 0===e&&(e=u.ControllerSettingsBehaviorEnum.IgnoreControllerSettings),void 0===t&&(t=!0),void 0===r&&(r=null),void 0===o&&(o=i.FloatingImageStrategy.IfHasAlphaOrIsLogo),void 0===n&&(n=i.AddFormaParentingHint.defaultHandling),this.behavior=e,this.suggestPlacement=t,this.formaToReplace=r,this.floatingImageStrategy=o,this.parentingHint=n},n={},l.defineClass({name:"AddFormaParams",ctor:o,superName:"CoreObject",statics:{DEFAULTS:{get:function(){return void 0===n.DEFAULTS&&(n.DEFAULTS=new o),n.DEFAULTS}},makeWithFormaToReplace:function(e){return new o(void 0,void 0,e)},makeWithFormaToReplace:function(e,t){return new o(void 0,void 0,e,void 0,t)}}}),o),i.CreationFacade=function(){var e=function(){f.CoreObject.call(this)},t={};return l.defineClass({name:"CreationFacade",ctor:e,superName:"CoreObject",statics:{addImage:function(t,r,o,n,a,u,s,c,d,g){var m,f,F,v,C,h;if(void 0===n&&(n=null),void 0===a&&(a=null),void 0===u&&(u=null),void 0===s&&(s=!1),void 0===c&&(c=i.AddFormaParams.DEFAULTS),void 0===d&&(d=null),void 0===g&&(g=null),(v=t.document)&&(C=v.controller)&&(h=l.as(v.content.createNode(b.ImageContentNode.KIND,null),b.ImageContentNode))){var y;if(null==h.componentID&&null!=g&&(h.componentID=g),h.url=r,h.mimeType=o,y=d)for(var I=l.iter(y);!I.done;I.next()){var k=I.key,T=I.value;h.setTag(k,T)}return h.whenLoaded().then((function(t){var r;return(r=l.as(t,M.HostImage))&&(s&&h.createImageFeatures(),h.hasAlpha=(m=u)||null!=m?m:r.hasAlpha(),h.pixelWidth=(f=n)||null!=f?f:r.getWidth(),h.pixelHeight=(F=a)||null!=F?F:r.getHeight()),e.addImageForContentNode(C.document.firstPage,h,c)}))}return p.CorePromise.reject("document has no controller or imageCN was nil")},addImageForContentNode:function(t,r,o){return e.addContent(t,r,null,!1,o).then((function(e){var r;return(r=l.as(e,v.Forma))?(r.isImage()&&Y.TheoDocumentUtils.updateConstrainedImageInfo(t.document),r):(B.LegacyCoreAssert.fail("expected a forma result from CreationFacade.addContent",void 0,"CreationFacade.addImageForContentNode","CreationFacade.swift",162),null)}))},addLibraryShape:function(e,t,r,o){var n;return(n=l.as(e.createFormaWithController(U.ShapeForma.KIND,G.ShapeController.KIND),U.ShapeForma))?(e.root.appendChild(n),n.intent=v.Forma.INTENT_ICON,H.ShapeLibrary.applyToShapeForma(n,t),n.style.colors.fieldPrimary=o,n.controller.fit(r),p.CorePromise.resolve(n)):p.CorePromise.reject("could not create shape forma")},addText:function(t,r,o,n){return void 0===n&&(n=i.AddFormaParams.DEFAULTS),A.Host.textModelUtils.defaultFont().availability!=C.FontAvailability.LOADED?(l.opt(A.Host.logging,(function(e){return e.logToNewRelic(D.RemoteLoggingEvent.ADD_TEXT_FONT_UNAVAILABLE_ERROR,{})})),p.CorePromise.reject(new g.CoreStringError(F.ErrorMessageConstants.kAddTextMissingFontError,!0))):(a=t.document)?p.CorePromise.resolve(null).then((function(t){var i;return(i=l.as(a.content.createNode(W.TextContentNode.KIND,null),W.TextContentNode))?(i.text=r,e.addContent(a.firstPage,i,void 0,void 0,n).then((function(e){var t;return(t=l.as(e,v.Forma))?t:(B.LegacyCoreAssert.fail("Unexpected result from AddContentAction, expected a Forma",void 0,"CreationFacade.addText","CreationFacade.swift",223),null)})).then((function(e){return o?(t=l.as(e,v.Forma))&&(r=l.as(t.controller,X.TypeLockupController))&&(n=l.as(t.style,x.LockupStyle))&&(a=n.font)?y.FontFacade.ensureFontLoaded(a.fontData).then((function(e){return r.updateGroup(),t})):p.CorePromise.reject("unable to inspect created lockup for style and font"):e;var t,r,n,a}))):p.CorePromise.reject("textCN is nil")})):p.CorePromise.reject("document has no controller");var a},duplicateItems:function(t,r,o,n){var a,i;void 0===n&&(n=!1);var u=l.clone(N.LayerFacade.sortInZOrder(t));return e.copyItems(u,null).then((function(e){var t=l.clone(e);if(0==!t.length){if(r&&t.forEach((function(e){return e.move(P.Matrix2D.translationXY(25,25))})),o)t[0].page.document.controller.selection.replaceSelectionWithFormae(t);if(t.length==u.length)for(var s=l.iter(l.toSequence(u));!s.done;s.next()){var c=s.value,d=c.offset,g=c.element,m=t[d],f=N.LayerFacade.getZOrder(g),p=N.LayerFacade.getReorderableLayerCount(m)+N.LayerFacade.getMinLayerIndex(m)-1,F=Math.min(f+1,p);1==n?(N.LayerFacade.setZOrder(f,m),N.LayerFacade.setZOrder(F,g)):N.LayerFacade.setZOrder(F,m)}else l.opt(A.Host.logging,(function(e){return e.info("copyItems failed to copy all items")}));if(((a=l.opt(l.opt(t[0].page.document,(function(e){return e.controller})),(function(e){return e.enableMoveableChildren})))||null!=a)&&a&&u.length==t.length)for(var v=l.iter(l.range(0,u.length,!1));!v.done;v.next()){var C=v.value;((i=l.opt(u[C].controller,(function(e){return e.userGroupChild})))||null!=i)&&i&&l.opt(u[C].parent,(function(e){return e.appendChild(t[C])}))}}return t}))},fixUpColorReferences:function(e,t,r,o,n,a){t?m.ColorLibraryMap.remapColors(e,r,o,a):m.ColorLibraryMap.detachFromLibrary(e,r,n)},remapReferences:function(t,r,o,n){if(!l.opt(t.controller,(function(e){return 1==e.userGroup}))){if(t.page!=r.page){var a,i,u,s,c=t.style,d=r.style;if((a=c.colorLibrary)&&(i=d.colorLibrary))e.fixUpColorReferences(d.colors,n,a,i,r.page.colorLibraryController,o),(u=l.as(d,x.LockupStyle))&&(s=u.characterStyles[X.TypeLockupController.HIGHLIGHT_STYLE])&&e.fixUpColorReferences(s.colors,n,a,i,r.page.colorLibraryController,o)}var g,m,f,p;(g=l.as(t,h.FrameForma))&&(m=l.as(r,h.FrameForma))&&(f=g.image)&&(p=m.image)&&e.remapReferences(f,p,o,n)}},copyItemsState:{get:function(){return void 0===t.copyItemsState&&(t.copyItemsState=new i.CopyItemsState),t.copyItemsState},set:function(e){t.copyItemsState=e}},copyItems:function(t,r,o){if(void 0===r&&(r=null),void 0===o&&(o=!0),0==t.length)return p.CorePromise.resolve([]);var n;if(n=t[0].page.document){var a=t.filter((function(e){return l.opt(e.controller,(function(e){return 1==e.duplicatable}))}),this);if(0==a.length)return p.CorePromise.resolve([]);e.copyItemsState.onStart(o);var i=[],u=!1,s=p.CorePromise.resolve(null);return a.forEach((function(t){s=s.then((function(o){return t.controller.copyTo(r).then((function(r){var o;return(o=l.as(r,v.Forma))?(o.isImage()&&(u=!0),e.remapReferences(t,o,e.copyItemsState.mappingCache,e.copyItemsState.mapColorsToTheme),i.push(o),o):null}))}))})),s.then((function(t){return u&&Y.TheoDocumentUtils.updateConstrainedImageInfo(l.opt(r,(function(e){return e.document}))||n),e.copyItemsState.onEnd(),i}))}return p.CorePromise.reject("copyItems: no document?")},deleteFormae:function(e,t){var r,o;if(e.length>0&&(o=e[0].page.document)){for(var n,a,i=!1,u=!1,d=!1,g=l.iter(e);!g.done;g.next()){var m=g.value;if(!(m instanceof w.RootForma)){var f;if(m.isImage()&&(u=!0),m.isLogo()?c.BrandingFacade.isImageBrandedLogo(m)&&(i=!0):m.isTypeLockup()&&c.BrandingFacade.doesLockupUseBrandedFonts(m)&&(i=!0),m.isVideo()&&(d=!0),o.controller.selection.isSelected(m)&&o.controller.selection.deselectForma(m),f=m.parent){var p=m.parent;for(l.opt(l.as(f.controller,I.GroupController),(function(e){return e.removeFormaFromGroup(m)}));((r=l.opt(l.opt(p,(function(e){return e.controller})),(function(e){return e.userGroup})))||null!=r)&&r;){var F=p.parent;p.childCount<=1?T.GroupFacade.ungroupItems([p]):T.GroupFacade.updateUserGroupBounds(p),p=F}}var v=m.controller.settings;null!=v&&v==m.page.document.controller.controllerSettingsState.settings&&(m.page.document.controller.controllerSettingsState.settings=null)}}if(n=l.as(o.firstPage.root.controller,O.RootController))(a=n.getGridController())&&a.onFormaeDeleted(e);s.AnimationLibrary.updateCurrentStyle(o,d),i&&c.BrandingFacade.unBrandDocumentIfNoBrandedElements(o),u&&Y.TheoDocumentUtils.updateConstrainedImageInfo(o)}l.opt(t,(function(e){return e()}))},addContentNodeToDocument:function(e,t){var r;(r=e)&&null==r.parent&&t.content.root.appendChild(r)},removeContentNodeFromDocument:function(e,t){var r;(r=e)&&t.content.root.removeChild(r)},addContent:function(t,r,o,n,a){var u,c;if(void 0===o&&(o=null),void 0===n&&(n=!1),void 0===a&&(a=i.AddFormaParams.DEFAULTS),(u=t.document)&&(c=u.controller)){var d;if(e.addContentNodeToDocument(r,u),e.addContentNodeToDocument(o,u),R.MotionUtils.invalidateAnimation(u),d=e.createFormaFromContent(t,r,o)){var g,m;if((g=a.formaToReplace)&&(m=l.as(l.opt(g.parent,(function(e){return e.controller})),I.GroupController))){var f=E.ImageFacade.getCutoutModeForForma(g);return(f==S.CutoutMode.Off?p.CorePromise.resolve(null):E.ImageFacade.createAndLoadCutoutMaskForReplacementImage(d,f)).then((function(e){var t,r,o,a=g.finalFrame;return m.replaceChildWithForma(g,d,n),s.AnimationLibrary.updateCurrentStyle(u,d.isVideo()),(t=l.as(e,L.ImageForma))&&(r=l.as(d,h.FrameForma))&&(o=l.as(g,h.FrameForma))&&E.ImageFacade.finalizeCutoutAfterMaskLoad(r,t,f,o,a),d}))}return a.parentingHint==i.AddFormaParentingHint.doNotAddFormaForContentToTree?p.CorePromise.resolve(d):e.addForma(c.document.firstPage,d,a).thenReturn(d)}return p.CorePromise.reject("Could not create forma from content")}return p.CorePromise.reject("No related document, or controller")},addForma:function(e,t,r){var o;return void 0===r&&(r=i.AddFormaParams.DEFAULTS),(o=t.controller)?o.addForma(e,t,r).then((function(o){var n;return t.isImage()&&Y.TheoDocumentUtils.updateConstrainedImageInfo(e.document),(n=e.document)&&s.AnimationLibrary.updateCurrentStyle(n,t.isVideo()),r.behavior==u.ControllerSettingsBehaviorEnum.SetControllerSettings&&l.opt(l.opt(e.document,(function(e){return e.controller})),(function(e){return e.controllerSettingsState.settings=l.opt(t.controller,(function(e){return e.settings}))})),null})):p.CorePromise.resolve(null)},createFormaFromContent:function(e,t,r){var o,n,a,i,u,s,d;if((n=e.document)&&(a=n.controller))if(i=l.as(t,b.ImageContentNode)){var g=e.createForma(L.ImageForma.KIND);if(g.contentID=t.id,t.getTag(b.ImageContentNode.IMAGE_MASK_ROLE_TAG)==b.ImageContentNode.ROLE_MASK)o=g;else{switch(l.opt(i.mediaMetadata,(function(e){return e.designIntent}))){case"logo":null!=i.sparkElementID&&""!=i.sparkElementID&&c.BrandingFacade.brandDocumentForElement(n,i.sparkElementID,c.AUTHORING_CONTEXT_TYPE_LOGO),g.intent=v.Forma.INTENT_LOGO;break;case"pattern":g.intent=v.Forma.INTENT_PATTERN;break;case"icon":g.intent=v.Forma.INTENT_ICON;break;case"floating-image":g.intent=v.Forma.INTENT_FLOATING_IMAGE}(f=e.createForma(h.FrameForma.KIND)).appendChild(g),o=f}}else if(u=l.as(t,V.VideoContentNode)){var m,f,p=e.createForma(q.VideoForma.KIND);p.videoContentNode=u,(m=l.as(p.style,Z.VideoStyle))&&(m.duration=u.duration),null!=r&&(p.contentID=r.id),(f=e.createForma(h.FrameForma.KIND)).appendChild(p),o=f,l.opt(l.opt(p.contentNode,(function(e){return e.mediaMetadata})),(function(e){return e.designIntent==_.MediaMetadata.DESIGNINTENT_STICKER}))&&(p.intent=v.Forma.INTENT_STICKER)}else if(s=l.as(t,K.VectorContentNode)){B.LegacyCoreAssert.isFalse(l.opt(s.mediaMetadata,(function(e){return e.designIntent==_.MediaMetadata.DESIGNINTENT_ICON})),"can't create icon from VectorContentNode",void 0,"CreationFacade.createFormaFromContent","CreationFacade.swift",754);var F=e.createForma(z.VectorForma.KIND);F.contentID=s.id,o=F}else if(d=l.as(t,W.TextContentNode)){var C=e.createForma(k.GroupForma.KIND),y=a.controllerFactory.createController(X.TypeLockupController.KIND,C);C.controller=y,y.contentNode=d,y.size=new j.TheoSize(400,300),o=C}return o}}}),e}(),i.CopyItemsState=(a=function(){this.mappingCache=null,this.mapColorsToTheme=!1,this.depth=0},l.defineClass({name:"CopyItemsState",ctor:a,props:{onStart:function(e){0==this.depth&&(this.mappingCache={},this.mapColorsToTheme=e),this.depth+=1},onEnd:function(){0!=this.depth?(this.depth-=1,0==this.depth&&(this.mappingCache=null,this.mapColorsToTheme=!1)):d.CoreAssertDebugOnly.fail("CopyItemsState mismatched onStart/onEnd",void 0,"CopyItemsState.onEnd","CreationFacade.swift",801)}}}),a)},DP9v:function(e,t,r){var o,n,a=t,i=r("oAGj"),l=r("0wFF"),u=r("gXiO"),s=r("iCxV"),c=r("8vXU"),d=r("rxGp"),g=r("fNpk"),m=r("Kkml"),f=r("rrhp");a.MultiBrandFeatureSet=i.defineEnum("MultiBrandFeatureSet",{MULTIBRAND_OWNED_ONLY:0,MULTIBRAND_COMPATIBILITY_MODE_OWNED_ONLY:1,SHARED_BRANDS:2}),a.MultiBrandFacade=(o=function(){u.CoreObject.call(this)},n={},i.defineClass({name:"MultiBrandFacade",ctor:o,superName:"CoreObject",statics:{_sparkACManager:{get:function(){return void 0===n._sparkACManager&&(n._sparkACManager=s.Host.brandkitManager.authoringContextManager),n._sparkACManager},set:function(e){n._sparkACManager=e}},acManager:{get:function(){var e;return(e=o._acManager)?e:o._sparkACManager}},_usingMockedACManager:!1,usingMockedACManager:{get:function(){return o._usingMockedACManager}},useMockACManager:function(e){o._acManager=e,o._usingMockedACManager=!0,o._defaultBrandkitID=null,o._activeBrandkitID=null},useDefaultACHelper:function(){o._acManager=o._sparkACManager,o._usingMockedACManager=!1,o._defaultBrandkitID=null,o._activeBrandkitID=null,o.determineDefaultBrand()},_defaultBrandkitID:null,defaultBrandkitID:{get:function(){return g.LegacyCoreAssert.isTrue(null==o._defaultBrandkitID||!i.isEmpty(o._defaultBrandkitID),"default brand kit id should be nil or non-empty",void 0,"MultiBrandFacade","MultiBrandFacade.swift",74),o._defaultBrandkitID}},defaultBrand:{get:function(){var e;return(e=o.authoringContext(o.defaultBrandkitID))?e.isMinimal?null:e:null}},_activeBrandkitID:null,activeBrandkitID:{get:function(){return g.LegacyCoreAssert.isTrue(null==o._activeBrandkitID||!i.isEmpty(o._activeBrandkitID),"active brand kit id should be nil or non-empty",void 0,"MultiBrandFacade","MultiBrandFacade.swift",103),o._activeBrandkitID}},setActiveBrandkitID:function(e){var t=o.activeBrandkitID;o._activeBrandkitID=null!=e&&i.isEmpty(e)?null:e,t!=o.activeBrandkitID&&(s.Host.logging.logForCategory(d.LogCategories.kMultibrand,"MultiBrandFacade.setActiveBrand: changing from "+o.brandInfo(t)+" to "+o.brandInfo(o.activeBrandkitID),c.LogLevelEnum.INFO_LEVEL),i.opt(s.Host.brandkitManager,(function(e){return e.sendActiveBrandChangedNotification(o.activeBrandkitID)})))},activeBrand:{get:function(){var e,t;return null==o.activeBrandkitID&&null!=o.defaultBrandkitID&&(o.usingMockedACManager||s.Host.logging.logForCategory(d.LogCategories.kMultibrand,"MultiBrandFacade.activeBrand: activeBrandkitID is nil, falling back to defaultBrandkit: "+((e=o.defaultBrandkitID)||null!=e?e:"none"),c.LogLevelEnum.INFO_LEVEL)),o.authoringContext((t=o.activeBrandkitID)||null!=t?t:o.defaultBrandkitID)}},getBrand:function(e){return i.isEmpty(e.authoringContextID)?null:o.authoringContext(e.authoringContextID)},setActiveBrand:function(e){null==e?o.setActiveBrandkitID(null):i.isEmpty(e.authoringContextID)?o.setActiveBrandkitID(o.defaultBrandkitID):o.setActiveBrandkitID(e.authoringContextID)},isBrandOwnedByCurrentUser:function(e){return i.clone(o.acManager.getOwnedAuthoringContextIDs()).filter((function(t){return t==e.id}),this).length>0},authoringContext:function(e){return null==e||i.isEmpty(e)?null:o.acManager.authoringContext(e)},authoringContexts:{get:function(){return o.acManager.authoringContexts}},ownedAuthoringContexts:{get:function(){var e=[],t=i.clone(o.acManager.getOwnedAuthoringContextIDs());if(t.length>0)for(var r=i.iter(t);!r.done;r.next()){var n,a=r.value;(n=o.acManager.authoringContext(a))&&e.push(n)}return e}},ownedBrandCount:{get:function(){return o.ownedAuthoringContexts.length}},sharedWithMeAuthoringContexts:{get:function(){var e=i.clone(o.acManager.getOwnedAuthoringContextIDs());return o.authoringContexts.filter((function(t){return!e.includes(t.id)}),this)}},sharedWithMeBrandCount:{get:function(){return o.sharedWithMeAuthoringContexts.length}},partialAuthoringContexts:{get:function(){return o.authoringContexts.filter((function(e){return!e.activated}),this)}},partialBrandCount:{get:function(){return o.partialAuthoringContexts.length}},usableAuthoringContexts:{get:function(){var e,t,r,n=[];if(e=o.featureSet==a.MultiBrandFeatureSet.SHARED_BRANDS?o.authoringContexts.filter((function(e){return e.activated}),this).map((function(e){return e.id}),this):o.ownedAuthoringContexts.filter((function(e){return e.activated}),this).map((function(e){return e.id}),this),null!=(t=o.defaultBrandkitID)&&(r=o.acManager.authoringContext(t))&&(n.push(r),e=e.filter((function(e){return e!=t}),this)),e.length>0)for(var l=i.iter(e);!l.done;l.next()){var u,s=l.value;(u=o.acManager.authoringContext(s))&&n.push(u)}return n}},usableBrandCount:{get:function(){return o.usableAuthoringContexts.length}},handleUndoRedoMessage:function(e){var t,r,o,n,a;if((n=i.as(e.changeAction,m.ChangeBrandingUserAction))&&null!=(a=e.changeDirection)){var l=(t=n.fromDocBrandID)||null!=t?t:"",u=(r=n.toBrandID)||null!=r?r:"";i.isEmpty(l)&&(a==f.UndoRedoChangeDirection.Undo?(s.Host.logging.logForCategory(d.LogCategories.kMultibrand,"MultiBrandManager.handleUndoRedoMessage: for Undo from "+u+" to none, resetting active brand to previous value "+((o=n.fromActiveBrandID)||null!=o?o:"none"),c.LogLevelEnum.INFO_LEVEL),i.opt(s.Host.brandkitManager,(function(e){return e.activateBrand(n.fromActiveBrandID)}))):(s.Host.logging.logForCategory(d.LogCategories.kMultibrand,"MultiBrandManager.handleUndoRedoMessage: for Redo from none to "+u+", resetting active brand to new brand",c.LogLevelEnum.INFO_LEVEL),i.opt(s.Host.brandkitManager,(function(e){return e.activateBrand(u)}))))}},featureSet:{get:function(){return void 0===n.featureSet&&(n.featureSet=a.MultiBrandFeatureSet.MULTIBRAND_OWNED_ONLY),n.featureSet},set:function(e){n.featureSet=e}},determineDefaultBrand:function(){var e=o.acManager.getDefaultBrandIdFromServer();switch(o.featureSet){case a.MultiBrandFeatureSet.MULTIBRAND_OWNED_ONLY:o.determineDefaultBrand_forMultiBrand();break;case a.MultiBrandFeatureSet.MULTIBRAND_COMPATIBILITY_MODE_OWNED_ONLY:o.determineDefaultBrand_CompatibilityMode(e);break;case a.MultiBrandFeatureSet.SHARED_BRANDS:o.determineDefaultBrand(e)}},determineDefaultBrand_forMultiBrand:function(){var e,t,r=null,n=null,a=(e=i.opt(s.Host.brandkitManager,(function(e){return e.adobeID})))||null!=e?e:"";if(s.Host.logging.logForCategory(d.LogCategories.kMultibrand,"MultiBrandFacade.determineDefaultBrand: "+o.authoringContexts.length+" authoringContexts",c.LogLevelEnum.INFO_LEVEL),(!i.isEmpty(a)&&s.Host.brandkitManager.isBrandkitEnabled||o.usingMockedACManager)&&o.authoringContexts.length>0){var l=i.clone(o.ownedAuthoringContexts);switch(s.Host.logging.logForCategory(d.LogCategories.kMultibrand,"MultiBrandFacade.determineDefaultBrand: "+l.length+" ownedBrands",c.LogLevelEnum.INFO_LEVEL),l.length){case 0:r=null;break;case 1:l[0].isDefault&&(r=(n=l[0]).id,n.activated||s.Host.logging.logForCategory(d.LogCategories.kMultibrand,"MultiBrandFacade.determineDefaultBrand: default brand "+o.brandInfo(n.id)+" is a partial brand",c.LogLevelEnum.INFO_LEVEL));break;default:for(var u=i.iter(l);!u.done;u.next()){var g=u.value;if(g.isDefault){r=(n=g).id,g.activated||s.Host.logging.logForCategory(d.LogCategories.kMultibrand,"MultiBrandFacade.determineDefaultBrand: default brand "+o.brandInfo(g.id)+" is a partial brand",c.LogLevelEnum.INFO_LEVEL);break}}}}null!=n&&n.isMinimal&&s.Host.logging.logForCategory(d.LogCategories.kMultibrand,"MultiBrandFacade.determineDefaultBrand: default brand is in minimal sync state!",c.LogLevelEnum.INFO_LEVEL),o.defaultBrandkitID!=r?(s.Host.logging.logForCategory(d.LogCategories.kMultibrand,"MultiBrandFacade.determineDefaultBrand: changing from "+o.brandInfo(o.defaultBrandkitID)+" to "+o.brandInfo(r),c.LogLevelEnum.INFO_LEVEL),o._defaultBrandkitID=r,o.usingMockedACManager||s.Host.brandkitManager.sendDefaultBrandChangedNotification(o.defaultBrandkitID)):s.Host.logging.logForCategory(d.LogCategories.kMultibrand,"MultiBrandFacade.determineDefaultBrand: no change, still using "+((t=o.defaultBrandkitID)||null!=t?t:"none"),c.LogLevelEnum.INFO_LEVEL)},determineDefaultBrand_CompatibilityMode:function(e){var t,r=null;if(s.Host.brandkitManager.isBrandkitEnabled||o.usingMockedACManager){var n,a=!1;if((n=o.authoringContext(e))&&n.ownedByCurrentUser&&n.activated&&(s.Host.logging.logForCategory(d.LogCategories.kMultibrand,"determineDefaultBrand: using valueFromSpark "+n.name,c.LogLevelEnum.INFO_LEVEL),a=!0),a)r=e;else{var l,u,g,m=i.clone(o.ownedAuthoringContexts);(l=i.first(m.filter((function(e){return e.isDefault}),this).filter((function(e){return e.activated}),this)))?(r=l.id,s.Host.logging.logForCategory(d.LogCategories.kMultibrand,"determineDefaultBrand: fallback using preSharingLogic_DefaultBrand "+l.name,c.LogLevelEnum.INFO_LEVEL)):(u=i.first(i.sort(m.filter((function(e){return e.activated}),this),(function(e,t){return e.name<t.name}))))?(r=u.id,s.Host.logging.logForCategory(d.LogCategories.kMultibrand,"determineDefaultBrand: fallback using firstOwnedActivatedAlphabeticBrand "+u.name,c.LogLevelEnum.INFO_LEVEL)):(g=i.first(i.sort(m.filter((function(e){return!e.activated}),this),(function(e,t){return e.name<t.name}))))?(r=g.id,s.Host.logging.logForCategory(d.LogCategories.kMultibrand,"determineDefaultBrand: fallback using firstOwnedUnActivatedAlphabeticBrand: "+g.name,c.LogLevelEnum.INFO_LEVEL)):s.Host.logging.logForCategory(d.LogCategories.kMultibrand,"determineDefaultBrand: no fallback default brand",c.LogLevelEnum.INFO_LEVEL)}}var f=o.authoringContext(r);null!=f&&f.isMinimal&&s.Host.logging.logForCategory(d.LogCategories.kMultibrand,"MultiBrandFacade.determineDefaultBrand: default brand is in minimal sync state!",c.LogLevelEnum.INFO_LEVEL),o.defaultBrandkitID!=r?(s.Host.logging.logForCategory(d.LogCategories.kMultibrand,"MultiBrandFacade.determineDefaultBrand: changing from "+o.brandInfo(o.defaultBrandkitID)+" to "+o.brandInfo(r),c.LogLevelEnum.INFO_LEVEL),o._defaultBrandkitID=r,o.usingMockedACManager||s.Host.brandkitManager.sendDefaultBrandChangedNotification(o.defaultBrandkitID)):s.Host.logging.logForCategory(d.LogCategories.kMultibrand,"MultiBrandFacade.determineDefaultBrand: no change, still using "+((t=o.defaultBrandkitID)||null!=t?t:"none"),c.LogLevelEnum.INFO_LEVEL)},determineDefaultBrand:function(e){var t,r=null;if(s.Host.brandkitManager.isBrandkitEnabled||o.usingMockedACManager){var n,a=!1;if((n=o.authoringContext(e))&&n.activated&&(s.Host.logging.logForCategory(d.LogCategories.kMultibrand,"determineDefaultBrand: using valueFromSpark "+n.name,c.LogLevelEnum.INFO_LEVEL),a=!0),a)r=e;else{var l,u,g,m,f=i.clone(o.ownedAuthoringContexts);(l=i.first(f.filter((function(e){return e.isDefault}),this).filter((function(e){return e.activated}),this)))?(r=l.id,s.Host.logging.logForCategory(d.LogCategories.kMultibrand,"determineDefaultBrand: fallback using preSharingLogic_DefaultBrand "+l.name,c.LogLevelEnum.INFO_LEVEL)):(u=i.first(i.sort(f.filter((function(e){return e.activated}),this),(function(e,t){return e.name<t.name}))))?(r=u.id,s.Host.logging.logForCategory(d.LogCategories.kMultibrand,"determineDefaultBrand: fallback using firstOwnedActivatedAlphabeticBrand "+u.name,c.LogLevelEnum.INFO_LEVEL)):(g=i.first(i.sort(o.sharedWithMeAuthoringContexts.filter((function(e){return e.activated}),this),(function(e,t){return e.name<t.name}))))?(r=g.id,s.Host.logging.logForCategory(d.LogCategories.kMultibrand,"determineDefaultBrand: fallback using firstSharedActivatedAlphabeticBrand: "+g.name,c.LogLevelEnum.INFO_LEVEL)):(m=i.first(i.sort(f.filter((function(e){return!e.activated}),this),(function(e,t){return e.name<t.name}))))?(r=m.id,s.Host.logging.logForCategory(d.LogCategories.kMultibrand,"determineDefaultBrand: fallback using firstOwnedUnActivatedAlphabeticBrand: "+m.name,c.LogLevelEnum.INFO_LEVEL)):s.Host.logging.logForCategory(d.LogCategories.kMultibrand,"determineDefaultBrand: no fallback default brand",c.LogLevelEnum.INFO_LEVEL)}}var p=o.authoringContext(r);null!=p&&p.isMinimal&&s.Host.logging.logForCategory(d.LogCategories.kMultibrand,"MultiBrandFacade.determineDefaultBrand: default brand is in minimal sync state!",c.LogLevelEnum.INFO_LEVEL),o.defaultBrandkitID!=r?(s.Host.logging.logForCategory(d.LogCategories.kMultibrand,"MultiBrandFacade.determineDefaultBrand: changing from "+o.brandInfo(o.defaultBrandkitID)+" to "+o.brandInfo(r),c.LogLevelEnum.INFO_LEVEL),o._defaultBrandkitID=r,o.usingMockedACManager||s.Host.brandkitManager.sendDefaultBrandChangedNotification(o.defaultBrandkitID)):s.Host.logging.logForCategory(d.LogCategories.kMultibrand,"MultiBrandFacade.determineDefaultBrand: no change, still using "+((t=o.defaultBrandkitID)||null!=t?t:"none"),c.LogLevelEnum.INFO_LEVEL)},brandWasDeleted:function(e){o.determineDefaultBrand(),o.activeBrandkitID==e&&(s.Host.logging.logForCategory(d.LogCategories.kMultibrand,"MultiBrandFacade.onAuthoringContextDeleted:  Active Brand was deleted!",c.LogLevelEnum.INFO_LEVEL),o.setActiveBrandkitID(o.defaultBrandkitID))},brandInfo:function(e){var t,r="none";return(t=o.authoringContext(e))&&(r=t.name+":"+t.id),r},addBrandkit:function(e){var t;return 0!=o.ownedBrandCount&&g.LegacyCoreAssert.fail("addBrandkit called when user already owns at least one Brandkit",{},"MultiBrandFacade.addBrandkit","MultiBrandFacade.swift",535),(t=o.acManager.createAuthoringContext(e,!0))?(s.Host.platform.isIOS?i.opt(s.Host.logging,(function(e){return e.logToAnalytics(l.AnalyticsConstants.kAnalyticsDataBrandkitCreatediOS,{})})):s.Host.platform.isAndroid&&i.opt(s.Host.logging,(function(e){return e.logToAnalytics(l.AnalyticsConstants.kAnalyticsDataBrandkitCreatedAndroid,{})})),t):null}}}),o)},K9Oa:function(e,t,r){var o,n=t,a=r("oAGj"),i=r("gXiO"),l=r("ylxa"),u=r("iCxV"),s=r("3DEm"),c=r("sIWg");n.PageFacade=(o=function(){i.CoreObject.call(this)},a.defineClass({name:"PageFacade",ctor:o,superName:"CoreObject",statics:{kMinPageDimension:50,kMaxPageDimension:6e3,getMinPageDimensionForUnits:function(e,t){var r=o.getNumDecimalPlacesForUnits(e),n=o.unitsToPixelsFactor(e,t),i=o.kMinPageDimension/n;if(0!=r){var l=1/Math.pow(10,a.toDouble(r)),u=.5/Math.pow(10,a.toDouble(r));i=s.MathUtils.nearestMultiple(i+u,l)}return i},getMaxPageDimensionForUnits:function(e,t){var r=o.getNumDecimalPlacesForUnits(e),n=o.unitsToPixelsFactor(e,t),i=o.kMaxPageDimension/n;if(0!=r){var l=1/Math.pow(10,a.toDouble(r)),u=.5/Math.pow(10,a.toDouble(r));i=s.MathUtils.nearestMultiple(i-u,l)}return i},pageDimensionIsInRange:function(e,t,r){return!o.pageDimensionIsTooSmall(e,t,r)&&!o.pageDimensionIsTooLarge(e,t,r)},pageDimensionIsTooSmall:function(e,t,r){var n=o.convertStringToPixelsValue(e,t,r),a=o.getMinPageDimensionForUnits(t,r);return n<o.unitsToPixelsFactor(t,r)*a},pageDimensionIsTooLarge:function(e,t,r){var n=o.convertStringToPixelsValue(e,t,r),a=o.getMaxPageDimensionForUnits(t,r);return n>o.unitsToPixelsFactor(t,r)*a},setPageDesignSize:function(e,t){e.setPageSizeFromDesignSize(t)},getNumDecimalPlacesForUnits:function(e){var t=0;return e==l.PageExportFormat.INCHES?t=2:e==l.PageExportFormat.MILLIMETERS&&(t=1),t},unitsToPixelsFactor:function(e,t){return e==l.PageExportFormat.MILLIMETERS?l.FormaPageExportData.MM_TO_INCHES*t:e==l.PageExportFormat.INCHES?t:1},convertStringToPixelsValue:function(e,t,r){var n;return((n=a.opt(u.Host.locale,(function(t){return t.convertStringToNumber(e)})))||null!=n?n:a.toDouble(e))*o.unitsToPixelsFactor(t,r)},convertPixelsToUnitsString:function(e,t,r){var n,i=e/o.unitsToPixelsFactor(t,r),l=o.getNumDecimalPlacesForUnits(t);if(null!=u.Host.locale)return n=u.Host.locale.formatNumber(i,l);if((n=a.toString("%."+l+"f",i)).includes("."))for(;n.endsWith("0");)n=n.substr(0,n.length-1);return n.endsWith(".")&&(n=n.substr(0,n.length-1)),n},aspectRatioIsVeryTallOrWide:function(e){var t=c.TheoRect.fromSize(e);return t.aspectRatio>=5||t.aspectRatio<=.2}}}),o)},"LP+A":function(e,t,r){var o,n=t,a=r("oAGj"),i=r("gXiO"),l=r("iSwi"),u=r("LqGn");n.RetargetLayoutOption=a.defineEnum("RetargetLayoutOption",{UNSET:-1,DisableLayout:0,EnableLayout:1}),n.DesignSuggestionFacade=(o=function(){i.CoreObject.call(this)},a.defineClass({name:"DesignSuggestionFacade",ctor:o,superName:"CoreObject",statics:{createSuggestionsFromTemplate:function(e,t,r,o,i,s){void 0===i&&(i=10),void 0===s&&(s=n.RetargetLayoutOption.UNSET);var c=new l.RetargetSuggester(t,r,e,o),d=a.clone(c.createSuggestions()).filter((function(e){return e instanceof u.RetargetSuggestion}),this).map((function(e){return e}),this);return s!=n.RetargetLayoutOption.UNSET?d=d.filter((function(e){return e.layoutUpdate==(s==n.RetargetLayoutOption.EnableLayout)}),this):l.RetargetSuggester.shouldAttemptLayoutSuggestion(t)||(d=d.filter((function(e){return 0==e.layoutUpdate}),this)),d.slice(0,Math.min(d.length,i))}}}),o)},MWx2:function(e,t,r){var o,n=t,a=r("oAGj");n.HandleFacade=(o=function(){},a.defineClass({name:"HandleFacade",ctor:o}),o)},MYNe:function(e,t,r){var o,n=t,a=r("oAGj"),i=r("gXiO");n.LayerFacade=(o=function(){i.CoreObject.call(this)},a.defineClass({name:"LayerFacade",ctor:o,superName:"CoreObject",statics:{sortInZOrder:function(e){var t=a.clone(e);return a.sortInPlace(t,(function(e,t){return o.getZOrder(e)<o.getZOrder(t)})),t},getZOrder:function(e){var t;return(t=e.controller)?t.getZOrder():0},setZOrder:function(e,t){a.opt(t.controller,(function(t){return t.setZOrder(e)}))},getMinLayerIndex:function(e){var t;return(t=e.controller)?t.getMinLayerIndex():0},getReorderableLayerCount:function(e){var t;return(t=e.controller)?t.getReorderableLayerCount():0},checkForContiguousChunk:function(e,t){var r=a.clone(o.sortInZOrder(t)),n=o.getMinLayerIndex(t[0]),i=o.getReorderableLayerCount(t[0])+n-1,l=0,u=0;if("backward"==e||"back"==e){if(o.getZOrder(r[0])==n)for(var s=a.iter(a.range(1,r.length-1,!0));!s.done;s.next()){var c=r[f=s.value],d=r[f-1];if(o.getZOrder(c)-o.getZOrder(d)!=1)break;l+=1}if(0!=l)return a.dropFirst(r,l+1)}else if("forward"==e||"front"==e){var g=a.last(r);if(o.getZOrder(g)==i)for(var m=a.iter(a.range(1,r.length-1,!0).reversed());!m.done;m.next()){var f;if(c=r[f=m.value],d=r[f-1],o.getZOrder(c)-o.getZOrder(d)!=1)break;u+=1}if(0!=u)return a.dropLast(r,u+1)}return r}}}),o),n.ZOrderEnum=a.defineEnum("ZOrderEnum",{Forward:"forward",Backward:"backward",Front:"front",Back:"back"})},O8XL:function(e,t,r){var o,n,a=t,i=r("oAGj"),l=r("0wFF"),u=r("cZuM"),s=r("gXiO"),c=r("wNKJ"),d=r("FNB+"),g=r("iCxV"),m=r("fNpk"),f=r("tGKA"),p=r("3DEm");a.DistributeType=i.defineEnum("DistributeType",{HorizontalSpace:0,LeftEdge:1,CenterX:2,RightEdge:3,VerticalSpace:4,TopEdge:5,CenterY:6,BottomEdge:7,Row:8,Column:9}),a.describeDistributeType=function(e){switch(e){case 0:return"HorizontalSpace";case 1:return"LeftEdge";case 2:return"CenterX";case 3:return"RightEdge";case 4:return"VerticalSpace";case 5:return"TopEdge";case 6:return"CenterY";case 7:return"BottomEdge";case 8:return"Row";case 9:return"Column"}},a.FormaGeometryInfo=(o=function(){this.minEdge=99999999.9,this.maxEdge=-99999999.9,this.totalObjectSpan=0,this.interiorFormaeSortedByPosition=[]},i.defineClass({name:"FormaGeometryInfo",ctor:o,props:{getNumFormae:function(){return i.eq(d._equality_Forma_Forma,this.firstForma,this.lastForma)?this.interiorFormaeSortedByPosition.length+1:this.interiorFormaeSortedByPosition.length+2}}}),o),a.AlignmentFacade=(n=function(){s.CoreObject.call(this)},i.defineClass({name:"AlignmentFacade",ctor:n,superName:"CoreObject",statics:{arrangeFormae:function(e,t){i.opt(g.Host.logging,(function(r){return r.logToAnalytics(l.AnalyticsConstants.kAnalyticsFormaeArranged,{contextualData1:"horizontal: "+e,contextualData2:"formae count: "+t.length})})),n.distributeOrArrangeFormae(e?a.DistributeType.Row:a.DistributeType.Column,t),n.rescueFormae(t)},distributeFormae:function(e,t){i.opt(g.Host.logging,(function(r){return r.logToAnalytics(l.AnalyticsConstants.kAnalyticsFormaeDistributed,{contextualData1:"type: "+a.describeDistributeType(e),contextualData2:"formae count: "+t.length})})),m.LegacyCoreAssert.isTrue(t.length>2,"not enough formae to distribute",void 0,"AlignmentFacade.distributeFormae","AlignmentFacade.swift",79),m.LegacyCoreAssert.isTrue(e!=a.DistributeType.Row&&e!=a.DistributeType.Column,"Use arrangeFormae to do row/column layout",void 0,"AlignmentFacade.distributeFormae","AlignmentFacade.swift",80),n.distributeOrArrangeFormae(e,t),n.rescueFormae(t)},alignFormae:function(e,t){e==u.AlignmentType.CenterX||e==u.AlignmentType.CenterY?n.alignCenters(e,t):n.alignEdges(e,t),n.rescueFormae(t)},rescueFormae:function(e){for(var t=i.iter(e);!t.done;t.next()){var r=t.value;c.DragFacade.rescueFormaToPageBounds(r)}},calculateFormaGeometryInfo:function(e,t){m.LegacyCoreAssert.isTrue(t.length>=2,"Not enough forma to distribute",void 0,"AlignmentFacade.calculateFormaGeometryInfo","AlignmentFacade.swift",105);for(var r=new a.FormaGeometryInfo,o=i.iter(t);!o.done;o.next()){var l=o.value.controller.getUserPerceivedFrame();if(null!=l)switch(e){case 0:case 1:case 2:case 3:case 8:r.minEdge=p.MathUtils.minDouble(r.minEdge,l.minX),r.maxEdge=p.MathUtils.maxDouble(r.maxEdge,l.maxX),r.totalObjectSpan+=l.maxX-l.minX;break;case 4:case 5:case 6:case 7:case 9:r.minEdge=p.MathUtils.minDouble(r.minEdge,l.minY),r.maxEdge=p.MathUtils.maxDouble(r.maxEdge,l.maxY),r.totalObjectSpan+=l.maxY-l.minY}}var u=i.sort(t,(function(t,r){var o=t.controller.getUserPerceivedFrame(),n=r.controller.getUserPerceivedFrame();if(null!=o&&null!=n)switch(e){case 0:case 1:case 2:case 3:case 8:return o.minX<n.minX;case 4:case 5:case 6:case 7:case 9:return o.minY<n.minY}return!1}));r.firstForma=i.first(u),r.lastForma=i.last(u);for(var s=i.iter(u);!s.done;s.next()){var c=s.value,g=c.controller.getUserPerceivedFrame(),f=r.firstForma.controller.getUserPerceivedFrame(),F=r.lastForma.controller.getUserPerceivedFrame();switch(e){case 0:case 1:case 2:case 3:case 8:n.isVeryClose(f.minX,g.minX)&&g.width>f.width&&(r.firstForma=c),(g.maxX>F.maxX||n.isVeryClose(g.maxX,F.maxX)&&g.width>F.width)&&(r.lastForma=c);break;case 4:case 5:case 6:case 7:case 9:n.isVeryClose(f.minY,g.minY)&&g.height>f.height&&(r.firstForma=c),(g.maxY>F.maxY||n.isVeryClose(g.maxY,F.maxY)&&g.height>F.height)&&(r.lastForma=c)}}return i.remove(u,r.firstForma),i.eq(d._equality_Forma_Forma,r.firstForma,r.lastForma)||i.remove(u,r.lastForma),r.interiorFormaeSortedByPosition=i.clone(u),r},distributeOrArrangeFormae:function(e,t){var r=n.calculateFormaGeometryInfo(e,t);m.LegacyCoreAssert.isTrue(null!=r.firstForma,"expected to have a firstForma computed",void 0,"AlignmentFacade.distributeOrArrangeFormae","AlignmentFacade.swift",189),m.LegacyCoreAssert.isTrue(null!=r.lastForma,"expected to have a lastForma computed",void 0,"AlignmentFacade.distributeOrArrangeFormae","AlignmentFacade.swift",190),m.LegacyCoreAssert.isTrue(r.getNumFormae()==t.length,"expected sorted formae to match formae list",void 0,"AlignmentFacade.distributeOrArrangeFormae","AlignmentFacade.swift",191),e==a.DistributeType.Row||e==a.DistributeType.Column||e==a.DistributeType.VerticalSpace||e==a.DistributeType.HorizontalSpace?n.distributeSpaceOrMakeRowColumn(r,e):n.distributeEdges(r,e)},distributeEdges:function(e,t){m.LegacyCoreAssert.isTrue(e.getNumFormae()>=3,"expected at least 3 items to distribute",void 0,"AlignmentFacade.distributeEdges","AlignmentFacade.swift",201),m.LegacyCoreAssert.isTrue(t==a.DistributeType.LeftEdge||t==a.DistributeType.CenterX||t==a.DistributeType.RightEdge||t==a.DistributeType.TopEdge||t==a.DistributeType.CenterY||t==a.DistributeType.BottomEdge,"unexpected distribute type",void 0,"AlignmentFacade.distributeEdges","AlignmentFacade.swift",202);var r=0,o=0,n=e.firstForma.controller.getUserPerceivedFrame(),l=e.lastForma.controller.getUserPerceivedFrame();switch(m.LegacyCoreAssert.isTrue(null!=n&&null!=l,"expecting formae to have frames",void 0,"AlignmentFacade.distributeEdges","AlignmentFacade.swift",209),t){case 1:r=n.minX,o=l.minX;break;case 5:r=n.minY,o=l.minY;break;case 3:r=n.maxX,o=l.maxX;break;case 7:r=n.maxY,o=l.maxY;break;case 2:r=(n.maxX+n.minX)/2,o=(l.maxX+l.minX)/2;break;case 6:r=(n.maxY+n.minY)/2,o=(l.maxY+l.minY)/2;break;default:m.LegacyCoreAssert.fail("unexpected distribute type",void 0,"AlignmentFacade.distributeEdges","AlignmentFacade.swift",230)}for(var u=(o-r)/i.toDouble(e.getNumFormae()-1),s=r+u,c=i.iter(e.interiorFormaeSortedByPosition);!c.done;c.next()){var d=c.value,g=d.controller.getUserPerceivedFrame();if(null!=g){var p=0,F=0;switch(t){case 1:p=s-g.minX,s=g.minX+p+u;break;case 3:p=s-g.maxX,s=g.maxX+p+u;break;case 5:F=s-g.minY,s=g.minY+F+u;break;case 7:F=s-g.maxY,s=g.maxY+F+u;break;case 2:var v=(g.maxX+g.minX)/2;s=v+(p=s-v)+u;break;case 6:var C=(g.maxY+g.minY)/2;s=C+(F=s-C)+u;break;default:m.LegacyCoreAssert.fail("unexpected distribute type",void 0,"AlignmentFacade.distributeEdges","AlignmentFacade.swift",270)}if(0!=p||0!=F){var h=new f.Matrix2D(1,0,0,1,p,F);i.opt(d.controller,(function(e){return e.move(h)}))}}}},isVeryClose:function(e,t){return p.MathUtils.absDouble(e-t)<1e-4},getRequiredShiftAmount:function(e,t,r){var o=0;if(r==a.DistributeType.Row||r==a.DistributeType.Column){var n,l,u=e.totalObjectSpan+t*i.toDouble(e.getNumFormae()-1),s=e.firstForma.controller.getUserPerceivedFrame();r==a.DistributeType.Row?(n=s.minX+u,l=e.firstForma.page.pageSize.width):(n=s.minY+u,l=e.firstForma.page.pageSize.height),n>l&&(o=u>l?r==a.DistributeType.Row?-1*s.minX:-1*s.minY:l-n)}return o},getFormaSpacingForRowCol:function(e,t){var r=e.totalObjectSpan/(10*i.toDouble(e.getNumFormae())),o=e.totalObjectSpan/(5*i.toDouble(e.getNumFormae())),a=e.totalObjectSpan/(2*i.toDouble(e.getNumFormae()));return t<0?0:n.isVeryClose(t,r)?o:n.isVeryClose(t,o)?a:n.isVeryClose(t,a)?0:r},distributeSpaceOrMakeRowColumn:function(e,t){var r,o;m.LegacyCoreAssert.isTrue(t==a.DistributeType.Row||t==a.DistributeType.Column||t==a.DistributeType.VerticalSpace||t==a.DistributeType.HorizontalSpace,"wrong distribute type",void 0,"AlignmentFacade.distributeSpaceOrMakeRowColumn","AlignmentFacade.swift",353);var l,u=(e.maxEdge-e.minEdge-e.totalObjectSpan)/i.toDouble(e.getNumFormae()-1),s=e.interiorFormaeSortedByPosition.concat();t!=a.DistributeType.Row&&t!=a.DistributeType.Column||(s.push(e.lastForma),u=n.getFormaSpacingForRowCol(e,u)),l=t==a.DistributeType.Row||t==a.DistributeType.HorizontalSpace?((r=i.opt(e.firstForma.controller.getUserPerceivedFrame(),(function(e){return e.maxX})))||null!=r?r:0)+u:((o=i.opt(e.firstForma.controller.getUserPerceivedFrame(),(function(e){return e.maxY})))||null!=o?o:0)+u;var c=n.getRequiredShiftAmount(e,u,t);0!=c&&s.splice(0,0,e.firstForma);for(var g=i.iter(s);!g.done;g.next()){var p=g.value,F=p.controller.getUserPerceivedFrame();if(null!=F){var v=0,C=0;if(i.eq(d._equality_Forma_Forma,p,e.firstForma)&&!i.eq(d._equality_Forma_Forma,p,e.lastForma)?(m.LegacyCoreAssert.isTrue(0!=c,"shouldn't be moving first element",void 0,"AlignmentFacade.distributeSpaceOrMakeRowColumn","AlignmentFacade.swift",394),t==a.DistributeType.Row?(v=c,l=F.maxX+v+u):(m.LegacyCoreAssert.isTrue(t==a.DistributeType.Column,"Shouldn't have a shift unless we're doing Row or Column layout",void 0,"AlignmentFacade.distributeSpaceOrMakeRowColumn","AlignmentFacade.swift",400),C=c,l=F.maxY+C+u)):t==a.DistributeType.Row||t==a.DistributeType.HorizontalSpace?(v=l-F.minX,l=F.maxX+v+u):(C=l-F.minY,l=F.maxY+C+u),0!=v||0!=C){var h=new f.Matrix2D(1,0,0,1,v,C);i.opt(p.controller,(function(e){return e.move(h)}))}}}},alignCenters:function(e,t){m.LegacyCoreAssert.isTrue(e==u.AlignmentType.CenterX||e==u.AlignmentType.CenterY,"alignCenters called with non-center alignment type",void 0,"AlignmentFacade.alignCenters","AlignmentFacade.swift",430);for(var r=99999999.9,o=-99999999.9,n=i.iter(t);!n.done;n.next())null!=(c=(s=n.value).controller.getUserPerceivedFrame())&&(e==u.AlignmentType.CenterX?(r=p.MathUtils.minDouble(r,c.minX),o=p.MathUtils.maxDouble(o,c.maxX)):(r=p.MathUtils.minDouble(r,c.minY),o=p.MathUtils.maxDouble(o,c.maxY)));for(var a=(r+o)/2,l=i.iter(t);!l.done;l.next()){var s,c;if(null!=(c=(s=l.value).controller.getUserPerceivedFrame())){var d=0,g=0;if(e==u.AlignmentType.CenterX?d=a-(c.minX+c.maxX)/2:g=a-(c.minY+c.maxY)/2,0!=d||0!=g){var F=new f.Matrix2D(1,0,0,1,d,g);i.opt(s.controller,(function(e){return e.move(F)}))}}}},alignEdges:function(e,t){var r=99999999.9;e!=u.AlignmentType.Right&&e!=u.AlignmentType.Bottom||(r*=-1);for(var o=i.iter(t);!o.done;o.next())null!=(l=(a=o.value).controller.getUserPerceivedFrame())&&(e==u.AlignmentType.Left?r=p.MathUtils.minDouble(r,l.minX):e==u.AlignmentType.Right?r=p.MathUtils.maxDouble(r,l.maxX):e==u.AlignmentType.Top?r=p.MathUtils.minDouble(r,l.minY):e==u.AlignmentType.Bottom?r=p.MathUtils.maxDouble(r,l.maxY):m.LegacyCoreAssert.fail("align to type not yet implemented",{type:e},"AlignmentFacade.alignEdges","AlignmentFacade.swift",493));for(var n=i.iter(t);!n.done;n.next()){var a,l;if(null!=(l=(a=n.value).controller.getUserPerceivedFrame())){var s=0,c=0;if(e==u.AlignmentType.Left?s=r-l.minX:e==u.AlignmentType.Right?s=r-l.maxX:e==u.AlignmentType.Top?c=r-l.minY:e==u.AlignmentType.Bottom&&(c=r-l.maxY),0!=s||0!=c){var d=new f.Matrix2D(1,0,0,1,s,c);i.opt(a.controller,(function(e){return e.move(d)}))}}}}}}),n)},T8w7:function(e,t,r){var o,n=t,a=r("oAGj"),i=r("gXiO"),l=r("FNB+"),u=r("QbzR"),s=r("X0GW"),c=r("lmwz"),d=r("uxH+"),g=r("8t9B");n.OpacityFacade=(o=function(){i.CoreObject.call(this)},a.defineClass({name:"OpacityFacade",ctor:o,superName:"CoreObject",statics:{applyOpacity:function(e,t){for(var r=a.iter(t);!r.done;r.next()){var o=r.value;a.opt(o.controller,(function(t){return t.applyOpacity(e)}))}},getOpacityForForma:function(e){var t;return(t=a.opt(e.controller,(function(e){return e.currentOpacity})))||null!=t?t:1},applyTextOpacity:function(e,t){for(var r=a.iter(t);!r.done;r.next()){var o=r.value;a.opt(a.as(o.controller,g.TypeLockupController),(function(t){return t.applyTextOpacity(e)}))}},applyShapeOpacity:function(e,t){for(var r=a.iter(t);!r.done;r.next()){var o=r.value;a.opt(a.as(o.controller,g.TypeLockupController),(function(t){return t.applyShapeOpacity(e)}))}},getShapeOpacityForForma:function(e){var t;return(t=a.as(e.controller,g.TypeLockupController))?t.currentShapeOpacity:u.FormaStyle.OPACITY_UNSET},applyBackgroundOpacity:function(e,t){var r;(r=a.as(t.root.controller,d.RootController))&&r.setBackgroundTransparency(e)},getBackgroundOpacity:function(e){var t;return(t=a.as(e.root.controller,d.RootController))?t.getBackgroundTransparency():1},applyBlendMode:function(e,t){for(var r=a.iter(t);!r.done;r.next()){var o=r.value;a.opt(o.controller,(function(t){return t.applyBlendMode(e)}))}},getBlendModeForForma:function(e){return e.style.blendMode},formaHasNonNormalBlendMode:function(e){return o.getBlendModeForForma(e)!=u.FormaBlendMode.Normal},formaCanHaveBlendMode:function(e){var t,r,o=!1;return s.GroupFacade.isInsideUserGroup(e)||(e.isImage()?(t=c.ImageFacade.getFrameFormaForForma(e))&&(r=t.controller)&&(o=!e.isVideo()&&!e.isLogo()&&!e.isSticker()&&r.floating):e.isShape()&&(o=!e.isGridCell())),o},getBlendModeUseForAnalytics:function(e){var t=!1,r=!1;return e.firstPage.root.visitAll(l.FormaTraversal.PreOrder,(function(e){if(o.formaCanHaveBlendMode(e)){var n=o.getBlendModeForForma(e);n==u.FormaBlendMode.Multiply?t=!0:n==u.FormaBlendMode.Screen&&(r=!0)}})),t&&r?"multiply,screen":t?"multiply":r?"screen":"none"}}}),o)},V3yt:function(e,t,r){var o,n=t,a=r("oAGj"),i=r("yGNn"),l=r("iCxV");n.FontFacade=(o=function(){},a.defineClass({name:"FontFacade",ctor:o,statics:{ensureFontLoaded:function(e){switch(e.availability){case 1:var t;return(t=l.Host.fontProvider)?new i.CorePromise((function(r,o){return t.loadFont(e,(function(){return r(e)}),(function(){return o("could not load font")}))})):i.CorePromise.reject("Host.fontProvider not available; can't load font.");case 2:return i.CorePromise.resolve(e);case 3:return i.CorePromise.reject("font cannot be loaded");case 0:return i.CorePromise.reject("font unknown loadable")}}}}),o)},X0GW:function(e,t,r){var o,n=t,a=r("oAGj"),i=r("gXiO"),l=r("yGNn"),u=r("FNB+"),s=r("ZK0l"),c=r("pnSN"),d=r("6Rk9"),g=r("iCxV"),m=r("fNpk"),f=r("MYNe"),p=r("tGKA"),F=r("JFv5"),v=r("sIWg");n.GroupFacade=(o=function(){i.CoreObject.call(this)},a.defineClass({name:"GroupFacade",ctor:o,superName:"CoreObject",statics:{groupItems:function(e){return 0==e.length?l.CorePromise.resolve([]):(t=o.createGroupFromFormae(e))?(t.intent=u.Forma.INTENT_USER_GROUP,l.CorePromise.resolve(t)):l.CorePromise.reject("couldn't create a group");var t},updateUserGroupBounds:function(e){m.LegacyCoreAssert.isTrue(e.controller.userGroup,"asked to update user group bounds for a group that's not a user group",void 0,"GroupFacade.updateUserGroupBounds","GroupFacade.swift",33);var t=a.clone(e.childrenAsArray);if(t.length>0){for(var r={},o=d.GeometryFacade.unionFrame(t),n=a.iter(t);!n.done;n.next())r[(c=n.value).formaID]=c.finalFrame,e.root.appendChild(c,!0);var i=e.placement.calculateTransformValuesSKRT(),l=p.Matrix2D.rotation(i.rotCosine,i.rotSine).transformPoint(o.origin);e.bounds=v.TheoRect.fromSize(o.size),e.placement=e.placement.translateXY(l.x,l.y);for(var u=a.iter(t);!u.done;u.next()){var s,c=u.value;e.appendChild(c,!0),(s=c.finalFrame)&&(r[c.formaID].equalWithAccuracy(s,.001)||g.Host.logging.warning("error. a child's position changed in updateUserGroupBounds."))}}},updateUserGroupHierarchy:function(e){for(var t,r=e;((t=a.opt(a.opt(r,(function(e){return e.controller})),(function(e){return e.userGroup})))||null!=t)&&t;)o.updateUserGroupBounds(r),r=a.opt(r,(function(e){return e.parent}))},createGroupFromFormae:function(e){var t;if(0==e.length)return null;var r,o,n=d.GeometryFacade.unionFrame(e),i=e.concat(),l=a.as(a.opt(a.first(e),(function(e){return e.page.createFormaWithController(c.GroupForma.KIND,s.GroupController.KIND)})),c.GroupForma);if((r=l)&&(o=n)){a.opt(a.opt(a.first(e),(function(e){return e.parent})),(function(e){return e.appendChild(r)})),r.intent=u.Forma.INTENT_USER_GROUP,r.placement=p.Matrix2D.translationXY(o.minX,o.minY),r.bounds=v.TheoRect.fromSize(o.size);var g=r.controller;g.preferredResizeType=F.ResizeLayoutType.Proportional,g.preserveResizeController=!0;for(var m=0,C=a.iter(i);!C.done;C.next()){var h=C.value;m=Math.max(m,(t=a.opt(h.parent,(function(e){return e.indexOfChild(h)})))||null!=t?t:0)}a.opt(r.parent,(function(e){return e.insertChildAt(r,m,!0)}));for(var y=a.iter(f.LayerFacade.sortInZOrder(i));!y.done;y.next())h=y.value,r.appendChild(h,!0);return r}return null},removeAllGroups:function(e){for(var t,r=a.clone(e.filterWithCallback((function(e){return!(!(t=a.opt(e.controller,(function(e){return e.userGroup})))&&null==t)&&t}))),n=a.iter(r);!n.done;n.next()){var i=n.value;o.cleanupGroup(i)}},cleanupGroup:function(e){for(var t,r=a.iter(e.childrenAsArray);!r.done;r.next()){var o=r.value,n=(t=a.opt(e.parent,(function(t){return t.indexOfChild(e)})))||null!=t?t:e.childCount;a.opt(e.parent,(function(e){return e.insertChildAt(o,n,!0)}))}e.removeFromParent()},ungroupItems:function(e){var t,r;if(0==e.length)return l.CorePromise.resolve([]);for(var n=[],i=[],u=[],s=!1,c=a.iter(e);!c.done;c.next()){var d,g=c.value;((t=a.opt(g.controller,(function(e){return e.userGroup})))||null!=t)&&t?(a.append(n,g.childrenAsArray),a.append(u,g.childrenAsArray)):(f=g.controller)&&(d=f.userGroupRoot)&&(s=!0,n.push(g),a.append(u,d.childrenAsArray))}for(var m=a.iter(u);!m.done;m.next()){var f,p,F,v;if((f=(g=m.value).controller)&&(p=g.parent)&&(F=a.opt(g.parent,(function(e){return e.parent})))&&null!=(v=F.indexOfChild(p))&&f.userGroupChild)if(F.insertChildAt(g,v,!0),p.childCount<=1){for(var C=a.iter(p.childrenAsArray);!C.done;C.next()){var h=C.value,y=(r=F.indexOfChild(p))||null!=r?r:F.childCount;F.insertChildAt(h,y,!0),s||n.push(h)}p.removeFromParent()}else i.includes(p)||i.push(p)}for(var I=a.iter(i);!I.done;I.next()){var k=I.value;o.updateUserGroupBounds(k)}return l.CorePromise.resolve(n)},getGroupDepth:function(e){var t,r=0;return e.visit(u.FormaTraversal.PreOrder,(function(e,o,n){return((t=a.opt(e.controller,(function(e){return e.userGroupChild})))||null!=t)&&t&&(r=Math.max(r,o)),!1})),r},isUserGroup:function(e){var t;return!(!(t=a.opt(a.opt(e,(function(e){return e.controller})),(function(e){return e.userGroup})))&&null==t)&&t},isInsideUserGroup:function(e){for(var t=e;null!=t&&!o.isUserGroup(t);)t=a.opt(t,(function(e){return e.parent}));return null!=t}}}),o)},cYKp:function(e,t,r){var o,n=t,a=r("oAGj"),i=r("gXiO");n.AnimationFacade=(o=function(){i.CoreObject.call(this)},a.defineClass({name:"AnimationFacade",ctor:o,superName:"CoreObject",statics:{applyAnimationStyle:function(e,t){t.animationLibrary.modifyModelForAnimation(e,t.root)},shuffleAnimationStyle:function(e,t){return t.animationLibrary.getNextAnimationStyleOfSameType(e)}}}),o)},"gBh/":function(e,t,r){var o,n=t,a=r("oAGj"),i=r("gXiO");n.ColorThemeFacade=(o=function(){i.CoreObject.call(this)},a.defineClass({name:"ColorThemeFacade",ctor:o,superName:"CoreObject",statics:{applyColorTheme:function(e,t,r){r.colorLibraryController.applyColorTheme(e,t,!0)},shuffleColorTheme:function(e){e.colorLibraryController.shuffleColorAssignments()},modifyColorTheme:function(e,t,r){r.colorLibraryController.setTheoColorToLibrary(e,t)}}}),o)},gpZI:function(e,t,r){var o,n,a=t,i=r("oAGj"),l=r("gXiO"),u=r("ascj"),s=r("6ZWm"),c=r("cmoc"),d=r("lmwz"),g=r("fNpk"),m=r("c+uM"),f=r("T6jX"),p=r("8t9B");a.SavedColorState=(o=function(e,t,r,o){this.formae=i.clone(e),this.colorLibraryState=t,this.primaryColorIDs=i.clone(r),this.secondaryColorIDs=i.clone(o)},i.defineClass({name:"SavedColorState",ctor:o,superName:"CoreObject"}),o),a.ColorFacade=(n=function(){l.CoreObject.call(this)},i.defineClass({name:"ColorFacade",ctor:n,superName:"CoreObject",statics:{applyColorsToForma:function(e,t,r,o){void 0===r&&(r=!1),void 0===o&&(o=0);var a,l,g=o%2==0?u.ColorRole.FieldPrimary:u.ColorRole.FieldSecondary;if(e.isTypeLockup())return(a=i.opt(i.as(e.controller,p.TypeLockupController),(function(e){return e.styleController})))&&(r&&i.opt(i.opt(e.page.document,(function(e){return e.controller})),(function(e){return e.selection.inCharStyleMode=!0})),n.getDominantColorRoleOfLockup(e)==u.ColorRole.FieldSecondary&&(g=g==u.ColorRole.FieldPrimary?u.ColorRole.FieldSecondary:u.ColorRole.FieldPrimary),a.applyColors(t,g)),e;if(e instanceof c.FrameForma){if(l=f.TheoDocumentUtils.getCellBackgroundShape(e))i.opt(l.controller,(function(e){return e.applyColors(t,g)}));else if(null!=i.as(e.controller,s.FrameController))return d.ImageFacade.replaceImageWithColors(e,t)}else i.opt(e.controller,(function(e){return e.applyColors(t,g)}));return e},applyColorsWithRoleToForma:function(e,t,r){var o,a;if(void 0===r&&(r=!1),e.isTypeLockup()&&(o=i.opt(i.as(e.controller,p.TypeLockupController),(function(e){return e.styleController})))&&(r&&i.opt(i.opt(e.page.document,(function(e){return e.controller})),(function(e){return e.selection.inCharStyleMode=!0})),a=i.opt(e.controller,(function(e){return e.getCurrentColorsWithRole(o.targetedLockupStyle)})))){var l=i.clone(n.updateColorsWithRole(t,a));o.applyColorsWithRole(l)}return e},updateColorsWithRole:function(e,t){for(var r=t.concat(),o=i.iter(e);!o.done;o.next())for(var n=o.value,a=i.iter(r);!a.done;a.next()){var l=a.value;n.role==l.role&&(l.color=n.color.rgbColor)}return r},applyColorsToFormae:function(e,t,r,o){return void 0===r&&(r=!1),void 0===o&&(o=0),e.map((function(e){return n.applyColorsToForma(e,t,r,o)}),this)},applyNoneColorToFormae:function(e,t){return void 0===t&&(t=u.ColorRole.FieldPrimary),e.map((function(e){return g.LegacyCoreAssert.isTrue(e.kind==c.FrameForma.KIND,"Only frame forma can have primary color as nil",void 0,"ColorFacade.applyNoneColorToFormae","ColorFacade.swift",122),e.style.colors.setColor(t,null),e}),this)},applyColorsWithRoleToFormae:function(e,t,r){return void 0===r&&(r=!1),e.map((function(e){return n.applyColorsWithRoleToForma(e,t,r)}),this)},getDominantColorRoleOfLockup:function(e){var t;if(e.isTypeLockup()&&(t=i.opt(i.as(e.controller,p.TypeLockupController),(function(e){return e.styleController})))){var r=t.targetedLockupStyle;return r.textLook==m.LockupTextLook.KnockoutOnly||r.textLook==m.LockupTextLook.OutlineOnly?u.ColorRole.FieldSecondary:u.ColorRole.FieldPrimary}return u.ColorRole.FieldPrimary},getSavedColorState:function(e){var t,r;g.LegacyCoreAssert.isTrue(e.length>0,"empty Forma array",void 0,"ColorFacade.getSavedColorState","ColorFacade.swift",151);var o=e[0].page.colorLibraryController.recordUndoState(),n=e.map((function(e){return(t=e.style.colors.colorID(u.ColorRole.FieldPrimary))||null!=t?t:""}),this),i=e.map((function(e){return(r=e.style.colors.colorID(u.ColorRole.FieldSecondary))||null!=r?r:""}),this);return new a.SavedColorState(e,o,n,i)}}}),n)},kYI4:function(e,t,r){var o,n=t,a=r("oAGj"),i=r("0wFF"),l=r("CWW7"),u=r("gXiO"),s=r("yGNn"),c=r("ascj"),d=r("QgZx"),g=r("ZK0l"),m=r("iCxV"),f=r("3lr5"),p=r("8vXU"),F=r("q5zr"),v=r("fdtz"),C=r("rxGp"),h=r("fNpk"),y=r("c+uM"),I=r("VkKB"),k=r("umUn"),T=r("VJ9E"),A=r("8t9B");n.AUTHORING_CONTEXT_TYPE_LOGO="LOGO",n.AUTHORING_CONTEXT_TYPE_FONT="FONT",n.AUTHORING_CONTEXT_TYPE_COLOR="COLOR",n.SPARK_LOGO_ROLE_PRIMARY="primary-logo",n.SPARK_LOGO_ROLE_SECONDARY="secondary-logo",n.SPARK_LOGO_ROLE_POST_STAMP="post-stamp",n.IAuthoringContextManager=a.defineProtocol("IAuthoringContextManager",{authoringContexts:"Array<IAuthoringContext>",authoringContext:"(String) -> IAuthoringContext",getOwnedAuthoringContextIDs:"() -> Array<String>",getDefaultBrandIdFromServer:"() -> String",createAuthoringContext:"(String, Boolean) -> IAuthoringContext"}),n.IAuthoringContext=a.defineProtocol("IAuthoringContext",{id:"String",name:"String",activated:"Boolean",isDefault:"Boolean",contextID:"String",urn:"String",colors:"Array<IAuthoringContextColor>",fonts:"Array<IAuthoringContextFont>",logos:"Array<IAuthoringContextLogo>",isMinimal:"Boolean",isValidVersion:"Boolean",ownedByCurrentUser:"Boolean",isBrandkitComplete:"() -> Boolean"}),n.IAuthoringContextColor=a.defineProtocol("IAuthoringContextColor",{id:"String",acRoles:"Array<String>",red:"Double",green:"Double",blue:"Double",alpha:"Double"}),n.IAuthoringContextFont=a.defineProtocol("IAuthoringContextFont",{id:"String",acRoles:"Array<String>",sourceType:"String",descriptor:"FontDescriptor"}),n.IAuthoringContextLogo=a.defineProtocol("IAuthoringContextLogo",{id:"String",acRoles:"Array<String>",acName:"String",url:"String",pixelWidth:"Integer",pixelHeight:"Integer",mimeType:"String"}),n.BrandingFacade=(o=function(){u.CoreObject.call(this)},a.defineClass({name:"BrandingFacade",ctor:o,superName:"CoreObject",statics:{brandifyDocument:function(e,t,r,n,a){return void 0===r&&(r=!0),void 0===n&&(n=!0),void 0===a&&(a=!0),h.LegacyCoreAssert.isTrue(""!=t.id,"need a valid authoring context to brandify",void 0,"BrandingFacade.brandifyDocument","BrandingFacade.swift",122),o.addBrandLogo(e,t,n).then((function(n){return a&&o.brandifyColors(e,t),r&&o.brandifyFonts(e,t),null}))},addBrandLogo:function(e,t,r){void 0===r&&(r=!0);var i=s.CorePromise.resolve(null);if(r){var u,c=t.logos.filter((function(e){return!a.isEmpty(e.url)&&e.acRoles.includes(n.SPARK_LOGO_ROLE_POST_STAMP)}),this);if((u=a.first(c))&&null==a.first(e.firstPage.root.filterWithCallback((function(e){return e.isLogo()&&e.kind==v.ImageForma.KIND})))){var d=o.makeLogoContentNode(u,e);i=i.then((function(t){return l.CreationFacade.addContent(e.firstPage,d,void 0,void 0,new l.AddFormaParams(void 0,void 0,null))}))}}return i},brandifyColors:function(e,t,r){void 0===r&&(r=!1),o.updateBrandedColorPalette(e,t,r)},updateBrandedColorPalette:function(e,t,r){for(var o=0,n=0,i=a.clone(e.firstPage.colorLibraryController.getTheoColorsUsedInDocument()),l=a.iter(i);!l.done;l.next()){var u=l.value;u.isBrandkitSecondaryColor()&&(n+=1),u.isBrandkitShade()&&(o+=1)}for(var s=n>0&&n>=o,d=[],g=a.iter(t.colors);!g.done;g.next()){var f=g.value,F=k.TheoColor.init_bb45(f);(s&&(F.isBrandkitSecondaryColor()||F.isBrandkitPrimaryColor())||!s&&F.isBrandkitShade())&&d.push(F)}if(d.length>0){var v;if(r)if(null!=(T=e.firstPage.root.controller.getGridController())){h.LegacyCoreAssert.isTrue(T.gridStyle.gridCells.length>=1,"expecting to have a grid with at least one cell",void 0,"BrandingFacade.updateBrandedColorPalette","BrandingFacade.swift",218);var y=T.forma.childAt(0).style.colors.colorID(c.ColorRole.FieldPrimary);null!=y&&(v=e.firstPage.colorLibraryController.getTheoColorForKey(y))}else{var I=e.firstPage.root.style.colors.colorID(c.ColorRole.FieldPrimary);null!=I&&(v=e.firstPage.colorLibraryController.getTheoColorForKey(I))}if(e.firstPage.colorLibraryController.applyColorTheme(d,"brandkit"),r){if(null!=v){var T,A=e.firstPage.colorLibraryController.getKeyOfColorInTheme(v);null==A&&(A=e.firstPage.colorLibraryController.addNewThemeKeyWithColor(v)),null!=(T=e.firstPage.root.controller.getGridController())?T.forma.childAt(0).style.colors.setColorId(c.ColorRole.FieldPrimary,A):e.firstPage.root.style.colors.setColorId(c.ColorRole.FieldPrimary,A)}}else e.firstPage.colorLibraryController.shuffleColorAssignments()}else m.Host.logging.logForCategory(C.LogCategories.kMultibrand,"addBranding asked to update color palette, but brandkit doesn't have any colors. Hope that's ok.",p.LogLevelEnum.INFO_LEVEL)},brandifyFonts:function(e,t){var r=o.getHeadlineFontForBrandify(e,t);if(null!=r){for(var n=!1,i=a.iter(e.firstPage.root.filterWithCallback((function(e){return e.isTypeLockup()})));!i.done;i.next()){var l,u=i.value;(l=a.as(u.style,y.LockupStyle))&&(l.font=r,n=!0)}0==n&&m.Host.logging.logForCategory(C.LogCategories.kMultibrand,"addBranding asked to apply fonts, but document contains no text lockups, so we can't. Hope that's ok.",p.LogLevelEnum.INFO_LEVEL)}},getHeadlineFontForBrandify:function(e,t){var r=o.getTheoFontForRole(T.TheoFont.SPARK_FONT_ROLE_HEADLINE,t);if(null==r)if(t.fonts.length>0){var n,a=t.fonts[0];(n=o.getFontFromIncludedFonts(a.descriptor))?r=T.TheoFont.init_9e5c(n,a.id,a.acRoles):(m.Host.logging.logForCategory(C.LogCategories.kMultibrand,"addBranding asked to apply fonts, but brandkit doesn't have a headline font, so we're just picking some random font. Hope that's ok.",p.LogLevelEnum.INFO_LEVEL),r=T.TheoFont.init_9e5c(m.Host.fontProvider.getIncludedFonts(e).fontAt(0)))}else m.Host.logging.logForCategory(C.LogCategories.kMultibrand,"addBranding asked to apply fonts, but brandkit doesn't have any fonts. Hope that's ok.",p.LogLevelEnum.INFO_LEVEL);return r},whichUserUploadedFontsWillBeUsedInBrandify:function(e,t){var r,n=[];if((r=o.getHeadlineFontForBrandify(e,t))&&r.fontData.source==d.FontSource.USER_UPLOAD)for(var i=a.iter(e.firstPage.root.filterWithCallback((function(e){return e.isTypeLockup()})));!i.done;i.next()){var l=i.value;if(null!=a.as(l.style,y.LockupStyle)){n.push(r.fontData.touaName);break}}return n},getCustomFontsForBrand:function(e){return e.fonts.filter((function(e){var t;return null!=(t=e.sourceType)&&"user-uploaded"==t}),this)},getCustomFontNamesForBrand:function(e){var t;return e.fonts.filter((function(e){var t;return null!=(t=e.sourceType)&&"user-uploaded"==t}),this).map((function(e){return(t=a.opt(e.descriptor,(function(e){return e.touaName})))||null!=t?t:""}),this).filter((function(e){return""!=e}),this)},getEmbeddableFontNamesForBrand:function(e){var t;return e.fonts.filter((function(e){var t;return null!=(t=e.sourceType)&&"user-uploaded"==t&&a.opt(e.descriptor,(function(e){return e.fsType==d.FontEmbeddability.INSTALLABLE}))}),this).map((function(e){return(t=a.opt(e.descriptor,(function(e){return e.touaName})))||null!=t?t:""}),this).filter((function(e){return""!=e}),this)},getTheoFontForRole:function(e,t){for(var r,n=a.iter(t.fonts);!n.done;n.next()){var i,l=n.value;if(i=o.getFontFromIncludedFonts(l.descriptor)){var u=T.TheoFont.init_9e5c(i,l.id,l.acRoles);if(u.getSparkFontRole()==e){r=u;break}}}return r},getFontFromIncludedFonts:function(e){if(null==e)return null;var t,r=m.Host.fontProvider.getIncludedFonts(f.ANY_DOCUMENT);return null!=(t=r.indexOf(e))?r.fontAt(t):null},changeBranding:function(e,t){return s.CorePromise.resolve(null).then((function(r){return null==t?""==e.authoringContextID?null:o.removeBranding(e):e.authoringContextID==t.id?null:""==e.authoringContextID?(a.opt(m.Host.brandkitManager,(function(e){return e.activateBrand(t.id)})),null):o.addBranding(e,t)}))},addBranding:function(e,t){return h.LegacyCoreAssert.isTrue(""!=t.id,"need a valid authoring context to add branding",void 0,"BrandingFacade.addBranding","BrandingFacade.swift",467),o.applyLogoForAddBranding(e,t).then((function(r){return a.opt(m.Host.fontProvider,(function(e){return e.registerBrandFonts(t.id)})),o.applyBrandFontsForAddBranding(e,t),o.applyColorsForAddBranding(e,t),a.opt(m.Host.brandkitManager,(function(e){return e.activateBrand(t.id)})),e.setAuthoringContext(t),null}))},applyLogoForAddBranding:function(e,t){for(var r=[],n=a.iter(e.firstPage.root.filterWithCallback((function(e){return e.isLogo()&&e.kind==v.ImageForma.KIND})));!n.done;n.next()){var i=n.value;r.push(i)}for(var u=s.CorePromise.resolve(null),c=a.iter(r);!c.done;c.next()){var d=c.value,g=a.as(e.content.nodeByID(d.contentID),F.ImageContentNode),m=o.getReplacementLogoContentNode(e,t,g.getSparkLogoRole());null!=m&&(u=u.then((function(t){return l.CreationFacade.addContent(e.firstPage,m,void 0,void 0,new l.AddFormaParams(void 0,void 0,d.parent))})))}return u},applyColorsForAddBranding:function(e,t){for(var r=[],o=a.iter(t.colors);!o.done;o.next()){var n=o.value;r.push(k.TheoColor.init_bb45(n))}r.length>0&&e.firstPage.colorLibraryController.updateSparkColorsByRole(r)},applyBrandFontsForAddBranding:function(e,t){for(var r,o=[],n=a.iter(t.fonts);!n.done;n.next()){var i=n.value,l=T.TheoFont.init_a314(i);o.push(l),l.getSparkFontRole()==T.TheoFont.SPARK_FONT_ROLE_BODY&&(r=l)}for(var u=a.iter(e.firstPage.root.filterWithCallback((function(e){return e.isTypeLockup()})));!u.done;u.next()){var s,c=u.value;if(s=a.as(c.style,y.LockupStyle)){var d;if((d=s.font)&&d.isSparkFont()){for(var g,m=r,f=a.iter(o);!f.done;f.next())if(i=f.value,d.getSparkFontRole()==i.getSparkFontRole()){m=i;break}(g=m)&&(s.font=g)}for(var p=a.iter(s.characterStyles);!p.done;p.next()){var F,v=p.value;if((F=v.font)&&F.isSparkFont()){m=r;for(var C=a.iter(o);!C.done;C.next())if(i=C.value,F.getSparkFontRole()==i.getSparkFontRole()){m=i;break}null!=m&&(v.font=m)}}}}},whichUserUploadedFontsWouldBeUsedInBrandSwitch:function(e,t,r){var o,n,i=[];if((o=t)&&(n=r)){var l,u=[];a.opt(m.Host.fontProvider,(function(e){return e.registerBrandFonts(n.id)}));for(var s=a.iter(n.fonts);!s.done;s.next()){var c=s.value,g=T.TheoFont.init_a314(c);g.fontData.source==d.FontSource.USER_UPLOAD&&(u.push(g),g.getSparkFontRole()==T.TheoFont.SPARK_FONT_ROLE_BODY&&(l=g))}if(a.opt(m.Host.fontProvider,(function(e){return e.refreshBrandkitFonts(o.id)})),0==!u.length)for(var f=a.iter(e.firstPage.root.filterWithCallback((function(e){return e.isTypeLockup()})));!f.done;f.next()){var p,F=f.value;if(p=a.as(F.style,y.LockupStyle)){var v;if((v=p.font)&&v.isSparkFont()){for(var C=l,h=a.iter(u);!h.done;h.next())if(c=h.value,v.getSparkFontRole()==c.getSparkFontRole()){C=c;break}null!=(A=a.opt(C,(function(e){return e.fontData.touaName})))&&(i.includes(A)||i.push(A))}for(var I=a.iter(p.characterStyles);!I.done;I.next()){var k;if((k=I.value.font)&&k.isSparkFont()){C=l;for(var A,M=a.iter(u);!M.done;M.next())if(c=M.value,k.getSparkFontRole()==c.getSparkFontRole()){C=c;break}null!=(A=a.opt(C,(function(e){return e.fontData.touaName})))&&(i.includes(A)||i.push(A))}}}}}return i},getReplacementLogoContentNode:function(e,t,r){for(var i,l=a.iter(t.logos);!l.done;l.next())for(var u=l.value,s=a.iter(u.acRoles);!s.done;s.next()){var c=s.value;if(c==r)return o.makeLogoContentNode(u,e);c==n.SPARK_LOGO_ROLE_PRIMARY&&(i=u)}return null!=i?o.makeLogoContentNode(i,e):null},removeBranding:function(e){return o.removeAllBrandkitFontsAndLogos(e),e.setAuthoringContext(null),s.CorePromise.resolve(null)},removeAllBrandkitFontsAndLogos:function(e){var t;if(t=e.controller)for(var r=a.iter(e.firstPage.root.filterWithCallback((function(e){return e.isTypeLockup()||e.isLogo()})));!r.done;r.next()){var n=r.value;if(n.isTypeLockup()){var i,l;if((i=a.as(n.style,y.LockupStyle))&&(l=i.font)&&l.isSparkFont()){var u=o.getNonBKFontForRemapping(l);m.Host.logging.logForCategory(C.LogCategories.kMultibrand,"Replacing brandkit font "+l.fontData.postScriptName+" with non-BK font "+u.postScriptName,p.LogLevelEnum.INFO_LEVEL),i.font=T.TheoFont.init_9e5c(u)}}else{var s;t.selection.deselectForma(n),(s=n.parent)&&a.opt(a.as(s.controller,g.GroupController),(function(e){return e.removeFormaFromGroup(n)}));var c=n.controller.settings;null!=c&&c==t.controllerSettingsState.settings&&(t.controllerSettingsState.settings=null)}}else h.LegacyCoreAssert.fail("Document has no controller",void 0,"BrandingFacade.removeAllBrandkitFontsAndLogos","BrandingFacade.swift",701)},getNonBKFontForRemapping:function(e){return e.fontData.source==d.FontSource.EMBEDDED?e.fontData:e.fontData.serif?e.fontData.blackness>=7?o.getFontWithPostscriptName("CantataOne-Regular"):e.fontData.italic?o.getFontWithPostscriptName("OldStandardTT-Italic"):o.getFontWithPostscriptName("Lora-Regular"):e.fontData.calligraphic?o.getFontWithPostscriptName("Yellowtail"):e.fontData.blackness>=7?o.getFontWithPostscriptName("SourceSansPro-Black"):e.fontData.italic?o.getFontWithPostscriptName("CallunaSans-Italic"):o.getFontWithPostscriptName("Raleway")},getFontWithPostscriptName:function(e){return m.Host.fontProvider.descriptorForPostScriptName(e,f.ANY_DOCUMENT)},brandDocumentForElement:function(e,t,r){var o=m.Host.brandkitManager.brandkitForElement(t,r);h.LegacyCoreAssert.isTrue(null!=o,"Adding a branded element but can't find the brandkit it belongs to",{elementType:r},"BrandingFacade.brandDocumentForElement","BrandingFacade.swift",748),a.opt(m.Host.logging,(function(e){return e.logToAnalytics(i.AnalyticsConstants.kAnalyticsDataBrandkitElementUsed,{elementType:r})})),null!=o&&(""==e.authoringContextID?(m.Host.logging.logForCategory(C.LogCategories.kMultibrand,"** Branding document, because it now contains a branded element of type "+r,p.LogLevelEnum.INFO_LEVEL),a.opt(m.Host.logging,(function(t){return t.logToAnalytics(i.AnalyticsConstants.kAnalyticsEventAddedBrandingToProject,{projectID:e.uuid})}))):e.authoringContextID!=o.id&&m.Host.logging.logForCategory(C.LogCategories.kMultibrand,"** Re-Branding document, because it was branded (for a different brand) and now contains a branded element of type "+r,p.LogLevelEnum.INFO_LEVEL),e.setAuthoringContext(o))},unBrandDocumentIfNoBrandedElements:function(e){""!=e.authoringContextID&&(o.doesDocumentContainBrandedElements(e,!1)||(e.setAuthoringContext(null),m.Host.logging.logForCategory(C.LogCategories.kMultibrand,"** Unbranding document, because it no longer contains any branded elements",p.LogLevelEnum.INFO_LEVEL)))},isDocumentBranded:function(e,t){return""!=e.authoringContextID&&(!t||o.getDocumentBrandedElementsUsage(e,!0).length>0)},kBrandUsageColor:"color",kBrandUsageFont:"font",kBrandUsageCustomFont:"customFont",kBrandUsageLogo:"logo",getDocumentBrandedElementsUsage:function(e,t,r){void 0===r&&(r=!0);var n=!1,i=!1,l=!1,u=!1,s=[];if(!t&&e.firstPage.colorLibraryController.areAnySparkColorsInUse()&&(s.push(o.kBrandUsageColor),n=!0,1==r))return s;for(var c=a.iter(e.firstPage.root.filterWithCallback((function(e){return e.isLogo()||e.isTypeLockup()})));!c.done;c.next()){var d=c.value;if(d.isTypeLockup())!i&&o.doesLockupUseBrandedFonts(d)&&(s.push(o.kBrandUsageFont),i=!0),!l&&o.doesLockupUseCustomFonts(d)&&(s.push(o.kBrandUsageCustomFont),l=!0);else if(!u&&d.isLogo()&&null!=d.contentID){var g;(g=a.as(e.content.nodeByID(d.contentID),F.ImageContentNode))&&null!=g.sparkElementID&&""!=g.sparkElementID&&(s.push(o.kBrandUsageLogo),u=!0)}if(r&&(n||i||l||u))return s;if(n&&i&&l&&u)break}return s},doesDocumentContainBrandedElements:function(e,t){return o.getDocumentBrandedElementsUsage(e,t).length>0},areSparkFontsInUse:function(e,t){if(0==t.length)return!1;for(var r=a.iter(e.firstPage.root.filterWithCallback((function(e){return e.isTypeLockup()})));!r.done;r.next()){var o,n=r.value;if(o=a.as(n.style,y.LockupStyle)){var i;if((i=o.font)&&null!=i.sparkElementID&&i.sparkElementID.length>0&&t.includes(i.sparkElementID))return!0;for(var l=a.iter(o.characterStyles);!l.done;l.next()){var u;if((u=l.value.font)&&null!=u.sparkElementID&&u.sparkElementID.length>0&&t.includes(u.sparkElementID))return!0}}}return!1},updateSparkFont:function(e,t){for(var r=!1,o=a.iter(e.firstPage.root.filterWithCallback((function(e){return e.isTypeLockup()})));!o.done;o.next()){var n,i=o.value;if(n=a.as(i.style,y.LockupStyle)){var l;if(l=n.font){var u=l.sparkElementID;null!=u&&u.length>0&&u==t.id&&(r=!0,n.font=T.TheoFont.init_a314(t))}for(var s=a.iter(n.characterStyles);!s.done;s.next()){var c=s.value;null!=c.font&&null!=c.font.sparkElementID&&c.font.sparkElementID.length>0&&c.font.sparkElementID==t.id&&(r=!0,c.font=T.TheoFont.init_a314(t))}}}h.LegacyCoreAssert.isTrue(r,"asked to update spark font which isn't currently used.",void 0,"BrandingFacade.updateSparkFont","BrandingFacade.swift",971)},relinkSparkFont:function(e,t,r){for(var o=!1,n=a.iter(e.firstPage.root.filterWithCallback((function(e){return e.isTypeLockup()})));!n.done;n.next()){var i,l=n.value;if(i=a.as(l.style,y.LockupStyle)){var u;if(u=i.font){var s=u.sparkElementID;null!=s&&s.length>0&&s==t&&(o=!0,i.font=T.TheoFont.init_a314(r))}for(var c=a.iter(i.characterStyles);!c.done;c.next()){var d=c.value;null!=d.font&&null!=d.font.sparkElementID&&d.font.sparkElementID.length>0&&d.font.sparkElementID==t&&(o=!0,d.font=T.TheoFont.init_a314(r))}}}h.LegacyCoreAssert.isTrue(o,"asked to relink spark font which isn't currently used.",void 0,"BrandingFacade.relinkSparkFont","BrandingFacade.swift",1010)},doesLockupUseBrandedFonts:function(e){var t;if(t=a.as(e.style,y.LockupStyle)){var r;if((r=t.font)&&null!=r.sparkElementID&&r.sparkElementID.length>0)return!0;for(var o=a.iter(t.characterStyles);!o.done;o.next()){var n=o.value;if(null!=n.font&&null!=n.font.sparkElementID&&n.font.sparkElementID.length>0)return!0}}else h.LegacyCoreAssert.fail("doesLockupUseBrandedFonts called for something which is not a type lockup",void 0,"BrandingFacade.doesLockupUseBrandedFonts","BrandingFacade.swift",1043);return!1},doesLockupUseCustomFonts:function(e){var t;if(t=a.as(e.style,y.LockupStyle)){var r;if((r=t.font)&&r.fontData.source==d.FontSource.USER_UPLOAD)return!0;for(var o=a.iter(t.characterStyles);!o.done;o.next()){var n=o.value;if(null!=n.font&&n.font.fontData.source==d.FontSource.USER_UPLOAD)return!0}}else h.LegacyCoreAssert.fail("doesLockupUseCustomFonts called for something which is not a type lockup",void 0,"BrandingFacade.doesLockupUseCustomFonts","BrandingFacade.swift",1078);return!1},areSparkLogosInUse:function(e,t){if(0==t.length)return!1;for(var r=a.iter(e.firstPage.root.filterWithCallback((function(e){return e.isLogo()&&e.kind==v.ImageForma.KIND})));!r.done;r.next()){var o,n=r.value;if((o=a.as(e.content.nodeByID(n.contentID),F.ImageContentNode))&&null!=o.sparkElementID&&""!=o.sparkElementID&&t.includes(o.sparkElementID))return!0}return!1},updateSparkLogo:function(e,t){for(var r=!1,n=a.iter(e.firstPage.root.filterWithCallback((function(e){return e.isLogo()&&e.kind==v.ImageForma.KIND})));!n.done;n.next()){var i=n.value,u=a.as(e.content.nodeByID(i.contentID),F.ImageContentNode);if(a.opt(u,(function(e){return null!=e.sparkElementID&&a.opt(u,(function(e){return""!=e.sparkElementID}))&&t.id==a.opt(u,(function(e){return e.sparkElementID}))}))){r=!0;var s=o.makeLogoContentNode(t,e);l.CreationFacade.addContent(e.firstPage,s,void 0,void 0,new l.AddFormaParams(void 0,void 0,i.parent))}}h.LegacyCoreAssert.isTrue(r,"asked to update spark logo which isn't currently used.",void 0,"BrandingFacade.updateSparkLogo","BrandingFacade.swift",1130)},relinkSparkLogo:function(e,t,r){for(var n=!1,i=a.iter(e.firstPage.root.filterWithCallback((function(e){return e.isLogo()&&e.kind==v.ImageForma.KIND})));!i.done;i.next()){var u=i.value,s=a.as(e.content.nodeByID(u.contentID),F.ImageContentNode);if(a.opt(s,(function(e){return null!=e.sparkElementID&&a.opt(s,(function(e){return""!=e.sparkElementID}))&&t==a.opt(s,(function(e){return e.sparkElementID}))}))){n=!0;var c=o.makeLogoContentNode(r,e);l.CreationFacade.addContent(e.firstPage,c,void 0,void 0,new l.AddFormaParams(void 0,void 0,u.parent))}}h.LegacyCoreAssert.isTrue(n,"asked to relink spark logo which isn't currently used.",void 0,"BrandingFacade.relinkSparkLogo","BrandingFacade.swift",1154)},isImageBrandedLogo:function(e){var t;return!(null==e.contentID||!(t=a.as(e.page.document.content.nodeByID(e.contentID),F.ImageContentNode))||!e.isLogo()||null==t.sparkElementID||""==t.sparkElementID)},makeLogoContentNode:function(e,t){var r=t.content.createNode(F.ImageContentNode.KIND,null);return r.url=e.url,r.pixelWidth=e.pixelWidth,r.pixelHeight=e.pixelHeight,r.mimeType=e.mimeType,r.setRoles(e.acRoles),r.sparkElementID=e.id,r.mediaMetadata=I.MediaMetadata.init_5f01(void 0,void 0,void 0,void 0,void 0,void 0,"brandkit",void 0,void 0,void 0,void 0,I.MediaMetadata.DESIGNINTENT_LOGO),r},areSparkColorsInUse:function(e,t){return 0!=t.length&&e.firstPage.colorLibraryController.areSparkColorsInUse(t)},updateSparkColor:function(e,t){return e.firstPage.colorLibraryController.updateSparkColor(k.TheoColor.init_bb45(t))},getBrandkitColorsForUI:function(e,t){var r,o,n=!1,i=[];if((r=a.as(a.opt(t,(function(e){return e.controller})),A.TypeLockupController))&&r.styleController.isCurrentlyShowingMultipleColors()){n=!0;var l=r.lockupStyle.colors.theoColor(c.ColorRole.FieldPrimary),u=r.lockupStyle.colors.theoColor(c.ColorRole.FieldSecondary);null!=l&&l.isBrandkitColor()&&null!=u&&u.isBrandkitColor()&&(i=[l,u])}for(var s=[],d=a.iter(e.colors);!d.done;d.next()){var g=d.value,m=k.TheoColor.init_bb45(g);if(0==n)s.push([m]),m.isBrandkitPrimaryColor()&&(o=m,m.isBrandkitShade()&&s.push([k.TheoColor.init_bb45(g)]));else{var f=0,p="";if(m.isBrandkitPrimaryColor())o=m,f=5;else if(m.isBrandkitSecondaryColor())f=3;else if(m.isBrandkitShade()){f=1;var F=m.getBrandkitShadeRole();if(F.startsWith(k.SHADE_ROLE_PREFIX)){var v=F.substr(k.SHADE_ROLE_PREFIX.length),C=(a.toInt(v)+3)%7;p=k.SHADE_ROLE_PREFIX+a.toString(C)}}else f=1;for(var h=0,y=a.clone(a.shuffle(e.colors)),I=a.iter(y);!I.done;I.next()){var T=I.value,M=k.TheoColor.init_bb45(T);if((""==p&&Math.abs(m.rgbColor.lightness-M.rgbColor.lightness)>30||p==M.getBrandkitShadeRole())&&(s.push([m,M]),(h+=1)>=f))break}}}if(n&&i.length>0){for(var D=!1,S=a.iter(s);!S.done;S.next()){var b=S.value;if(b[0].sparkElementID==i[0].sparkElementID&&b[1].sparkElementID==i[1].sparkElementID){D=!0;break}}D||s.push(i)}return a.sortInPlace(s,(function(e,t){var r=e[0],n=t[0];if(null!=o){if(r===o)return n!==o;if(n===o)return!1}if(r.isBrandkitSecondaryColor())return!n.isBrandkitSecondaryColor()||r.rgbColor.lightness<n.rgbColor.lightness;if(n.isBrandkitSecondaryColor())return!1;var a=r.getBrandkitShadeRole(),i=n.getBrandkitShadeRole();return null!=a?null==i||a<i:null==i&&r.rgbColor.lightness<n.rgbColor.lightness})),s},getTheoColorForSolidColor:function(e,t){if(null!=e)for(var r=a.iter(e.colors);!r.done;r.next()){var o=r.value,n=k.TheoColor.init_bb45(o);if(n.rgbColor.isEqual(t))return n}return k.TheoColor.init_5344(t,null,null)}}}),o)},lmwz:function(e,t,r){var o,n=t,a=r("oAGj"),i=r("0wFF"),l=r("SpAV"),u=r("aO0D"),s=r("SDMx"),c=r("gpZI"),d=r("CWW7"),g=r("gXiO"),m=r("yGNn"),f=r("Bpjk"),p=r("ascj"),F=r("FNB+"),v=r("6ZWm"),C=r("cmoc"),h=r("JEzR"),y=r("P83h"),I=r("9Lk3"),k=r("ZK0l"),T=r("6Rk9"),A=r("4mVB"),M=r("ZhwN"),D=r("iCxV"),S=r("xYeW"),b=r("8vXU"),L=r("kJ8p"),E=r("IUM5"),B=r("Qlvz"),N=r("U010"),x=r("q5zr"),P=r("fdtz"),_=r("uWOl"),R=r("fNpk"),O=r("tGKA"),w=r("VkKB"),G=r("uxH+"),U=r("K0Rh"),H=r("JO5d"),W=r("djAF"),Y=r("35Q0"),X=r("fAXt"),j=r("8t9B"),K=r("oKlP"),V=r("sIWg"),z=r("zjod");n.ImageFacade=(o=function(){g.CoreObject.call(this)},a.defineClass({name:"ImageFacade",ctor:o,superName:"CoreObject",statics:{replaceImageWithColors:function(e,t){var r=e;if(e instanceof C.FrameForma||e instanceof P.ImageForma&&e.parent instanceof C.FrameForma){var o,n,i=a.as(e,C.FrameForma)||e.parent;(o=a.as(e.parent,U.RootForma))?(d.CreationFacade.deleteFormae([i],null),null!=t&&c.ColorFacade.applyColorsToForma(o,t),r=o):(r=i,(n=a.opt(a.as(i.controller,v.FrameController),(function(e){return e.replaceWithColoredShape()})))&&(null!=t?c.ColorFacade.applyColorsToForma(n,t):a.opt(n.controller,(function(e){return e.shuffleColorAssignment()})),r=n))}return r},replaceImagesWithColors:function(e,t){return e.map((function(e){return o.replaceImageWithColors(e,t)}),this)},applyImageFilter:function(e,t,r){a.clone(r?o.getBackgroundImagesFromPage(e.document.firstPage):e.selection.asFormaArray()).forEach((function(e){var r;if(r=o.getImageFormaForForma(e)){t.adjustments=B.ImageAdjustments.createDefault();var n=r.style;t.adjustments=n.adjustments,o.applyImageStyle(t,[e])}}))},applyImageStyle:function(e,t){for(var r=a.iter(t);!r.done;r.next()){var n,i=r.value;(n=o.getImageFormaForForma(i))&&(a.opt(a.opt(n.root,(function(e){return e.animation})),(function(e){return e.invalidate()})),n.applyStyle(e))}},getImageStyleForForma:function(e){var t;return(t=o.getImageFormaForForma(e))?a.as(t.style,_.ImageStyle):null},isFrame:function(e){return e instanceof C.FrameForma},getImageContentForForma:function(e){var t;return(t=o.getImageFormaForForma(e))?t.contentNode:null},getImageFormaForForma:function(e){var t,r,o;if(t=a.as(e,P.ImageForma))return t;if(r=a.as(e,z.VideoForma))return r;if((o=a.as(e,C.FrameForma))&&o.childCount>0){for(var n=a.iter(o.childrenAsArray);!n.done;n.next()){var i,l=n.value;if(i=a.as(l,P.ImageForma))return i}return null}return null},getMaskFormaForFormaByIntent:function(e,t){var r;return(r=o.getFrameFormaForForma(e))?r.findAuxiliary((function(e){return e.hasIntent(t)})):a.opt(e,(function(e){return 1==e.hasIntent(t)}))?e:null},getMaskFormaForForma:function(e){return o.getMaskFormaForFormaByIntent(e,F.Forma.INTENT_IMAGE_MASK)},getCutoutMaskFormaForForma:function(e){return a.as(o.getMaskFormaForFormaByIntent(e,F.Forma.INTENT_CUTOUT_MASK),P.ImageForma)},setCutoutModeForForma:function(e,t){var r,n,i;if((r=o.getFrameFormaForForma(e))&&(n=o.getImageFormaForForma(e))&&(i=a.as(r.style,h.FrameStyle))){var l=new y.FormaCutoutChangedEvent(n);n.beginUpdate(l),i.cutoutMode=t,n.endUpdate(l)}},getCutoutModeForForma:function(e){var t,r;return(t=o.getFrameFormaForForma(e))&&(r=a.as(t.style,h.FrameStyle))?r.cutoutMode:N.CutoutMode.Off},getVideoFormaForForma:function(e){var t;return(t=a.as(e,C.FrameForma))&&t.childCount>0?a.as(t.childAt(0),z.VideoForma):a.as(e,z.VideoForma)},getFrameFormaForForma:function(e){var t,r;return(t=a.as(a.opt(e,(function(e){return e.parent})),C.FrameForma))?t:(r=a.as(e,P.ImageForma))?a.as(r.parent,C.FrameForma):a.as(e,C.FrameForma)},getBackgroundImagesFromPage:function(e){for(var t=[],r=a.iter(e.root.filterWithCallback((function(e){return e.kind==C.FrameForma.KIND&&e.isBackgroundImage()&&e.childCount>0})));!r.done;r.next()){var o=r.value;t.push(o.childAt(0))}return t},getCropRatioId:function(e){var t;return(t=o.getFrameFormaForForma(e))?t.cropRatioId:f.CropRatioPresetLibrary.FREEFORM_ID},setImageCropToFreeform:function(e){var t;if((t=o.getFrameFormaForForma(e))&&t.cropRatioId!=f.CropRatioPresetLibrary.FREEFORM_ID){var r=new y.FormaTransformChangedEvent(t);t.beginUpdate(r),t.cropRatioId=f.CropRatioPresetLibrary.FREEFORM_ID,t.endUpdate(r)}},usesFreeformCropPreset:function(e){return o.getCropRatioId(e)==f.CropRatioPresetLibrary.FREEFORM_ID},migrateImageRotationToFrame:function(e,t){var r,o,n=e.placement.transformValues;if((r=t.bounds)&&(o=t.parent)){var a=Math.atan2(n.rotSine,n.rotCosine);if(Math.abs(a)>.001){var i=O.Matrix2D.rotation(n.rotCosine,n.rotSine),l=O._asterisk_TheoPoint_Matrix2D(r.evalXY(.5,.5),t.totalPlacement),u=O._asterisk_Matrix2D_Matrix2D(O._asterisk_Matrix2D_Matrix2D(O.Matrix2D.translation(K._negate_TheoPoint(l)),i),O.Matrix2D.translation(l)),s=O._asterisk_Matrix2D_Matrix2D(O._asterisk_Matrix2D_Matrix2D(o.totalPlacement,u),o.totalPlacement.inverse);t.move(s),X.TransformFacade.rotateForma(e,-a),n=e.placement.transformValues}}return n},resetCrop:function(e,t){var r,n,i,l;if(void 0===t&&(t=!0),(r=o.getFrameFormaForForma(e))&&(n=a.as(r.controller,v.FrameController))&&(i=e.bounds)&&(l=e.page.root.bounds)){var u=l.insetXY(10,10),s=e.finalFrame||u,c=s.center,d=new y.FormaTransformChangedEvent(r);r.beginUpdate(d);for(var g=o.migrateImageRotationToFrame(e,r),m=g.xscale,p=g.yscale,F=!1,C=0;!F&&C<10;){var h=i.transform(O.Matrix2D.scalingXY(m,p)),I=V.TheoRect.fromSize(h.size);n.setBoundsWithCropType(I,v.CropType.FitBorder);var k=(s=e.finalFrame||u).center;if(n.move(O.Matrix2D.translation(K._minus_TheoPoint_TheoPoint(c,k))),t)if(0==e.totalPlacement.transformPoints(i.points).filter((function(e){return u.containsPoint(e)}),this).length){s=e.finalFrame||u;var T=u.intersectionWith(s)||u,A=Math.max(s.width/T.width,s.height/T.height);A=Math.max(A,1.05),0==C&&(c=T.center),m/=A,p/=A,C+=1}else F=!0;else F=!0}10==C&&a.opt(D.Host.logging,(function(e){return e.warning("resetCrop did not converge")})),r.cropRatioId=f.CropRatioPresetLibrary.ORIGINAL_ID,r.endUpdate(d),n.updateCropModeImage()}},cropImageToRatio:function(e,t,r){var n,i,l,u,s;if(void 0===t&&(t=0),void 0===r&&(r=null),o.canCropImage(e)){if(o.removeMaskForForma(e),(i=o.getFrameFormaForForma(e))&&(l=o.getImageFormaForForma(e))&&(u=l.finalFrame)&&(s=l.bounds)){var c,d;t<=0?(d=s.aspectRatio,c=f.CropRatioPresetLibrary.ORIGINAL_ID):(d=t,c=(n=f.CropRatioPresetLibrary.getIdForRatio(t))||null!=n?n:f.CropRatioPresetLibrary.FREEFORM_ID);var g=i.controller,m=u.origin,p=new y.FormaTransformChangedEvent(i);i.beginUpdate(p);var F=r||i.bounds,C=V.TheoRect.fromSize(F.fitAspectRatioWithin(d)),h=g.isImageCropped()?v.CropType.PreserveFocusAndScale:v.CropType.FitBorder;g.setBoundsWithCropType(C,h);var I=a.opt(l.finalFrame,(function(e){return e.origin}))||K.TheoPoint.ZERO;g.move(O.Matrix2D.translation(K._minus_TheoPoint_TheoPoint(m,I))),i.cropRatioId=c,i.endUpdate(p),g.updateCropModeImage()}}else a.opt(D.Host.logging,(function(e){return e.warning("Asked to crop an image that can't be.")}))},snapFrameToVisibleImage:function(e,t){var r,n;if((r=a.opt(e.finalFrame,(function(e){return e.center})))&&(n=a.as(t.controller,v.FrameController))){var i,l,u=new y.FormaTransformChangedEvent(t);t.beginUpdate(u),(i=o.calcSnapFrameToVisibleImageBounds(e,t))&&(n.setBoundsWithCropType(i,v.CropType.PreserveFocusAndScale),(l=a.opt(e.finalFrame,(function(e){return e.center})))&&n.move(O.Matrix2D.translation(K._minus_TheoPoint_TheoPoint(r,l)))),t.endUpdate(u)}},calcSnapFrameToVisibleImageBounds:function(e,t,r){var n,i;if(void 0===r&&(r=.99),(n=e.bounds)&&(i=t.bounds)){var l=e.placement,u=l.transformValues,s=Math.atan2(u.rotSine,u.rotCosine);if(Math.abs(s)<.001)return o.calcSnapFrameToVisibleImageBoundsUnrotated(n,i,l,r);var c=a.clone(T.GeometryFacade.getIntersectionPolygon(i,n,O.Matrix2D.Identity,e.placement));if(T.GeometryFacade.areaOfConvexPolygon(c)<r*i.area){var d=O.Matrix2D.rotation(Math.cos(s),Math.sin(s)),g=T.GeometryFacade.centerOfPolygon(c),m=t.totalPlacement.transformPoint(g);return X.TransformFacade.justTransformFormaInPageSpaceAboutPoint(t,d,m),X.TransformFacade.justTransformFormaInPageSpaceAboutPoint(e,d.inverse,m),l=e.placement,o.calcSnapFrameToVisibleImageBoundsUnrotated(n,i,l,r)}}return null},calcSnapFrameToVisibleImageBoundsUnrotated:function(e,t,r,o){var n;return void 0===o&&(o=.99),(n=r.transformRect(e).intersectionWith(t))&&n.area<o*t.area?n:null},inCropMode:function(e){return o.pageInCropMode(a.opt(e,(function(e){return e.page})))},pageInCropMode:function(e){var t;return null!=(t=a.opt(a.opt(a.opt(e,(function(e){return e.document})),(function(e){return e.controller})),(function(e){return e.selection.inCropMode})))&&t},enterCropMode:function(e){var t,r;return!(!(t=a.as(a.opt(e.parent,(function(e){return e.controller})),v.FrameController))||!(r=a.opt(e.controller,(function(e){return e.owner})))||(r.selection.inCropMode=!0,t.enterCropMode(),0))},exitCropMode:function(e){var t;if((o=a.as(a.opt(e.parent,(function(e){return e.controller})),v.FrameController))&&(t=a.opt(e.controller,(function(e){return e.owner})))&&(t.selection.inCropMode=!1,o.cleanupCropVisualization()),a.as(e.controller,G.RootController)&&(t=a.opt(e.controller,(function(e){return e.owner})))){t.selection.inCropMode=!1;for(var r=a.iter(e.filterByKind(C.FrameForma.KIND));!r.done;r.next()){var o,n=r.value;(o=a.as(n.controller,v.FrameController))&&o.cleanupCropVisualization()}}},getTempCropImageForForma:function(e){var t;if(t=a.opt(a.opt(e,(function(e){return e.parent})),(function(e){return e.visitAsArray(F.FormaTraversal.JustChildren)})))for(var r=a.iter(t);!r.done;r.next()){var o=r.value;if(o.hasIntent(F.Forma.INTENT_TEMP_IMAGE_CROP)&&o.kind==C.FrameForma.KIND)return o}return null},canSetBackgroundImage:function(e){var t,r;return!(!(t=a.as(e,C.FrameForma))||!(r=t.controller))&&e.isImage()&&!t.isLogo()&&r.floating&&!e.isSticker()&&!r.userGroupMember},canSetFloatingImage:function(e){var t,r;return!(!(t=e)||!(r=t.controller))&&t.isImage()&&!t.isLogo()&&!r.floating&&!t.isVideo()&&!r.userGroupMember},canApplyCutout:function(e){var t;return!!(t=e)&&t.isImage()&&!t.isLogo()&&!t.isVideo()&&!t.isSticker()},canApplyBackgroundColor:function(e){var t,r;return!(!(t=a.as(e,C.FrameForma))||!(r=a.as(t.controller,v.FrameController)))&&t.isImage()&&(r.isBackgroundImageWithAlpha()||r.hasCutout)},isPotentialBackgroundImage:function(e){var t;return!!(t=a.as(e,C.FrameForma))&&(!t.isLogo()&&!t.isSticker()&&!t.controller.userGroupMember||t.isBackgroundImage())},isFloatingImage:function(e){var t,r;return!(!(t=a.as(e,C.FrameForma))||!(r=t.controller))&&r.floating},canCropImage:function(e){var t,r;return!(!(t=o.getFrameFormaForForma(e))||!(r=t.controller))&&!t.isLogo()&&r.floating&&!e.isSticker()},addHiddenImageToGrid:function(e){var t,r,n;(t=a.opt(a.as(a.opt(e.root,(function(e){return e.controller})),G.RootController),(function(e){return e.getGridController()})))&&(r=a.as(e,C.FrameForma))&&(n=o.getImageFormaForForma(r))&&(n.style.opacity=1,n.intent=F.Forma.INTENT_GRID_CELL,r.intent=F.Forma.INTENT_GRID_CELL,r.allowUserMove=!1,t.removeFormaFromGroup(r),t.addFormaToGroup(r))},setBackgroundImage:function(e){e.isBackgroundImage()||(R.LegacyCoreAssert.isTrue(o.canSetBackgroundImage(e),"asked to pin an image that can't be pinned",void 0,"ImageFacade.setBackgroundImage","ImageFacade.swift",668),o.setBackgroundOrFloatingImage(e,!0))},setFloatingImage:function(e){var t;(t=e.controller)&&t.floating||(R.LegacyCoreAssert.isTrue(o.canSetFloatingImage(e),"asked to float an image that can't be floated",void 0,"ImageFacade.setFloatingImage","ImageFacade.swift",678),o.setBackgroundOrFloatingImage(e,!1))},setBackgroundOrFloatingImage:function(e,t){var r,n,i,l;if(!(e.isBackgroundImage()&&t||!e.isBackgroundImage()&&!t)&&(r=a.opt(a.as(a.opt(e.root,(function(e){return e.controller})),G.RootController),(function(e){return e.getGridController()})))&&(n=a.as(e,C.FrameForma))&&(i=o.getImageFormaForForma(n))&&(l=n.finalFrame)){var u,s=a.opt(i.finalFrame,(function(e){return e.intersectionWith(l)})),c=new y.FormaStyleChangedEvent(r.forma);r.forma.beginUpdate(c),t&&(o.formaHasMask(n)&&o.removeMaskForForma(e),a.opt(i.controller,(function(e){return e.rotate(n.rotationInRadians())})),i.style.opacity=1,n.cropRatioId=f.CropRatioPresetLibrary.FREEFORM_ID,null!=(u=r.getBasicShapeLayoutColor())&&a.opt(e.root,(function(e){return e.style.colors.setColorId(p.ColorRole.FieldPrimary,u)})));var d=!1;if(!t&&null!=r.formaMappingSwiftDict[n.formaID]){var g=r.gridStyle.name.includes(A.GridStyle.SINGLE_LAYOUT_NAME)||r.gridStyle.name.includes(A.GridStyle.BALANCED_LAYOUT_NAME)||r.gridStyle.name==A.GridStyle.CUSTOM_LAYOUT_NAME;(r.getBackgroundShapes().length>0||!g)&&(r.removeFormaWithoutGridModification(n),d=!0)}if(d||r.removeFormaFromGroup(n),n.allowUserMove=!t,n.intent=t?F.Forma.INTENT_GRID_CELL:F.Forma.INTENT_FLOATING_IMAGE,i.intent=t?F.Forma.INTENT_GRID_CELL:F.Forma.INTENT_FLOATING_IMAGE,!t){var m=l.center;(null!=s?s.area/l.area:1)<.8?(n.bounds=V.TheoRect.fromSize(s.size),m=s.center):n.bounds=a.opt(n.bounds,(function(e){return e.scale(.95,new K.TheoPoint(0,0))})),n.moveCenterToPoint(m)}if(r.addFormaToGroupWithCurrentImage(n),!t){var v,h=n.parent,I=a.clone(h.filterByControllerKind(j.TypeLockupController.KIND));if(I.length>0){for(var k,T=I[0];null!=T&&null==h.indexOfChild(T);)T=T.parent;(k=T)?h.insertBefore(n,k,!0):R.LegacyCoreAssert.fail("Parenting confusion while moving image to fore; not reordering",void 0,"ImageFacade.setBackgroundOrFloatingImage","ImageFacade.swift",790)}(v=o.getCutoutMaskFormaForForma(n))&&o.setTightCropToCutoutMask(n,v,!1)}r.forma.endUpdate(c)}},getFrameForForma:function(e){var t;return(t=a.as(e,C.FrameForma))?t:e instanceof P.ImageForma||e instanceof z.VideoForma?a.as(e.parent,C.FrameForma):null},logCutoutProgressToAnalytics:function(e,t,r,o){var n;if(void 0===o&&(o=null),n=D.Host.logging){var a,i={mode:t,duration:r,platformID:n.platformID()};null!=(a=o)&&(i.error=a),n.logToNewRelic(e,i)}},generateMaskFromImageBytes:function(e,t,r){var n,i,l,u,s;if((n=a.opt(e.contentNode,(function(e){return e.image})))&&null!=(i=e.mimeType)&&(l=D.Host.network)&&(u=D.Host.dataFactory)&&(s=D.Host.logging)){var c=s.getCurrentTime();return n.getImageRepresentationData(i,r).then((function(e){var r;return(r=a.as(e,S.HostDataProtocol))?(t.data=u.createFromFormData({file:new S.HostNetworkFormDatum(r,"masksource")}),l.request(t).then((function(e){return o.logCutoutProgressToAnalytics(b.RemoteLoggingEvent.CUTOUT_SUCCESS,"upload",a.toInt(1e3*(s.getCurrentTime()-c))),e})).fail((function(e){var t,r=e;return o.logCutoutProgressToAnalytics(b.RemoteLoggingEvent.CUTOUT_ERROR,"upload",a.toInt(1e3*(s.getCurrentTime()-c)),a.toString(r)),(t=a.as(r,L.HostNetworkError))&&(r=N.ImageCutoutErrorLibrary.mapServerErrorToMaskError(t)),m.CorePromise.reject(r)}))):(R.LegacyCoreAssert.fail("Failed to get resized image.",void 0,"ImageFacade.generateMaskFromImageBytes","ImageFacade.swift",879),m.CorePromise.reject("Failed to get resized image."))}))}return R.LegacyCoreAssert.fail("Invalid image data or Host instance(s).",void 0,"ImageFacade.generateMaskFromImageBytes","ImageFacade.swift",884),m.CorePromise.reject("Invalid image data or Host instance(s).")},generateMaskFromCCStorageImage:function(e,t){var r,n,i,l,u,s,c;if((r=a.opt(e.contentNode,(function(e){return e.image})))&&(n=e.contentNode)&&null!=(i=r.getStoragePath(n))&&(l=D.Host.network)&&(u=D.Host.dataFactory)&&(s=D.Host.logging)&&(c=u.createFromString("cc-storage://"+i,"text/plain"))){var d=s.getCurrentTime();return t.data=u.createFromFormData({url:new S.HostNetworkFormDatum(c)}),l.request(t).then((function(e){return o.logCutoutProgressToAnalytics(b.RemoteLoggingEvent.CUTOUT_SUCCESS,"cc-storage",a.toInt(1e3*(s.getCurrentTime()-d))),e})).fail((function(e){var t,r=e,n=a.toString(r);return(t=a.as(r,L.HostNetworkError))&&(t.type==L.HostNetworkErrorType.NotFound&&(n="image not found on CC Storage"),r=N.ImageCutoutErrorLibrary.mapServerErrorToMaskError(t)),o.logCutoutProgressToAnalytics(b.RemoteLoggingEvent.CUTOUT_ERROR,"cc-storage",a.toInt(1e3*(s.getCurrentTime()-d)),n),m.CorePromise.reject(r)}))}return R.LegacyCoreAssert.fail("Invalid image data or Host instance(s).",void 0,"ImageFacade.generateMaskFromCCStorageImage","ImageFacade.swift",938),m.CorePromise.reject("Invalid image data or Host instance(s).")},setModelVersionFromResponse:function(e,t){var r,o;(r=e.headers)&&null!=(o=r["x-version"])&&(t.modelVersion=o,t.model==N.ImageCutoutModelLibrary.CURRENT_MODEL&&N.ImageCutoutModelLibrary.instance.setModelVersion(o))},processNetworkResponseAndSaveImage:function(e,t){var r,n;return(r=a.as(e,L.HostNetworkResponse))&&(n=r.data)?(o.setModelVersionFromResponse(r,t),D.Host.network.saveImageComponent(n,r.mimeType)):m.CorePromise.reject("Invalid network response")},generateCutoutMaskForImage:function(e,t,r,n){var i;return void 0===n&&(n=!1),(i=o.getImageFormaForForma(e))?N.ImageCutoutModelLibrary.buildMaskNetworkRequestForConfig(t,N.MASK_ENDPOINT,L.HostNetworkRequestMethod.post,r).then((function(e){var r;return(r=a.as(e,L.HostNetworkRequest))?n?o.generateMaskFromImageBytes(i,r,t.maskSize):o.generateMaskFromCCStorageImage(i,r).then((function(e){return t.maskSize=N.CutoutMaskSize.ORIGINAL,e})).fail((function(e){var n;return(n=a.as(e,L.HostNetworkError))&&n.type==L.HostNetworkErrorType.NotFound?o.generateMaskFromImageBytes(i,r,t.maskSize):m.CorePromise.reject(e)})):m.CorePromise.reject("Invalid network request object")})):m.CorePromise.reject("Invalid image or frame")},processMask:function(e,t,r,n){var i,u;if(void 0===n&&(n=!0),(i=a.as(r,L.HostNetworkResponse))&&(u=i.data)){var s,c,d,g,f=a.opt(a.opt(e.page.document,(function(e){return e.controller})),(function(e){return e.saveMgr}));return null!=(d=a.opt(D.Host.imageAnalysis,(function(e){return e.createTempMaskURL(u)})))&&(n&&a.opt(f,(function(e){return e.suspend()})),s=o.applyCutoutMaskToImage(e,d,"",null,t)),(n||null==s)&&(c=o.processNetworkResponseAndSaveImage(r,t).then((function(r){var n,i;return(n=a.as(r,L.HostComponentResponse))?(i=s)?o.updateTempCutoutMaskWithComponentizedMask(e,i,n).then((function(e){return a.opt(f,(function(e){return e.resume()})),e})).fail((function(e){return l.CoreAssert.fail("Failed to substitute temporary cutout mask with componentized mask",{error:a.toString(e)},"ImageFacade.processMask","ImageFacade.swift",1060)})):o.applyCutoutMaskToImage(e,n.url,n.type,n.id,t):m.CorePromise.reject("Invalid component response object")}))),(g=s)?g:c}return m.CorePromise.reject("Invalid network response")},retryNewMaskFromCC:function(e,t,r){var n,i;if((n=o.getImageFormaForForma(e))&&(i=D.Host.logging)){var l=i.getCurrentTime();return o.logCutoutProgressToAnalytics(b.RemoteLoggingEvent.CUTOUT_RETRY,"cc-storage",a.toInt(1e3*(i.getCurrentTime()-l))),N.ImageCutoutModelLibrary.buildMaskNetworkRequestForConfig(t,N.MASK_ENDPOINT,L.HostNetworkRequestMethod.post,r).then((function(r){var u;return(u=a.as(r,L.HostNetworkRequest))?o.generateMaskFromCCStorageImage(n,u).then((function(r){return t.maskSize=N.CutoutMaskSize.ORIGINAL,o.logCutoutProgressToAnalytics(b.RemoteLoggingEvent.CUTOUT_RETRY_SUCCESS,"cc-storage",a.toInt(1e3*(i.getCurrentTime()-l))),o.processMask(e,t,r)})):m.CorePromise.reject("Invalid network request object")}))}return m.CorePromise.reject("Invalid image data or Host instance(s).")},updateTempCutoutMaskWithComponentizedMask:function(e,t,r){return t.then((function(t){var o,n,i,l,u;return(o=a.as(t,P.ImageForma))&&(n=o.contentNode)&&null!=(i=n.url)&&(l=e.page.document)&&(u=a.opt(l.controller,(function(e){return e.undoRedoMgr})))?new m.CorePromise((function(e,t){a.opt(D.Host.imageAnalysis,(function(e){return e.disposeTempMaskURL(i)})),l.maskSubstitutionController.substitute(i,r.id,r.url,r.type),u.invalidatePatches((function(){return e(o)}))})):m.CorePromise.reject("Invalid forma or content node or db.")}))},getNewMaskForImage:function(e,t,r,n){return void 0===n&&(n=!1),o.generateCutoutMaskForImage(e,t,r,n).then((function(r){var a=D.Host.platform.isWeb&&!n;return o.processMask(e,t,r,!a)}))},runDeepCutDirectly:function(e,t){void 0===t&&(t=N.ImageCutoutModelLibrary.DEFAULT_TIMEOUT);var r=new N.CutoutMaskMetadata(N.ImageCutoutModelLibrary.CURRENT_MODEL,N.ImageCutoutModelLibrary.DEFAULT_MASK_SIZE,null);return o.generateCutoutMaskForImage(e,r,t,!1).then((function(e){var t,n;return(t=a.as(e,L.HostNetworkResponse))&&(n=t.data)?(o.setModelVersionFromResponse(t,r),[n,r]):m.CorePromise.reject("Invalid image data for cutout mask")}))},hasRefinedCutout:function(e){var t,r;return!(!(t=o.getCutoutMaskFormaForForma(e))||!(r=t.contentNode))&&null==r.getTag(x.ImageContentNode.IMAGE_MASK_METADATA_TAG)},isRefineCutoutUnmaskedImageVisible:function(e){return a.opt(e,(function(e){return 1==e.page.refineCutoutController.isUnmaskedImageVisible()}))},getCutoutMaskMetadataForForma:function(e){var t,r,n;return(t=o.getCutoutMaskFormaForForma(e))&&(r=t.contentNode)&&null!=(n=r.getTag(x.ImageContentNode.IMAGE_MASK_METADATA_TAG))?N.CutoutMaskMetadata.decode(n):null},createCutoutMaskForImage:function(e,t,r,n,i){void 0===i&&(i=!1);var l=o.getCutoutMaskFormaForForma(e),u=new N.CutoutMaskMetadata(t,r,null);if(null==l)return o.getNewMaskForImage(e,u,n,i);var s=a.opt(a.opt(l,(function(e){return e.contentNode})),(function(e){return e.getTag(x.ImageContentNode.IMAGE_MASK_METADATA_TAG)})),c=N.CutoutMaskMetadata.decode(s),d=a.opt(c,(function(e){return e.maskSize==N.CutoutMaskSize.ORIGINAL}));return N.ImageCutoutModelLibrary.isMaskUptodateWithCurrentModel(c).then((function(t){var r;return null!=(r=a.as(t,"Bool"))&&r?d?l:o.retryNewMaskFromCC(e,u,n).fail((function(e){return l})):o.getNewMaskForImage(e,u,n)}))},createAndLoadCutoutMaskForImage:function(e,t,r,n,i,u){return void 0===t&&(t=N.ImageCutoutModelLibrary.CURRENT_MODEL),void 0===r&&(r=N.ImageCutoutModelLibrary.DEFAULT_MASK_SIZE),void 0===n&&(n=N.ImageCutoutModelLibrary.DEFAULT_TIMEOUT),void 0===u&&(u=!1),i==N.CutoutMode.Off?(l.CoreAssertDebugOnly.fail("Asked to create cutout mask with cutout mode OFF",void 0,"ImageFacade.createAndLoadCutoutMaskForImage","ImageFacade.swift",1297),m.CorePromise.resolve(null)):o.createCutoutMaskForImage(e,t,r,n,u).then((function(e){var t,r;return(t=a.as(e,P.ImageForma))&&(r=t.contentNode)?r.whenLoaded().thenReturn(e):e}))},createAndLoadCutoutMaskForReplacementImage:function(e,t){var r;return(r=a.as(e,C.FrameForma))?o.createAndLoadCutoutMaskForImage(r,void 0,void 0,void 0,t,!0).then((function(e){return e})).fail((function(e){return a.opt(D.Host.logging,(function(t){return t.logToNewRelic(b.RemoteLoggingEvent.CUTOUT_ERROR_AFTER_REPLACE,{error:a.toString(e)})})),null})):m.CorePromise.resolve(null)},finalizeCutoutAfterMaskLoad:function(e,t,r,n,l){void 0===n&&(n=null),void 0===l&&(l=null);var u,s,c=new y.FormaAnimationTransactionEvent(e);if(c.duration=0,e.beginUpdate(c),o.setCutoutModeForForma(e,r),(u=n)&&(s=u.frame))if(e.matchColors(u),o.setTightCropToCutoutMask(e,t)){var d=e.rotationInRadians();a.opt(e.controller,(function(e){return e.rotate(-d)})),a.opt(e.controller,(function(e){return e.fitInArea(s)})),a.opt(e.controller,(function(e){return e.rotate(d)})),T.GeometryFacade.fitInPage(e,l,void 0,void 0,void 0,1.25)}else e.isBackgroundImage()||o.matchTrimmedRegion(u,e);else{D.Host.platform.isWeb||o.setTightCropToCutoutMask(e,t);var g=N.ImageCutoutLibrary.getCutoutModeString(r);a.opt(D.Host.logging,(function(e){return e.logToAnalytics(i.AnalyticsConstants.kAnalyticsDataEditImageRemoveBackgroundApplied,{contextualData1:"appliedCutout: "+g})}))}e.isBackgroundImage()&&a.opt(a.as(a.opt(e.parent,(function(e){return e.controller})),k.GroupController),(function(e){return e.updateGroup()})),e.endUpdate(c)},removeCutoutMaskFromImage:function(e){return o.setCutoutModeForForma(e,N.CutoutMode.Off),m.CorePromise.resolve(null)},formaHasMask:function(e){return null!=o.getMaskFormaForForma(e)},formaHasShapeMask:function(e){return o.getMaskFormaForForma(e)instanceof W.ShapeForma},setAuxiliaryForForma:function(e,t,r){var n;if(n=o.getFrameFormaForForma(e)){var a,i,l,u=new y.FormaContentChangedEvent(n);if(n.beginUpdate(u),(a=o.getMaskFormaForFormaByIntent(n,r))&&n.removeAuxiliary(a),(i=t)&&(i.intent=r,n.appendAuxiliary(i)),e.endUpdate(u),l=o.getImageFormaForForma(e)){var s=new y.FormaContentChangedEvent(l);l.beginUpdate(s),l.endUpdate(s)}}},setMaskForForma:function(e,t){o.setAuxiliaryForForma(e,t,F.Forma.INTENT_IMAGE_MASK)},removeMaskForForma:function(e){o.setMaskForForma(e,null)},setCutoutForForma:function(e,t){var r;o.setAuxiliaryForForma(e,t,F.Forma.INTENT_CUTOUT_MASK),(r=t)&&o.updateCutoutMaskPlacement(e,r)},removeCutoutForForma:function(e){o.setCutoutForForma(e,null),o.setCutoutModeForForma(e,N.CutoutMode.Off)},getMaskForForma:function(e){var t,r,n,i,l=o.getMaskFormaForForma(e);return(t=a.as(l,W.ShapeForma))&&null!=(r=t.shapeLibraryID)?u.CropAssetLibrary.getCropShapeFromID(r):(n=a.as(l,P.ImageForma))&&null!=(i=n.contentNode.getTag(x.ImageContentNode.ASSET_ID_TAG))?u.CropAssetLibrary.getRasterMaskFromID(i):null},applyMaskToForma:function(e,t,r,n){var i;if(void 0===r&&(r=null),void 0===n&&(n=!1),i=a.as(e,C.FrameForma)){var l,s,c,d=null,g=new y.FormaApplyMaskEvent(i);return i.beginUpdate(g),(l=a.as(t,u.CropShape))?d=o.applyShapeMaskToImage(e,l.id,r,n):(s=a.as(t,u.RasterMask))&&(d=o.applyRasterMaskToImage(e,s,r,n)),(c=d)?c.then((function(e){var t;if(t=a.as(i.controller,v.FrameController)){if(o.formaHasMask(i)){var r=new y.FormaGeometryChangedEvent(i);i.beginUpdate(r),t.fitChildrenToFrame(),i.endUpdate(r)}t.fitting=v.FitType.None,t.updateCropModeImage()}return i.cropRatioId=f.CropRatioPresetLibrary.NONE_ID,i.endUpdate(g),e})):m.CorePromise.reject("Invalid CropAsset type.")}return m.CorePromise.reject("Invalid frame.")},applyShapeMaskToImage:function(e,t,r,n){var i;if(void 0===r&&(r=null),void 0===n&&(n=!1),i=a.as(e,C.FrameForma)){var l,u,s,c,d,g=o.formaHasMask(i),f=a.opt(a.opt(o.getImageFormaForForma(i),(function(e){return e.finalFrame})),(function(e){return e.origin}));if((l=r)&&a.opt(a.as(i.controller,v.FrameController),(function(e){return e.setBoundsWithCropType(l,v.CropType.PreserveFocusAndScale)})),o.removeMaskForForma(i),null!=t&&(u=a.as(i.page.createFormaWithController(W.ShapeForma.KIND,H.ShapeController.KIND),W.ShapeForma))){Y.ShapeLibrary.applyToShapeForma(u,t);var p,h,y=u.canonicalArtwork;if(!n&&(p=y.bounds)&&(h=i.bounds)){var I=h.fitAspectRatioWithin(p.aspectRatio);i.bounds=V.TheoRect.fromXYWH(h.minX,h.minY,I.width,I.height)}u.preScale=null,u.allowUserMove=!1,u.intent=F.Forma.INTENT_IMAGE_MASK,o.setMaskForForma(i,u)}return(h=i.bounds)&&(s=a.opt(o.getImageFormaForForma(i),(function(e){return e.bounds})))&&!o.formaHasMask(i)&&g&&null==r&&(I=h.fitAspectRatioWithin(s.aspectRatio),i.bounds=V.TheoRect.fromXYWH(h.minX,h.minY,I.width,I.height)),(c=f)&&(d=a.opt(a.opt(o.getImageFormaForForma(i),(function(e){return e.finalFrame})),(function(e){return e.origin})))&&i.move(O.Matrix2D.translation(K._minus_TheoPoint_TheoPoint(c,d))),m.CorePromise.resolve(o.getMaskFormaForForma(e))}return m.CorePromise.reject("frame is nil")},applyRasterMaskToImage:function(e,t,r,n){var i,l,u;if(void 0===r&&(r=null),void 0===n&&(n=!1),(i=o.getFrameFormaForForma(e))&&(l=t)&&null!=(u=D.Host.resourceUtils.urlForResource(E.CATEGORY_ID_RASTER_MASK,l.id))){var s=new d.AddFormaParams(void 0,void 0,void 0,void 0,d.AddFormaParentingHint.doNotAddFormaForContentToTree),c={"image-role":x.ImageContentNode.ROLE_MASK,"asset-id":l.id};return d.CreationFacade.addImage(e.page,u,l.mimeType,l.width,l.height,!1,void 0,s,c).then((function(e){var t;return(t=a.as(e,P.ImageForma))?(o.setMaskForForma(i,t),t):m.CorePromise.reject("imageCN is nil")}))}return m.CorePromise.reject("frame is invalid")},getBoundingBoxAndMask:function(e,t){var r;void 0===t&&(t=5);var o,n,i,l,u,c,d={source:{bytes:e},saliency:{boundingBoxRectangles:!0,mask:!0}},g=new s.CoreContentJSON(a.as(d,["Dictionary","String","Any"]),"application/json;charset=UTF-8");if((o=D.Host.network)&&(n=D.Host.imageAnalysis)&&(i=D.Host.dataFactory)&&(l=D.Host.resourceUtils)&&(u=D.Host.logging)&&(c=i.createFromCoreContent(g))){var f=u.newLog("host");return m.CorePromise.all([o.getAuthToken(),n.getSaliencyAPIEndpoint(),n.getSaliencyAPIKey()]).then((function(e){var n,i,s,d,g=a.clone(a.as(e,["Array","Any"]));if(R.LegacyCoreAssert.isTrue(a.opt(g,(function(e){return 3==e.length})),"Expected three CorePromise results.",void 0,"ImageFacade.getBoundingBoxAndMask","ImageFacade.swift",1658),(n=g)&&null!=(i=a.as(n[0],"String"))&&null!=(s=a.as(n[1],"String"))&&null!=(d=a.as(n[2],"String"))){var p=l.makeGUID(),F=new L.HostNetworkRequest(s+"/imageAnalysis");F.timeout=t,F.method=L.HostNetworkRequestMethod.post,F.headers.Authorization="Bearer "+i,F.headers["X-API-Key"]=d,F.headers["X-Request-Id"]=p,F.data=c;var v=u.getCurrentTime(),C={saliency:{boundingBoxRectangles:[]}};return o.request(F).then((function(e){var t,r;if((t=a.as(e,L.HostNetworkResponse))&&(r=t.data)){var o=1e3*(u.getCurrentTime()-v);return f.info("Successfully got Saliency BoundingBoxAndMask in "+o+"ms."),r.asJSON()}return f.warning("Invalid Saliency BoundingBoxAndMask API response type."),C})).fail((function(e){var o;return(o=a.as(e,L.HostNetworkError))?o.type==L.HostNetworkErrorType.Timeout?f.warning("Saliency BoundingBoxAndMask timed-out after "+1e3*t+"ms. request-id: "+p):f.warning("Error getting Saliency BoundingBoxAndMask: ["+((r=o.status)||null!=r?r:-1)+"] "+o.description+". request-id: "+p):f.warning("Error getting Saliency BoundingBoxAndMask. request-id: "+p),C}))}return m.CorePromise.reject("Invalid auth data")}))}return m.CorePromise.reject("Invalid Host instances")},updateCutoutMaskPlacement:function(e,t){var r,n,a;if((r=o.getImageFormaForForma(e))&&(n=r.bounds)&&(a=t.bounds)){R.LegacyCoreAssert.isTrue(a.width>0&&a.height>0,"Invalid mask bounds.",void 0,"ImageFacade.updateCutoutMaskPlacement","ImageFacade.swift",1722);var i=n.width/a.width,l=n.height/a.height;t.placement=O.Matrix2D.scalingXY(i,l).concat(r.placement)}else R.LegacyCoreAssert.fail("Failed to update cutout mask bounds - invalid image or mask bounds.",void 0,"ImageFacade.updateCutoutMaskPlacement","ImageFacade.swift",1728)},applyCutoutMaskToImage:function(e,t,r,n,i){var l,u;if(void 0===n&&(n=null),void 0===i&&(i=null),u=a.as(e,C.FrameForma)){var s=new d.AddFormaParams(void 0,void 0,void 0,void 0,d.AddFormaParentingHint.doNotAddFormaForContentToTree),g={"image-role":x.ImageContentNode.ROLE_MASK,"image-mask-metadata":(l=a.opt(i,(function(e){return e.encode()})))||null!=l?l:""};return d.CreationFacade.addImage(e.page,t,r,void 0,void 0,void 0,void 0,s,g,n).then((function(e){var t;return(t=a.as(e,P.ImageForma))?a.opt(t.contentNode,(function(e){return null==e.trimmedBounds}))?(t.removeFromParent(),m.CorePromise.reject(new L.HostCutoutMaskError(L.HostCutoutMaskErrorType.NoForegroundObjectImage))):(c.ColorFacade.applyNoneColorToFormae([u]),o.setCutoutForForma(u,t),o.setCutoutModeForForma(u,N.CutoutMode.Off),t):m.CorePromise.reject("mask is not an ImageForma.")}))}return m.CorePromise.reject("frame is nil")},canSetTightCropToCutoutMask:function(e,t){var r,n;return void 0===t&&(t=!0),!(!(r=e)||!(n=r.controller)||o.formaHasShapeMask(r)||r.isBackgroundImage()||n.userGroupChild||t&&null!=r.style.colors.fieldPrimary)},setTightCropToCutoutMask:function(e,t,r){if(void 0===r&&(r=!0),!o.canSetTightCropToCutoutMask(e,r))return!1;var n,i,l,u,s;if((n=o.getImageFormaForForma(e))&&(i=a.as(e.controller,v.FrameController))&&(l=n.bounds)&&(u=t.bounds)&&(s=a.opt(t.contentNode,(function(e){return e.trimmedBounds})))){var c,d,g=s.multiplyXY(l.width/u.width,l.height/u.height);if((c=a.opt(n.placement.inverse,(function(t){return t.transformRect(e.bounds)})))&&(d=g.intersectionWith(c))){var m=new y.FormaGeometryChangedEvent(e);e.beginUpdate(m);var f=n.placement.transformRect(d),p=n.totalPlacement.transformPoint(d.center);e.bounds=V.TheoRect.fromSize(f.size);var F=O.Matrix2D.translation(K._minus_TheoPoint_TheoPoint(e.bounds.center,n.placement.transformPoint(d.center)));n.move(F),i.fitChildrenToFrame(),e.move(O.Matrix2D.translation(K._minus_TheoPoint_TheoPoint(p,e.finalFrame.center))),e.endUpdate(m)}}return!0},getTrimmedRegionForMatching:function(e,t){var r,n,i,l;return(r=t.bounds)&&(n=o.getCutoutMaskFormaForForma(e))&&(i=n.bounds)&&(l=a.opt(n.contentNode,(function(e){return e.trimmedBounds})))?l.multiplyXY(r.width/i.width,r.height/i.height):null},getTrimmedRegionCropBoundsAndArea:function(e,t,r){var o=a.clone(T.GeometryFacade.getIntersectionPolygon(e,t,O.Matrix2D.Identity,r)),n=V.TheoRect.boundsOfPoints(o)||V.TheoRect.Zero,i=T.GeometryFacade.areaOfConvexPolygon(o),l=r.transformRect(t).intersectionWith(e)||V.TheoRect.Zero,u=l.area;return(i<.05*u||i>u)&&(n=l,i=u),{croppedBounds:n,croppedArea:i}},matchTrimmedRegion:function(e,t){var r,n,a,i,u,s;if((r=e.frame)&&(n=t.frame)&&(a=e.bounds)&&(i=t.bounds)&&(u=o.getImageFormaForForma(e))&&(s=o.getImageFormaForForma(t))){l.CoreAssertDebugOnly.isTrue(r.equalWithAccuracy(n,.01),"matchTrimmedRegion expects congruent frames",void 0,"ImageFacade.matchTrimmedRegion","ImageFacade.swift",1894);var c,d,g=s.rotationInRadians();if(l.CoreAssertDebugOnly.isTrue(Math.abs(g)<.01,"matchTrimmedRegion expects the destination image to be unrotated",void 0,"ImageFacade.matchTrimmedRegion","ImageFacade.swift",1896),(c=o.getTrimmedRegionForMatching(e,u))&&(d=o.getTrimmedRegionForMatching(t,s))){var m=o.getTrimmedRegionCropBoundsAndArea(a,c,u.placement);c=m.croppedBounds;var f=e.placement.transformValues,p=m.croppedArea*f.xscale*f.yscale;if(p>0){d=s.placement.transformRect(d);var F=t.placement.transformValues,v=d.area*F.xscale*F.yscale,C=T.GeometryFacade.getClosestPin(a,c),h=O._asterisk_TheoPoint_Matrix2D(c.evalXY(C.x,C.y),e.placement),y=O._asterisk_TheoPoint_Matrix2D(h,t.placement.inverse),I=d.evalXY(C.x,C.y),k=K._minus_TheoPoint_TheoPoint(y,I);X.TransformFacade.translateForma(s,k),d=d.offset(k);var A,M=Math.sqrt(p/v);null!=(A=T.GeometryFacade.getScaleToFit(d,i,y))&&(M=Math.min(M,A)),X.TransformFacade.transformFormaeInPageSpaceAboutPoint([s],O.Matrix2D.scalingXY(M,M),O._asterisk_TheoPoint_Matrix2D(y,t.totalPlacement))}}}},canAddImages:function(e,t){return t+e.filterByControllerKind(v.FrameController.KIND).length<=I.GridController.MAX_IMAGE_COUNT},addPlaceholderImage:function(e){var t,r;return null!=(t=D.Host.resourceUtils.urlForResource(E.CATEGORY_ID_IMAGE,"placeholder"))&&(r=a.opt(D.Host.imageAnalysis,(function(e){return e.createHostImage(t,!1)})))?r.getImageRepresentationData("image/png",Math.max(r.getHeight(),r.getWidth())).then((function(t){var o;return(o=a.as(t,S.HostDataProtocol))?D.Host.network.saveImageComponent(o,"image/png").then((function(t){var o,n;return(o=a.as(t,L.HostComponentResponse))?(n=a.as(e.content.createNode(x.ImageContentNode.KIND,M.GUIDUtils.makeGUID()),x.ImageContentNode))?(n.url=o.url,n.mimeType="image/png",n.pixelWidth=r.getWidth(),n.pixelHeight=r.getHeight(),n.mediaMetadata=w.MediaMetadata.init_5f01(),n.componentID=o.id,d.CreationFacade.addContent(e.firstPage,n,null,!1,new d.AddFormaParams(void 0,void 0,void 0,d.FloatingImageStrategy.Always)).then((function(e){var t=a.as(e,F.Forma);return null!=t?m.CorePromise.resolve(t):(R.LegacyCoreAssert.fail("expected a forma result from CreationFacade.addContent",void 0,"ImageFacade.addPlaceholderImage","ImageFacade.swift",2e3),m.CorePromise.resolve(null))}))):m.CorePromise.resolve(null):m.CorePromise.reject(t)})):m.CorePromise.resolve(null)})):m.CorePromise.resolve(null)}}}),o)},nPwb:function(e,t,r){var o,n=t,a=r("oAGj");n.PGMFacade=(o=function(){},a.defineClass({name:"PGMFacade",ctor:o}),o)},pmb0:function(e,t,r){var o,n=t,a=r("oAGj"),i=r("VQVe"),l=r("FNB+"),u=r("KkVW"),s=r("3/rh"),c=r("Pn67"),d=r("nQ+V"),g=r("SAU6"),m=r("nUE5");n.EXPOSE_MOTION_STYLE=!1,n.MotionFacade=(o=function(){},a.defineClass({name:"MotionFacade",ctor:o,statics:{ANIM_STYLE_NAME_STACKED:"Stacked",ANIM_STYLE_NAME_COMPOSITE:"Composite",getCurrentAnimationStyle:function(){return o._animStyle},applyEntryToForma:function(e,t){var r=m.MotionSource.getSourceAnimation(t.srcId,e);t.logic.apply(e,r,t.args)},canApplyStyle:function(e){return e.name==o.ANIM_STYLE_NAME_STACKED||e.name==o.ANIM_STYLE_NAME_COMPOSITE||e.name==i.AnimationStyle.NAME_DYNAMIC&&3==e.variant},createAllAnimationStyles:function(){return n.EXPOSE_MOTION_STYLE?[i.AnimationStyle.init_e14f(o.ANIM_STYLE_NAME_STACKED,0,1,i.AnimationStyleCategory.Text),i.AnimationStyle.init_e14f(o.ANIM_STYLE_NAME_COMPOSITE,0,1,i.AnimationStyleCategory.Text)]:[]},applyStyle:function(e,t){if(o.canApplyStyle(t))if(o._animStyle=t,t.name==i.AnimationStyle.NAME_DYNAMIC)o.applyEntryToForma(e,new g.MotionEntryStackedRoot);else{var r,n=[],m=new c.MotionEntryNone;e.visitAll(l.FormaTraversal.PreOrder,(function(e){o.applyEntryToForma(e,m),e.isTypeLockup()&&n.push(e)})),(r=a.first(n))&&(t.name==o.ANIM_STYLE_NAME_COMPOSITE?(o.applyEntryToForma(r,new u.MotionEntryDropIn),o.applyEntryToForma(r,new s.MotionEntryFadeIn)):t.name==o.ANIM_STYLE_NAME_STACKED&&o.applyEntryToForma(r,new d.MotionEntryStacked))}}}}),o)},wNKJ:function(e,t,r){var o,n=t,a=r("oAGj"),i=r("gXiO"),l=r("quOg"),u=r("FNB+"),s=r("6ZWm"),c=r("cmoc"),d=r("OdB2"),g=r("P83h"),m=r("9Lk3"),f=r("ZK0l"),p=r("pnSN"),F=r("X0GW"),v=r("iCxV"),C=r("fdtz"),h=r("lmwz"),y=r("fNpk"),I=r("tGKA"),k=r("KIfs"),T=r("K0Rh"),A=r("djAF"),M=r("6Tzw"),D=r("T6jX"),S=r("oKlP"),b=r("sIWg");n.DragFacade=(o=function(){i.CoreObject.call(this)},a.defineClass({name:"DragFacade",ctor:o,superName:"CoreObject",statics:{processBeginFormaDrag:function(e){var t=e.dragDelegate.dragController,r=a.opt(t,(function(e){return e.owner.document.firstPage}));a.opt(r,(function(e){return e.publish(new d.BeginFormaDragMessage(r))})),a.opt(t,(function(t){return t.afterProcessBeginFormaDrag(e)}))},processFormaDrag:function(e){var t=e.dragDelegate.dragController;a.opt(t,(function(t){return t.beforeProcessFormaDrag(e)}));var r=[],n=!(1==e.dragDelegate.modifierKeys.control)&&1==e.dragDelegate.draggedFormae.length;return e.dragDelegate.forEachDraggedForma((function(t,a){r=r.concat(o.processOneFormaDrag(e,t,a,n))})),a.opt(t,(function(t){return t.afterProcessFormaDrag(e)})),r},processOneFormaDrag:function(e,t,r,n){var i=[],u=e.drag;if(null==e.dragDelegate.dragController.owner)return i;if(null==t.controller)return i;var s=e.dragDelegate.dragController.owner,c=t.controller,m=s.selection;if(!c.moveable||s.interactionMode==l.InteractionMode.SelectionFocused&&m.selectedCount>0&&!m.isSelected(t))return i;var f=new g.FormaTransformChangedEvent(t);t.beginUpdate(f),o.doMove(u,t,r,m),n&&(i=a.clone(o.doSnap(u,t,r))),t.endUpdate(f);var p=s.document.firstPage;return p.publish(new d.FormaDragMessage(p)),i},doMove:function(e,t,r,o){var n,i=a.opt(t.parent,(function(e){return e.totalPlacement.inverse}))||I.Matrix2D.Identity,l=e.freeMovement(i),u=l.movement;switch(l.rise,l.run,n=t.parent instanceof c.FrameForma?t.parent.bounds.center:I._asterisk_TheoPoint_Matrix2D(t.bounds.center,r),e.dragMode){case 1:u=e.noScale(i,n);break;case 2:u=e.noRotation(i,n)}y.LegacyCoreAssert.isFalse(0==u.determinant,"movement determinant should be non-zero",void 0,"DragFacade.doMove","DragFacade.swift",101),I._asterisk_Matrix2D_Matrix2D(I._asterisk_Matrix2D_Matrix2D(I.Matrix2D.translation(n),u),I.Matrix2D.translation(S._negate_TheoPoint(n))),e.uncommitedMovement=u;var s,d=I._asterisk_Matrix2D_Matrix2D(r,u);(s=t.controller)&&s.place(d)},doSnap:function(e,t,r){var o,n,i=[];n=t.parent instanceof c.FrameForma?t.parent.bounds.center:I._asterisk_TheoPoint_Matrix2D(t.bounds.center,r);var l,s=t.bounds.locatePoint(t.placement.inverse.transformPoint(n)),d=e.dragMode==k.DragMode.NoScaleNoSkew,g=e.activePace();l=!(!(o=a.opt(v.Host.platform,(function(e){return e.isWeb})))&&null==o||!o)||g==k.DragPace.MediumPace||e.currentlySnapped,e.dragMode==k.DragMode.UniformScaleNoRotationNoSkew&&(l=!1);var f,p,F,C=a.clone(t.filterByControllerKind(m.GridController.KIND,u.FormaTraversal.NearestAncestor));if((f=a.as(a.opt(a.first(C),(function(e){return e.controller})),m.GridController))&&f.isChildSwappable(t)&&l&&(l=d),(p=h.ImageFacade.getFrameFormaForForma(t))&&(l=p.controller.floating),F=t.controller){var y=e.currentlySnapped;if(e.currentlySnapped=!1,l){var T,A=F.setSnappedPlacement(d?s:null,8/e.viewportScale,!1);(T=A.snapLines)&&(i=a.clone(T)),null!=A.movement&&(e.currentlySnapped=!0),!y&&e.currentlySnapped&&e.commitDrag()}}return i},processEndFormaDrag:function(e){var t,r,n,i=e.dragDelegate.dragController;if(n=a.as(i,s.FrameController))n.processEndFormaDrag(e);else{var l=e.drag.viewportScale,u=26/l,c=0;e.drag.pointers.length>1&&(c=24/l),M.SelectionFacade.enableAdditionalMultiSelectGestures()&&a.opt(i,(function(t){return t.owner.selection.replaceSelectionWithFormae(e.dragDelegate.draggedFormae)}));var g=!(!(t=a.opt(i,(function(e){return e.owner.selection.inCropMode})))&&null==t)&&t;e.dragDelegate.forEachDraggedForma((function(e,t){o.rescueFormaToPageBounds(e,u,c),g||!(r=a.opt(e.controller,(function(e){return e.userGroupChild})))&&null==r||!r||F.GroupFacade.updateUserGroupHierarchy(e.parent)}));var m=a.opt(i,(function(e){return e.owner.document.firstPage}));a.opt(m,(function(e){return e.publish(new d.EndFormaDragMessage(m))})),e.dragDelegate.forEachDraggedForma((function(e,t){var r;if(r=a.opt(e.root,(function(e){return e.filterWithCallback((function(e){return e instanceof p.GroupForma&&null!=e.controller}))})))for(var o=a.iter(r);!o.done;o.next()){var n,i=o.value;(n=a.as(i.controller,f.GroupController))&&n.canClaimForma(e)&&n.claimForma(e)}else v.Host.logging.error("Error: forma has not root "+e.print())})),a.opt(i,(function(t){return t.afterProcessEndFormaDrag(e)}))}},rescueFormaToPageBounds:function(e,t,r,n){var a;if(void 0===t&&(t=50),void 0===r&&(r=50),void 0===n&&(n=new S.TheoPoint(.5,.5)),a=e.root){var i=a.bounds,l=I.Matrix2D.Identity;o.rescueToArbitraryBounds(e,i,l,t,r,n)}},rescueToArbitraryBounds:function(e,t,r,o,n,i){var l;if(void 0===i&&(i=new S.TheoPoint(.5,.5)),l=e.parent){var u=e.totalPlacement,s=e.bounds,c=o*Math.sqrt(Math.abs(r.determinant)),d=t.insetXY(c,c),g=s.maximumSpan(u);if(g<n){y.LegacyCoreAssert.isTrue(g>0,"forma's span is not positive",void 0,"DragFacade.rescueToArbitraryBounds","DragFacade.swift",264);var m=s.eval(i),f=u.transformPoint(m),p=I.Matrix2D.translation(f.multiply(-1)).concat(I.Matrix2D.uniformScaling(n/g).concat(I.Matrix2D.translation(f))),F=(v=l.totalPlacement).concat(p.concat(v.inverse));a.opt(e.controller,(function(e){return e.move(F)}))}if(u=e.totalPlacement,!b.TheoRect.PointInCommon(s,I._asterisk_Matrix2D_Matrix2D(u,r.inverse),t)){var v,C=b.TheoRect.JustTouch(s,u,d,r);F=(v=l.totalPlacement).concat(C.concat(v.inverse)),a.opt(e.controller,(function(e){return e.move(F)}))}}},getSwappableFormae:function(e){var t=a.first(e.dragDelegate.draggedFormae);a.opt(t,(function(e){return e.kind==C.ImageForma.KIND}))&&(t=a.opt(t,(function(e){return e.parent})));var r=e.dragDelegate.dragController,n=a.opt(a.opt(r,(function(e){return e.owner})),(function(e){return e.document})),i=[];return null==t||null==n||n.firstPage.root.visitAll(u.FormaTraversal.PreOrder,(function(e){o.isFormaSwappable(e,n)&&i.push(e)})),i},getSwapState:function(e,t,r,n,i){var l=o.getSwapTargetForma(e,t,r),u=n;(u||null!=l)&&(u=!0,null!=i&&a.opt(a.first(e.dragDelegate.draggedFormae),(function(e){return e.placement=i})));var s=e.drag.pointers[0].currentLocation,c=a.opt(a.opt(e.dragDelegate.dragController.owner,(function(e){return e.document})),(function(e){return e.firstPage.formaAtPoint(s)})),d=null!=c&&c.kind==T.RootForma.KIND;return null==l&&d&&(l=r,u=n),[u,l]},getSwapTargetForma:function(e,t,r){var n=e.drag;if(1!=e.dragDelegate.draggedFormae.length)return null;var i=a.first(e.dragDelegate.draggedFormae);a.opt(i,(function(e){return e.kind==C.ImageForma.KIND}))&&(i=a.opt(i,(function(e){return e.parent})));var l=e.dragDelegate.dragController,s=a.opt(a.opt(l,(function(e){return e.owner})),(function(e){return e.document}));if(1!=n.pointers.length||null==i||null==s)return null;if(!o.isFormaSwappable(i,s))return null;var c=n.pointers[0].currentLocation,d=s.firstPage.pageSize;if(c.x<0||c.x>d.width||c.y<0||c.y>d.height)return null;for(var g=null,m=a.iter(t);!m.done;m.next()){var f=m.value;if(f.finalFrame.containsPoint(c)&&o.inSwappableRegion(i,f,c,s)){g=f;break}}return null==r&&a.eq(u._equality_Forma_Forma,g,i)&&(g=null),g},isFormaSwappable:function(e,t){return!(e.kind==T.RootForma.KIND||e.kind==p.GroupForma.KIND||null!=e.controller&&e.controller.moveable||!e.isGridCell()||null==o.getGridForma(t)||(r=a.as(e,A.ShapeForma))&&null!=D.TheoDocumentUtils.getCellBackgroundImage(r));var r},getGridForma:function(e){var t=a.clone(e.firstPage.root.filterByControllerKind(m.GridController.KIND));return t.length>0?t[0]:null},inSwappableRegion:function(e,t,r,n){var a=o.getGridForma(n),i=0;if(null!=a&&(i=a.controller.spacing),null==e.finalFrame||null==t.finalFrame)return!1;var l=e.finalFrame.minY==t.finalFrame.maxY+i,u=e.finalFrame.maxY==t.finalFrame.minY-i,s=e.finalFrame.minX==t.finalFrame.maxX+i,c=e.finalFrame.maxX==t.finalFrame.minX-i,d=l&&s||l&&c||u&&s||u&&c,g=e.finalFrame.minY>=t.finalFrame.minY&&e.finalFrame.minY<=t.finalFrame.maxY||t.finalFrame.minY>=e.finalFrame.minY&&t.finalFrame.minY<=e.finalFrame.maxY||d,m=e.finalFrame.minX>=t.finalFrame.minX&&e.finalFrame.minX<=t.finalFrame.maxX||t.finalFrame.minX>=e.finalFrame.minX&&t.finalFrame.minX<=e.finalFrame.maxX||d,f=l&&g,p=u&&g,F=s&&m,v=c&&m;if(f||p||F||v){var C=t.finalFrame.minY,h=t.finalFrame.maxY,y=t.finalFrame.minX,I=t.finalFrame.maxX,k=h-C,T=I-y;return f&&(h-=.2*k),p&&(C+=.2*k),F&&(I-=.2*T),v&&(y+=.2*T),r.x>=y&&r.y>=C&&r.x<=I&&r.y<=h}return!0}}}),o)},x35w:function(e,t,r){var o,n=t,a=r("oAGj"),i=r("gXiO"),l=r("ascj"),u=r("FNB+"),s=r("9Lk3"),c=r("fNpk"),d=r("uxH+");n.GridFacade=(o=function(){i.CoreObject.call(this)},a.defineClass({name:"GridFacade",ctor:o,superName:"CoreObject",statics:{getPageGrid:function(e,t){var r=a.clone(e.root.filterByControllerKind(s.GridController.KIND));return r.length>0?a.as(r[0].controller,s.GridController):t?a.opt(a.as(e.root.controller,d.RootController),(function(e){return e.createGridControllerIfNone()})):null},createPaddedCollage:function(e){var t;return(t=o.getPageGrid(e,!0))?(t.setMarginAndSpacing(10,10),t.forma.root.style.colors.setColorId(l.ColorRole.FieldPrimary,"white"),t.forma):(c.LegacyCoreAssert.fail("couldn't get a grid controller",void 0,"GridFacade.createPaddedCollage","GridFacade.swift",45),null)},setPageGridParameters:function(e,t,r){var n;(n=o.getPageGrid(e,!0))?isNaN(t)||isNaN(r)?isNaN(t)?isNaN(r)||(n.margin=r):n.spacing=t:n.setMarginAndSpacing(t,r):c.LegacyCoreAssert.fail("couldn't get a grid controller",void 0,"GridFacade.setPageGridParameters","GridFacade.swift",67)},isChildSwappable:function(e){var t,r=a.clone(e.filterByControllerKind(s.GridController.KIND,u.FormaTraversal.NearestAncestor));return!!(t=a.as(a.opt(a.first(r),(function(e){return e.controller})),s.GridController))&&t.isChildSwappable(e)},swapChildren:function(e,t){var r,n=a.clone(e.filterByControllerKind(s.GridController.KIND,u.FormaTraversal.NearestAncestor));(r=a.as(a.opt(a.first(n),(function(e){return e.controller})),s.GridController))&&o.isChildSwappable(e)&&o.isChildSwappable(t)&&r.swapGridChildren(e,t)},setMoveableShift:function(e,t){e.moveableShift=t},getMoveableShift:function(e){return e.moveableShift},applyGridStyle:function(e,t,r){var n;(n=o.getPageGrid(r,!1))?n.applyStyle(e,t):c.LegacyCoreAssert.fail("couldn't get a grid controller",void 0,"GridFacade.applyGridStyle","GridFacade.swift",127)}}}),o)}}]);
//# sourceMappingURL=vendors_npm_spark_62e2d343-d9d5d5af.js.map