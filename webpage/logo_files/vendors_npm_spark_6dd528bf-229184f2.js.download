(window.webpackJsonptheoWebApp=window.webpackJsonptheoWebApp||[]).push([[30],{"06HC":function(t,e,o){var n,i=e,r=o("oAGj"),a=o("ascj"),l=o("JgVS"),s=o("cEEQ"),u=o("c+uM"),h=o("tGKA");i.ShadowDecorationStrategy=(n=function(){l.BaseDecorationStrategy.call(this)},r.defineClass({name:"ShadowDecorationStrategy",ctor:n,superName:"BaseDecorationStrategy",statics:{_implements:function(t){return"LockupDecorationStrategy"==t}},props:{rotatePoint:function(t,e,o){var n=o*Math.PI/180;return{x:Math.cos(n)*(t.x-e.x)-Math.sin(n)*(t.y-e.y)+e.x,y:Math.sin(n)*(t.x-e.x)+Math.cos(n)*(t.y-e.y)+e.y}},supportsConfiguration:function(t){return!1},decorate:function(t,e){for(var o=[],n=e.avgTextPointSize,i=t.style.shadowAngle,c=n/16*t.style.shadowOffset+.02*n,p=this.rotatePoint({x:0,y:-c},{x:0,y:0},i),g=r.iter(r.range(0,e.items.length,!1));!g.done;g.next()){var d=g.value,f=e.items[d];if(f.type==s.LockupItemType.Text){var y,m,k=t.style.textLook;if(null!=(y=f.characterStyle)&&(m=t.style.characterStyles[y])&&(k=m.textLook==u.LockupTextLook.UNSET?k:m.textLook),u.LockupStyle.isShadowLook(k)){c=k==u.LockupTextLook.KnockoutAndShadow||k==u.LockupTextLook.KnockoutShadowOutline?.08*f.pointSize*(1.7*t.style.shadowOffset+.25)/2:k==u.LockupTextLook.ShadowAndOutline?n/8*t.style.shadowOffset+.02*n:n/16*t.style.shadowOffset+.02*n,p=this.rotatePoint({x:0,y:-c},{x:0,y:0},i);var L=f.placement;(f=f.clone()).colorRole=a.ColorRole.Shadow,f.placement=new h.Matrix2D(L.a,L.b,L.c,L.d,L.tx+p.x,L.ty+p.y),o.push(f)}}}return new l.DecorationResults(o)}}}),n)},"3UhB":function(t,e,o){var n,i=e,r=o("oAGj"),a=o("6h7+"),l=o("kYI4"),s=o("gXiO"),u=o("ascj"),h=o("FNB+"),c=o("QgZx"),p=o("6Rk9"),g=o("53P9"),d=o("iCxV"),f=o("8vXU"),y=o("rxGp"),m=o("fNpk"),k=o("c+uM"),L=o("KdeS"),S=o("mGL3"),v=o("enh0"),T=o("VJ9E"),C=o("8t9B"),F=o("uUew"),x=o("sIWg");i.TypeLockupUtils=(n=function(){s.CoreObject.call(this)},r.defineClass({name:"TypeLockupUtils",ctor:n,superName:"CoreObject",statics:{replaceFontsInDocument:function(t,e){var o=d.Host.textModelUtils.defaultFont(),i=n.createTheoFont(o,null);t.firstPage.root.visitAll(h.FormaTraversal.PreOrder,(function(t){if(t.style instanceof k.LockupStyle){var o,n=!1,a=t.style,l=r.opt(a.font,(function(t){return t.fontData.postScriptName}));null!=l&&e.includes(l)&&(a.font=i,n=!0);for(var s=r.iter(a.characterStyles);!s.done;s.next()){var u=s.value;if(null!=u.font){var h=r.opt(u.font,(function(t){return t.fontData.postScriptName}));null!=h&&e.includes(h)&&(u.font=i,n=!0)}}n&&(o=r.as(t.controller,C.TypeLockupController))&&o.styleChanged()}}))},fontsInDocument:function(t){var e=new S.OrderedFontSet;return t.firstPage.root.visitAll(h.FormaTraversal.PreOrder,(function(t){var o;(o=r.as(t,v.TextForma))&&e.append(o.fontDescriptor)})),e},sizesInDocument:function(t,e,o){void 0===e&&(e=null),void 0===o&&(o=!1);var n=[];return t.firstPage.root.visitAll(h.FormaTraversal.PreOrder,(function(t){var i;if((i=r.as(t,v.TextForma))&&i.lockupForma!=e&&!(o&&i.rowIndex>0)){var a=i.fontSize*i.lockupForma.placement.extractedScale.scale.x;n.includes(a)||n.push(a)}})),r.sortInPlace(n),n},applyFontToController:function(t,e){var o=this,n=t.fontData;n.availability==c.FontAvailability.LOADED?(a.BadgeFacade.logFontChange(r.opt(e.styleController.forma,(function(t){return t.source})),t.fontData.postScriptName),e.styleController.targetedLockupStyle.font=t,null!=t.sparkElementID?l.BrandingFacade.brandDocumentForElement(e.forma.page.document,t.sparkElementID,l.AUTHORING_CONTEXT_TYPE_FONT):l.BrandingFacade.unBrandDocumentIfNoBrandedElements(e.forma.page.document),e.styleController.targetedLockupStyle!==e.styleController.forma.style&&(t.isEqual(e.styleController.forma.style.font)&&(e.styleController.targetedLockupStyle.font=null),e.styleChanged())):n.availability==c.FontAvailability.LOADABLE&&d.Host.fontProvider.loadFont(n,(function(){return o.applyFontToController(t,e)}),(function(){return d.Host.logging.logForCategory(y.LogCategories.kFont,"applyFontToController, Failed to load font",f.LogLevelEnum.WARN_LEVEL)}))},createTheoFont:function(t,e){if(null!=e)for(var o=r.iter(e.fonts);!o.done;o.next()){var n=o.value;if(null!=n.descriptor&&n.descriptor.isEqual(t))return T.TheoFont.init_a314(n)}return T.TheoFont.init_9e5c(t)},getFontDescriptorFromPostScriptName:function(t,e){var o,n;return(o=r.opt(d.Host.fontProvider,(function(e){return e.getIncludedFonts(t.page.document)})))&&null!=(n=o.getIndexOfPostScriptName(e))?o.fontAt(n):null},calculateFontRole:function(t,e){var o,i,a=null;if(null!=t){var l=n.createTheoFont(t,e);a=l.getSparkFontRole(),r.isEmpty((o=a)||null!=o?o:"")&&l.hasSparkFontRole("custom")&&(a="custom")}return r.isEmpty((i=a)||null!=i?i:"")?"":a},calculateFaceWithHighestRole:function(t,e){for(var o=["headline-font","body-font","body-font-italic","body-font-bold","body-font-bold-italic","secondary-font","custom"],i=null,a="",l=r.iter(t);!l.done;l.next()){var s=l.value,u=n.calculateFontRole(s,e);if(0==r.isEmpty(u)){var h=r.indexOf(o,u);null!=h&&(r.isEmpty(a)||h<r.indexOf(o,a))&&(a=u,i=s)}}return i},isLTRCharacter:function(t){return t>="A"&&t<="Z"||t>="a"&&t<="z"||t>="À"&&t<="Ö"||t>="Ø"&&t<="ö"||t>="ø"&&t<="ʻ"||t>="̀"&&t<="֐"||t>="ࠀ"&&t<="῿"||t>="Ⰰ"&&t<="﬜"||t>="﷾"&&t<="﹯"||t>="﻽"&&t<="￿"},isRTLCharacter:function(t){return t>="֑"&&t<="߿"||t>="יִ"&&t<="﷽"||t>="ﹰ"&&t<="ﻼ"},isTextRightToLeft:function(t){for(var e=0,o=0,i=r.iter(r.chars(t));!i.done;i.next()){var a=i.value;n.isLTRCharacter(a)?e+=1:n.isRTLCharacter(a)&&(o+=1)}return o>0&&o>e},canBreakAnywhere:function(t){return t>="ぁ"&&t<="ヿ"||t>="㐀"&&t<="䶵"||t>="一"&&t<="龥"},isWhiteSpace:function(t){for(var e=r.iter(r.chars(t));!e.done;e.next()){var o=e.value;if(!n.isWhiteSpace(o))return!1}return!0},isWhiteSpace:function(t){return t>="\t"&&t<="\r"||" "==t||""==t||" "==t||" "==t||t>=" "&&t<="​"||"\u2028"==t||"\u2029"==t||" "==t||" "==t||"　"==t},iskinsokuBefore:function(t){return"!"==t||")"==t||"."==t||":"==t||";"==t||"?"==t||"’"==t||"”"==t||"、"==t||"。"==t||"々"==t||"〉"==t||"》"==t||"」"==t||"』"==t||"】"==t||"〕"==t||"ゝ"==t||"ゞ"==t||"・"==t||"ヽ"==t||"ヾ"==t||"！"==t||"）"==t||"，"==t||"．"==t||"："==t||"？"==t||"］"==t||"｝"==t},iskinsokuAfter:function(t){return"("==t||"["==t||"{"==t||"£"==t||"§"==t||"‘"==t||"“"==t||"〈"==t||"《"==t||"「"==t||"『"==t||"【"==t||"〒"==t||"〔"==t||"〝"==t||"（"==t},lineBreaks:function(t,e,o){for(var i=0,a=0,l=!1,s=!0,u=r.iter(r.chars(t));!u.done;u.next()){var h=u.value;n.iskinsokuBefore(h)?s=!0:n.iskinsokuAfter(h)?(i!=a&&s&&(e.push(new F.TextRange(i,a)),i=a),l=h.charCodeAt(0)>=12288,s=!1):n.canBreakAnywhere(h)?(i!=a&&s&&(e.push(new F.TextRange(i,a)),i=a),l=!0,s=!0):n.isWhiteSpace(h)?(i!=a&&e.push(new F.TextRange(i,a)),"\n"==h&&o&&e.push(new F.TextRange(a,a+1)),i=a+1,l=!1,s=!0):l&&s?(i!=a&&(e.push(new F.TextRange(i,a)),i=a),l=!1,s=!0):(l=!1,s=!0),a+=1,h.charCodeAt(0)>65535&&(a+=1)}i!=a&&e.push(new F.TextRange(i,a))},getBreakRanges:function(t){var e=[];return n.lineBreaks(t,e,!0),e},getWordRanges:function(t,e){var o=[];if(n.lineBreaks(t,o,!1),F.TextRange.makeRangesContiguous(o),1==o.length){o.splice(0);for(var i=0,a=-1,l=-1,s=-1,u=0,h=!0,c=r.clone(g.GraphemeUtils.splitGraphemes(t)),p=r.iter(c);!p.done;p.next()){var d=p.value,f=d.toLowerCase()!=d;f&&!h&&(o.push(new F.TextRange(u,i)),u=i),h=f,i+=1,"."==d?(o.push(new F.TextRange(u,i)),u=i,-1==a&&(a=i),l=i,s=o.length-1,h=!0):"/"==d&&(o.push(new F.TextRange(u,i-1)),o.push(new F.TextRange(i-1,i)),u=i)}o.push(new F.TextRange(u,c.length)),((e==C.HighlightMethod.Bracket||e==C.HighlightMethod.InsideBracket)&&-1!=a&&-1!=l||-1!=a&&a==l)&&(o[s]=new F.TextRange(o[s].start,l-1),o[s+1]=new F.TextRange(l-1,o[s+1].end))}return o},computeLockupMeasurements:function(t,e,o,i,a,l,s,u,h,c){void 0===h&&(h=1),void 0===c&&(c=!1);for(var p=e,f=32*o,y=32*p.spaceWidthRatio/f,m=a,k=c,S=i?t.toUpperCase():t,v=n.isTextRightToLeft(S),T=n.getBreakRanges(S),R=[],w=null!=u[C.TypeLockupController.HIGHLIGHT_STYLE]&&null!=u[C.TypeLockupController.HIGHLIGHT_STYLE].font,A=r.iter(T);!A.done;A.next()){var _=A.value,M=_,I="",D=!1;m=a,k=c;for(var B=r.iter(s);!B.done;B.next()){var b=B.value;(_.start>=b.start&&_.start<b.end||_.start<=b.start&&_.end>=b.start)&&((b.end<_.end||b.start>_.start)&&(m=!0,k=!0),I=C.TypeLockupController.HIGHLIGHT_STYLE),_.end!=b.end&&_.end!=b.end-1&&_.end!=b.start&&_.end!=b.start-1||(D=!0)}var H=32;p=""!=I&&null!=u[I]&&null!=u[I].font?u[I].font.fontData:e,""!=I&&null!=u[I]&&(H=32*h);var P=t.substr(_.start,_.length);v&&"\n"!=P&&(P="‫"+P);var E=i?P.toUpperCase():P;if(_.end<t.length)for(var O=t.substr(_.end),z=0,G=r.iter(r.chars(O));!G.done;G.next()){var N=G.value;if(!n.isWhiteSpace(N)&&"\n"!=N){0==z&&(y=0);break}if((w||1!=h)&&D){var U=32*h*(r.opt(u[C.TypeLockupController.HIGHLIGHT_STYLE].font,(function(t){return t.fontData}))||e).spaceWidthRatio/f;y=(32*e.spaceWidthRatio/f+U)/2}else y=H*p.spaceWidthRatio/f;z+=1,M=new F.TextRange(_.start,_.end+z)}else y=H*p.spaceWidthRatio/f;if(m&&!v){var Y=0,W=H*l/f,V=r.clone(d.Host.textModelUtils.getGlyphPositions(E,e,32,!k)),K=r.opt(r.opt(u[C.TypeLockupController.HIGHLIGHT_STYLE],(function(t){return t.font})),(function(t){return t.fontData}))||e,X=null;null!=u[C.TypeLockupController.HIGHLIGHT_STYLE]&&(X=r.clone(d.Host.textModelUtils.getGlyphPositions(E,K,32*h,!k)));for(var Q=r.clone(V),j=r.clone(g.GraphemeUtils.splitGraphemes(E)),q=r.iter(j);!q.done;q.next()){var Z=q.value,J=new F.TextRange(Y+_.start,Y+_.start+1);I="";for(var $=r.iter(s);!$.done;$.next())b=$.value,J.start>=b.start&&J.start<b.end&&(I=C.TypeLockupController.HIGHLIGHT_STYLE);""!=I&&null!=u[I]?(H=32*h,Q=r.clone(X)):(H=32,Q=r.clone(V)),""!=I&&null!=u[I]&&null!=u[I].font?p.isEqual(K)||(p=K):p.isEqual(e)||(p=e);var tt=d.Host.textModelUtils.measureBoundsForLayout(Z,p,H,0),et=(U=(Q[Y+1]-Q[Y]-tt.width)/f+W,!1);Y==j.length-1&&(U=y,W>0&&(U+=2*W),et=!0);var ot=""!=I&&null!=u[I]&&-1!=u[I].spacing&&0!=u[I].spacing?h:1,nt=new L.LockupWordInfo(Z,tt.width/f,U,I,ot,P.includes("\n"),et,J);R.push(nt),Y+=1}}else{var it=d.Host.textModelUtils.measureBoundsForLayout(E,p,H,l);0!=l&&(it=new x.TheoRect(it.minX,it.minY,it.maxX-0,it.maxY),W=H*l/f,0==y?y=W:l>0&&(y+=2*W));var rt=""!=I&&null!=u[I]&&-1!=u[I].spacing&&0!=u[I].spacing?h:1;if(nt=new L.LockupWordInfo(P,it.width/f,y,I,rt,P.includes("\n"),!0,M),""!=I&&null!=u[I]&&-1!=u[I].spacing&&0!=u[I].spacing&&u[I].lineBreakAtCharacterStyleSizeChange&&r.opt(r.last(R),(function(t){return""==t.characterStyle}))&&!P.includes("\n")){var at=new L.LockupWordInfo("\n",0,0,I,rt,!0,!0,new F.TextRange(_.start,_.start));R.push(at)}if(R.push(nt),""!=I&&null!=u[I]&&-1!=u[I].spacing&&0!=u[I].spacing&&u[I].lineBreakAtCharacterStyleSizeChange&&D&&!P.includes("\n")){var lt=new L.LockupWordInfo("\n",0,0,I,rt,!0,!0,new F.TextRange(_.end,_.end));R.push(lt)}}}return R},getLockupStringsForRoot:function(t){var e=[];return t.visitAll(h.FormaTraversal.PreOrder,(function(t){var o=r.as(t.controller,C.TypeLockupController);null!=o&&e.push(o.text)})),e},getFullCanvasLockups:function(t){var e=[];return t.visitAll(h.FormaTraversal.PreOrder,(function(t){if(t.style instanceof k.LockupStyle&&t.style.backing==k.LockupBacking.Knockout){var o=r.as(t.controller,C.TypeLockupController);null!=o&&e.push(o)}})),e},getNewCharSelectionRange:function(t,e,o){for(var n=e,i=t,a=new F.TextRange(0,0),l=r.iter(o);!l.done;l.next()){var s=l.value;t.start>=s.start&&t.end<=s.end&&(i=s),e.start>=s.start&&e.end<=s.end&&(a=s)}if(i.start==a.start&&i.end==a.end){if(e.end<=t.start&&0!=a.length)return new F.TextRange(a.start,e.end);if(e.end<=a.end&&t.end<=e.start)return new F.TextRange(e.start,a.end);if(e.start==t.start&&e.end==t.end)return new F.TextRange(a.start,a.end)}return i.start<e.start?n=new F.TextRange(i.start,e.end):i.end>e.end&&(n=new F.TextRange(e.start,i.end)),n},rangesAreEqual:function(t,e){if(t.length!=e.length)return!1;for(var o=r.iter(r.toSequence(t));!o.done;o.next()){var n=o.value,i=n.offset,a=n.element;if(a.start!=e[i].start||a.end!=e[i].end)return!1}return!0},adjustRanges:function(t,e,o){for(var i=0,a=!1,l=r.clone(t),s=r.iter(r.toSequence(t));!s.done;s.next()){var u=s.value,h=u.offset,c=u.element;e.start>=c.start&&e.start<c.end?(i=o-e.length,a=!0,c.end+i<c.start||e.end>c.end?l[h]=new F.TextRange(c.start,c.start):l[h]=new F.TextRange(c.start,c.end+i)):e.start<c.start&&e.end>c.start?(e.end<c.end?l[h]=new F.TextRange(e.start+o,c.end-e.end+e.start+o):l[h]=new F.TextRange(c.start,c.start),a||(i=o-e.length,a=!0)):0!=i&&(l[h]=new F.TextRange(c.start+i,c.end+i)),!a&&e.end<=c.start&&(i=o-e.length,a=!0,l[h]=new F.TextRange(c.start+i,c.end+i))}return a?n.cleanupAndMerge(l):l},cleanupAndMerge:function(t){for(var e=[],o=r.iter(r.toSequence(t));!o.done;o.next()){var n=o.value,i=n.offset,a=n.element;if(0!=a.length){m.LegacyCoreAssert.isTrue(a.start<a.end,"cleanupAndMerge - bad range",void 0,"TypeLockupUtils.cleanupAndMerge","TypeLockupUtils.swift",815);var l=e.length-1;if(e.length>0&&a.start<=e[l].end){var s=Math.max(a.end,e[l].end);e[l]=new F.TextRange(e[l].start,s)}else e.push(t[i])}}return e},invertRanges:function(t,e){for(var o=[],n=0,i=r.iter(t);!i.done;i.next()){var a=i.value;if(0!=a.start&&o.push(new F.TextRange(n,a.start)),(n=a.end)>e){m.LegacyCoreAssert.fail("invertRanges range beyond maxRangeEnd.",{start:a.start,end:a.end,max:e},"TypeLockupUtils.invertRanges","TypeLockupUtils.swift",838);break}}return n<e&&o.push(new F.TextRange(n,e)),o},getCharFontAdjust:function(t,e,o){void 0===o&&(o=!0);var n=1,i=C.TypeLockupController.HIGHLIGHT_STYLE,a=t.font.fontData,l=r.opt(r.opt(t.characterStyles[i],(function(t){return t.font})),(function(t){return t.fontData}));return null!=t.characterStyles[i]&&-1!=t.characterStyles[i].spacing&&0!=t.characterStyles[i].spacing?(n=t.characterStyles[i].spacing,o&&n>1&&(n=1/n)):null!=l&&(n=e||a.capRatio==a.meanRatio||l.capRatio==l.meanRatio?a.capRatio/l.capRatio:a.meanRatio/l.meanRatio),n},getCharFontYAdjust:function(t,e,o){var n=0,i=C.TypeLockupController.HIGHLIGHT_STYLE;if(null==t.characterStyles[i])return m.LegacyCoreAssert.isTrue(e==o,"getCharFontYAdjust - charFontSize should match fontSize if no character style!",void 0,"TypeLockupUtils.getCharFontYAdjust","TypeLockupUtils.swift",882),n;var a=t.font.fontData,l=r.opt(r.opt(t.characterStyles[i],(function(t){return t.font})),(function(t){return t.fontData}));return null!=l?(n=e*a.capRatio-e*a.baselineOffsetRatio-(o*l.capRatio-o*l.baselineOffsetRatio),t.characterStyles[i].alignment==k.LockupAlignment.Center?n-=(a.capRatio*e-l.capRatio*o)/2:t.characterStyles[i].alignment==k.LockupAlignment.Right&&(n-=a.capRatio*e-l.capRatio*o)):e!=o&&(n=e*a.capRatio-e*a.baselineOffsetRatio-(o*a.capRatio-o*a.baselineOffsetRatio),t.characterStyles[i].alignment==k.LockupAlignment.Center?n-=(a.capRatio*e-a.capRatio*o)/2:t.characterStyles[i].alignment==k.LockupAlignment.Right&&(n-=a.capRatio*e-a.capRatio*o)),n},sortTextFormae:function(t){var e,o=r.clone(t);return r.sortInPlace(o,(function(t,o){if(t.lockupForma==o.lockupForma)return t.rangeInLockup.start<o.rangeInLockup.start;var n,i,a,l,s,u,h,c;if((n=t.lockupForma)&&(i=o.lockupForma)&&(a=n.finalFrame)&&(l=i.finalFrame)&&(s=n.parent)&&null!=(u=s.indexOfChild(n))&&(h=i.parent)&&null!=(c=h.indexOfChild(i))){if(n!=i&&p.GeometryFacade.formaBoundsIntersect(n,i))return u<c;var g=.5*((e=r.opt(r.as(n.controller,C.TypeLockupController),(function(t){return t.averageLineHeight})))||null!=e?e:0);return a.minY-l.minY<-g||!(a.minY-l.minY>g)&&a.minX<l.minX}return!1})),o},formaForSameTextRun:function(t,e){return t.lockupForma==e.lockupForma&&t.rangeInLockup.start==e.rangeInLockup.start&&t.text==e.text},padTextFormaeForLetterAnimation:function(t,e){for(var o=[],i=!1,a=r.iter(r.toSequence(t));!a.done;a.next()){var l=a.value,s=l.offset,u=l.element;if(i)i=!1;else{var h,c=u.text.length+1==u.rangeInLockup.length,p=e&&c?1:0,g=u.text.length+p;if((h=r.as(r.opt(u.lockupForma,(function(t){return t.style})),k.LockupStyle))&&k.LockupStyle.isDuplicateFormaLook(h.textLook)&&s+1<t.length){var d=t[s+1];if(n.formaForSameTextRun(u,d)){for(var f=r.iter(r.range(0,g,!0));!f.done;f.next())o.push(u),o.push(d);i=!0;continue}}i=!1;for(var y=r.iter(r.range(0,g,!0));!y.done;y.next())o.push(u)}}return o},leftSingleQuote:"‘",rightSingleQuote:"’",leftDoubleQuote:"“",rightDoubleQuote:"”",doubleStraightQuote:'"',singleStraightQuote:"'",isSingleCurlyQuote:function(t){return t==n.leftSingleQuote||t==n.rightSingleQuote},isDoubleCurlyQuote:function(t){return t==n.leftDoubleQuote||t==n.rightDoubleQuote},isCurlyQuote:function(t){return n.isSingleCurlyQuote(t)||n.isDoubleCurlyQuote(t)},isStraightQuote:function(t){return t==n.doubleStraightQuote||t==n.singleStraightQuote},isInteger:function(t){return t>="0"&&t<="9"},isLetter:function(t){return t>="a"&&t<="z"||t>="A"&&t<="Z"},getLeftCurlyQuoteForStraightQuote:function(t){return t==n.singleStraightQuote?n.leftSingleQuote:n.leftDoubleQuote},getRightCurlyQuoteForStraightQuote:function(t){return t==n.singleStraightQuote?n.rightSingleQuote:n.rightDoubleQuote},fixUpQuotes:function(t,e){if(t.length==e.length){for(var o=r.iter(r.toCharSequence(t));!o.done;o.next()){var i=o.value.element;if(n.isCurlyQuote(i))return t}for(var a=r.iter(r.toCharSequence(e));!a.done;a.next()){var l=a.value.element;if(n.isCurlyQuote(l))return t}}for(var s=r.chars(t),u=!1,h=0,c=r.iter(r.toCharSequence(t));!c.done;c.next()){var p=c.value,g=p.offset,d=p.element,f=" ",y=" ",m=" ",k=" ";if(g-1>=0&&(f=s[g-1]),g+1<s.length&&(y=s[g+1]),g+2<s.length&&(m=s[g+2]),g+3<s.length&&(k=s[g+3]),n.isStraightQuote(d)){if(d==n.singleStraightQuote){if(("s"==y||"S"==y)&&" "==m){s[g]=n.rightSingleQuote;continue}if("s"!=f&&"S"!=f||" "!=y||(s[g]=n.rightSingleQuote),n.isLetter(f)&&n.isLetter(y)&&(" "==m||" "==k)){s[g]=n.rightSingleQuote;continue}if(" "==f&&n.isInteger(y)&&n.isInteger(m)&&" "==k){s[g]=n.leftSingleQuote;continue}}if(!u&&n.isInteger(f))continue;if(!u&&" "==f){u=!0,h=g;continue}if(u&&" "==y){d==s[h]&&(u=!1,s[h]=n.getLeftCurlyQuoteForStraightQuote(s[h]),s[g]=n.getRightCurlyQuoteForStraightQuote(d));continue}}}return s.join("")},fixUpColors:function(t,e){var o;void 0===e&&(e=null);var i=t.colors.colorID(u.ColorRole.FieldPrimary),r=(o=e)||null!=o?o:t.colors.colorID(u.ColorRole.FieldSecondary),a=t.colors.colorID(u.ColorRole.Border),l=t.colors.colorID(u.ColorRole.Shadow);if(null==a||null==l){null==a&&(a=n.getColorIDForBorder(t.textLook,i,r)),null==l&&(l=n.getColorIDForShadow(t.textLook,i,r));var s=t.textLook;k.LockupStyle.isKnockoutLook(s)&&s!=k.LockupTextLook.KnockoutOnly?(a==r&&(a=i),s==k.LockupTextLook.KnockoutAndShadow&&l==r&&(l=i)):k.LockupStyle.isOutlineLook(s)&&s!=k.LockupTextLook.OutlineOnly&&(a==i&&(a=r),l==i&&(l=r))}t.colors.setColorIDs([{key:u.ColorRole.FieldSecondary,value:r},{key:u.ColorRole.Border,value:a},{key:u.ColorRole.Shadow,value:l}],!1)},getColorIDForBorder:function(t,e,o){return t==k.LockupTextLook.KnockoutAndOutline||t==k.LockupTextLook.KnockoutAndShadow?e:o},getColorIDForShadow:function(t,e,o){return t==k.LockupTextLook.KnockoutAndShadow?e:o}}}),n)},"8t9B":function(t,e,o){var n,i,r,a,l=e,s=o("oAGj"),u=o("0wFF"),h=o("cZuM"),c=o("XupS"),p=o("8/a0"),g=o("kYI4"),d=o("SpAV"),f=o("CWW7"),y=o("9WSY"),m=o("yGNn"),k=o("AVHO"),L=o("ascj"),S=o("R0Y+"),v=o("JEnV"),T=o("UB0O"),C=o("FNB+"),F=o("6ZWm"),x=o("waL6"),R=o("yHU1"),w=o("QgZx"),A=o("Pil/"),_=o("cmoc"),M=o("16hp"),I=o("QbzR"),D=o("P83h"),B=o("9Lk3"),b=o("ZK0l"),H=o("pnSN"),P=o("X0GW"),E=o("53P9"),O=o("iCxV"),z=o("fdtz"),G=o("VDg0"),N=o("fNpk"),U=o("PXlJ"),Y=o("d3iY"),W=o("cEEQ"),V=o("c+uM"),K=o("TkOd"),X=o("tGKA"),Q=o("3DEm"),j=o("EDIN"),q=o("X1F6"),Z=o("Cj3Q"),J=o("K0Rh"),$=o("Zifs"),tt=o("06HC"),et=o("djAF"),ot=o("35Q0"),nt=o("n/CE"),it=o("JKVa"),rt=o("byfQ"),at=o("EoOi"),lt=o("lJxM"),st=o("9YN4"),ut=o("enh0"),ht=o("Vm85"),ct=o("VJ9E"),pt=o("3UhB"),gt=o("x4Gy"),dt=o("mL0c"),ft=o("hgLm"),yt=o("oKlP"),mt=o("uUew"),kt=o("sIWg"),Lt=o("1NAc");l.CharStyleApplyMode=s.defineEnum("CharStyleApplyMode",{SwipeApply:0,Apply:1,Remove:2,Toggle:3}),l.HighlightMethod=s.defineEnum("HighlightMethod",{Manual:0,EvenRows:1,OddRows:2,EvenWords:3,OddWords:4,First:5,Last:6,Bracket:7,InsideBracket:8,Numbers:100,Nouns:101,Verbs:102,Names:103,Adjectives:104,SmallWords:105}),l.ControllerDBListener=(n=function(t,e){this.transactions_=[],this.controller_=e,t.addListener(this)},s.defineClass({name:"ControllerDBListener",ctor:n,statics:{_implements:function(t){return"IDatabaseListener"==t}},props:{onBeginTransaction:function(t,e){this.transactions_.push(e),1==this.transactions_.length&&s.opt(this.controller_,(function(t){return t.shrinkPools=!1}))},onEndTransaction:function(t,e){e===s.last(this.transactions_)&&this.transactions_.pop()},onObjectStateChanged:function(t,e){},onStateChanged:function(t,e){s.opt(this.controller_,(function(t){return t.updateFormaPools()}))}}}),n),l.LockupFormaPool=(i=function(t,e){this.stringsToFormae_={},this.shapeFormae_=[],this.shrinkPools_=!0,this.page_=t,this.createModelFormae_=e},s.defineClass({name:"LockupFormaPool",ctor:i,props:{createForma:function(t){var e=this.page_;return null==e?null:this.createModelFormae_?e.createModelForma(t):e.createForma(t)},clear:function(){this.stringsToFormae_={},this.shapeFormae_=[]},addForma:function(t){var e,o;if(e=s.as(t,et.ShapeForma))this.shapeFormae_.push(e);else if(o=s.as(t,ut.TextForma)){var n=o.text.toUpperCase();null==this.stringsToFormae_[n]&&(this.stringsToFormae_[n]=[]),this.stringsToFormae_[n].push(o)}},configureTextFormae:function(t){var e,o=this,n=[],i=[],r=[];if(s.each(this.stringsToFormae_,(function(a,l){var u=(e=t[a])||null!=e?e:0,h=l.length;if(0==u)s.append(n,l),r.push(a);else if(u<h){var c=h-u,p=l.slice(u,h);o.shrinkPools_&&l.splice(u,c),s.append(n,p)}else for(var g=u-h,d=s.iter(s.range(0,g,!1));!d.done;d.next())i.push(a)})),this.shrinkPools_)for(var a=s.iter(r);!a.done;a.next()){var l=a.value;s.removeKey(this.stringsToFormae_,l)}s.each(t,(function(t,e){if(null==o.stringsToFormae_[t]){o.stringsToFormae_[t]=[];for(var n=e,r=s.iter(s.range(0,n,!1));!r.done;r.next())i.push(t)}}));for(var u=s.iter(i);!u.done;u.next()){l=u.value;var h=this.createForma(ut.TextForma.KIND);this.stringsToFormae_[s.as(l,"String")].push(h)}return n},configureShapeFormae:function(t){var e=[],o=this.shapeFormae_.length;if(o>t){var n=o-t,i=this.shapeFormae_.slice(t,o);this.shrinkPools_&&this.shapeFormae_.splice(t,n),s.append(e,i)}else if(o<t){var r=t-o;if(r>0)for(var a=s.iter(s.range(1,r,!0));!a.done;a.next()){var l=s.as(this.createForma(et.ShapeForma.KIND),et.ShapeForma);null!=l&&this.shapeFormae_.push(l)}}return e},nthTextFormaForString:function(t,e){var o=s.opt(this.stringsToFormae_[e],(function(e){return e[t]}));return null==o?null:o},textFormaCount:function(){return s.keys(this.stringsToFormae_).length},nthShapeForma:function(t){var e=t<this.shapeFormae_.length?this.shapeFormae_[t]:null;return null==e?null:e},shapeFormaCount:function(){return this.shapeFormae_.length}}}),i),l.TypeLockupController=(r=function t(e,o,n){var i;this.changeSubscriptions_=[],this.settings_=null,this.tagsToFormae_={},this.isRightToLeft=!1,this.initialCharStyleRanges_=[],this.fitContainerToArea=!1,this.bannerRatio_=t.DEFAULT_BANNER_RATIO,this.forceLetterFormaMode=!1,this.currentColors={1:$.SolidColor.WHITE,2:$.SolidColor.BLACK,3:$.SolidColor.BLACK,4:$.SolidColor.BLACK},this.cachedPin_=null,this.shouldCachePin_=!1,this.startSize_=null,this.passedARThreshold_=!1,this.resizePin_=null,this.preferredFontSize_=null,this.expansionSize_=null,this.lockLineBreaks_=!1,this.allowFewerLineBreaks_=!1,this.missingFontCount_=0,this.validDecode_=null,this.versionDecoded_=0,this.layoutStrategy_=null,this.decorationStrategy_=null,this.renderedConfiguration_=null,this.renderedColorLibrary_=null,this.renderedLayoutResults_=null,this.renderedDecorationResults_=null,this.updateQueued_=!1,this.thresholdGroupWidth=0,this.thresholdGroupHeight=0,this.hasFirstUpdateRun=!1,this.formaUpdateEvents_=[],this.sgID=o.formaID,this.layoutFormaePool_=new l.LockupFormaPool(o.page,o.isModel),this.decorationFormaePool_=new l.LockupFormaPool(o.page,o.isModel),this.styleController_=new K.LockupStyleController(o),this.missingFontCount_=0,b.GroupController.call(this,e,o,n),(i=this.lockupStyle)&&this.updateCurrentColors(i),o.persisted&&(this.dbListener=new l.ControllerDBListener(o.database,this))},a={},s.defineClass({name:"TypeLockupController",ctor:r,superName:"GroupController",statics:{KIND:{get:function(){return"type-lockup"}},PROPERTY_SIZE_DEPRECATED:"size",PROPERTY_LOCKUPSTYLE_DEPRECATED:"lockup-style",PROPERTY_CONTENT_ID:"content-id",PROPERTY_WRAPPER_ID:"wrapper-id",PROPERTY_HIGHLIGHTMETHOD_ID:"highlightMethod",PROPERTY_CHARSTYLERANGES:"charstyle-ranges",PROPERTY_AUTOTEXTRANGES:"weighted-ranges",MIN_LINE_HEIGHT:{get:function(){return 20}},DEFAULT_BANNER_RATIO:{get:function(){return 1.5}},HIGHLIGHT_STYLE:"Highlight",FIRST_AUTO_METHOD:{get:function(){return void 0===a.FIRST_AUTO_METHOD&&(a.FIRST_AUTO_METHOD=l.HighlightMethod.EvenRows),a.FIRST_AUTO_METHOD}},MAX_AUTO_METHOD:{get:function(){return void 0===a.MAX_AUTO_METHOD&&(a.MAX_AUTO_METHOD=l.HighlightMethod.InsideBracket),a.MAX_AUTO_METHOD}},FIRST_NLP_METHOD:{get:function(){return void 0===a.FIRST_NLP_METHOD&&(a.FIRST_NLP_METHOD=l.HighlightMethod.Numbers),a.FIRST_NLP_METHOD}},MAX_NLP_METHOD:{get:function(){return void 0===a.MAX_NLP_METHOD&&(a.MAX_NLP_METHOD=l.HighlightMethod.SmallWords),a.MAX_NLP_METHOD}},NUM_HIGHLIGHTMETHODS:14,DelayBetweenUpdates:{get:function(){return 16}},rangesEqual:function(t,e){if(t.length==e.length){for(var o=s.iter(s.range(0,t.length,!1));!o.done;o.next()){var n=o.value;if(t[n].start!=e[n].start||t[n].end!=e[n].end)return!1}return!0}return!1}},props:{contentID_:{get:function(){return s.as(this.controllerMetadata.get(r.PROPERTY_CONTENT_ID),"String")},set:function(t){this.controllerMetadata.set(r.PROPERTY_CONTENT_ID,t)}},wrappingGroupID_:{get:function(){return s.as(this.controllerMetadata.get(r.PROPERTY_WRAPPER_ID),"String")},set:function(t){this.controllerMetadata.set(r.PROPERTY_WRAPPER_ID,t)}},highlightMethod:{get:function(){var t,e;return(t=l.HighlightMethod.toCaseValue((e=s.as(this.controllerMetadata.get(r.PROPERTY_HIGHLIGHTMETHOD_ID),"Int"))||null!=e?e:0))||null!=t?t:l.HighlightMethod.Manual},set:function(t){this.controllerMetadata.set(r.PROPERTY_HIGHLIGHTMETHOD_ID,t)}},charStyleRanges:{get:function(){var t,e=[];if(t=s.as(this.controllerMetadata.get(r.PROPERTY_CHARSTYLERANGES),["Dictionary","String",["Array","Int"]]))for(var o=s.iter(t);!o.done;o.next()){var n=o.key,i=o.value;N.LegacyCoreAssert.isTrue(n==r.HIGHLIGHT_STYLE,"unexpected character style",void 0,"TypeLockupController","TypeLockupController.swift",300);for(var a=s.iter(s.range(0,i.length,!0));!a.done;a.next()){var l=a.value;if(l%2==0&&l<i.length-1){var u=new mt.TextRange(i[l],i[l+1]);e.push(u)}}}return e},set:function(t){for(var e=[],o=s.iter(t);!o.done;o.next()){var n=o.value;e.push(n.start),e.push(n.end)}var i={Highlight:e};this.controllerMetadata.set(r.PROPERTY_CHARSTYLERANGES,i)}},autoTextRanges:{get:function(){var t,e,o=[];if(t=s.as(this.controllerMetadata.get(r.PROPERTY_AUTOTEXTRANGES),["Array","Int"]))for(var n=s.iter(s.range(0,t.length,!0));!n.done;n.next()){var i=n.value;if(i%2==0&&i<t.length-1){var a=new mt.TextRange(t[i],t[i+1]);o.push(a)}}else s.opt(this.lockupStyle,(function(t){return t.layout==V.LockupLayout.Auto}))&&(e=at.TypographyComposer.getWeightingForAlignment(this.lockupStyle.alignment,this.text,this.charStyleRanges))&&(o=s.clone(e));return o},set:function(t){for(var e=[],o=s.iter(t);!o.done;o.next()){var n=o.value;e.push(n.start),e.push(n.end)}this.controllerMetadata.set(r.PROPERTY_AUTOTEXTRANGES,e)}},updateCurrentColors:function(t){var e,o,n,i;(e=t.colors.fieldPrimary)&&(this.currentColors[L.ColorRole.FieldPrimary]=e),(o=t.colors.fieldSecondary)&&(this.currentColors[L.ColorRole.FieldSecondary]=o),(n=t.colors.border)&&(this.currentColors[L.ColorRole.Border]=n),(i=t.colors.shadow)&&(this.currentColors[L.ColorRole.Shadow]=i),null==this.currentColors[L.ColorRole.Border]&&(this.currentColors[L.ColorRole.Border]=this.currentColors[L.ColorRole.FieldSecondary]),null==this.currentColors[L.ColorRole.Shadow]&&(this.currentColors[L.ColorRole.Shadow]=this.currentColors[L.ColorRole.FieldSecondary])},processEvent:function(t){var e;return(e=s.as(t,A.BeginPointerTrackingEvent))?(e.trackingResponse=R.BeginPointerTrackingResponseEnum.TrackAsGroup,!1):b.GroupController.prototype.processEvent.call(this,t)},selectable:{get:function(){return!0}},moveable:{get:function(){return null==this.forma.allowUserMove||this.forma.allowUserMove}},duplicatable:{get:function(){return!0}},replaceable:{get:function(){return!0}},flippable:{get:function(){return!1}},copyTo:function(t){void 0===t&&(t=null);var e=this,o=s.opt(t,(function(t){return t.document}))||this.owner.document,n=o.content.createNode(lt.TextContentNode.KIND,null);return n.match(this.contentNode),f.CreationFacade.addContent(t||o.firstPage,n,void 0,void 0,new f.AddFormaParams(void 0,!1)).then((function(t){var o,n;return(o=s.as(t,C.Forma))?((n=s.as(o.controller,r))&&n.match(e),o.match(e.forma),o):m.CorePromise.reject("didn't get a forma back from addContent?")}))},size:{get:function(){return s.opt(s.opt(this.forma,(function(t){return t.bounds})),(function(t){return t.size}))},set:function(t){var e=kt.TheoRect.fromSize(t),o=s.opt(this.forma,(function(t){return t.bounds}));null!=o&&e.equal(o)||s.opt(this.forma,(function(t){return t.bounds=e}))}},contentDocument:{get:function(){return s.opt(s.opt(this.forma,(function(t){return t.page.document})),(function(t){return t.content}))}},contentID:{get:function(){return this.contentID_},set:function(t){t!=this.contentID_&&(N.LegacyCoreAssert.isFalse(!(null==this.contentID_||""==this.contentID_||null!=t&&""!=t),"Why are we setting a nil/empty text content node id?",void 0,"TypeLockupController","TypeLockupController.swift",536),this.removeListenersFromNode(),this.contentID_=t,this.addListenersToNode(),this.updateGroup())}},lockupForma:{get:function(){return s.as(this.forma,H.GroupForma)}},contentNode:{get:function(){var t=this;return null==this.contentID_?null:s.as(s.opt(this.contentDocument,(function(e){return e.nodeByID(t.contentID_)})),lt.TextContentNode)},set:function(t){N.LegacyCoreAssert.isFalse(null==t,"Why are we setting a nil text content node?",void 0,"TypeLockupController","TypeLockupController.swift",555),this.contentID=s.opt(t,(function(t){return t.id})),N.LegacyCoreAssert.isFalse(""==this.contentID,"Why are we setting a text content node with empty id?",void 0,"TypeLockupController","TypeLockupController.swift",557)}},text:{get:function(){var t,e=this;if(null==this.contentNode){var o=s.opt(this.forma,(function(t){return t.formaID!=s.opt(e.forma,(function(t){return t.originalID}))}))?"Forma is a clone":"NOT A CLONE",n=1==this.validDecode_?"VALID DECODE":"Decode not valid";N.LegacyCoreAssert.fail("Why do we have a type lockup with no content node? "+o+" "+n,void 0,"TypeLockupController","TypeLockupController.swift",566)}return(t=s.opt(this.contentNode,(function(t){return t.text})))||null!=t?t:""}},getCurrentMSLPrimaryColor:function(){for(var t=s.iter(this.forma.style.characterStyles);!t.done;t.next()){var e;if(e=t.value.colors.fieldPrimary)return e}return null},getCurrentMSLBackingColor:function(){for(var t=s.iter(this.forma.style.characterStyles);!t.done;t.next()){var e,o=t.value;if((e=o.colors.fieldSecondary)&&o.backing!=V.LockupBacking.None)return e}return null},settings:{get:function(){return null==this.settings_&&(this.settings_=new k.TypeLockupControllerSettings(this)),this.settings_}},loadFontsForStyle:function(){var t,e=this;(t=s.opt(s.as(s.opt(this.lockupForma,(function(t){return t.style})),V.LockupStyle),(function(t){return t.font})))&&O.Host.fontProvider.loadFont(t.fontData,(function(){null!=e.lockupForma&&e.updateGroup()}),(function(){return O.Host.logging.warning("Unable to load font "+t.fontData.postScriptName+" for style.")}))},styleChanged:function(){s.opt(s.opt(s.opt(this.forma,(function(t){return t.root})),(function(t){return t.animation})),(function(t){return t.invalidate()})),this.updateGroup()},maintainAspectRatio:{get:function(){var t=s.replaceAll(s.replaceAll(this.text,"\n","")," ","");return this.lockLineBreaks_||this.text==t}},getAlignments:function(t){var e;if(void 0===t&&(t=!1),null==this.localCoordinateAlignmentLines_&&(this.localCoordinateAlignmentLines_=s.clone(this.alignmentsInLocalCoords(t))),e=this.lockupForma){for(var o=[],n=e.totalPlacement,i=this.forma_.visit(C.FormaTraversal.FurthestAncestor,(function(t,e,o){return!0})),r=s.iter(this.localCoordinateAlignmentLines_);!r.done;r.next()){var a=r.value;N.LegacyCoreAssert.isTrue(a.coordinateSpace==e,"alignment line not in lockup coordinate space",void 0,"TypeLockupController.getAlignments","TypeLockupController.swift",652),o.push(new h.AlignmentLine(a.type,a.location,h.AlignmentDetector.ALIGNMENT_FORMA,a.line.transform(n),a.text,i))}return o}return[]},alignmentsInLocalCoords:function(t){void 0===t&&(t=!1);var e,o=[];if(e=this.lockupForma){var n,i,r,a=h.AlignmentEdges.None,l=!1,u=!1,c=!1,p=!1,g=!1,d=!1,f=!1;if(r=this.lockupStyle){if(r.backing!=V.LockupBacking.None){n=e.childrenBoundsInCoordSpace(X.Matrix2D.Identity);var y=ot.ShapeLibrary.shapeDictionary[r.backingShapeID];null!=y?(a=y.alignmentEdges,l=y.centered):(l=!0,r.backing==V.LockupBacking.BannerHorizontal?a=h.AlignmentEdges.TopAndBottom:r.backing==V.LockupBacking.BannerVertical?a=h.AlignmentEdges.LeftAndRight:r.backing==V.LockupBacking.Knockout?(a=h.AlignmentEdges.None,n=null,l=!1):a=h.AlignmentEdges.All)}null!=n&&(0!=(s.toInt(a)&s.toInt(h.AlignmentEdges.CenterX))&&(o.push(new h.AlignmentLine(h.AlignmentType.CenterX,h.AlignmentLocation.Forma,h.AlignmentDetector.ALIGNMENT_FORMA,n.verticalLine(.5),!0,e)),d=!0),0!=(s.toInt(a)&s.toInt(h.AlignmentEdges.Left))&&(o.push(new h.AlignmentLine(h.AlignmentType.Left,h.AlignmentLocation.Forma,h.AlignmentDetector.ALIGNMENT_FORMA,n.verticalLine(0),!1,e)),u=!0),0!=(s.toInt(a)&s.toInt(h.AlignmentEdges.Right))&&(o.push(new h.AlignmentLine(h.AlignmentType.Right,h.AlignmentLocation.Forma,h.AlignmentDetector.ALIGNMENT_FORMA,n.verticalLine(1),!1,e)),c=!0),0!=(s.toInt(a)&s.toInt(h.AlignmentEdges.CenterY))&&(o.push(new h.AlignmentLine(h.AlignmentType.CenterY,h.AlignmentLocation.Forma,h.AlignmentDetector.ALIGNMENT_FORMA,n.horizontalLine(.5),!0,e)),f=!0),0!=(s.toInt(a)&s.toInt(h.AlignmentEdges.Top))&&(o.push(new h.AlignmentLine(h.AlignmentType.Top,h.AlignmentLocation.Forma,h.AlignmentDetector.ALIGNMENT_FORMA,n.horizontalLine(0),!1,e)),g=!0),0!=(s.toInt(a)&s.toInt(h.AlignmentEdges.Bottom))&&(o.push(new h.AlignmentLine(h.AlignmentType.Bottom,h.AlignmentLocation.Forma,h.AlignmentDetector.ALIGNMENT_FORMA,n.horizontalLine(1),!1,e)),p=!0)),null==(i=this.textBoundsInCoordSpace(X.Matrix2D.Identity))||null!=n&&l&&a==h.AlignmentEdges.All||((null==n||!l||!(u||d||c))&&(this.numLines()<=1||s.opt(this.lockupStyle,(function(t){return t.alignment==V.LockupAlignment.UNSET}))?(o.push(new h.AlignmentLine(h.AlignmentType.CenterX,h.AlignmentLocation.Forma,h.AlignmentDetector.ALIGNMENT_FORMA,i.verticalLine(.5),!0,e)),o.push(new h.AlignmentLine(h.AlignmentType.Left,h.AlignmentLocation.Forma,h.AlignmentDetector.ALIGNMENT_FORMA,i.verticalLine(0),!0,e)),o.push(new h.AlignmentLine(h.AlignmentType.Right,h.AlignmentLocation.Forma,h.AlignmentDetector.ALIGNMENT_FORMA,i.verticalLine(1),!0,e))):s.opt(this.lockupStyle,(function(t){return t.alignment==V.LockupAlignment.Center}))?o.push(new h.AlignmentLine(h.AlignmentType.CenterX,h.AlignmentLocation.Forma,h.AlignmentDetector.ALIGNMENT_FORMA,i.verticalLine(.5),!0,e)):s.opt(this.lockupStyle,(function(t){return t.alignment==V.LockupAlignment.Left}))?o.push(new h.AlignmentLine(h.AlignmentType.Left,h.AlignmentLocation.Forma,h.AlignmentDetector.ALIGNMENT_FORMA,i.verticalLine(0),!0,e)):s.opt(this.lockupStyle,(function(t){return t.alignment==V.LockupAlignment.Right}))&&o.push(new h.AlignmentLine(h.AlignmentType.Right,h.AlignmentLocation.Forma,h.AlignmentDetector.ALIGNMENT_FORMA,i.verticalLine(1),!0,e))),(null==n||!l||!(g||f||p))&&(s.opt(this.lockupStyle,(function(t){return t.verticalAlignment==V.VerticalLockupAlignment.UNSET}))?(o.push(new h.AlignmentLine(h.AlignmentType.CenterY,h.AlignmentLocation.Forma,h.AlignmentDetector.ALIGNMENT_FORMA,i.horizontalLine(.5),!0,e)),o.push(new h.AlignmentLine(h.AlignmentType.Top,h.AlignmentLocation.Forma,h.AlignmentDetector.ALIGNMENT_FORMA,i.horizontalLine(0),!0,e)),o.push(new h.AlignmentLine(h.AlignmentType.Bottom,h.AlignmentLocation.Forma,h.AlignmentDetector.ALIGNMENT_FORMA,i.horizontalLine(1),!0,e))):s.opt(this.lockupStyle,(function(t){return t.verticalAlignment==V.VerticalLockupAlignment.VerticalCenter}))?o.push(new h.AlignmentLine(h.AlignmentType.CenterY,h.AlignmentLocation.Forma,h.AlignmentDetector.ALIGNMENT_FORMA,i.horizontalLine(.5),!0,e)):s.opt(this.lockupStyle,(function(t){return t.verticalAlignment==V.VerticalLockupAlignment.Top}))?o.push(new h.AlignmentLine(h.AlignmentType.Top,h.AlignmentLocation.Forma,h.AlignmentDetector.ALIGNMENT_FORMA,i.horizontalLine(0),!0,e)):s.opt(this.lockupStyle,(function(t){return t.verticalAlignment==V.VerticalLockupAlignment.Bottom}))&&o.push(new h.AlignmentLine(h.AlignmentType.Bottom,h.AlignmentLocation.Forma,h.AlignmentDetector.ALIGNMENT_FORMA,i.horizontalLine(1),!0,e))))}}return o},processFormaDoubleClick:function(t){this.owner.selection.replaceSelection(t.forma),this.owner.selection.isSelected(t.forma)&&(s.opt(O.Host.logging,(function(t){return t.logToAnalytics(u.AnalyticsConstants.kAnalyticsDataTextDoubleTapEnterTextEditor,{contextualData1:"method: doublePressed"})})),this.owner.controllerSettingsState.settings=this.settings)},isResizing:{get:function(){var t,e=this;return null!=this.startSize_&&!(((t=s.opt(this.owner,(function(t){return t.selection.inSpacingMode})))||null!=t)&&t&&s.opt(this.resizePin_,(function(t){return.5==t.x||s.opt(e.resizePin_,(function(t){return.5==t.y}))})))}},isResizingHorizontally:{get:function(){return this.isResizing&&s.opt(this.resizePin_,(function(t){return.5==t.y}))}},canResizeHorizontally:{get:function(){if(s.opt(this.lockupStyle,(function(t){return t.layout==V.LockupLayout.Standard}))){var t=s.replaceAll(this.text,"\n","");return pt.TypeLockupUtils.getBreakRanges(t).length>1}return!1}},processBeginFormaResize:function(t){b.GroupController.prototype.processBeginFormaResize.call(this,t),this.startSize_=this.size,this.resizePin_=t.spot,this.passedARThreshold_=!1,s.opt(s.opt(s.opt(this.forma,(function(t){return t.root})),(function(t){return t.animation})),(function(t){return t.invalidate()})),this.updateBannerRatio(),this.styleController.resetSessionContainerSize(),this.styleController.resetSessionContainerCenter()},processFormaResize:function(t){var e,o,n,i;if((e=this.forma)&&(o=this.size)&&(n=t.newSize)&&(i=e.bounds)){var r,a=null,l=null;if(f=t.pin){var s=this.isResizingHorizontally?0:f.y;a=new yt.TheoPoint(f.x,s),l=e.placement.transformPoint(i.eval(a))}if(null==this.lockupStyle||this.lockupStyle.layout!=V.LockupLayout.Auto)if(this.isResizingHorizontally){var u=e.placement.transformValues,h=Math.abs(u.xscale);if(Math.abs(h-1)>.001){this.beginBlockedUpdate();var c=e.placement.extractedScale;e.placement=c.matrix,this.size=o.multiply(h),this.endBlockedUpdate(),this.renderedLayoutResults_=null,this.renderedConfiguration_=null}null==this.renderedLayoutResults_&&this.internalUpdateGroup(!0)}else if(r=this.startSize_){var p=r.similarity(n);p<.03?(p<.005&&(this.passedARThreshold_=!1),this.passedARThreshold_||(n=r.myAspectRatioClosestCorner(n))):this.passedARThreshold_=!0}this.updateBanner(n);var g,d,f,y,m=new D.FormaTransformChangedEvent(e);if(e.beginUpdate(m),c=e.placement.extractedScale,e.placement=c.matrix,this.size=n,this.isResizingHorizontally&&(g=this.renderedLayoutResults_)){var k=g.size,L=k.height,S=Math.max(n.width,k.width);this.recordSize(new Lt.TheoSize(S,L))}if((d=l)&&(f=a)&&(y=e.bounds)){var v=e.placement.transformPoint(y.eval(f));e.move(X.Matrix2D.translation(d.subtract(v)))}e.endUpdate(m),this.updateParentGroup()}},processEndFormaResize:function(t){b.GroupController.prototype.processEndFormaResize.call(this,t),this.snapSizeToBounds();var e=this.isResizingHorizontally?"side":"corner";s.opt(O.Host.logging,(function(t){return t.logToAnalytics(u.AnalyticsConstants.kAnalyticsDataTextFrameEdited,{contextualData1:"handle:"+e})})),this.startSize_=null,this.resizePin_=null,this.invalidateStyleScores()},place:function(t){b.GroupController.prototype.place.call(this,t),this.styleController.resetSessionContainerCenter()},processEndFormaDrag:function(t){b.GroupController.prototype.processEndFormaDrag.call(this,t)},invalidateStyleScores:function(){this.styleController_.hasScoresForAttributes=!1},addListenersToNode:function(){var t=this;0==this.changeSubscriptions_.length&&null!=this.contentNode&&this.changeSubscriptions_.push(this.contentNode.subscribeWithCallbackToTextModel((function(e){return s.opt(t,(function(t){return t.updateGroup()}))}),gt.TextModelDidInsertMessage.TYPE))},removeListenersFromNode:function(){for(;this.changeSubscriptions_.length>0;)this.changeSubscriptions_.pop().unsubscribe()},bannerRatio:{get:function(){return this.bannerRatio_},set:function(t){this.bannerRatio_=t}},styleController:{get:function(){return this.styleController_}},updateBannerRatio:function(){var t;(t=this.lockupStyle)&&(t.backing!=V.LockupBacking.Banner&&t.backing!=V.LockupBacking.BannerHorizontal&&t.backing!=V.LockupBacking.BannerVertical||(t.backing==V.LockupBacking.BannerHorizontal&&this.size.width<this.size.height?this.bannerRatio=this.size.height/this.size.width+.1:t.backing==V.LockupBacking.BannerVertical&&this.size.height<this.size.width?this.bannerRatio=this.size.width/this.size.height+.1:this.bannerRatio=r.DEFAULT_BANNER_RATIO))},updateBanner:function(t){var e;(e=this.lockupStyle)&&(e.backing!=V.LockupBacking.Banner&&e.backing!=V.LockupBacking.BannerHorizontal&&e.backing!=V.LockupBacking.BannerVertical||(e.backing==V.LockupBacking.BannerVertical&&t.width/t.height>this.bannerRatio?(e.backing=V.LockupBacking.BannerHorizontal,this.bannerRatio=r.DEFAULT_BANNER_RATIO):e.backing==V.LockupBacking.BannerHorizontal&&t.height/t.width>this.bannerRatio&&(e.backing=V.LockupBacking.BannerVertical,this.bannerRatio=r.DEFAULT_BANNER_RATIO)))},shift:function(t,e){return new mt.TextRange(t.start+e,t.end+e)},onStyleApplication:function(){this.loadFontsForStyle(),this.updateGroup()},layoutStrategyForConfiguration:function(t){return null!=this.layoutStrategy_&&this.layoutStrategy_.supportsConfiguration(t)?this.layoutStrategy_:this.layoutStrategyForLayout(t.style.layout,t.style.alignment)},layoutStrategyForLayout:function(t,e){return V.LockupStyle.isAutoLayout(t)?new c.AutoTextLayoutStrategy:t==V.LockupLayout.FitJustified?new T.EvenRowWidthsLayoutStrategy:t==V.LockupLayout.Standard?new v.EvenRowHeightsLayoutStrategy(e):V.LockupStyle.isLetterGrid(t)?new Y.LetterGridLayoutStrategy:V.LockupStyle.isPath(t)?new q.PathLayoutStrategy:(N.LegacyCoreAssert.fail("Unknown Layout",{layout:t},"TypeLockupController.layoutStrategyForLayout","TypeLockupController.swift",1167),new v.EvenRowHeightsLayoutStrategy(V.LockupAlignment.Left))},decorationStrategyForConfiguration:function(t){if(null!=this.decorationStrategy_&&this.decorationStrategy_.supportsConfiguration(t))return this.decorationStrategy_;var e=null,o=t.style.backing;return V.LockupStyle.isLetterGrid(t.style.layout)?e=new U.LetterDecorationStrategy:o==V.LockupBacking.None?e=new j.NoDecorationStrategy:o==V.LockupBacking.Rows?e=new Z.RowsDecorationStrategy:o==V.LockupBacking.Knockout?e=new Z.KnockoutDecorationStrategy:o==V.LockupBacking.Banner||o==V.LockupBacking.BannerVertical||o==V.LockupBacking.BannerHorizontal?e=new p.BannerDecorationStrategy:o==V.LockupBacking.SVGBackground?null!=t.style.backingArtworkID?e=new it.SVGBackgroundDecorationStrategy(t.style.backingArtworkID):(O.Host.logging.warning("Error in svg background. nil backingArtworkID. defaulting to no backing"),e=new j.NoDecorationStrategy):(N.LegacyCoreAssert.fail("Unimplemented value for lockup layout.",void 0,"TypeLockupController.decorationStrategyForConfiguration","TypeLockupController.swift",1200),e=new j.NoDecorationStrategy),e},styleFontsLoaded:function(){var t;return!(t=s.opt(s.as(s.opt(this.lockupForma,(function(t){return t.style})),V.LockupStyle),(function(t){return t.font})))||t.fontData.availability==w.FontAvailability.LOADED},updatePoolForItems:function(t,e){for(var o,n=0,i={},r=s.iter(t);!r.done;r.next()){var a=r.value;if(a.type==W.LockupItemType.Text){var l=a.text.toUpperCase(),u=(o=i[l])||null!=o?o:0;i[l]=u+1}else n+=1}for(var h=s.iter(e.configureTextFormae(i));!h.done;h.next()){var c=h.value;s.opt(c.parent,(function(t){return t.removeChild(c)}))}for(var p=s.iter(e.configureShapeFormae(n));!p.done;p.next())c=p.value,s.opt(c.parent,(function(t){return t.removeChild(c)}))},conformFormaeForItems:function(t,e,o,n){var i,r;if(void 0===o&&(o=!1),void 0===n&&(n=!1),r=s.as(s.opt(this.lockupForma,(function(t){return t.root})),J.RootForma)){var a=new D.FormaGeometryChangedEvent(r);r.beginUpdate(a);for(var l={},u=0,h=s.iter(t);!h.done;h.next()){var c,p,g,d=h.value;switch(d.type){case 0:var f,y,m=d.text.toUpperCase(),k=(i=l[m])||null!=i?i:0;c=L=e.nthTextFormaForString(k,m),l[m]=k+1,p=n?0:1,(f=c.parent)&&(y=s.as(s.opt(this.wrappingGroup_,(function(t){return t.childAt(p)})),H.GroupForma))&&f!==y&&f.removeChild(c);break;case 1:var L=e.nthShapeForma(u);this.conformShapeFormaToItem(L,d,!1),c=L,u+=1,p=0;break;case 2:L=e.nthShapeForma(u),this.conformShapeFormaToItem(L,d,!1),c=L,u+=1,p=0}if(c.isFullCanvas=d.isFullCanvas,0==p&&(g=c.parent)){var S=o?e.shapeFormaCount()-u:u-1;g.childCount<=S||S<0?(g.removeChild(c),g.appendChild(c,!1)):s.eq(C._equality_Forma_Forma,g.childAt(S),c)||(g.removeChild(c),g.insertChildAt(c,S,!1))}if(null==c.parent){var v=s.as(s.opt(this.wrappingGroup_,(function(t){return t.childAt(p)})),H.GroupForma);null!=v&&(o?v.insertChildAt(c,0,!1):v.appendChild(c,!1))}d.type==W.LockupItemType.Text&&this.conformTextFormaToItem(c,d)}r.endUpdate(a)}},lockupStyle:{get:function(){return s.as(s.opt(this.lockupForma,(function(t){return t.style})),V.LockupStyle)}},renderedLayoutResults:{get:function(){return this.renderedLayoutResults_}},annotations:{get:function(){var t,e,o;return(t=this.renderedLayoutResults_)?t.annotations:!this.blockUpdate&&(e=this.size)&&(o=this.lockupStyle)?this.layoutStrategyForLayout(o.layout,o.alignment).annotate(this.text,e,o,this.getTextFormaCount()):null}},layoutStrategyPrivate:{get:function(){return this.layoutStrategy_},set:function(t){this.layoutStrategy_=t}},calculateScalarToFit:function(t,e){var o=t.width,n=t.height,i=o/n,r=e.width,a=e.height,l=r/a,s=(i>=l?n:o/l)/a;return isNaN(s)?1:s},scalarToFitLayoutResultsIntolockupForma:function(){var t=this.renderedLayoutResults_;if(null==t)return 1;var e=t.size,o=this.calculateScalarToFit(this.size,e);return isNaN(o)?1:o},wrappingGroup:{get:function(){var t,e=this;return null!=this.wrappingGroup_?this.wrappingGroup_:null!=this.wrappingGroupID_&&(t=s.as(s.opt(this.lockupForma,(function(t){return t.page.formaByID(e.wrappingGroupID_)})),H.GroupForma))?t:s.opt(this.lockupForma,(function(t){return 1==t.childCount}))?s.as(s.opt(this.lockupForma,(function(t){return t.childAt(0)})),H.GroupForma):null}},onFirstUpdate:function(){var t,e=this,o=!1;null!=(t=this.wrappingGroupID_)&&0==s.isEmpty(t)&&(o=!0);var n=null!=this.wrappingGroup_;if(o&&!n&&(this.wrappingGroup_=s.as(s.opt(this.lockupForma,(function(t){return t.page.formaByID(e.wrappingGroupID_)})),H.GroupForma),null==this.wrappingGroup&&(d.CoreAssertDebugOnly.fail("onFirstUpdate has wrappingGroupID_ but can't get wrappingGroup_",void 0,"TypeLockupController.onFirstUpdate","TypeLockupController.swift",1523),o=!1)),0==o&&(N.LegacyCoreAssert.isTrue(null!=this.lockupForma,"onFirstUpdate no lockupForma",void 0,"TypeLockupController.onFirstUpdate","TypeLockupController.swift",1537),(r=s.as(this.lockupForma.isModel?s.opt(this.lockupForma,(function(t){return t.page.createModelForma(H.GroupForma.KIND)})):s.opt(this.lockupForma,(function(t){return t.page.createForma(H.GroupForma.KIND)})),H.GroupForma))&&(s.opt(this.lockupForma,(function(t){return t.removeAllChildren()})),this.wrappingGroup_=r,this.wrappingGroupID_=r.formaID,s.opt(this.lockupForma,(function(t){return t.appendChild(r)})))),N.LegacyCoreAssert.isTrue(null!=this.wrappingGroup_,"onFirstUpdate no wrappingGroup_",void 0,"TypeLockupController.onFirstUpdate","TypeLockupController.swift",1564),0==this.wrappingGroup_.childCount)for(var i=s.iter(s.range(0,2,!1));!i.done;i.next()){var r;(r=s.as(this.lockupForma.isModel?this.lockupForma.page.createModelForma(H.GroupForma.KIND):this.lockupForma.page.createForma(H.GroupForma.KIND),H.GroupForma))&&s.opt(this.wrappingGroup_,(function(t){return t.appendChild(r)}))}this.updateFormaPools()},updateFormaPools:function(){var t;if(this.decorationFormaePool_.clear(),this.layoutFormaePool_.clear(),this.renderedLayoutResults_=null,this.renderedDecorationResults_=null,this.renderedConfiguration_=null,null!=this.wrappingGroup_&&this.wrappingGroup_.childCount>=2){var e,o;if(e=s.as(this.wrappingGroup_.childAt(0),H.GroupForma))for(var n=s.iter(e.childrenAsArray);!n.done;n.next()){var i=n.value;this.decorationFormaePool_.addForma(i)}if(o=s.as(this.wrappingGroup_.childAt(1),H.GroupForma))for(var r=s.iter(o.childrenAsArray);!r.done;r.next())i=r.value,((t=s.opt(s.as(i,ut.TextForma),(function(t){return t.isDecorationTextForma()})))||null!=t)&&t?this.decorationFormaePool_.addForma(i):this.layoutFormaePool_.addForma(i)}},recalculateTracking:function(t){var e=this.lockupForma,o=this.lockupStyle,n=this.text,i=new G.LockupConfiguration(n,o,t,e.placement,s.opt(e.parent,(function(t){return t.bounds})),void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,this.fitContainerToArea),r=new Lt.TheoSize(this.size.width,this.size.height);null==this.layoutStrategy_&&(this.layoutStrategy_=this.layoutStrategyForConfiguration(i));var a=this.layoutStrategy_.calculateTracking(i,r),l=t;0!=a&&a<1e-4&&(l=new Lt.TheoSize(-a,l.height),a=0),this.beginBlockedUpdate(),s.opt(s.as(s.opt(this.lockupForma,(function(t){return t.style})),V.LockupStyle),(function(t){return t.tracking=a})),this.styleController.onTrackingChanged(),this.size=l,this.endBlockedUpdate(),this.internalUpdateGroup(!1)},recalculateLeading:function(t){var e=this.lockupForma,o=this.lockupStyle,n=this.text,i=new G.LockupConfiguration(n,o,t,e.placement,s.opt(e.parent,(function(t){return t.bounds})),void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,this.fitContainerToArea),r=new Lt.TheoSize(this.size.width,this.size.height);null==this.layoutStrategy_&&(this.layoutStrategy_=this.layoutStrategyForConfiguration(i));var a=this.layoutStrategy_.calculateLeading(i,r),l=t;a<0&&(l=new Lt.TheoSize(l.width,-a),a=0),this.beginBlockedUpdate(),s.opt(this.lockupStyle,(function(t){return t.spacing=a})),this.styleController.onSpacingChanged(),this.size=l,this.endBlockedUpdate(),this.internalUpdateGroup(!1)},setLetterSpacingAndBounds:function(t,e){var o;if(void 0===e&&(e=yt.TheoPoint.ZERO),null==this.renderedLayoutResults_&&this.updateGroup(),o=this.renderedLayoutResults_){var n=this.layoutStrategy_.adjustSizeForTracking(this.text,o,this.lockupStyle.tracking,t),i=s.opt(n,(function(t){return t.width})),r=s.opt(n,(function(t){return t.height}));if(0==i&&0==r)return;var a,l=!1,u=0;null!=(a=i)&&(l=!0,u=a);var h,c=0;null!=(h=r)&&(l=!0,c=h);var p=this.forma.placement.transformValues,g=this.forma.bounds,d=new Lt.TheoSize(g.width*p.xscale,g.height*p.xscale),f=new Lt.TheoSize(d.width+u,d.height+c);if(f.width<=0||f.height<=0)return;if(l){this.beginBlockedUpdate(),this.lockupStyle.tracking=t,this.endBlockedUpdate();var y=new A.FormaResizeEvent(this.forma,f,e);this.onEvent(y),this.snapSizeToBounds()}else this.lockupStyle.tracking=t}},setLineSpacingAndBounds:function(t,e){var o;if(void 0===e&&(e=yt.TheoPoint.ZERO),null==this.renderedLayoutResults_&&this.updateGroup(),!(this.numLines()-1<1)&&(o=this.renderedLayoutResults_)){var n=this.layoutStrategy_.adjustSizeForLeading(this.forma.bounds,o,this.lockupStyle.spacing,t),i=n.width,r=n.height,a=this.forma.placement.transformValues,l=this.forma.bounds,u=new Lt.TheoSize(l.width*a.xscale,l.height*a.xscale),h=new Lt.TheoSize(u.width+i,u.height+r);s.opt(this.lockupStyle,(function(t){return t.layout==V.LockupLayout.Auto}))?this.lockupStyle.spacing=t:(this.beginBlockedUpdate(),this.lockupStyle.spacing=t,this.endBlockedUpdate());var c=new A.FormaResizeEvent(this.forma,h,e);this.onEvent(c),s.opt(this.lockupStyle,(function(t){return t.layout!=V.LockupLayout.Auto}))&&this.snapSizeToBounds()}},addLineBreakConstraints:function(t){void 0===t&&(t=!1),this.allowFewerLineBreaks_=!1;var e=s.replaceAll(s.replaceAll(this.text,"\n"," "),"  "," "),o=s.replaceAll(e," ","");this.lockLineBreaks_=t||e.split(" ").length==o.length,!this.lockLineBreaks_&&this.text.split("\n").length>1&&(this.allowFewerLineBreaks_=!0)},removeLineBreakConstraints:function(){this.lockLineBreaks_=!1,this.allowFewerLineBreaks_=!1},updateGroup:function(){this.internalUpdateGroup(!0)},updateGroupWithFontSize:function(t,e){void 0===e&&(e=null),(this.lockLineBreaks_||this.allowFewerLineBreaks_)&&null!=t?s.opt(O.Host.logging,(function(t){return t.warning("Can't preserve font size while line breaks are constrainted")})):(this.preferredFontSize_=t,this.expansionSize_=e),this.internalUpdateGroup(!0),this.preferredFontSize_=null,this.expansionSize_=null},internalUpdateGroup:function(t){var e;if(!(e=s.opt(s.opt(this.owner,(function(t){return t.document})),(function(t){return t.inUndoRedo})))&&null==e||!e)if(null!=this.lockupForma){if(!this.blockUpdate&&null!=s.as(s.opt(this.lockupForma,(function(t){return t.root})),J.RootForma)&&null!=this.lockupStyle){0==this.hasFirstUpdateRun&&(this.onFirstUpdate(),this.hasFirstUpdateRun=!0);var o=this.lockupForma,n=this.lockupStyle;if(!(null!=this.size&&null!=n.font&&this.styleFontsLoaded()&&n.colors.count>0&&this.text.length>0))return this.renderedConfiguration_=null,this.renderedColorLibrary_=null,this.renderedDecorationResults_=null,this.renderedLayoutResults_=null,this.clearLockupFormaPool(this.layoutFormaePool_),void this.clearLockupFormaPool(this.decorationFormaePool_);var i=this.text,a=!this.owner.selection.inCharStyleMode,l=this.forceLetterFormaMode,u=new G.LockupConfiguration(i,n,this.fitContainerToArea&&this.styleController.getSessionContainerSize()||this.size,o.placement,s.opt(o.parent,(function(t){return t.bounds})),a,l,this.preferredFontSize_,this.expansionSize_,void 0,void 0,void 0,void 0,void 0,this.fitContainerToArea);if(u.characterStyleRanges=s.clone(this.charStyleRanges),u.highlightMethod=this.highlightMethod,u.autoTextRanges=s.clone(this.autoTextRanges),u.rowWordLengths=null,this.lockLineBreaks_||this.allowFewerLineBreaks_){for(var h=s.clone(this.lockupForma.filterByKind(ut.TextForma.KIND)),c=0,p=s.iter(h);!p.done;p.next()){var g=p.value;c=Math.max(c,g.rowIndex)}u.rowWordLengths=s.repeat(0,c+1);for(var f=s.iter(h);!f.done;f.next())g=f.value,u.rowWordLengths[g.rowIndex]+=1;u.allowFewerLineBreaks=this.allowFewerLineBreaks_}this.updateCurrentColors(n),this.decorationStrategy_=this.decorationStrategyForConfiguration(u),this.layoutStrategy_=this.layoutStrategyForConfiguration(u);var m=s.opt(this.renderedConfiguration_,(function(t){return t.useOptimization==a})),k=null==this.renderedConfiguration_||null==this.renderedLayoutResults_||Math.abs(this.size.height-this.thresholdGroupHeight)>1||Math.abs(this.size.width-this.thresholdGroupWidth)>1||this.renderedConfiguration_.text!=u.text||u.style.needsLayout(this.renderedConfiguration_.style)||!r.rangesEqual(this.renderedConfiguration_.characterStyleRanges,u.characterStyleRanges)||this.renderedConfiguration_.highlightMethod!=u.highlightMethod||0==this.layoutFormaePool_.textFormaCount()||this.renderedConfiguration_.forceLetterForma!=u.forceLetterForma||!m;if(!k)for(var S=s.iter(u.style.characterStyles);!S.done;S.next()){var v=S.key,T=S.value;if(!(w=this.renderedConfiguration_.style.characterStyles[v])){k=!0;break}if(w.colorLibrary=this.renderedColorLibrary_,N.LegacyCoreAssert.isTrue(T.colorLibrary==n.colorLibrary,"char style library doesnt match lockup style",void 0,"TypeLockupController.internalUpdateGroup","TypeLockupController.swift",1953),T.needsLayout(w)||T.textOpacity!=w.textOpacity||T.backingOpacity!=w.backingOpacity){k=!0;break}}var C=k||!u.style.sameColors(this.renderedConfiguration_.style),F=null==this.renderedConfiguration_||u.style.needsLayout(this.renderedConfiguration_.style),x=null==this.renderedConfiguration_||k||!this.renderedConfiguration_.containerSize.equal(u.containerSize)||!this.renderedConfiguration_.placement.equal(u.placement)||this.renderedConfiguration_.style.backingArtworkID!=u.style.backingArtworkID||this.renderedConfiguration_.style.backing!=u.style.backing||this.renderedConfiguration_.style.textLook!=u.style.textLook||this.renderedConfiguration_.style.shadowAngle!=u.style.shadowAngle||C&&V.LockupStyle.isShadowLook(u.style.textLook);if(!x)for(var R=s.iter(u.style.characterStyles);!R.done;R.next()){var w;if(v=R.key,T=R.value,x=C&&T.textLook==V.LockupTextLook.KnockoutAndShadow,(w=this.renderedConfiguration_.style.characterStyles[v])&&(T.backingArtworkID!=w.backingArtworkID||T.shadowAngle!=w.shadowAngle)){x=!0;break}}if(this.isRightToLeft=pt.TypeLockupUtils.isTextRightToLeft(i),k){var A,_,M,I;this.isResizing&&m&&s.opt(this.lockupStyle,(function(t){return t.layout!=V.LockupLayout.Auto}))&&(_=this.renderedLayoutResults_)&&(M=this.renderedConfiguration_)&&(I=this.size)&&(A=this.layoutStrategy_.reflow(I,this.resizePin_,M,_));var D=A||this.layoutStrategy_.layout(u);if(0==D.items.length){var B=this.getAverageFontSize(),b=0==B?12:B;D=new W.LayoutResults([W.LockupItem.init_bc20(L.ColorRole.FieldPrimary,null,u.containerSize,X.Matrix2D.Identity," ",u.style.font.fontData,b,b,D.typographicBoundingRatios,0,new mt.TextRange(0,1),void 0,b)],u.containerSize,X.Matrix2D.Identity,D.typographicBoundingRatios,u.containerSize.width/u.containerSize.height)}this.isRightToLeft&&D.flipForRightToLeft(),this.updatePoolForItems(D.items,this.layoutFormaePool_),this.renderedLayoutResults_=D;for(var H=!1,P=s.iter(D.items);!P.done;P.next())if(P.value.type==W.LockupItemType.Text){H=!0;break}H||d.CoreAssertDebugOnly.fail("layoutResults has no text items",{layoutType:u.style.layoutType,containerSize:u.containerSize.print(),text:u.text.substr(0,3)},"TypeLockupController.internalUpdateGroup","TypeLockupController.swift",2064)}null==this.renderedLayoutResults_&&d.CoreAssertDebugOnly.fail("renderedLayoutResults_ is nil",{layoutType:u.style.layoutType,containerSize:u.containerSize.print(),text:u.text.substr(0,3)},"TypeLockupController.internalUpdateGroup","TypeLockupController.swift",2069);var E=u.style.backing==V.LockupBacking.None,z=!1;if(x){var U=!1,Y=this.decorationStrategy_.decorate(u,this.renderedLayoutResults_);if((T=u.style.characterStyles[r.HIGHLIGHT_STYLE])&&!V.LockupStyle.isPath(u.style.layout)&&!V.LockupStyle.isAutoLayout(u.style.layout)){if(V.LockupStyle.isShadowLook(T.textLook)){var K=(new tt.ShadowDecorationStrategy).decorate(u,this.renderedLayoutResults_);s.append(Y.items,K.items),E=!0,z=T.textLook==V.LockupTextLook.KnockoutAndShadow||T.textLook==V.LockupTextLook.KnockoutShadowOutline,U=!0}if(u.style.backing!=V.LockupBacking.None&&T.textLook==V.LockupTextLook.FillAndOutline2){var Q=(new j.NoDecorationStrategy).decorate(u,this.renderedLayoutResults_);s.append(Y.items,Q.items),E=!0}if((T.backing==V.LockupBacking.Rows||T.backing==V.LockupBacking.SVGBackground)&&u.style.backing!=V.LockupBacking.Rows&&!V.LockupStyle.isLetterGrid(u.style.layout)){var q=(new Z.RowsDecorationStrategy).decorate(u,this.renderedLayoutResults_);if(E&&Y.items.length>1)for(var $=s.iter(q.items);!$.done;$.next()){var et=$.value;Y.items.splice(0,0,et)}else s.append(Y.items,q.items)}}if(u.style.backing!=V.LockupBacking.None&&u.style.textLook==V.LockupTextLook.FillAndOutline2){var ot=(new j.NoDecorationStrategy).decorate(u,this.renderedLayoutResults_);s.append(Y.items,ot.items),E=!0}else if(V.LockupStyle.isShadowLook(u.style.textLook)){if(!U){var nt=(new tt.ShadowDecorationStrategy).decorate(u,this.renderedLayoutResults_);s.append(Y.items,nt.items),E=!0}z=z||u.style.textLook==V.LockupTextLook.KnockoutAndShadow||u.style.textLook==V.LockupTextLook.KnockoutShadowOutline}this.updatePoolForItems(Y.items,this.decorationFormaePool_),this.renderedDecorationResults_=Y}(C||k)&&this.conformFormaeForItems(this.renderedLayoutResults_.items,this.layoutFormaePool_),(C||x)&&this.conformFormaeForItems(this.renderedDecorationResults_.items,this.decorationFormaePool_,E,z);var it=this.renderedLayoutResults_.size.width,rt=this.renderedLayoutResults_.size.height;this.thresholdGroupHeight=this.size.height,this.thresholdGroupWidth=this.size.width,this.setLayerOpacities(n);var at=this.findInternalOffset(n,this.size,new Lt.TheoSize(it,rt));this.updateChildGroupBounds(),t&&s.opt(this.wrappingGroup,(function(t){return t.placement=X.Matrix2D.Identity.translate(at)})),this.localCoordinateAlignmentLines_=s.clone(this.alignmentsInLocalCoords(!0)),(k||x)&&s.opt(s.opt(this.lockupForma,(function(t){return t.animation})),(function(t){return t.invalidate()})),u.style=n.clone(),this.renderedColorLibrary_=y.ColorLibrary.init_fcb1(n.colorLibrary),this.renderedConfiguration_=u,this.renderedConfiguration_.style.colorLibrary=this.renderedColorLibrary_,k&&this.highlightMethod>=r.FIRST_AUTO_METHOD&&this.highlightMethod<=r.MAX_AUTO_METHOD&&(this.autoApplyCharStyle(!0,!1,!0),F&&this.updateGroup())}}else s.opt(O.Host.logging,(function(t){return t.warning("TypeLockupController.updateGroup() after detachment")}))},setLayerOpacities:function(t){var e=t.currentTextOpacity,o=t.currentBackingOpacity,n=s.as(s.opt(this.wrappingGroup_,(function(t){return t.childAt(1)})),H.GroupForma);s.opt(n,(function(t){return t.style.opacity=e})),n=s.as(s.opt(this.wrappingGroup_,(function(t){return t.childAt(0)})),H.GroupForma),s.opt(n,(function(t){return t.style.opacity=o}))},updateChildGroupBounds:function(){var t,e;if(t=this.wrappingGroup_){var o=new D.FormaGeometryChangedEvent(t);t.beginUpdate(o),t.endUpdate(o)}(e=s.as(s.opt(this.wrappingGroup_,(function(t){return t.childAt(1)})),H.GroupForma))&&(o=new D.FormaGeometryChangedEvent(e),e.beginUpdate(o),e.endUpdate(o)),(e=s.as(s.opt(this.wrappingGroup_,(function(t){return t.childAt(0)})),H.GroupForma))&&(o=new D.FormaGeometryChangedEvent(e),e.beginUpdate(o),e.endUpdate(o))},findInternalOffset:function(t,e,o){var n=0,i=0,r=(e.width-o.width)/2,a=(e.height-o.height)/2,l=t.alignment,u=t.verticalAlignment;return this.isResizingHorizontally&&(l=s.opt(this.resizePin_,(function(t){return 0==t.x?V.LockupAlignment.Right:V.LockupAlignment.Left})),u=V.VerticalLockupAlignment.Top),t.layout==V.LockupLayout.Auto||l==V.LockupAlignment.UNSET||l==V.LockupAlignment.Center?n=r:l==V.LockupAlignment.Right&&(n=e.width-o.width),u==V.VerticalLockupAlignment.UNSET||u==V.VerticalLockupAlignment.VerticalCenter?i=a:u==V.VerticalLockupAlignment.Bottom&&(i=e.height-o.height),new yt.TheoPoint(n,i)},conformTextFormaToItem:function(t,e){var o,n,i=this;if(e.type==W.LockupItemType.Text){var r,a,l,u=e.font,h=this.currentColors[e.colorRole],c=e.colorRole==L.ColorRole.Shadow?h:this.currentColors[L.ColorRole.Border],p=this.lockupStyle.textLook;t.style.opacity=1,null!=e.characterStyle&&(r=s.opt(this.lockupStyle,(function(t){return t.characterStyles[e.characterStyle]})))&&(r.textLook!=V.LockupTextLook.UNSET&&(p=r.textLook),N.LegacyCoreAssert.isTrue(r.colorLibrary==this.lockupStyle.colorLibrary,"char style library doesnt match lockup style",void 0,"TypeLockupController.conformTextFormaToItem","TypeLockupController.swift",2320),(a=r.colors.color(e.colorRole))&&(h=a),(l=r.colors.border)&&(c=e.colorRole==L.ColorRole.Shadow?h:l),r.textOpacity!=I.FormaStyle.OPACITY_UNSET&&(t.style.opacity=r.textOpacity),r.textLook==V.LockupTextLook.Fill&&V.LockupStyle.isKnockoutLook(this.lockupStyle.textLook)&&r.textOpacity<1&&r.textOpacity!=I.FormaStyle.OPACITY_UNSET&&(p=V.LockupTextLook.KnockoutAndFill));var g=(o=s.opt(this.renderedLayoutResults_,(function(t){return t.avgTextPointSize})))||null!=o?o:e.pointSize,d=0,f=this.lockupStyle.strokeWeight+.04;p==V.LockupTextLook.OutlineOnly||p==V.LockupTextLook.KnockoutAndOutline||p==V.LockupTextLook.FillAndOutline?d=.5*g*f:p==V.LockupTextLook.ShadowAndOutline?d=.08*g*(f+.25):p==V.LockupTextLook.KnockoutAndShadow?e.colorRole!=L.ColorRole.FieldPrimary&&(d=.08*e.pointSize*(1.7*this.lockupStyle.shadowOffset+.25),t.style.opacity=.75):p==V.LockupTextLook.FillAndOutline2?e.colorRole!=L.ColorRole.FieldPrimary&&(d=.5*g*f):p==V.LockupTextLook.KnockoutAndFill&&s.opt(this.lockupStyle,(function(t){return t.colors.colorID(L.ColorRole.FieldPrimary)==s.opt(i.lockupStyle,(function(t){return t.colors.colorID(L.ColorRole.FieldSecondary)}))}))?d=((n=s.opt(this.lockupStyle,(function(t){return t.backingOpacity})))||null!=n?n:1)>.8?6:1:p==V.LockupTextLook.ShadowOutlineTransparentText?e.colorRole==L.ColorRole.FieldPrimary?(p=V.LockupTextLook.OutlineOnly,0==(d=.5*g*f)&&(d=10)):(p=V.LockupTextLook.Shadow,d=0):p==V.LockupTextLook.KnockoutShadowOutline&&(e.colorRole!=L.ColorRole.FieldPrimary?(p=V.LockupTextLook.KnockoutAndShadow,d=.08*e.pointSize*(1.7*this.lockupStyle.shadowOffset+.25),t.style.opacity=.75):(p=V.LockupTextLook.KnockoutAndOutline,0==(d=.5*g*f)&&(d=10))),e.colorRole==L.ColorRole.FieldPrimary&&V.LockupStyle.isKnockoutLook(p)&&p!=V.LockupTextLook.KnockoutAndFill&&(h=$.SolidColor.BLACK);var y=d==ut.TextForma.STROKEWIDTH_ZERO?null:d,m=p==V.LockupTextLook.Fill?null:p,k=s.opt(this.lockupStyle,(function(t){return t.tracking==ut.TextForma.TRACKING_ZERO}))?null:s.opt(this.lockupStyle,(function(t){return t.tracking}));t.setTextProperties(e.text,u,e.pointSize,h,c,y,m,k,e.rangeInLockup,e.rowIndex,e.colorRole),t.placement=e.placement}else N.LegacyCoreAssert.fail("Expected text item",void 0,"TypeLockupController.conformTextFormaToItem","TypeLockupController.swift",2303)},conformShapeFormaToItem:function(t,e,o){var n=null;o&&((n=new D.FormaAnimationTransactionEvent(t)).duration=0,t.beginUpdate(n)),t.style.opacity=1;var i,r,a=this.currentColors[e.colorRole];switch(null!=e.characterStyle&&(i=s.opt(this.lockupStyle,(function(t){return t.characterStyles[e.characterStyle]})))&&(N.LegacyCoreAssert.isTrue(i.colorLibrary==this.lockupStyle.colorLibrary,"char style library doesnt match lockup style",void 0,"TypeLockupController.conformShapeFormaToItem","TypeLockupController.swift",2451),(r=i.colors.color(e.colorRole))&&(a=r),i.backingOpacity!=I.FormaStyle.OPACITY_UNSET&&(t.style.opacity=i.backingOpacity)),e.type){case 0:N.LegacyCoreAssert.fail("Text item cannot be associated with a shape forma",void 0,"TypeLockupController.conformShapeFormaToItem","TypeLockupController.swift",2464);break;case 1:t.contentID=null,t.preScale=null,t.size=e.size,t.sliceBox=null,t.shapeLibraryID=null,t.canonicalArtwork=rt.TheoArtworkShape.fromPath(e.path),t.style.colors.fieldPrimary=a,t.placement=e.placement;break;case 2:if(t.shapeLibraryID!=e.artworkID&&ot.ShapeLibrary.applyToShapeForma(t,e.artworkID),null==t.sliceBox){var l=t.canonicalArtwork.bounds,u=l.width,h=l.height,c=e.size,p=c.width<=c.height?c.width/u:c.height/h;u*=p,h*=p,t.size=new Lt.TheoSize(u,h)}else t.size=e.size;t.preScale=e.preScale,t.placement=e.placement,t.style.colors.fieldPrimary=a}o&&t.endUpdate(n)},decodeMetadata:function(){var t,e;this.beginBlockedUpdate(),(t=s.as(this.controllerMetadata.get(r.PROPERTY_LOCKUPSTYLE_DEPRECATED),V.LockupStyle))&&(t.backing==V.LockupBacking.Banner&&(t.backing=this.size.width>this.size.height?V.LockupBacking.BannerHorizontal:V.LockupBacking.BannerVertical),s.opt(this.lockupForma,(function(e){return e.applyStyle(t)}))),(e=s.as(this.controllerMetadata.get(r.PROPERTY_SIZE_DEPRECATED),Lt.TheoSize))&&(this.size=e),this.endBlockedUpdate()},postDecode:function(){var t,e,o;this.validDecode_=null!=this.contentNode,this.beginBlockedUpdate(),this.styleController_.legacyColorConversion(),this.endBlockedUpdate();var n=(t=s.opt(s.opt(this.lockupForma,(function(t){return t.page.document})),(function(t){return t.versionDecoded.vers})))||null!=t?t:0,i=!1;if(N.LegacyCoreAssert.isTrue(this.lockupForma.controller===this,"Controller-forma mismatch",void 0,"TypeLockupController.postDecode","TypeLockupController.swift",2562),L=s.as(s.opt(this.lockupForma,(function(t){return t.style})),V.LockupStyle)){var a,l;if(L.backing==V.LockupBacking.SVGBackground&&(null==L.backingArtworkID&&(N.LegacyCoreAssert.fail("postDecode - style.backingArtworkID is nil.",{version:(e=s.opt(s.opt(this.lockupForma,(function(t){return t.page.document})),(function(t){return t.versionDecoded.description})))||null!=e?e:"nil"},"TypeLockupController.postDecode","TypeLockupController.swift",2570),L.backingArtworkID="square_001"),null!=(a=L.backingArtworkID)&&(l=this.contentDocument.nodeWithTag(ot.TAG_SHAPE_ID,a))&&l.removeFromParent()),n<st.TheoDocumentVersion.Knockouts&&L.backing==V.LockupBacking.None&&1!=L.textOpacity){var u=L.textOpacity,h=L.backingOpacity;L.textOpacity=u,L.backingOpacity=h}var c,p=V.LockupStyle.isKnockoutLook(L.textLook);if((c=L.characterStyles[r.HIGHLIGHT_STYLE])&&(p=p||V.LockupStyle.isKnockoutLook(c.textLook)),p){var g=L.backing;L.backing=V.LockupBacking.None,L.backing=g}var f=(o=s.opt(s.opt(this.forma,(function(t){return t.page.document})),(function(t){return t.missingFontList.length})))||null!=o?o:0;if(f>this.missingFontCount_?(i=!0,this.missingFontCount_=f):n<st.TheoDocumentVersion.LetterSpacing&&s.opt(L.font,(function(t){return"Pacifico-Regular"==t.fontData.postScriptName||s.opt(L.font,(function(t){return"Montserrat-Regular"==t.fontData.postScriptName}))}))&&(i=!0),n<st.TheoDocumentVersion.NewTextAnimations&&(this.text.includes("–")||this.text.includes("—"))&&0==L.spacing&&(L.spacing=.5,i=!0),n<st.TheoDocumentVersion.TextEffects&&null!=this.contentNode){var y=gt.ContentTextModel.init_d41d();y.match(this.contentNode.textModel),this.contentNode.textModel=y}this.text.trim().length>0&&!this.hasTextFormae()&&(null==L.font?L.font=ct.TheoFont.init_9e5c(O.Host.textModelUtils.defaultFont()):i=!0)}var m,k=!1;null!=(m=this.wrappingGroupID_)&&0==s.isEmpty(m)&&(k=!0);var L,S,v=this.hasTextFormae();(d.CoreAssertDebugOnly.isTrue(v,"postDecode type lockup has no text forma!",void 0,"TypeLockupController.postDecode","TypeLockupController.swift",2653),this.removeListenersFromNode(),this.addListenersToNode(),i)?((L=s.as(s.opt(this.lockupForma,(function(t){return t.style})),V.LockupStyle))&&L.layout==V.LockupLayout.Auto&&((S=at.TypographyComposer.getWeightingForAlignment(L.alignment,this.text,this.charStyleRanges))?this.autoTextRanges=s.clone(S):(L.alignment=ht.TextFacade.getNextValidAutoAlignment(this.forma,L.alignment),this.autoTextRanges=s.clone(at.TypographyComposer.getWeightingForAlignment(L.alignment,this.text,this.charStyleRanges)))),this.styleChanged()):k&&v||this.updateGroup()},replaceFonts:function(t,e){this.beginBlockedUpdate();var o=this.replaceFontInStyle(this.lockupStyle,t,e),n=this.replaceFontInStyle(s.opt(this.lockupStyle,(function(t){return t.characterStyles[r.HIGHLIGHT_STYLE]})),t,e);this.endBlockedUpdate(),(o||n)&&(this.clearLockupFormaPool(this.layoutFormaePool_),this.styleChanged())},replaceFontInStyle:function(t,e,o){var n;return!(null==(n=s.opt(s.opt(t,(function(t){return t.font})),(function(t){return t.fontData.postScriptName})))||!e.includes(n)||(s.opt(t,(function(t){return t.font=o})),0))},clone:function(t){var e=new x.FormaControllerFactory(this.owner).createController(this.kind,t);return e.beginBlockedUpdate(),e.controllerMetadata=t.controllerMetadata,e.size=this.size,e.highlightMethod=this.highlightMethod,e.charStyleRanges=s.clone(this.charStyleRanges),e.contentID=this.contentID,e.validDecode_=this.validDecode_,e.removeListenersFromNode(),e.endBlockedUpdate(),e},match:function(t){var e;(e=s.as(t,r))?(this.size=e.size,this.highlightMethod=e.highlightMethod,0==s.count(s.opt(this.lockupStyle,(function(t){return t.characterStyles})))&&0==!this.charStyleRanges.length?this.charStyleRanges=[]:pt.TypeLockupUtils.rangesAreEqual(this.charStyleRanges,e.charStyleRanges)||this.text==e.text&&(this.charStyleRanges=s.clone(e.charStyleRanges)),pt.TypeLockupUtils.rangesAreEqual(this.autoTextRanges,e.autoTextRanges)||this.text==e.text&&(this.autoTextRanges=s.clone(e.autoTextRanges)),this.updateGroup()):b.GroupController.prototype.match.call(this,t)},formaWillChangeState:function(t,e){var o=this;if(null!=e[H.GroupForma.PROPERTY_BOUNDS]||null!=e[C.Forma.PROPERTY_STYLE]||null!=e[C.Forma.PROPERTY_PLACEMENT]){t.visitAll(C.FormaTraversal.PreOrder,(function(t){(t instanceof et.ShapeForma||t instanceof ut.TextForma)&&(o.formaUpdateEvents_.push(new D.FormaGeometryChangedEvent(t)),null!=e[C.Forma.PROPERTY_STYLE]&&o.formaUpdateEvents_.push(new D.FormaStyleChangedEvent(t)))}));for(var n=s.iter(this.formaUpdateEvents_);!n.done;n.next()){var i=n.value;i.forma.beginUpdate(i)}}},formaDidChangeState:function(t,e){if(null!=e[H.GroupForma.PROPERTY_BOUNDS]||null!=e[C.Forma.PROPERTY_STYLE]||null!=e[C.Forma.PROPERTY_PLACEMENT]){for(var o=s.iter(this.formaUpdateEvents_);!o.done;o.next()){var n=o.value;n.forma.endUpdate(n)}this.formaUpdateEvents_.splice(0)}},formaWillCommitState:function(t){b.GroupController.prototype.formaWillCommitState.call(this,t),this.shrinkPools=!0},shrinkPools:{get:function(){return this.layoutFormaePool_.shrinkPools_},set:function(t){this.layoutFormaePool_.shrinkPools_=t,this.decorationFormaePool_.shrinkPools_=t,t&&(null!=this.renderedLayoutResults_&&this.updatePoolForItems(this.renderedLayoutResults_.items,this.layoutFormaePool_),null!=this.renderedDecorationResults_&&this.updatePoolForItems(this.renderedDecorationResults_.items,this.decorationFormaePool_))}},textBacked:{get:function(){var t;return!!(t=this.lockupStyle)&&t.textBacked}},maxLineLengthDifference:{get:function(){var t=this.numLines(),e=s.repeat(1/0,t),o=s.repeat(-1/0,t);this.lockupForma.visit(C.FormaTraversal.PreOrder,(function(t,n,i){var r,a;return(r=s.as(t,ut.TextForma))&&0!=r.rangeInLockup.length&&(a=r.finalFrame)&&(e[r.rowIndex]=Math.min(e[r.rowIndex],a.minY),o[r.rowIndex]=Math.max(o[r.rowIndex],a.maxY)),!1}));for(var n=[],i=s.iter(s.range(0,t,!1));!i.done;i.next()){var r=i.value;isFinite(e[r])&&isFinite(o[r])&&n.push(o[r]-e[r])}return n.length>0?s.max(n)-s.min(n):0}},doesContrast:function(){return this.styleController.doesLockupContrastWithBackground()},contrastCheck:function(t){void 0===t&&(t=!0),this.styleController_.backgroundContrastCheck(t)},getBackgroundEdge:function(){var t,e;return(t=s.as(this.visualParent.controller,F.FrameController))&&(e=s.opt(this.forma,(function(t){return t.finalFrame})))?t.getAverageEdge(e):null},getBackgroundLightnessSpread:function(t){for(var e=100,o=0,n=s.iter(t);!n.done;n.next()){var i=n.value;e=Math.min(e,i.lightness),o=Math.max(o,i.lightness)}return Q.MathUtils.absDouble(o-e)},recordSize:function(t){this.thresholdGroupHeight=t.height,this.thresholdGroupWidth=t.width,this.size=t},snapSizeToBounds:function(){var t=new D.FormaTransformChangedEvent(this.lockupForma);if(null!=this.lockupForma.frame&&null!=this.renderedLayoutResults_){this.lockupForma.beginUpdate(t),this.lockupForma.placement=this.wrappingGroup_.placement.concat(this.lockupForma.placement);var e,o=this.renderedLayoutResults_.size;this.recordSize(o),this.lockupForma.endUpdate(t),(e=this.lockupForma.parent)&&P.GroupFacade.updateUserGroupHierarchy(e)}},isTypeLockup:{get:function(){return!0}},avgLineHeight:{get:function(){var t;return null!=(t=this.averageLineHeight)?t:-1}},averageLineHeight:{get:function(){var t;if(t=this.renderedLayoutResults_){var e=this.lockupForma.placement.transformValues.yscale;if(isFinite(t.avgTextItemHeight))return t.avgTextItemHeight*e}return null}},currentHeightScale:{get:function(){return this.getAverageFontSize()}},getSizeHeightScales:function(){return null==this.sizeHeightScales_&&this.calculateSizeHeightScales(),this.sizeHeightScales_},calculateSizeHeightScales:function(){var t=[];this.forma.placement=X.Matrix2D.Identity;for(var e=[this.size.aspectRatio,.1,.2,.3,.4,.5,.6,.8,1,1.4,2,3,5,12],o=s.iter(e);!o.done;o.next()){for(var n=o.value,i=s.opt(this.renderedLayoutResults_,(function(t){return t.size}))||new Lt.TheoSize(100*n,100),r=!1,a=s.iter(t);!a.done;a.next()){var l=a.value;Math.abs(l.size.aspectRatio-i.aspectRatio)<.01&&(r=!0)}r||t.push({size:i,scale:this.avgLineHeight})}this.sizeHeightScales_=s.clone(t)},numLines:function(){var t,e=0;if(null!=(t=s.opt(this.renderedLayoutResults_,(function(t){return t.numberOfLines}))))e=t;else{var o=-1;this.lockupForma.visit(C.FormaTraversal.PreOrder,(function(t,e,n){var i;return(i=s.as(t,ut.TextForma))&&0!=i.rangeInLockup.length&&(o=Math.max(o,i.rowIndex)),!1})),o>-1&&(e=o+1)}return e},textFrame:{get:function(){return this.textBoundsInCoordSpace(this.lockupForma.placement)}},textFinalFrame:{get:function(){var t,e=null;return(t=this.lockupForma)&&t.visitAll(C.FormaTraversal.PreOrder,(function(t){t.kind==ut.TextForma.KIND&&(e=kt.TheoRect.unionOf(e,t.finalFrame))})),e}},getKnockoutOutlines:function(t){var e,o=ft.TheoPathBuilder.init_d41d(),n=!0;if(null!=(e=t.shapeLibraryID)){var i=ot.ShapeLibrary.shapeDictionary[e];if(!i.filled)return null;n=i.clockwise}var r,a=t.boundsInCoordSpace(t.placement);return(r=this.lockupForma)&&r.visit(C.FormaTraversal.PreOrder,(function(t,e,i){var r;if(r=s.as(t,ut.TextForma)){var l=r.boundsInCoordSpace(r.placement).evalXY(.5,.5);if(!a.containsPoint(l))return!1;var u=r.fontDescriptor,h=r.fontSize,c=r.textLook,p=V.LockupStyle.isKnockoutLook(c);if(c==V.LockupTextLook.KnockoutAndShadow&&(p=0==r.fontStrokeWidth),p){var g=r.tracking,d=O.Host.textModelUtils.textOutlines(r.text,u,h,g);null!=d&&(n==O.Host.textModelUtils.fontHasClockwiseOutlines(u)&&(d=O.Host.textModelUtils.rewindPath(d)||d),o.addPath(d,r.placement))}}return!1})),null==o.path.bounds?null:o.path},textBoundsInCoordSpace:function(t){var e,o=null;if(e=this.lockupForma){var n=[];e.visit(C.FormaTraversal.PreOrder,(function(e,i,r){var a;return 0==i?n=[t]:(n=n.slice(0,i)).push(e.placement.concat(s.last(n))),(a=s.as(e,ut.TextForma))&&(o=kt.TheoRect.unionOf(o,a.boundsInCoordSpace(s.last(n)))),!1}))}return o},textBoundsInCoordSpace2:function(t){var e,o=null;return(e=this.lockupForma)&&e.visitPlaced(t,(function(t,e,n,i){var r;return(r=s.as(t,ut.TextForma))&&(o=kt.TheoRect.unionOf(o,r.boundsInCoordSpace(e))),!1})),o},shapeCount:function(){return s.as(this.lockupForma.root,J.RootForma).filterByControllerKind(B.GridController.KIND).length},wordCount:function(){return this.text.length>0?this.text.split(" ").length:0},updateScoring:function(){this.styleController_.updateScoring()},shuffleColorAssignment:function(){var t;if(t=this.lockupForma){var e=new D.FormaStyleChangedEvent(t);t.beginUpdate(e),this.styleController_.shuffleColorAssignment(),t.endUpdate(e)}},applyTextStyleSuggestion:function(t,e,o){var n,i;if(void 0===e&&(e=null),void 0===o&&(o=!0),!((n=t)&&(a=e)&&(i=a.lockupStyleEvaluator.styleEvaluatedWithReadability(n)))){var a,l=null;(a=e)&&(l=a.getTextStyleSuggestion(e)),null==l&&(l=this.getNewStyleAttributes(!0,e,o)),l.layout==V.LockupLayout.Auto&&(this.autoTextRanges=s.clone(at.TypographyComposer.getWeightingForAlignment(l.alignment,this.text)));var u=s.as(this.forma.style,V.LockupStyle);return this.forma.applyStyle(l),null!=l.font&&l.font.isSparkFont()?g.BrandingFacade.brandDocumentForElement(this.forma.page.document,l.font.sparkElementID,g.AUTHORING_CONTEXT_TYPE_FONT):s.opt(u,(function(t){return null!=t.font}))&&u.font.isSparkFont()&&g.BrandingFacade.unBrandDocumentIfNoBrandedElements(this.forma.page.document),l}if(i.layout==V.LockupLayout.Auto){var h=s.clone(at.TypographyComposer.getWeightingForAlignment(i.alignment,this.text));null!=h?this.autoTextRanges=s.clone(h):(i.alignment=ht.TextFacade.getNextValidAutoAlignment(this.forma,i.alignment),this.autoTextRanges=s.clone(at.TypographyComposer.getWeightingForAlignment(i.alignment,this.text)))}return this.forma.applyStyle(i),this.charStyleRanges.length>0&&0==s.count(i.characterStyles)?(this.getCharacterStyle(r.HIGHLIGHT_STYLE),this.updateGroup()):this.styleController.pickVisibleColorsForCharStyle()&&this.updateGroup(),null},applyNextTextEmphasisSuggestion:function(t){var e;return(e=t.postTextStylesServiceInterface.getNextTextEmphasisSuggestion())?(this.applyCharStyleFromRangeListWithoutUI(this.charStyleRanges,l.CharStyleApplyMode.Remove),s.clone(this.applyCharStyleFromRangeListWithoutUI(e,l.CharStyleApplyMode.Toggle))):[]},getNewStyleAttributes:function(t,e,o){for(var n=s.iter(s.range(0,5,!1));!n.done;n.next()){var i;if(i=this.styleController_.getNewStyleAttributes(t,e,o))return i}return s.opt(O.Host.logging,(function(t){return t.info("unable to find a suitable style using the evaluator, return a potential bad style")})),this.styleController_.getNewStyleAttributes(t,e,!1)},generateAndApplyInitialStyleAttributes:function(){this.styleController_.generateAndApplyInitialStyleAttributes(),s.isEmpty(this.text)||this.snapSizeToBounds()},clearLockupFormaPool:function(t){for(var e=s.iter(t.configureTextFormae({}));!e.done;e.next()){var o=e.value;s.opt(o.parent,(function(t){return t.removeChild(o)}))}for(var n=s.iter(t.configureShapeFormae(0));!n.done;n.next())o=n.value,s.opt(o.parent,(function(t){return t.removeChild(o)}))},preferredXAlignment:{get:function(){return this.lockupStyle.alignment==V.LockupAlignment.Left?h.AlignmentType.Left:this.lockupStyle.alignment==V.LockupAlignment.Right?h.AlignmentType.Right:h.AlignmentType.CenterX}},setAlignmentType:function(t){this.numLines()>1&&(t==h.AlignmentType.Left&&s.opt(this.lockupStyle,(function(t){return t.alignment!=V.LockupAlignment.UNSET}))&&s.opt(this.lockupStyle,(function(t){return t.alignment!=V.LockupAlignment.Left}))&&(this.lockupStyle.alignment=V.LockupAlignment.Left),t==h.AlignmentType.Right&&s.opt(this.lockupStyle,(function(t){return t.alignment!=V.LockupAlignment.UNSET}))&&s.opt(this.lockupStyle,(function(t){return t.alignment!=V.LockupAlignment.Right}))&&(this.lockupStyle.alignment=V.LockupAlignment.Right),t==h.AlignmentType.CenterX&&s.opt(this.lockupStyle,(function(t){return t.alignment!=V.LockupAlignment.UNSET}))&&s.opt(this.lockupStyle,(function(t){return t.alignment!=V.LockupAlignment.Center}))&&(this.lockupStyle.alignment=V.LockupAlignment.Center))},canClaimForma:function(t){return!1},getPinBounds:function(t){var e,o=s.opt(this.lockupForma,(function(t){return t.bounds}));return(e=this.lockupStyle)&&(o=t==dt.PinBoundsType.Bounds||e.backing==V.LockupBacking.Banner||e.backing==V.LockupBacking.BannerHorizontal||e.backing==V.LockupBacking.BannerVertical?this.textBoundsInCoordSpace(X.Matrix2D.Identity):this.lockupForma.childrenBoundsInCoordSpace(X.Matrix2D.Identity)),o},centerAlignmentIfSingleLine:function(){var t=this,e=s.opt(s.opt(this.wrappingGroup_,(function(t){return t.bounds})),(function(e){return e.equalWithAccuracy(t.forma.bounds,.01)}));1!=this.numLines()||null==e||!e||this.lockupStyle.alignment!=V.LockupAlignment.Left&&this.lockupStyle.alignment!=V.LockupAlignment.Right||(this.lockupStyle.alignment=V.LockupAlignment.Center)},preventOutofBoundsOrOverlap:function(t){var e,o;(e=this.textFinalFrame)&&(o=this.lockupForma)&&!t.contains(e)&&(e.minX<t.minX&&o.move(X.Matrix2D.translationXY(-1*(e.minX-t.minX)+10,0)),e.maxX>t.maxX&&o.move(X.Matrix2D.translationXY(t.maxX-e.maxX-10,0)),e.minY<t.minY&&o.move(X.Matrix2D.translationXY(0,-1*(e.minY-t.minY)+10)),e.maxY>t.maxY&&o.move(X.Matrix2D.translationXY(0,t.maxY-e.maxY-10)))},addForma:function(t,e,o){var n,i,a,l=this;if((n=s.as(t.root,J.RootForma))&&(i=s.as(e,H.GroupForma))&&(a=s.as(e.controller,r))){this.beginBlockedUpdate(),o.suggestPlacement||e.controller.fit(n.frame.insetRel(.25,.25,.25,.25)),e.applyStyle(V.LockupStyle.createDefault());var u=!1,h=s.clone(n.filterWithCallback((function(t){return t instanceof z.ImageForma&&t.parent instanceof _.FrameForma}))),c=null;h.length>0&&(c=s.as(h[0],z.ImageForma)),n.visitAll(C.FormaTraversal.PreOrder,(function(t){var o,n;if((o=s.as(t.controller,r))&&s.opt(o.lockupStyle,(function(t){return t.backing!=V.LockupBacking.Knockout}))&&(n=s.as(s.opt(o.lockupStyle,(function(t){return t.clone()})),V.LockupStyle))){var i=V.LockupStyle.isLetterGrid(n.layout),a=V.LockupStyle.isPath(n.layout);if(i||a){if(n.layout=V.LockupLayout.Standard,a)n.alignment=V.LockupAlignment.Center;else for(var l=s.iter(n.characterStyles);!l.done;l.next()){var h=l.value;h.backing==V.LockupBacking.UNSET&&(h.backing=V.LockupBacking.None)}n.tracking=V.LockupStyle.DEFAULT_TRACKING}e.applyStyle(n),u=!0}}));var p=s.clone(n.filterByControllerKind(B.GridController.KIND));if(1==p.length?p[0].appendChild(e):n.appendChild(e),this.endBlockedUpdate(),this.updateGroup(),o.suggestPlacement){var g,d=m.CorePromise.resolve(null);return(g=s.opt(s.opt(c,(function(t){return t.contentNode})),(function(t){return t.image})))&&(g.loaded()||(e.moveCenterToPoint(new yt.TheoPoint(-n.frame.center.x,n.frame.center.y)),d=g.whenLoaded())),d.then((function(t){return l.placeStyleLockup(i,n,a,u),m.CorePromise.resolve(null)}))}return m.CorePromise.resolve(null)}return m.CorePromise.reject("TypeLockupController.addFormaToRoot: no lockup forma")},getBackingContrastRole:function(){var t;if(t=this.lockupStyle){var e=t.textLook==V.LockupTextLook.KnockoutOnly||t.textLook==V.LockupTextLook.OutlineOnly,o=t.strokeWeight>.15;return e||o||t.textBacked?L.ColorRole.FieldSecondary:L.ColorRole.FieldPrimary}return L.ColorRole.FieldPrimary},getSuggestableColors:function(){return this.styleController_.getSuggestableColors()},getCurrentColorsWithRole:function(t,e){void 0===e&&(e=!1);var o,n,i,r,a=[];return e&&!this.primaryColorVisible()||((o=t.colors.color(L.ColorRole.FieldPrimary))?a.push(new S.SolidColorWithRole(L.ColorRole.FieldPrimary,o)):(d.CoreAssertDebugOnly.fail("Unexpected: ColorTable doesn't have primary color",void 0,"TypeLockupController.getCurrentColorsWithRole","TypeLockupController.swift",3856),a.push(new S.SolidColorWithRole(L.ColorRole.FieldPrimary,$.SolidColor.WHITE)))),e&&!this.secondaryColorVisible()||((n=t.colors.color(L.ColorRole.FieldSecondary))?a.push(new S.SolidColorWithRole(L.ColorRole.FieldSecondary,n)):(d.CoreAssertDebugOnly.fail("Unexpected: ColorTable doesn't have secondary color",void 0,"TypeLockupController.getCurrentColorsWithRole","TypeLockupController.swift",3866),a.push(new S.SolidColorWithRole(L.ColorRole.FieldSecondary,$.SolidColor.BLACK)))),e&&!this.borderColorVisible()||((i=t.colors.color(L.ColorRole.Border))?a.push(new S.SolidColorWithRole(L.ColorRole.Border,i)):(d.CoreAssertDebugOnly.fail("Unexpected: ColorTable doesn't have border color",void 0,"TypeLockupController.getCurrentColorsWithRole","TypeLockupController.swift",3876),a.push(new S.SolidColorWithRole(L.ColorRole.Border,$.SolidColor.BLACK)))),e&&!this.shadowColorVisible()||((r=t.colors.color(L.ColorRole.Shadow))?a.push(new S.SolidColorWithRole(L.ColorRole.Shadow,r)):(d.CoreAssertDebugOnly.fail("Unexpected: ColorTable doesn't have shadow color",void 0,"TypeLockupController.getCurrentColorsWithRole","TypeLockupController.swift",3886),a.push(new S.SolidColorWithRole(L.ColorRole.Shadow,$.SolidColor.BLACK)))),a},applyColors:function(t,e){this.styleController_.applyColors(t,e)},primaryColorVisible:function(){return this.styleController.targetedTextLook!=V.LockupTextLook.KnockoutOnly&&this.styleController.targetedTextLook!=V.LockupTextLook.OutlineOnly&&this.styleController.targetedTextLook!=V.LockupTextLook.ShadowOutlineTransparentText&&this.styleController.targetedTextLook!=V.LockupTextLook.KnockoutAndShadow&&this.styleController.targetedTextLook!=V.LockupTextLook.KnockoutShadowOutline&&this.styleController.targetedTextLook!=V.LockupTextLook.KnockoutAndOutline},secondaryColorVisible:function(){var t,e,o=this.styleController.targetedLockupStyle.backing;return o==V.LockupBacking.UNSET&&(N.LegacyCoreAssert.isTrue(V.LockupStyle.isLetterGrid((t=s.opt(this.lockupStyle,(function(t){return t.layout})))||null!=t?t:V.LockupLayout.Standard),"LockupBacking.UNSET in secondary styles for non-letter-grid layouts?",void 0,"TypeLockupController.secondaryColorVisible","TypeLockupController.swift",3914),o=(e=s.opt(this.lockupStyle,(function(t){return t.backing})))||null!=e?e:V.LockupBacking.None),o!=V.LockupBacking.None},borderColorVisible:function(){var t=this,e=this.styleController.targetedTextLook;return!!(e==V.LockupTextLook.OutlineOnly||e==V.LockupTextLook.KnockoutAndOutline||e==V.LockupTextLook.FillAndOutline||e==V.LockupTextLook.ShadowAndOutline||e==V.LockupTextLook.FillAndOutline2||e==V.LockupTextLook.KnockoutShadowOutline||e==V.LockupTextLook.ShadowOutlineTransparentText||e==V.LockupTextLook.KnockoutAndFill&&s.opt(this.lockupStyle,(function(e){return e.colors.colorID(L.ColorRole.FieldPrimary)==s.opt(t.lockupStyle,(function(t){return t.colors.colorID(L.ColorRole.FieldSecondary)}))})))},shadowColorVisible:function(){var t=this.styleController.targetedTextLook;return t==V.LockupTextLook.Shadow||t==V.LockupTextLook.ShadowAndOutline||t==V.LockupTextLook.KnockoutAndShadow||t==V.LockupTextLook.KnockoutShadowOutline||t==V.LockupTextLook.ShadowOutlineTransparentText},applyOpacity:function(t){this.styleController_.setOpacity(t)},currentOpacity:{get:function(){return this.styleController.getOpacityValue()}},applyTextOpacity:function(t){this.styleController_.setTextOpacity(t)},currentTextOpacity:{get:function(){return this.styleController.getTextOpacityValue()}},applyShapeOpacity:function(t){this.styleController_.setShapeOpacity(t)},currentShapeOpacity:{get:function(){return this.styleController.getShapeOpacityValue()}},getHighlightMethodName:function(t){return t==l.HighlightMethod.Manual?"k_HighlightMethod_None":t==l.HighlightMethod.Numbers?"k_HighlightMethod_Numbers":t==l.HighlightMethod.Nouns?"k_HighlightMethod_Nouns":t==l.HighlightMethod.Verbs?"k_HighlightMethod_Verbs":t==l.HighlightMethod.Names?"k_HighlightMethod_Names":t==l.HighlightMethod.Adjectives?"k_HighlightMethod_Adjectives":t==l.HighlightMethod.SmallWords?"k_HighlightMethod_SmallWords":t==l.HighlightMethod.EvenRows||t==l.HighlightMethod.OddRows||t==l.HighlightMethod.Bracket||t==l.HighlightMethod.InsideBracket?"k_HighlightMethod_Lines":t==l.HighlightMethod.EvenWords||t==l.HighlightMethod.OddWords?this.text.includes(" ")?"k_HighlightMethod_Words":"k_HighlightMethod_Letters":t==l.HighlightMethod.First?"k_HighlightMethod_First":t==l.HighlightMethod.Last?"k_HighlightMethod_Last":s.toString(this.highlightMethod)},placeStyleLockup:function(t,e,o,n){var i;if(i=new M.FormaPlacementSuggester(t,e).fastPlacement()){var r=new D.FormaTransformChangedEvent(t);r.duration=0,t.beginUpdate(r),i.apply(),o.text.length>0&&this.snapSizeToBounds(),o.updateScoring(),n?o.styleController.doesLockupContrastWithBackground()||o.styleController.pickVisibleColorsForLockup():o.generateAndApplyInitialStyleAttributes(),t.endUpdate(r)}},incrementHighlightMethod:function(){this.highlightMethod==l.HighlightMethod.Manual?this.highlightMethod=l.HighlightMethod.Numbers:this.highlightMethod==l.HighlightMethod.Numbers?this.highlightMethod=l.HighlightMethod.Nouns:this.highlightMethod==l.HighlightMethod.Nouns?this.highlightMethod=l.HighlightMethod.Verbs:this.highlightMethod==l.HighlightMethod.Verbs?this.highlightMethod=l.HighlightMethod.Names:this.highlightMethod==l.HighlightMethod.Names?this.highlightMethod=l.HighlightMethod.Adjectives:this.highlightMethod==l.HighlightMethod.Adjectives?this.highlightMethod=l.HighlightMethod.SmallWords:this.highlightMethod==l.HighlightMethod.SmallWords?this.highlightMethod=l.HighlightMethod.EvenRows:this.highlightMethod==l.HighlightMethod.EvenRows||this.highlightMethod==l.HighlightMethod.OddRows?this.highlightMethod=l.HighlightMethod.EvenWords:this.highlightMethod==l.HighlightMethod.EvenWords||this.highlightMethod==l.HighlightMethod.OddWords?this.highlightMethod=l.HighlightMethod.InsideBracket:this.highlightMethod==l.HighlightMethod.First||this.highlightMethod==l.HighlightMethod.Last?this.highlightMethod=l.HighlightMethod.Numbers:this.highlightMethod!=l.HighlightMethod.Bracket&&this.highlightMethod!=l.HighlightMethod.InsideBracket||(this.highlightMethod=l.HighlightMethod.Numbers)},getNextRanges:function(t,e){var o=this,n=[],i=pt.TypeLockupUtils.getWordRanges(t,this.highlightMethod);if(0==i.length||t.length<2)return n;var a=s.chars(t),u=E.GraphemeUtils.countGraphemes(t),h=1==i.length&&0==i[0].start&&i[0].end==u;if(e&&t.includes(" ")&&this.highlightMethod==l.HighlightMethod.Manual)return n.push(i[0]),n;if(this.highlightMethod>=r.FIRST_NLP_METHOD&&this.highlightMethod<=r.MAX_NLP_METHOD){var c=t;c==c.toUpperCase()&&(c=c.toLowerCase()),c=s.replaceAll(c,"\n"," ");var p=s.clone(O.Host.textModelUtils.getWordClassRanges(c,this.highlightMethod-r.FIRST_NLP_METHOD));if(h)for(var g=s.iter(p);!g.done;g.next()){var d=g.value;n.push(d)}else this.lockupForma.visit(C.FormaTraversal.PreOrder,(function(t,e,o){var i;if(i=s.as(t,ut.TextForma))for(var r=i.rangeInLockup,a=s.iter(p);!a.done;a.next()){var l=a.value;l.start>=r.start&&l.end<=r.end&&n.push(r)}return!1}));e&&this.highlightMethod==l.HighlightMethod.Numbers&&0==!n.length&&0!=n[0].start&&n.splice(0)}else if(this.highlightMethod==l.HighlightMethod.EvenWords||this.highlightMethod==l.HighlightMethod.OddWords){for(var f=s.iter(s.toSequence(i));!f.done;f.next()){var y=f.value,m=y.offset,k=y.element;(this.highlightMethod==l.HighlightMethod.EvenWords&&m%2==0||this.highlightMethod==l.HighlightMethod.OddWords&&m%2!=0)&&n.push(k)}if((this.highlightMethod==l.HighlightMethod.EvenWords||this.highlightMethod==l.HighlightMethod.OddWords)&&h){n.splice(0);for(var L=s.iter(s.range(0,u,!1));!L.done;L.next()){var S=L.value;(this.highlightMethod==l.HighlightMethod.EvenWords&&S%2==0||this.highlightMethod==l.HighlightMethod.OddWords&&S%2!=0)&&n.push(new mt.TextRange(S,S+1))}}}else if(this.highlightMethod!=l.HighlightMethod.Bracket&&this.highlightMethod!=l.HighlightMethod.InsideBracket||!(i.length<3)||!pt.TypeLockupUtils.isCurlyQuote(a[0])&&"("!=a[0]||!pt.TypeLockupUtils.isCurlyQuote(a[a.length-1])&&")"!=a[a.length-1]){var v=0;this.lockupForma.visit(C.FormaTraversal.PreOrder,(function(t,e,i){var r;if(r=s.as(t,ut.TextForma)){var a=r.rangeInLockup;(o.highlightMethod==l.HighlightMethod.EvenRows&&r.rowIndex%2==0||o.highlightMethod==l.HighlightMethod.OddRows&&r.rowIndex%2!=0)&&n.push(a),v=Math.max(v,r.rowIndex)}return!1})),this.highlightMethod!=l.HighlightMethod.EvenRows&&this.highlightMethod!=l.HighlightMethod.OddRows||0!=v||n.splice(0),(this.highlightMethod==l.HighlightMethod.First||this.highlightMethod==l.HighlightMethod.Last)&&0!=v||(this.highlightMethod==l.HighlightMethod.Bracket||this.highlightMethod==l.HighlightMethod.InsideBracket)&&v>1?(n.splice(0),this.lockupForma.visit(C.FormaTraversal.PreOrder,(function(t,e,i){var r;if(r=s.as(t,ut.TextForma)){var a=r.rangeInLockup;(o.highlightMethod!=l.HighlightMethod.First&&o.highlightMethod!=l.HighlightMethod.Bracket||0!=r.rowIndex)&&(o.highlightMethod!=l.HighlightMethod.Last&&o.highlightMethod!=l.HighlightMethod.Bracket||r.rowIndex!=v)?o.highlightMethod==l.HighlightMethod.InsideBracket&&0!=r.rowIndex&&r.rowIndex!=v&&n.push(a):n.push(a)}return!1}))):this.highlightMethod==l.HighlightMethod.First||this.highlightMethod==l.HighlightMethod.Last||this.highlightMethod==l.HighlightMethod.Bracket?(this.highlightMethod!=l.HighlightMethod.First&&this.highlightMethod!=l.HighlightMethod.Bracket||n.push(i[0]),this.highlightMethod!=l.HighlightMethod.Last&&this.highlightMethod!=l.HighlightMethod.Bracket||n.push(i[i.length-1])):this.highlightMethod==l.HighlightMethod.InsideBracket&&i.length>1&&n.push(new mt.TextRange(i[0].end,i[i.length-1].start))}else{n.splice(0);var T=h?u:s.chars(t).length;this.highlightMethod==l.HighlightMethod.Bracket?(n.push(new mt.TextRange(0,1)),n.push(new mt.TextRange(T-1,T))):this.highlightMethod==l.HighlightMethod.InsideBracket&&n.push(new mt.TextRange(1,T-1))}return s.sortInPlace(n,(function(t,e){return t.start<e.start})),n=s.clone(pt.TypeLockupUtils.cleanupAndMerge(n))},hasTextFormae:function(){var t;return!!(t=this.lockupForma)&&null!=t.findDescendant((function(t){return t instanceof ut.TextForma}))},getTextFormaCount:function(){var t=0;return s.opt(this.lockupForma,(function(e){return e.visit(C.FormaTraversal.PreOrder,(function(e,o,n){return e instanceof ut.TextForma&&(t+=1),!1}))})),t},getAllTextFormae:function(){var t=[];return this.lockupForma.visit(C.FormaTraversal.PreOrder,(function(e,o,n){var i;return(i=s.as(e,ut.TextForma))&&t.push(i),!1})),t},groupLetterFormaeByWord:function(){var t=this,e=s.clone(this.getAllTextFormae());e=s.clone(pt.TypeLockupUtils.sortTextFormae(e));var o=pt.TypeLockupUtils.getBreakRanges(this.text);return mt.TextRange.makeRangesContiguous(o),o.map((function(o){return e.filter((function(t){return o.contains(t.rangeInLockup)}),t)}),this).filter((function(t){return 0==!t.length}),this)},updateMethodToMatchCharStyleRange:function(t){var e=s.clone(this.charStyleRanges);if(0==!e.length&&this.highlightMethod==l.HighlightMethod.Manual){N.LegacyCoreAssert.isTrue(!s.isEmpty(t),"Asked to update highlight method to match char style range when there is no text",void 0,"TypeLockupController.updateMethodToMatchCharStyleRange","TypeLockupController.swift",4321),this.incrementHighlightMethod();for(var o=s.clone(this.getNextRanges(t,!1)),n=0;!r.rangesEqual(o,e);)if(this.incrementHighlightMethod(),o=s.clone(this.getNextRanges(t,!1)),(n+=1)>r.NUM_HIGHLIGHTMETHODS){this.highlightMethod=l.HighlightMethod.Manual;break}}},autoApplyCharStyle:function(t,e,o){var n;if(void 0===o&&(o=!1),!o){if(0==this.charStyleRanges.length&&t&&!e)return;if(0==!this.charStyleRanges.length&&!t&&!e)return}var i=s.clone(this.charStyleRanges);e&&this.incrementHighlightMethod();var a=(n=s.opt(this.lockupStyle,(function(t){return t.layout})))||null!=n?n:V.LockupLayout.Standard;0==i.length&&this.highlightMethod==l.HighlightMethod.Manual&&V.LockupStyle.doesPerLetterLayout(a)&&(this.highlightMethod=l.HighlightMethod.OddWords);var u=s.clone(this.getNextRanges(this.text,0==i.length));if(0!=!u.length||e||!r.rangesEqual(u,i)){var h=new D.FormaAnimationTransactionEvent(this.forma);if(h.duration=0,this.forma.beginUpdate(h),this.lockupForma.style.notifyBefore(),this.charStyleRanges=[],!o)for(var c=0;0==u.length||e&&r.rangesEqual(u,i)||0==u[0].start&&u[0].end==this.text.length;)if(this.incrementHighlightMethod(),u=s.clone(this.getNextRanges(this.text,!1)),(c+=1)>r.NUM_HIGHLIGHTMETHODS){u.splice(0),this.highlightMethod=l.HighlightMethod.Manual;break}this.charStyleRanges=s.clone(u),this.lockupForma.style.notifyAfter(),this.forma.endUpdate(h)}},applyCharStyle:function(t,e,o,n,i){var r;void 0===i&&(i=!0);var a=new mt.TextRange(0,0);if(t.lockupForma!=this.lockupForma)return this.selectCharStyleForma(),a;a=t.rangeInLockup;var l=(r=s.opt(this.lockupStyle,(function(t){return t.layout})))||null!=r?r:V.LockupLayout.Standard;if(V.LockupStyle.doesPerLetterLayout(l)){var u,h=pt.TypeLockupUtils.getWordRanges(this.text,this.highlightMethod);h.length>1&&(u=h.find((function(t){return t.contains(a)}),this))&&(a=u)}var c=new D.FormaAnimationTransactionEvent(this.forma);c.duration=0,this.forma.beginUpdate(c),this.lockupForma.style.notifyBefore();var p=this.applyCharStyleDirectly(a,n,o);return 1==i&&this.selectCharStyleForma(),this.lockupForma.style.notifyAfter(),this.forma.endUpdate(c),p},applyCharStyleFromRangeListWithoutUI:function(t,e){var o=new D.FormaAnimationTransactionEvent(this.forma);o.duration=0,this.forma.beginUpdate(o),this.lockupForma.style.notifyBefore();for(var n=[],i=s.iter(t);!i.done;i.next()){var r=i.value;n.push(this.applyCharStyleDirectly(r,r,e))}return this.lockupForma.style.notifyAfter(),this.forma.endUpdate(o),n},applyCharStyleDirectly:function(t,e,o,n){void 0===n&&(n=!0);var i=t;this.highlightMethod=l.HighlightMethod.Manual;var a=!1,u=i;o==l.CharStyleApplyMode.Apply&&0!=e.length&&(i=pt.TypeLockupUtils.getNewCharSelectionRange(e,i,this.initialCharStyleRanges_));for(var h=-1,c=s.iter(s.toSequence(this.charStyleRanges));!c.done;c.next()){var p=c.value,g=p.offset,d=p.element;i.start>=d.start&&i.start<d.end&&(h=g)}var f=s.clone(this.charStyleRanges);if(h>-1){var y=f[h];o==l.CharStyleApplyMode.SwipeApply?f[h]=new mt.TextRange(Math.min(i.start,y.start),Math.max(i.end,y.end)):o!=l.CharStyleApplyMode.Apply?y.length!=i.length?(i.end>=y.end?f.splice(h,1):f[h]=new mt.TextRange(i.end,y.end),y.start<i.start&&f.splice(h,0,new mt.TextRange(y.start,i.start))):f.splice(h,1):o!=l.CharStyleApplyMode.Remove&&(a=!0,f[h]=i),this.charStyleRanges=s.clone(f)}else o!=l.CharStyleApplyMode.Remove&&(a=!0,f.push(i),s.sortInPlace(f,(function(t,e){return t.start<e.start})),this.charStyleRanges=s.clone(f),0==s.count(this.lockupStyle.characterStyles)&&this.getCharacterStyle(r.HIGHLIGHT_STYLE));n&&(this.charStyleRanges=s.clone(pt.TypeLockupUtils.cleanupAndMerge(this.charStyleRanges)));var m=new mt.TextRange(0,0);if(a)for(var k=s.iter(this.charStyleRanges);!k.done;k.next())d=k.value,u.start>=d.start&&u.end<=d.end&&(m=d);return m},getCharacterStyle:function(t){var e=this.lockupStyle.characterStyles[t];return null==e&&(e=V.LockupStyle.createDefaultCharacterStyle(this.lockupStyle),this.lockupStyle.setCharacterStyle(t,e),this.styleController.pickVisibleColorsForCharStyle()),e},getCharacterStyleRanges:function(){return this.charStyleRanges},clearCharStyle:function(){this.highlightMethod=l.HighlightMethod.Manual,0!=this.charStyleRanges.length&&(this.lockupForma.style.notifyBefore(),this.charStyleRanges=[],this.lockupForma.style.notifyAfter())},selectCharStyleForma:function(){var t=this;this.owner.selection.clearSelectionNoUpdate(),this.owner.selection.selectForma(this.lockupForma,!1),this.lockupForma.visit(C.FormaTraversal.PreOrder,(function(e,o,n){var i;if(i=s.as(e,ut.TextForma))for(var r=i.rangeInLockup,a=s.iter(t.charStyleRanges);!a.done;a.next()){var l=a.value;if(r.start>=l.start&&r.start<l.end){var u=i.textLook;if(V.LockupStyle.isShadowLook(u)||u==V.LockupTextLook.KnockoutAndOutline){var h=i.fontColor;if(h.isEqual(t.styleController.targetedLockupStyle.colors.fieldSecondary)||h.isEqual(i.fontStrokeColor))continue}t.owner.selection.selectForma(i,!1)}}return!1})),this.owner.selection.publish(new nt.SelectionStateChangedMessage(this.owner.selection))},beginTouches:function(){this.initialCharStyleRanges_=s.clone(this.charStyleRanges)},clearInitialCharStyleRanges:function(){this.initialCharStyleRanges_=[]},updateTouches:function(t,e,o,n){void 0===n&&(n=null);var i=s.opt(this.lockupForma,(function(e){return e.page.formaAtPoint(t,void 0,[ut.TextForma.KIND])}));null!=i&&i instanceof ut.TextForma&&i.lockupForma!=this.lockupForma&&(i=null);var a,u=o?100:-100;if(null==i||!(i instanceof ut.TextForma)){var h=new yt.TheoPoint(t.x+u,t.y);i=s.opt(this.lockupForma,(function(t){return t.page.formaAtPoint(h,void 0,[ut.TextForma.KIND])}))}if(a=s.as(i,ut.TextForma)){if(null!=n&&0!=s.count(this.lockupStyle.characterStyles)&&s.opt(this.lockupStyle.characterStyles[r.HIGHLIGHT_STYLE],(function(t){return null!=t.font}))){var c,p=s.opt(this.lockupForma,(function(t){return t.page.formaAtPoint(n,void 0,[ut.TextForma.KIND])}));if(null==p||!(p instanceof ut.TextForma)){var g=new yt.TheoPoint(n.x+u,n.y);p=s.opt(this.lockupForma,(function(t){return t.page.formaAtPoint(g,void 0,[ut.TextForma.KIND])}))}if((c=s.as(p,ut.TextForma))&&c.rowIndex==a.rowIndex)for(var d=s.opt(s.opt(this.lockupForma,(function(t){return t.totalPlacement.inverse})),(function(e){return e.transformPoint(t)}))||t,f=s.opt(s.opt(this.lockupForma,(function(t){return t.totalPlacement.inverse})),(function(t){return t.transformPoint(n)}))||n,y=d.x>=f.x,m=d.x<=f.x,k=s.iter(this.charStyleRanges);!k.done;k.next()){var L=k.value;if(o){if(m&&a.rangeInLockup.start>=L.start&&a.rangeInLockup.start<L.end){if(a.rangeInLockup.end<L.end)return;break}if(y&&a.rangeInLockup.end==L.start)return}else{if(y&&a.rangeInLockup.start>=L.start&&a.rangeInLockup.start<L.end){if(a.rangeInLockup.end<L.end)return;break}if(m&&a.rangeInLockup.start==L.end)return}}}this.applyCharStyle(a,r.HIGHLIGHT_STYLE,l.CharStyleApplyMode.Apply,e.rangeInLockup)}},enterCharStyleModeWithTextForma:function(t,e){if(this.owner.allowSelectionChanges){var o=0==this.charStyleRanges.length;if(0==t.rangeInLockup.length){this.lockupForma.style.notifyBefore(),this.getCharacterStyle(r.HIGHLIGHT_STYLE),this.lockupForma.style.notifyAfter();var n=s.opt(this.lockupForma,(function(t){return t.page.formaAtPoint(e,void 0,[ut.TextForma.KIND])}));null!=n&&n instanceof ut.TextForma&&(s.opt(s.opt(t.page.document,(function(t){return t.controller})),(function(t){return t.selection.inCharStyleMode=!0})),this.styleController.pickVisibleColorsForCharStyle(),this.selectCharStyleForma(),this.applyCharStyle(n,r.HIGHLIGHT_STYLE,l.CharStyleApplyMode.SwipeApply,new mt.TextRange(0,0)))}else s.opt(s.opt(t.page.document,(function(t){return t.controller})),(function(t){return t.selection.inCharStyleMode=!0})),0==this.charStyleRanges.length&&this.styleController.pickVisibleColorsForCharStyle(),this.selectCharStyleForma(),this.applyCharStyle(t,r.HIGHLIGHT_STYLE,l.CharStyleApplyMode.SwipeApply,new mt.TextRange(0,0));o&&1==this.charStyleRanges.length&&0==this.charStyleRanges[0].start&&this.charStyleRanges[0].end==this.text.length&&(this.charStyleRanges=[],this.autoApplyCharStyle(!1,!1,!1),this.selectCharStyleForma())}},applyPredefinedCharStyle:function(t){var e=this.highlightMethod==t;if(this.highlightMethod=t,t==l.HighlightMethod.SmallWords){this.styleController.applyBacking(V.LockupBacking.None,null),e||this.lockupStyle.setCharacterStyles({});var o=this.getCharacterStyle(r.HIGHLIGHT_STYLE);o.spacing=.5,o.colors.setColorId(L.ColorRole.FieldPrimary,this.lockupStyle.colors.colorID(L.ColorRole.FieldPrimary)),o.colors.setColorId(L.ColorRole.FieldSecondary,this.lockupStyle.colors.colorID(L.ColorRole.FieldSecondary)),e?o.layout==V.LockupLayout.Standard&&o.alignment==V.LockupAlignment.Center&&0==o.lineBreakAtCharacterStyleSizeChange?(o.alignment=V.LockupAlignment.Right,o.lineBreakAtCharacterStyleSizeChange=!1):o.layout==V.LockupLayout.Standard&&o.alignment==V.LockupAlignment.Right?(o.alignment=V.LockupAlignment.Center,o.lineBreakAtCharacterStyleSizeChange=!0):o.layout==V.LockupLayout.UNSET&&0==o.lineBreakAtCharacterStyleSizeChange?(o.alignment=V.LockupAlignment.Center,o.layout=V.LockupLayout.Standard,o.lineBreakAtCharacterStyleSizeChange=!1):(o.alignment=V.LockupAlignment.UNSET,o.layout=V.LockupLayout.UNSET,o.lineBreakAtCharacterStyleSizeChange=!1):o.lineBreakAtCharacterStyleSizeChange=!1,this.autoApplyCharStyle(!0,!1,!0)}else this.highlightMethod==l.HighlightMethod.Manual?this.clearCharStyle():t==l.HighlightMethod.Nouns?(this.styleController.applyBacking(V.LockupBacking.Rows,null),this.lockupStyle.setCharacterStyles({}),this.getCharacterStyle(r.HIGHLIGHT_STYLE),this.autoApplyCharStyle(!0,!1,!0)):(e&&(this.highlightMethod==l.HighlightMethod.EvenRows?this.highlightMethod=l.HighlightMethod.OddRows:this.highlightMethod==l.HighlightMethod.OddRows?this.highlightMethod=l.HighlightMethod.Bracket:this.highlightMethod==l.HighlightMethod.Bracket?this.highlightMethod=l.HighlightMethod.InsideBracket:this.highlightMethod==l.HighlightMethod.InsideBracket&&(this.highlightMethod=l.HighlightMethod.EvenRows)),this.lockupStyle.setCharacterStyles({}),this.getCharacterStyle(r.HIGHLIGHT_STYLE));this.forma.controller.styleChanged()},snapToClosestExistingSize:function(t){var e=this;if(!s.opt(this.lockupStyle,(function(t){return t.layout==V.LockupLayout.FitJustified&&1!=e.numLines()}))){var o=s.clone(pt.TypeLockupUtils.sizesInDocument(this.forma.page.document)),n=this.getCurrentFontSize();if(0!=n){for(var i=t,r=s.iter(o);!r.done;r.next()){var a=r.value;(n!=a||t==n)&&Math.abs(n-a)<Math.abs(n-i)&&(i=a)}var l=i/n;if(!(0==i||l>1.2||l<(t==i?.2:.8))){var u=new Lt.TheoSize(this.forma.bounds.width*l,this.forma.bounds.height*l),h=new A.FormaResizeEvent(this.forma,u,yt.TheoPoint.ZERO);this.onEvent(h)}}}},getCurrentFontSize:function(){var t,e,o=0,n=!1;if(e=this.lockupForma){if(s.opt(this.lockupStyle,(function(t){return t.layout==V.LockupLayout.Auto}))){var i=0,r=0;e.visit(C.FormaTraversal.PreOrder,(function(t,e,o){var a;return!!(a=s.as(t,ut.TextForma))&&(i+=a.fontSize,r+=1,n=!0,!1)})),r>0&&(o=i/s.toDouble(r))}else e.visit(C.FormaTraversal.PreOrder,(function(t,e,i){var r;return!!(r=s.as(t,ut.TextForma))&&(o=r.fontSize,n=!0,!0)}));o*=this.lockupForma.placement.extractedScale.scale.x}if(0==o&&this.text.length>0){var a=null==this.lockupForma?" - no lockup":"",l=n?a:" - no text forma",u=(t=s.opt(this.lockupStyle,(function(t){return t.layoutType})))||null!=t?t:"nilStyle";return s.opt(O.Host.logging,(function(t){return t.warning("tried to return a font size of 0.0 "+l+" layoutType: "+u)})),1}return o},getAverageFontSize:function(){var t,e=this;if(t=this.lockupForma){var o=[];if(t.visit(C.FormaTraversal.PreOrder,(function(t,n,i){var r;if(r=s.as(t,ut.TextForma)){var a=r.fontSize;if(o.push(a*e.lockupForma.placement.extractedScale.scale.x),s.opt(e.lockupStyle,(function(t){return t.layout!=V.LockupLayout.FitJustified})))return!0}return!1})),o.length>0)return o.reduce((function(t,e){return t+e}),0)/s.toDouble(o.length)}return 0},getFontSizeSnapValues:function(){var t=[];if(this.styleController.targetedLockupStyle!==this.lockupStyle)return t.push(100),t;var e=s.clone(pt.TypeLockupUtils.sizesInDocument(this.forma.page.document,this.forma));s.sortInPlace(e);var o=this.getCurrentFontSize(),n=0;if(0!=o)for(var i=s.iter(e);!i.done;i.next()){var r=i.value;Math.round(r)==n&&r!=o||(n=Math.round(r),t.push(r))}return t},scale:function(t,e){void 0===e&&(e=new yt.TheoPoint(.5,.5));var o=this.forma.placement.transformValues,n=this.forma.bounds,i=new Lt.TheoSize(n.width*o.xscale,n.height*o.xscale),r=new Lt.TheoSize(i.width*t,i.height*t),a=this.forma.boundsInCoordSpace(this.forma.placement);Math.round(1e3*r.width)==Math.round(1e3*a.width)&&Math.round(1e3*r.height)==Math.round(1e3*a.height)||(this.onEvent(new A.BeginFormaResizeEvent(this.forma,yt.TheoPoint.ZERO)),this.onEvent(new A.FormaResizeEvent(this.forma,r,e)),this.onEvent(new A.EndFormaResizeEvent(this.forma)))},setFontSize:function(t,e){void 0===e&&(e=new yt.TheoPoint(.5,.5));var o=t/this.getCurrentFontSize();this.scale(o,e)},matchNextSize:function(t,e){for(var o=this.getCurrentFontSize(),n=o,i=!1,r=s.iter(t);!r.done;r.next()){var a=r.value,l=a/o;if(Math.round(n)<Math.round(a)&&(l<.99||l>1.01)){n=a,i=!0;break}}t.length>0&&(0==i||n>this.getSizeSliderMaxValue())&&(n=t[0]);var u=n/o;return(u<.99||u>1.01)&&this.scale(u,e),n},setSizeSliderValue:function(t,e,o){var n=t;if(this.styleController.targetedLockupStyle!==this.lockupStyle){n=t/100;for(var i=s.iter(e);!i.done;i.next())t>=(a=i.value)-5&&t<=a+5&&(n=a/100);this.styleController.targetedLockupStyle.spacing=1==n?-1:n,this.styleChanged(),this.selectCharStyleForma(),n*=100}else{for(var r=s.iter(e);!r.done;r.next()){var a;t>=(a=r.value)-5&&t<=a+5&&(n=a)}var l=n/this.getCurrentFontSize();this.scale(l,o)}return n},getSizeSliderValue:function(){return this.styleController.targetedLockupStyle!==this.lockupStyle?-1==this.styleController.targetedLockupStyle.spacing?100:100*this.styleController.targetedLockupStyle.spacing:this.getCurrentFontSize()},getSizeSliderMinValue:function(){if(this.styleController.targetedLockupStyle!==this.lockupStyle)return 20;var t=20,e=this.getCurrentFontSize();return e<20&&(t=e),t},getSizeSliderMaxValue:function(){if(this.styleController.targetedLockupStyle!==this.lockupStyle)return 400;var t=500,e=this.getCurrentFontSize();e>500&&(t=e+200);var o=t/e,n=1.2*this.forma.root.bounds.width/this.forma.bounds.width;return o>n?n*e:t}}}),r)},Cj3Q:function(t,e,o){var n,i,r=e,a=o("oAGj"),l=o("ascj"),s=o("iCxV"),u=o("JgVS"),h=o("cEEQ"),c=o("c+uM"),p=o("tGKA"),g=o("JKVa"),d=o("8t9B"),f=o("hgLm"),y=o("oKlP"),m=o("sIWg"),k=o("1NAc");r.P=function(t,e){return new y.TheoPoint(t,e)},r.clockwiseRectanglePath=function(t,e,o){var n=f.TheoPathBuilder.init_d41d(),i=e.transformPoint(t.eval(r.P(0,0)));n.moveTo(i.x,i.y);var l=new m.TheoRect(i.x,i.y,i.x,i.y);if(o)for(var s=a.iter([r.P(0,1),r.P(1,1),r.P(1,0)]);!s.done;s.next()){var u=s.value;i=e.transformPoint(t.eval(u)),n.lineTo(i.x,i.y),l=l.expandToFit(i)}else for(var h=a.iter([r.P(1,0),r.P(1,1),r.P(0,1)]);!h.done;h.next()){u=h.value;i=e.transformPoint(t.eval(u)),n.lineTo(i.x,i.y),l=l.expandToFit(i)}return n.closePath(),{path:n.path,bounds:l}},r.RowsDecorationStrategy=(n=function(){this.paddingScalar=.6,u.BaseDecorationStrategy.call(this)},a.defineClass({name:"RowsDecorationStrategy",ctor:n,superName:"BaseDecorationStrategy",statics:{_implements:function(t){return"LockupDecorationStrategy"==t}},props:{easeOutQuad:function(t,e,o,n){var i=t/n;return-o*i*(i-2)+e},easeOut:function(t,e,o){return this.easeOutQuad(o,t,e-t,1)},supportsConfiguration:function(t){return t.style.backing==c.LockupBacking.Rows},decorateNoKnockout:function(t,e){var o=t.style,n=[],i={},y={},L=0,S=this.paddingScalar,v=o.padding;0==o.spacing&&e.numberOfLines>1&&(S*=.5,0==o.padding&&(v=.1));var T,C,F=!1;(T=t.style.characterStyles[d.TypeLockupController.HIGHLIGHT_STYLE])&&(F=T.backing==c.LockupBacking.Rows&&o.backing==c.LockupBacking.Rows),o.backing!=c.LockupBacking.Rows&&(S=this.paddingScalar/2,(C=t.style.characterStyles[d.TypeLockupController.HIGHLIGHT_STYLE])&&C.padding>-1&&(v=C.padding));var x=e.avgLinePointSize*e.typographicBoundingRatios.heightRatio,R=x*v*S;v>=0&&(R=Math.max(.05*x,R));for(var w=e.typographicBoundingRatios.backingVerticalOffsetRatio*x,A=this.easeOut(0,w,v),_=R+e.typographicBoundingRatios.sideInsetRatio*e.avgLinePointSize,M=t.style.font.fontData,I=e.numberOfLines,D={},B=-1,b=a.iter(a.toSequence(e.items));!b.done;b.next()){var H=b.value,P=H.offset,E=H.element;if(E.type==h.LockupItemType.Text){var O=E.rowIndex,z=o.backing==c.LockupBacking.Rows,G=null;null!=E.characterStyle&&(Q=t.style.characterStyles[E.characterStyle])&&(Q.backing==c.LockupBacking.None&&o.backing!=c.LockupBacking.Rows?z=!1:(z=!0,Q.backing!=c.LockupBacking.UNSET&&Q.backing!=c.LockupBacking.None&&(G=E.characterStyle,o.backing==c.LockupBacking.Rows&&Q.backing==c.LockupBacking.Rows&&(L=_))));var N=0;if(P>0&&(N=E.placement.tx-(e.items[P-1].placement.tx+e.items[P-1].size.width)),z&&D[O]==G||(null!=i[O]&&(i[I]=i[O],y[I]=y[O],D[I]=D[O],0!=L&&L>N/2&&(i[I]=new m.TheoRect(i[I].minX,i[I].minY,i[I].maxX-L+N/2,i[I].maxY)),I+=1,a.removeKey(i,O),a.removeKey(D,O),B=O),z)){D[O]=G;var U=E.pointSize*e.typographicBoundingRatios.heightRatio,Y=F&&null==i[O]?_:0;0!=L&&B==O&&L>N/2&&(Y=N/2);var W=F?_:0,V=m.TheoRect.fromXYWH(E.placement.tx-Y,E.placement.ty,E.size.width+(Y+W),U);null==(q=i[O])?(q=V,y[O]=E.typographicBoundingRatios):q=q.unionWith(V),i[O]=q}}}if(0==a.count(i))return new u.DecorationResults(n);for(var K=u.BaseDecorationStrategy.getHorizontalOffsetForItalicAngle(e.avgLinePointSize*e.typographicBoundingRatios.heightFromBaselineRatio,M.italicAngle),X=a.iter(i,!0);!X.done;X.next()){var Q,j=X.key,q=X.value,Z=y[j],J=q.size.height/e.typographicBoundingRatios.heightRatio,$=(e.typographicBoundingRatios.textVerticalOffsetRatio-M.capRatio)*J,tt=e.typographicBoundingRatios.textVerticalOffsetRatio,et=e.typographicBoundingRatios.heightRatio,ot=Z.textVerticalOffsetRatio,nt=(tt-(et/2-Z.heightRatio/2)-ot)*J,it=F?0:_,rt=q.size.width+2*it+K,at=(U=q.size.height+2*R,q.minX-it),lt=q.minY+nt-$-R+A,st=new k.TheoSize(rt,U),ut=p.Matrix2D.translationXY(at,lt),ht=!1;if(null!=D[j]&&(Q=t.style.characterStyles[D[j]])&&Q.backing==c.LockupBacking.SVGBackground){if(null==Q.backingArtworkID)return a.opt(s.Host.logging,(function(t){return t.warning("artworkID or artworkInfo is nil ")})),new u.DecorationResults([]);var ct=new g.SVGBackgroundDecorationStrategy(Q.backingArtworkID),pt=new h.LayoutResults(e.items,q.size,e.placement,e.typographicBoundingRatios,e.avgRowAspect),gt=ct.calcSVGConfiguration(t.style,pt,Q.padding),dt=gt.frame,ft=gt.preScale;n.push(h.LockupItem.init_fbd7(l.ColorRole.FieldSecondary,dt.size,p.Matrix2D.translationXY(dt.minX+q.minX,dt.minY+q.minY+nt-$),Q.backingArtworkID,ft,j+e.numberOfLines,D[j])),ht=!0}if(!ht||o.backing==c.LockupBacking.Rows){var yt=f.TheoPathBuilder.init_d41d(),mt=r.clockwiseRectanglePath(m.TheoRect.fromSize(st),p.Matrix2D.Identity,!0).path;yt.addPath(mt,p.Matrix2D.Identity),n.push(h.LockupItem.init_79d9(l.ColorRole.FieldSecondary,st,ut,yt.path,j,void 0,ht&&o.backing==c.LockupBacking.Rows?null:D[j]))}}return n=a.sort(n,(function(t,e){return t.characterStyle!=e.characterStyle?null==t.characterStyle:t.rowIndex<e.rowIndex})),new u.DecorationResults(n)},decorate:function(t,e){var o,n=t.style,i=!1;if((o=t.style.characterStyles[d.TypeLockupController.HIGHLIGHT_STYLE])&&(i=o.backing!=c.LockupBacking.Rows&&c.LockupStyle.isKnockoutLook(o.textLook)),!s.Host.textModelUtils.useOutlinesForKnockouts()||n.backing!=c.LockupBacking.Rows||!c.LockupStyle.isKnockoutLook(n.textLook)&&!i)return this.decorateNoKnockout(t,e);var r=[],g={},y=[],L={},S=f.TheoPathBuilder.init_d41d(),v=f.TheoPathBuilder.init_d41d(),T=this.paddingScalar,C=n.padding;0==n.spacing&&e.numberOfLines>1&&(T*=.5,0==n.padding&&(C=.1));var F=e.avgLinePointSize*e.typographicBoundingRatios.heightRatio,x=F*C*T;C>=0&&(x=Math.max(.05*F,x));for(var R=t.style.font.fontData,w=u.BaseDecorationStrategy.getHorizontalOffsetForItalicAngle(e.avgLinePointSize*e.typographicBoundingRatios.heightFromBaselineRatio,R.italicAngle),A=e.typographicBoundingRatios.backingVerticalOffsetRatio*F,_=this.easeOut(0,A,C),M=x+e.typographicBoundingRatios.sideInsetRatio*e.avgLinePointSize,I=e.typographicBoundingRatios.textVerticalOffsetRatio,D=e.typographicBoundingRatios.heightRatio,B=p.Matrix2D.translationXY(-M,-x),b=!1,H=e.numberOfLines,P=a.iter(a.range(0,e.items.length,!1));!P.done;P.next()){var E=P.value,O=e.items[E];if(O.type==h.LockupItemType.Text){var z=O.rowIndex,G=n.backing==c.LockupBacking.Rows;if(null!=O.characterStyle&&null!=t.style.characterStyles[O.characterStyle]&&(G=!0),G){var N=O.pointSize*e.typographicBoundingRatios.heightRatio,U=m.TheoRect.fromXYWH(O.placement.tx,O.placement.ty,O.size.width,N),Y=g[z];null==Y?(Y=U,L[z]=O.typographicBoundingRatios):Y=Y.unionWith(U),g[z]=Y;var W=L[z],V=Y.size.height/e.typographicBoundingRatios.heightRatio,K=(e.typographicBoundingRatios.textVerticalOffsetRatio-O.font.capRatio)*V,X=W.textVerticalOffsetRatio,Q=(I-(D/2-W.heightRatio/2)-X)*V;if(b||(B=p.Matrix2D.translationXY(-M,Y.minY+Q-K-x+_),b=!0),E==e.items.length-1||z!=e.items[E+1].rowIndex){var j=!0,q=Y.size.width+2*M+w,Z=Y.size.height+2*x,J=Y.minX,$=Y.minY+Q-K+_,tt=a.last(y),et=m.TheoRect.fromXYWH(J,$,q,Z);y.push(et),null!=tt&&tt.maxY<et.minY?(v.lineTo(tt.maxX,tt.maxY),v.lineTo(tt.minX,tt.maxY),v.closePath(),v.moveTo(et.minX,et.minY),j=!1):null==tt?v.moveTo(et.minX,et.minY):tt.maxX>et.maxX?v.lineTo(tt.maxX,tt.maxY):v.lineTo(tt.maxX,et.minY),j&&null!=tt&&tt.maxX>et.maxX?v.lineTo(et.maxX,tt.maxY):v.lineTo(et.maxX,et.minY)}}else null!=g[z]&&(g[H]=g[z],L[H]=L[z],H+=1,a.removeKey(g,z))}}if(0==y.length)return new u.DecorationResults(r);v.lineTo(y[y.length-1].maxX,y[y.length-1].maxY);for(var ot=a.iter(a.stride(y.length-1,0,-1));!ot.done;ot.next()){var nt=ot.value;y[nt-1].maxY>=y[nt].minY?(v.lineTo(y[nt].minX,y[nt].maxY),y[nt].minX<y[nt-1].minX?(v.lineTo(y[nt].minX,y[nt].minY),v.lineTo(y[nt-1].minX,y[nt].minY)):(v.lineTo(y[nt].minX,y[nt-1].maxY),v.lineTo(y[nt-1].minX,y[nt-1].maxY))):nt==y.length-1&&v.lineTo(y[nt].minX,y[nt].maxY)}1==y.length&&v.lineTo(y[0].minX,y[0].maxY),v.closePath();var it=p.Matrix2D.translationXY(0,-y[0].minY),rt=s.Host.textModelUtils.rewindPath(v.simplestForm)||v.simplestForm;S.addPath(rt,it);var at=S.path,lt=new k.TheoSize(a.opt(at.bounds,(function(t){return t.width})),a.opt(at.bounds,(function(t){return t.height})));return r.push(h.LockupItem.init_79d9(l.ColorRole.FieldSecondary,lt,B,at,null)),new u.DecorationResults(r)}}}),n),r.KnockoutDecorationStrategy=(i=function(){u.BaseDecorationStrategy.call(this)},a.defineClass({name:"KnockoutDecorationStrategy",ctor:i,superName:"BaseDecorationStrategy",statics:{_implements:function(t){return"LockupDecorationStrategy"==t}},props:{supportsConfiguration:function(t){return t.style.backing==c.LockupBacking.Knockout},decorate:function(t,e){var o,n,i=(o=a.opt(t.parentBounds,(function(t){return t.width})))||null!=o?o:5e3;null!=t.parentBounds&&a.opt(t.parentBounds,(function(t){return t.height}))>i&&(i=(n=a.opt(t.parentBounds,(function(t){return t.height})))||null!=n?n:5e3);var s=f.TheoPathBuilder.init_d41d(),c=e.placement,g=p.Matrix2D.translationXY(-i,-i),d=[],y=new k.TheoSize(e.size.width+2*i,e.size.height+2*i),L=m.TheoRect.fromSize(y),S=r.clockwiseRectanglePath(L,p.Matrix2D.Identity,!0).path;return s.addPath(S,c),d.push(h.LockupItem.init_79d9(l.ColorRole.FieldSecondary,L.size,g,s.path,null,!0)),new u.DecorationResults(d)}}}),i)},JKVa:function(t,e,o){var n,i=e,r=o("oAGj"),a=o("ascj"),l=o("iCxV"),s=o("IUM5"),u=o("fNpk"),h=o("JgVS"),c=o("cEEQ"),p=o("c+uM"),g=o("tGKA"),d=o("ezSu"),f=o("35Q0"),y=o("oKlP"),m=o("sIWg");i.SVGBackgroundDecorationStrategy=(n=function(t){if(this.artworkID_=null,this.artworkInfo_=null,this.spacingScalar=.75,this.paddingScalar=.6,this.artworkID_=t,null!=t){var e=l.Host.resourceUtils.urlForResource(s.CATEGORY_ID_SHAPE,t);null!=e?(this.artworkInfo_=l.Host.pathUtils.artworkFromURL(e,!1),u.LegacyCoreAssert.isTrue(null!=this.artworkInfo_,"Unable to load artwork!",void 0,"SVGBackgroundDecorationStrategy.init","SVGBackgroundDecorationStrategy.swift",47)):r.opt(l.Host.logging,(function(t){return t.warning("Invalid artwork ID provided!")}))}},r.defineClass({name:"SVGBackgroundDecorationStrategy",ctor:n,superName:"BaseDecorationStrategy",statics:{_implements:function(t){return"LockupDecorationStrategy"==t}},props:{easeOutQuad:function(t,e,o,n){var i=t/n;return-o*i*(i-2)+e},easeOut:function(t,e,o){return this.easeOutQuad(o,t,e-t,1)},supportsConfiguration:function(t){return t.style.backing==p.LockupBacking.SVGBackground&&this.artworkID_==t.style.backingArtworkID&&!p.LockupStyle.isLetterGrid(t.style.layout)},decorate:function(t,e){if(null==this.artworkID_||null==this.artworkInfo_)return r.opt(l.Host.logging,(function(t){return t.warning("artworkID or artworkInfo is nil ")})),new h.DecorationResults([]);var o=[],n=this.calcSVGConfiguration(t.style,e),i=n.frame,s=n.preScale;return o.push(c.LockupItem.init_fbd7(a.ColorRole.FieldSecondary,i.size,g.Matrix2D.translationXY(i.minX,i.minY),this.artworkID_,s)),new h.DecorationResults(o)},calcSVGConfiguration:function(t,e,o){void 0===o&&(o=-1);var n=m.TheoRect.fromSize(e.size),i=e.typographicBoundingRatios.backingVerticalOffsetRatio*e.avgLinePointSize,r=t.font.fontData,a=h.BaseDecorationStrategy.getHorizontalOffsetForItalicAngle(e.avgLinePointSize*e.typographicBoundingRatios.heightFromBaselineRatio,r.italicAngle),l=((e.size.width+e.size.height)/4+e.avgLinePointSize)/2,s=t.padding*this.paddingScalar*l,u=t.padding;o>-1?(u=o/2,s=o*this.paddingScalar*l/2):e.numberOfLines>1&&(u+=t.spacing,s+=t.spacing*this.spacingScalar*e.avgLinePointSize),(t.padding>=0||o>-1)&&(s=Math.max(.05*l,s));var c,p=this.easeOut(0,i,Math.min(1,u)),g=n.minX-s,d=n.maxX+s+a,k=n.minY-s+p,L=n.maxY+s+p;if(n=new m.TheoRect(g,k,d,L),(c=f.ShapeLibrary.getShapeDataForArtworkId(this.artworkID_))&&c.category==f.ShapeCategory.Circle){var S=new y.TheoPoint(n.minX,n.minY),v=n.center,T=v.distanceTo(S),C=Math.sqrt(2*Math.pow(T,2))/2;g=v.x-C,d=v.x+C,k=v.y-C,L=v.y+C,n=new m.TheoRect(g,k,d,L)}return this.calcSVGFrame(n)},calcSVGFrame:function(t){var e,o,n=null!=this.artworkInfo_.sliceBox,i=null!=this.artworkInfo_.contentRegion,r=this.artworkInfo_.artwork.bounds,a=i?this.artworkInfo_.contentRegion:r,l=1,s=null;if(i)if(n){a=this.artworkInfo_.contentRegion;var u=t.width/a.width,h=t.height/a.height;s=Math.min(u,h);var c=d.NineSlicingFilter.calculateOuterBoundsForMapping(r,this.artworkInfo_.sliceBox,s,a,t);o=c.bounds,s=(e=c.prescribedPrescale)||null!=e?e:s}else u=t.width/a.width,h=t.height/a.height,l=Math.max(u,h),o=r.transform(g.Matrix2D.scalingXY(l,l));else n?o=t:(u=t.width/r.width,h=t.height/r.height,l=Math.max(u,h),o=r.transform(g.Matrix2D.scalingXY(l,l)));if(!n){var p=a.transform(g.Matrix2D.scalingXY(l,l));o=o.transform(g.Matrix2D.translation(t.center.subtract(p.center)))}return{frame:o,preScale:s}}}}),n)},X1F6:function(t,e,o){var n,i,r=e,a=o("oAGj"),l=o("EGPT"),s=o("ascj"),u=o("QgZx"),h=o("53P9"),c=o("iCxV"),p=o("fNpk"),g=o("cEEQ"),d=o("c+uM"),f=o("tGKA"),y=o("8t9B"),m=o("3UhB"),k=o("oKlP"),L=o("oKI3"),S=o("uUew"),v=o("sIWg"),T=o("1NAc");r.PathLayoutStrategy=(n=function(){this.trackingScalar=1.5,this.precision=.003,this.ascentCoeff=.594,this.concavityCoeff=1,this.requiredCoverageClosed=.99,this.requiredCoverageOpen=.99,this.coverageThresholdMustCenter=.98,this.sampleFontSize=32,this.minFontSize=8,this.maxFontSize=600,this.maxIterations=100,g.BaseLockupLayoutStrategy.call(this)},a.defineClass({name:"PathLayoutStrategy",ctor:n,superName:"BaseLockupLayoutStrategy",statics:{_implements:function(t){return"LockupLayoutStrategy"==t}},props:{supportsConfiguration:function(t){return d.LockupStyle.isPath(t.style.layout)},fitText:function(t){return t.style.alignment!=d.LockupAlignment.Right},layout:function(t){var e,o=t.containerSize,n=t.style,i=n.tracking*this.trackingScalar,r=t.text;r=this.newLinesToSpaces(r);var l=n.font.fontData;l.allCapsAllowed&&(r=r.toUpperCase());var u=g.getTypographicBoundingRatiosOfString(r,l,!1),h=L.TextPathLibrary.getPathForLockupStyle(n),c=this.transformPath(h,o,t.fitContainerToArea),p=c[0];h=c[1];var d=this.precision*p.hypotenuse,y=this.getCorrectedPathLen(h,u.heightFromBaselineRatio*this.sampleFontSize,d),m=h.isClosed()?this.requiredCoverageClosed:this.requiredCoverageOpen,C=this.measureLetters(r,t.characterStyleRanges,this.sampleFontSize,n,l,i,u.hasUppercase,h.isClosed()),F=C.renderableItemCount,x=a.clone(C.letterInfos),R=C.truncatedText,w=this.estimateFontSizeToFit(h,R,x.length,l,u,i,d);w=Math.min(Math.max(this.minFontSize,w),this.maxFontSize);for(var A=0,_=this.minFontSize,M=this.maxFontSize,I=0,D=null;A<this.maxIterations&&_<M;){var B=h.clone();if(B=(D=this.placeLetters(B,x,u,w,d)).path,D.placements.length<x.length)M=w;else{if((I=1-this.getCorrectedPathLen(B,u.heightFromBaselineRatio*this.sampleFontSize,d)/y)>=m)break;_=w}w=(_+M)/2,A+=1}((e=a.opt(D,(function(t){return 0==t.placements.length})))||null!=e)&&e&&(D.placements.push(f.Matrix2D.Identity),I=1),I<this.coverageThresholdMustCenter&&(D=this.placeLettersAndCenter(h,x,u,w,d));var b=this.fitText(t),H=D.bounds,P=H.size,E=1;if(b){var O=t.fitContainerToArea?p:o;(P.width>O.width||P.height>O.height)&&(E=(P=this.getFitSize(H,O)).width/H.width),h=(h=h.offset(k._minus_TheoPoint_TheoPoint(k.TheoPoint.ZERO,H.origin))).multiply(new T.TheoSize(E,E))}for(var z=h.getBounds(),G=u.heightFromBaselineRatio*w*E,N=[],U=a.iter(a.toSequence(D.placements));!U.done;U.next()){var Y=U.value,W=Y.offset,V=Y.element,K=x[W],X=b?H:z,Q=(V.tx-X.minX)*E,j=(V.ty-X.minY)*E,q=new f.Matrix2D(V.a,V.b,V.c,V.d,Q,j),Z=w*K.fontSizeAdjustRatio*E,J=g.LockupItem.init_bc20(s.ColorRole.FieldPrimary,K.characterStyle,new T.TheoSize(K.unitWidth*Z,G),q,K.character,K.font,Z,Z,u,0,new S.TextRange(W,W+1));N.push(J)}var $=b?v.TheoRect.fromSize(P).unionWith(z).size:z.size;return new g.LayoutResults(N,$,f.Matrix2D.Identity,u,$.aspectRatio,this.getAnnotations(F,N.length))},placeOneLetter:function(t,e,o,n,i){var r=t,l=n*this.ascentCoeff,s=this.concavityCoeff*l,u=t.findTValueByCorrectedPrefixLength(l,s,o,i);if(u>=a.toDouble(t.numSegments))return{placement:null,t:0,path:t};var h=t.findTValueByCorrectedPrefixLength(l,s,e/2,i);p.LegacyCoreAssert.isTrue(h<a.toDouble(t.numSegments),"t-value by corrected prefix length out of range",void 0,"PathLayoutStrategy.placeOneLetter","PathLayoutStrategy.swift",240);var c=t.pointAt(h),g=t.tangentUnitVectorAt(h),d=Math.atan2(g.y,g.x);return{placement:f.Matrix2D.translationXY(-e/2,-n).rotate(Math.cos(d),Math.sin(d)).translate(c),t:u,path:r=r.truncate(u).suffix}},placeLetters:function(t,e,o,n,i){for(var r=o.heightFromBaselineRatio*n,l=0,s=v.TheoRect.Zero,u=[],h=t,c=a.iter(e);!c.done;c.next()){var p=c.value,g=n*p.fontSizeAdjustRatio,d=p.unitWidth*g,f=p.unitTrackedWidth*g,y=p.unitYAdjust*g,m=this.placeOneLetter(h,d,f,r-y,i);h=m.path;var k=m.placement;if(null==k)break;u.push(k);var L=new v.TheoRect(0,0,f,r).transform(k);s=s.unionWith(L),l+=f}return{placements:u,bounds:s,composedWidth:l,path:h}},placeLettersAndCenter:function(t,e,o,n,i){var r=this.placeLetters(t,e,o,n,i);if(r.placements.length<e.length)return r;for(var a=0,l=i,s=0;(Math.abs(a-l)>.01*(a+l)||r.placements.length<e.length)&&s<this.maxIterations;){a>l||r.placements.length<e.length?a-=(a-l)/2:a+=(l-a)/2;var u=t.truncate(t.findTValueByCorrectedPrefixLength(0,0,a,i)).suffix;l=(r=this.placeLetters(u,e,o,n,i)).placements.length<e.length?0:r.path.getLength(i),s+=1}return r},calculateLeading:function(t,e){return t.style.spacing},adjustSizeForLeading:function(t,e,o,n){return T.TheoSize.Zero},calculateTracking:function(t,e){return t.style.tracking},adjustSizeForTracking:function(t,e,o,n){return null},getFitSize:function(t,e,o){void 0===o&&(o=1);var n,i,r=t.width,a=t.height,l=0==a?1/0:r/a,s=e.width,u=e.height,h=s/u,c=o>1?o:1/o;return l<h?(i=u,n=u*(h=Math.min(h,l*c))):(n=s,i=s/(h=Math.max(h,l/c))),new T.TheoSize(n,i)},transformPath:function(t,e,o){var n,i,r=t.getBounds();if(o){var a=r.size,l=Math.sqrt(e.width*e.height/(a.width*a.height));n=(i=t.multiply(new T.TheoSize(l,l))).getBounds().size}else{n=this.getFitSize(r,e,t.flex);var s=0==r.width?1:n.width/r.width,u=0==r.height?1:n.height/r.height;i=t.multiply(new T.TheoSize(s,u))}return[n,i]},getCorrectedPathLen:function(t,e,o){var n=e*this.ascentCoeff,i=this.concavityCoeff*n;return t.getCorrectedLength(n,i,o)},estimateFontSizeToFit:function(t,e,o,n,i,r,l){var s=a.clone(c.Host.textModelUtils.getGlyphPositions(e,n,32,!1)),u=a.toDouble(t.isClosed()?o:o-1)*r*32,h=a.last(s)+u,p=t.getLength(l);return 32*p/(h-(this.getCorrectedPathLen(t,32*i.heightFromBaselineRatio,l)-p))},getCharacterStyle:function(t,e,o){for(var n=a.iter(t);!n.done;n.next()){var i=n.value;if(e>=i.start&&e<i.end)return y.TypeLockupController.HIGHLIGHT_STYLE}return""},measureLetters:function(t,e,o,n,i,l,s,p){var g,d=a.clone(h.GraphemeUtils.splitGraphemes(t)),f=d.length,k=t;f>this.maxLetterLayoutGraphemeCount&&(k=(d=d.slice(0,this.maxLetterLayoutGraphemeCount)).join());var L=d.length,S=a.opt(a.opt(n.characterStyles[y.TypeLockupController.HIGHLIGHT_STYLE],(function(t){return t.font})),(function(t){return t.fontData}))||i,v=m.TypeLockupUtils.getCharFontAdjust(n,s,!1),T=m.TypeLockupUtils.getCharFontYAdjust(n,o,o*v),C=[],F=[],x=[],R=l<=.25;R&&(F=a.clone(c.Host.textModelUtils.getGlyphPositions(t,i,o,!1)),x=a.clone(a.eq(u._equality_FontDescriptor_FontDescriptor,S,i)?F:c.Host.textModelUtils.getGlyphPositions(t,S,o,!1)));for(var w,A,_=!1,M=a.iter(a.toSequence(d));!M.done;M.next()){var I=M.value,D=I.offset,B=I.element,b=(g=A)||null!=g?g:this.getCharacterStyle(e,D,D+1);D<L-1&&(A=this.getCharacterStyle(e,D+1,D+2));var H=b==y.TypeLockupController.HIGHLIGHT_STYLE,P=H?S:i,E=H?v:1,O=H?T/(o*E):0,z=0;if(R&&b==A){var G=a.clone(H?x:F);z=(G[D+1]-G[D])/o}else z=c.Host.textModelUtils.measureBoundsForLayout(B,P,o,0).width/o;var N=new r.LetterInfo(B,P,E,b,z,O,D!=L-1||p?l:0);(_=m.TypeLockupUtils.isWhiteSpace(B))&&(w=N),C.push(N)}return p&&!_&&null!=w&&C.push(w),{renderableItemCount:f,truncatedText:k,letterInfos:C}},newLinesToSpaces:function(t){return a.replaceAll(t,"\n"," ")},reflow:function(t,e,o,n){var i=o.style,r=o.text,l=Math.min(h.GraphemeUtils.countGraphemes(r),this.maxLetterLayoutGraphemeCount)>n.itemsForReflow.length;if(1==L.TextPathLibrary.getPathForLockupStyle(i).flex&&!l){for(var s=n.size,u=t.fitAspectRatioWithin(s.aspectRatio),c=u.width/s.width,p=[],d=a.iter(n.itemsForReflow);!d.done;d.next()){var y,m,k,S,v,T,C=d.value;if(null!=(r=C.text)&&(y=C.font)&&null!=(m=C.pointSize)&&null!=(k=C.rowPointSize)&&(S=C.typographicBoundingRatios)&&null!=(v=C.rowIndex)&&(T=C.rangeInLockup)){var F=m*c;if(F>this.maxFontSize||F<this.minFontSize)return null;var x=C.placement.transformValues,R=x.tx*c,w=x.ty*c,A=f.Matrix2D.rotation(x.rotCosine,x.rotSine).translateXY(R,w),_=g.LockupItem.init_bc20(C.colorRole,C.characterStyle,C.size.multiply(c),A,r,y,m*c,k*c,S,v,T);p.push(_)}}return new g.LayoutResults(p,u,n.placement,n.typographicBoundingRatios,n.avgRowAspect,n.annotations)}return null},supportsReturns:function(){return!1},annotate:function(t,e,o,n){var i=h.GraphemeUtils.countGraphemes(t),r=a.clone(this.getAnnotations(i,n)),s=a.clone(g.BaseLockupLayoutStrategy.prototype.annotate.call(this,t,e,o,n));return l.AnnotationState.concat(r,s)},getAnnotations:function(t,e){return e<t?[new l.Annotation(l.AnnotationID.TextTruncated,l.AnnotationPriority.High)]:e>this.maxLetterLayoutRecommendedGraphemeCount?[new l.Annotation(l.AnnotationID.TooMuchCurvedText)]:null}}}),n),r.LetterInfo=(i=function(t,e,o,n,i,r,a){this.character=t,this.font=e,this.fontSizeAdjustRatio=o,this.characterStyle=n,this.unitWidth=i,this.unitYAdjust=r,this.unitTrackedWidth=i+a},a.defineClass({name:"LetterInfo",ctor:i}),i)}}]);
//# sourceMappingURL=vendors_npm_spark_6dd528bf-229184f2.js.map