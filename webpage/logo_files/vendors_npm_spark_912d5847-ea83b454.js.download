(window.webpackJsonptheoWebApp=window.webpackJsonptheoWebApp||[]).push([[37],{"+nk0":function(e,t,o){var r,n=t,i=o("oAGj"),a=o("gXiO");n.ControllerEvent=(r=function(e){this.type=e,a.CoreObject.call(this)},i.defineClass({name:"ControllerEvent",ctor:r,superName:"CoreObject"}),r)},"0PPJ":function(e,t,o){var r,n=t,i=o("oAGj"),a=o("SpAV"),l=o("q5zr");n.MaskSubstitutionController=(r=function(){this.substitutions_={}},i.defineClass({name:"MaskSubstitutionController",ctor:r,props:{attach:function(e){var t=this,o=e.controller.undoRedoMgr;o.registerPatch((function(r){t.performSubstitutions(e,o),r()}))},substitute:function(e,t,o,r){a.CoreAssertDebugOnly.isTrue(null==this.substitutions_[e],"Requesting substitution for the same url twice",{originalUrl:e},"MaskSubstitutionController.substitute","MaskSubstitutionController.swift",32),this.substitutions_[e]={componentID:t,url:o,mimeType:r}},performSubstitutions:function(e,t){var o=this;e.content.root.visitAll((function(e){var r,n,a;if((r=i.as(e,l.ImageContentNode))&&null!=(n=r.url)&&null!=(a=o.substitutions_[n])){var s=r.componentID!=a.componentID,u=r.url!=a.url,c=r.mimeType!=a.mimeType;(s||u||c)&&(t.beginPatch(),s&&(r.componentID=a.componentID),u&&(r.url=a.url),c&&(r.mimeType=a.mimeType),t.endPatch())}}))}}}),r)},"1HsO":function(e,t,o){var r,n,i,a,l,s,u,c,d,h,g=t,C=o("oAGj"),m=o("gXiO");g.BaseHandle=(r=function(){m.CoreObject.call(this)},C.defineClass({name:"BaseHandle",ctor:r,superName:"CoreObject"}),r),g.TransformType=C.defineEnum("TransformType",{None:0,RotateAboutCenter:1,Translate:2,ProportionalScaleAboutCenter:3,TopLeftCornerTranslate:4,TopRightCornerTranslate:5,BottomLeftCornerTranslate:6,BottomRightCornerTranslate:7,LeftSideTranslate:8,RightSideTranslate:9,TopSideTranslate:10,BottomSideTranslate:11,LetterSpacing:12,LineSpacing:13}),g.BoxReference=(n=function(e,t){this.placement=e,this.bounds=t},C.defineClass({name:"BoxReference",ctor:n,superName:"CoreObject"}),n),g.BoxHandleDisplayHint=C.defineEnum("BoxHandleDisplayHint",{ThinOutline:0,WideOutline:1,GroupOutlineColor:2,TextFrame:3,PreferLeftSideHandle:4,SuppressRotationHandle:5,SuppressTranslationHandle:6,SuppressResizeAnimation:7,CropMode:8}),g.BoxTransformHandles=(i=function(e,t,o,r,n){this.reference=e,this.allowedTransforms=C.clone(t),this.displayHints=C.clone(o),this.activeTransform=r,this.handlesTarget=n},C.defineClass({name:"BoxTransformHandles",ctor:i,superName:"BaseHandle"}),i),g.BoxTransformMultipleFormae=(a=function(e,t,o,r,n,i){this.formaIDs=C.clone(i),g.BoxTransformHandles.call(this,e,t,o,r,n)},C.defineClass({name:"BoxTransformMultipleFormae",ctor:a,superName:"BoxTransformHandles"}),a),g.HandleTransformStage=C.defineEnum("HandleTransformStage",{Begin:0,Update:1,End:2}),g.HandleTransformEvent=(l=function(e,t){this.viewportScale=1,this.handle=e,this.stage=t},C.defineClass({name:"HandleTransformEvent",ctor:l,superName:"CoreObject"}),l),g.TranslateTransformEvent=(s=function(e,t,o){this.event=o,g.HandleTransformEvent.call(this,e,t)},C.defineClass({name:"TranslateTransformEvent",ctor:s,superName:"HandleTransformEvent"}),s),g.MoveTransformEvent=(u=function(e,t,o){this.totalDelta=o,g.HandleTransformEvent.call(this,e,t)},C.defineClass({name:"MoveTransformEvent",ctor:u,superName:"HandleTransformEvent"}),u),g.RotateAboutCenterTransformEvent=(c=function(e,t,o,r){void 0===r&&(r=!0),this.totalDeltaRadians=o,this.doSnapping=r,g.HandleTransformEvent.call(this,e,t)},C.defineClass({name:"RotateAboutCenterTransformEvent",ctor:c,superName:"HandleTransformEvent"}),c),g.CornerTranslateTransformEvent=(d=function(e,t,o,r){this.transformType=o,this.position=r,g.HandleTransformEvent.call(this,e,t)},C.defineClass({name:"CornerTranslateTransformEvent",ctor:d,superName:"HandleTransformEvent"}),d),g.SideTranslateTransformEvent=(h=function(e,t,o,r){this.transformType=o,this.position=r,g.HandleTransformEvent.call(this,e,t)},C.defineClass({name:"SideTranslateTransformEvent",ctor:h,superName:"HandleTransformEvent"}),h)},"8zEY":function(e,t,o){var r,n=t,i=o("oAGj");n.RefineCutoutState=(r=function(e,t,o){this.unmaskedGhost=null,this.darkScrim=null,this.frame=e,this.image=t,this.indexInParent=o,this.floating=i.opt(e.controller,(function(e){return 1==e.floating})),this.imageStyle=t.style.clone(),this.frameBackgroundColor=e.style.colors.fieldPrimary,this.frameBlendMode=e.style.blendMode},i.defineClass({name:"RefineCutoutState",ctor:r}),r)},AVHO:function(e,t,o){var r,n,i,a,l,s=t,u=o("oAGj"),c=o("gXiO");s.ControllerSettings=(r=function(e){this.type=e,c.CoreObject.call(this)},u.defineClass({name:"ControllerSettings",ctor:r,superName:"CoreObject"}),r),s.TypeLockupControllerSettings=(n=function e(t){this.controller=t,s.ControllerSettings.call(this,e.TYPE)},u.defineClass({name:"TypeLockupControllerSettings",ctor:n,superName:"ControllerSettings",statics:{TYPE:{get:function(){return"TypeLockupControllerSettings"}}}}),n),s.ImageControllerSettings=(i=function e(t){this.controller=t,s.ControllerSettings.call(this,e.TYPE)},u.defineClass({name:"ImageControllerSettings",ctor:i,superName:"ControllerSettings",statics:{TYPE:{get:function(){return"ImageControllerSettings"}}}}),i),s.RootControllerSettings=(a=function e(t){this.controller=t,s.ControllerSettings.call(this,e.TYPE)},u.defineClass({name:"RootControllerSettings",ctor:a,superName:"ControllerSettings",statics:{TYPE:{get:function(){return"RootControllerSettings"}}}}),a),s.ShapeControllerSettings=(l=function e(t){this.controller=t,s.ControllerSettings.call(this,e.TYPE)},u.defineClass({name:"ShapeControllerSettings",ctor:l,superName:"ControllerSettings",statics:{TYPE:{get:function(){return"ShapeControllerSettings"}}}}),l)},AnBp:function(e,t,o){var r,n,i,a,l,s,u=t,c=o("oAGj"),d=o("umUn");u.IEditorAttribute=c.defineProtocol("IEditorAttribute",{key:"String",isEqualTo:"(IEditorAttribute) -> Boolean"}),u.EditorAttributeBase=(r=function(e){this._key=e},c.defineClass({name:"EditorAttributeBase",ctor:r,superName:"CoreObject",props:{key:{get:function(){return this._key}}}}),r),u.ColorAttribute=(n=function e(t){this.colors=c.clone(t),u.EditorAttributeBase.call(this,e.KEY)},c.defineClass({name:"ColorAttribute",ctor:n,superName:"EditorAttributeBase",statics:{KEY:"color",_implements:function(e){return"IEditorAttribute"==e}},props:{isEqualTo:function(e){var t;if(t=c.as(e,n)){if(this.colors.length!=t.colors.length)return!1;for(var o=c.iter(c.range(0,this.colors.length,!1));!o.done;o.next()){var r=o.value;if(!c.eq(d._equality_TheoColor_TheoColor,this.colors[r],t.colors[r]))return!1}return!0}return!1}}}),n),u.OpacityAttribute=(i=function e(t){this.opacities=c.clone(t),u.EditorAttributeBase.call(this,e.KEY)},c.defineClass({name:"OpacityAttribute",ctor:i,superName:"EditorAttributeBase",statics:{KEY:"opacity",_implements:function(e){return"IEditorAttribute"==e}},props:{isEqualTo:function(e){var t;if(t=c.as(e,i)){if(this.opacities.length!=t.opacities.length)return!1;for(var o=c.iter(c.range(0,this.opacities.length,!1));!o.done;o.next()){var r=o.value;if(this.opacities[r]!=t.opacities[r])return!1}return!0}return!1}}}),i),u.MediaMetadataAttribute=(a=function e(t){this.mmds=c.clone(t),u.EditorAttributeBase.call(this,e.KEY)},c.defineClass({name:"MediaMetadataAttribute",ctor:a,superName:"EditorAttributeBase",statics:{KEY:"mediaMetadata",_implements:function(e){return"IEditorAttribute"==e}},props:{isEqualTo:function(e){var t;if(t=c.as(e,a)){if(this.mmds.length!=t.mmds.length)return!1;for(var o=c.iter(c.range(0,this.mmds.length,!1));!o.done;o.next()){var r=o.value;if(!this.mmds[r].isEqualTo(t.mmds[r]))return!1}return!0}return!1}}}),a),u.ControllerSettingAttribute=(l=function e(t){this.settings=c.clone(t),u.EditorAttributeBase.call(this,e.KEY)},c.defineClass({name:"ControllerSettingAttribute",ctor:l,superName:"EditorAttributeBase",statics:{KEY:"controllerSetting",_implements:function(e){return"IEditorAttribute"==e}},props:{isEqualTo:function(e){var t;if(t=c.as(e,l)){if(this.settings.length!=t.settings.length)return!1;for(var o=c.iter(c.range(0,this.settings.length,!1));!o.done;o.next()){var r=o.value;if(this.settings[r].type!=t.settings[r].type)return!1}return!0}return!1}}}),l),u.ImageAttribute=(s=function e(t){this.styles=c.clone(t),u.EditorAttributeBase.call(this,e.KEY)},c.defineClass({name:"ImageAttribute",ctor:s,superName:"EditorAttributeBase",statics:{KEY:"imageAttr",_implements:function(e){return"IEditorAttribute"==e}},props:{isEqualTo:function(e){var t;if(t=c.as(e,s)){if(this.styles.length!=t.styles.length)return!1;for(var o=c.iter(c.range(0,this.styles.length,!1));!o.done;o.next()){var r=o.value;if(!this.styles[r].equals(t.styles[r]))return!1}return!0}return!1}}}),s)},Bpjk:function(e,t,o){var r,n,i,a=t,l=o("oAGj"),s=o("gXiO");a.CropRatioPreset=(r=function(e,t,o,r,n){this.label=e,this.secondaryLabel=t,this.id=o,this.iconId=r,this.aspectRatio=n},l.defineClass({name:"CropRatioPreset",ctor:r,superName:"CoreObject"}),r),a.CropRatioPresetLibrary=(n=function(){s.CoreObject.call(this)},i={},l.defineClass({name:"CropRatioPresetLibrary",ctor:n,superName:"CoreObject",statics:{FREEFORM_ID:"Free",ORIGINAL_ID:"Original",NONE_ID:"None",FREECROP_PRESET:{get:function(){return void 0===i.FREECROP_PRESET&&(i.FREECROP_PRESET=new a.CropRatioPreset("k_Crop_Freeform","",n.FREEFORM_ID,"CropPaneFreeform",1)),i.FREECROP_PRESET}},ORIGINAL_SIZE_PRESET:{get:function(){return void 0===i.ORIGINAL_SIZE_PRESET&&(i.ORIGINAL_SIZE_PRESET=new a.CropRatioPreset("k_Crop_Original","",n.ORIGINAL_ID,"",0)),i.ORIGINAL_SIZE_PRESET}},ratios:{get:function(){return void 0===i.ratios&&(i.ratios=[new a.CropRatioPreset("k_Crop_Square","k_1_1_label","1:1","",1),new a.CropRatioPreset("","k_4_3_label","4:3","",1.33333333333),new a.CropRatioPreset("","k_3_4_label","3:4","",.75),new a.CropRatioPreset("","k_16_9_label","16:9","",1.77777777778),new a.CropRatioPreset("","k_9_16_label","9:16","",.5625)]),i.ratios}},getListOfRatios:function(){return n.ratios},getIdForRatio:function(e){var t=n.ratios.filter((function(t){return t.aspectRatio==e}),this);return 0==t.length?null:t[0].id}}}),n)},"G/OM":function(e,t,o){var r,n,i,a,l,s,u,c=t,d=o("oAGj");c.IFeatureSet=d.defineProtocol("IFeatureSet",{key:"String",isEqualTo:"(IFeatureSet) -> Boolean"}),c.FeatureSetBase=(r=function(e){this._key=e},d.defineClass({name:"FeatureSetBase",ctor:r,superName:"CoreObject",props:{key:{get:function(){return this._key}}}}),r),c.TextFrameAttributesFeature=(n=function e(){c.FeatureSetBase.call(this,e.KEY)},d.defineClass({name:"TextFrameAttributesFeature",ctor:n,superName:"FeatureSetBase",statics:{KEY:"TextFrameAttributesFeature",_implements:function(e){return"IFeatureSet"==e}},props:{isEqualTo:function(e){return e instanceof n}}}),n),c.AlignSpacingAttributesFeature=(i=function e(t,o,r,n){this.canAlign=t,this.canDistribute=o,this.canDoRow=r,this.canDoColumn=n,c.FeatureSetBase.call(this,e.KEY)},d.defineClass({name:"AlignSpacingAttributesFeature",ctor:i,superName:"FeatureSetBase",statics:{KEY:"AlignSpacingAttributesFeature",find:function(e){return d.as(e.find(i.KEY),i)},_implements:function(e){return"IFeatureSet"==e}},props:{isEqualTo:function(e){var t;return!!(t=d.as(e,i))&&t.canAlign==this.canAlign&&t.canDistribute==this.canDistribute&&t.canDoRow==this.canDoRow&&t.canDoColumn==this.canDoColumn}}}),i),c.FormaEditFeature=(a=function e(t,o,r,n,i,a,l,s){this.canMultiselect=t,this.canDuplicate=o,this.canGroup=r,this.canUngroup=n,this.canRecolor=i,this.canDelete=a,this.canEditSettings=l,this.supportsMultiStyle=s,c.FeatureSetBase.call(this,e.KEY)},d.defineClass({name:"FormaEditFeature",ctor:a,superName:"FeatureSetBase",statics:{KEY:"FormaEditFeature",_implements:function(e){return"IFeatureSet"==e}},props:{isEqualTo:function(e){var t;return!!(t=d.as(e,a))&&t.canMultiselect==this.canMultiselect&&t.canDuplicate==this.canDuplicate&&t.canGroup==this.canGroup&&t.canUngroup==this.canUngroup&&t.canRecolor==this.canRecolor&&t.canDelete==this.canDelete&&t.canEditSettings==this.canEditSettings&&t.supportsMultiStyle==this.supportsMultiStyle}}}),a),c.OpacityAttributesFeature=(l=function e(){c.FeatureSetBase.call(this,e.KEY)},d.defineClass({name:"OpacityAttributesFeature",ctor:l,superName:"FeatureSetBase",statics:{KEY:"OpacityAttributesFeature",_implements:function(e){return"IFeatureSet"==e}},props:{isEqualTo:function(e){return e instanceof l}}}),l),c.ImageFeature=(s=function e(t,o,r,n,i,a,l,s){this.canApplyFilter=t,this.canReplace=o,this.hasLicense=r,this.canCrop=n,this.canSetBackground=i,this.canSetFloating=a,this.canApplyBackgroundColor=l,this.canApplyCutout=s,c.FeatureSetBase.call(this,e.KEY)},d.defineClass({name:"ImageFeature",ctor:s,superName:"FeatureSetBase",statics:{KEY:"ImageFeature",_implements:function(e){return"IFeatureSet"==e}},props:{isEqualTo:function(e){var t;return!!(t=d.as(e,s))&&t.canApplyFilter==this.canApplyFilter&&t.canReplace==this.canReplace&&t.hasLicense==this.hasLicense&&t.canCrop==this.canCrop&&t.canSetBackground==this.canSetBackground&&t.canSetFloating==this.canSetFloating&&t.canApplyBackgroundColor==this.canApplyBackgroundColor&&t.canApplyCutout==this.canApplyCutout}}}),s),c.VideoAttributesFeature=(u=function e(){c.FeatureSetBase.call(this,e.KEY)},d.defineClass({name:"VideoAttributesFeature",ctor:u,superName:"FeatureSetBase",statics:{KEY:"VideoAttributesFeature",_implements:function(e){return"IFeatureSet"==e}},props:{isEqualTo:function(e){return e instanceof u}}}),u)},J3ZR:function(e,t,o){o("oAGj")},NbJN:function(e,t,o){var r,n=t,i=o("oAGj"),a=o("yvDn"),l=o("yGNn"),s=o("ascj"),u=o("O60Y"),c=o("FNB+"),d=o("cmoc"),h=o("QbzR"),g=o("JEzR"),C=o("P83h"),m=o("X0GW"),f=o("ZhwN"),S=o("iCxV"),p=o("U010"),T=o("fdtz"),y=o("SDdr"),_=o("lmwz"),E=o("uWOl"),w=o("T8w7"),v=o("8zEY"),b=o("JO5d"),D=o("Zifs"),R=o("djAF"),I=o("35Q0");n.RefineCutoutController=(r=function(){this.state_=null},i.defineClass({name:"RefineCutoutController",ctor:r,props:{enterRefineCutoutMode:function(e){if(null!=this.state_)return new a.CoreStringError("enter/exit mismatch");var t,o,r,n;if((t=i.opt(e.controller,(function(e){return e.owner})))&&(o=e.image)&&(r=e.parent)&&null!=(n=r.indexOfChild(e))){var l=this.cloneMaskContentNode(e);if(null!=l)return l;this.resetTightCrop(e,o);var s=new v.RefineCutoutState(e,o,n);return this.highlightImage(e,o,r,s),null!=(l=this.createUnmaskedGhost(e,s))?l:(this.state_=s,t.selection.inRefineCutoutMode=!0,null)}return new a.CoreStringError("No document controller, or corrupt frame")},exitRefineCutoutMode:function(e,t){var o,r,n=this;if(i.opt(this.state_,(function(t){return t.frame!=e})))return l.CorePromise.reject("enter/exit/frame mismatch");if((o=i.opt(e.controller,(function(e){return e.owner})))&&(r=this.state_)){this.revertTemporaryChanges(e,r);var a,s,u=null;return t&&(a=_.ImageFacade.getCutoutMaskFormaForForma(e))&&(s=a.contentNode)&&(u=s.recreateImageAndFeatures().then((function(t){return a.invalidateCachedBounds(),_.ImageFacade.updateCutoutMaskPlacement(e,a),n.redoTightCrop(e,a),null}))),(u||l.CorePromise.resolve(null)).then((function(e){return n.state_=null,o.selection.inRefineCutoutMode=!1,null}))}return l.CorePromise.reject("No document controller when exit refine cutout")},toggleUnmaskedImage:function(e){if(i.opt(this.state_,(function(t){return t.frame!=e})))return new a.CoreStringError("enter/exit/frame mismatch");var t;if(t=this.state_){var o,r;if(o=t.unmaskedGhost){var n=0==w.OpacityFacade.getOpacityForForma(o)?1:0;w.OpacityFacade.applyOpacity(n,[o])}if(r=t.frameBackgroundColor){var l=null==e.style.colors.fieldPrimary?r:null;e.style.colors.fieldPrimary=l}}return null},isUnmaskedImageVisible:function(){var e;return!!(e=i.opt(this.state_,(function(e){return e.unmaskedGhost})))&&1==w.OpacityFacade.getOpacityForForma(e)},cloneMaskContentNode:function(e){var t,o,r;if((t=e.page.document)&&(o=_.ImageFacade.getCutoutMaskFormaForForma(e))&&(r=o.contentNode)){if(i.opt(S.Host.imageAnalysis,(function(e){return 1==e.isTempMaskURL(r.url)})))return o.ensureContentNodeListeners(),null;var n;if(n=r.copyTo(t))return o.contentID=n.id,null}return new a.CoreStringError("could not clone mask content node",!0)},supportsAutoTrimming:function(e){return _.ImageFacade.canSetTightCropToCutoutMask(e,!1)},resetTightCrop:function(e,t){this.supportsAutoTrimming(e)&&_.ImageFacade.resetCrop(t,!1)},redoTightCrop:function(e,t){this.supportsAutoTrimming(e)&&_.ImageFacade.setTightCropToCutoutMask(e,t)},highlightImage:function(e,t,o,r){var n,a=new C.FormaAnimationTransactionEvent(e);a.duration=0,e.beginUpdate(a),t.internalSetStyle(E.ImageStyle.createDefault()),e.style.blendMode=h.FormaBlendMode.Normal,r.floating||(e.allowUserMove=!0),o.removeChild(e),o.appendChild(e),(n=i.as(e.page.createFormaWithController(R.ShapeForma.KIND,b.ShapeController.KIND),R.ShapeForma))&&(I.ShapeLibrary.applyToShapeForma(n,I.ShapeLibrary.Square),n.bounds=i.opt(e.root,(function(e){return e.bounds})),n.style.opacity=.5,n.style.colors.fieldPrimary=D.SolidColor.BLACK,n.intent=c.Forma.INTENT_TEMP_IMAGE_REFINE_CUTOUT,n.allowUserMove=!1,o.insertBefore(n,e,!0),r.darkScrim=n),e.endUpdate(a)},createUnmaskedGhost:function(e,t){var o,r,n,l,u;if((o=e.parent)&&(r=o.parent)&&(n=_.ImageFacade.getImageFormaForForma(e))&&(l=i.as(this.forkForCutoutVisualization(e,r),d.FrameForma))&&(u=i.as(this.forkForCutoutVisualization(n,l),T.ImageForma))){var h;i.opt(i.as(l.style,g.FrameStyle),(function(e){return e.cutoutMode=p.CutoutMode.Off})),(h=_.ImageFacade.getMaskForForma(e))&&_.ImageFacade.applyMaskToForma(l,h,null,!0),l.intent=c.Forma.INTENT_TEMP_IMAGE_REFINE_CUTOUT,l.isModel=!1;var m=new D.SolidColor(1,0,0,1),f=E.ImageStyle.init_1265("RedOverlay",s.ColorTable.init_2768(m,m),y.CompositeFilter.init_514f(void 0,"Duotone",.3,"normal",void 0,void 0,"duotone"));u.internalSetStyle(f),u.setParent(l),l.setParent(null),l.appendChild(u,!0),o.insertBefore(l,e),l.placement=e.placement,w.OpacityFacade.applyOpacity(0,[l]);var S=[];S.push(u);var v=new C.FormaInsertedChildrenEvent(l,S,0);return l.beginUpdate(v),l.endUpdate(v),t.unmaskedGhost=l,null}return new a.CoreStringError("could not create unmasked ghost")},revertTemporaryChanges:function(e,t){var o,r,n,a=new C.FormaAnimationTransactionEvent(e);a.duration=0,e.beginUpdate(a),i.opt(t.darkScrim,(function(e){return e.removeFromParent()})),i.opt(t.darkScrim,(function(e){return e.destroy()})),i.opt(t.unmaskedGhost,(function(e){return e.removeFromParent()})),i.opt(t.unmaskedGhost,(function(e){return e.destroy()})),(o=t.imageStyle)&&t.image.internalSetStyle(o),(r=t.frameBackgroundColor)&&(e.style.colors.fieldPrimary=r),e.style.blendMode=t.frameBlendMode,(n=e.parent)&&(n.removeChild(e),n.insertChildAt(e,t.indexInParent)),t.floating||(e.allowUserMove=!1),i.opt(e.controller,(function(e){return 1==e.userGroupChild}))&&m.GroupFacade.updateUserGroupHierarchy(e.parent),e.endUpdate(a)},forkForCutoutVisualization:function(e,t){void 0===t&&(t=null);var o,r=f.GUIDUtils.makeGUID(),n=e.database,i=null;return(o=t)&&(i=u.DBLink.init_8408(r,n,o.id)),e.forkToDatabase(r,!1,n,i)}}}),r)},U010:function(e,t,o){var r,n,i,a,l,s=t,u=o("oAGj"),c=o("SpAV"),d=o("gXiO"),h=o("yGNn"),g=o("iCxV"),C=o("kJ8p"),m=o("fNpk");s.MASK_ENDPOINT="/deepcut/mask",s.VERSION_ENDPOINT="/deepcut/version",s.CutoutMode=u.defineEnum("CutoutMode",{Off:0,BackgroundRemoval:1,ForegroundRemoval:2}),s.CutoutModel=u.defineEnum("CutoutModel",{DISCONTINUED_SAGEMAKER:0,DISCONTINUED_SENSEI:1,MALABI:2,REMOVE_BG:3,CLOUDINARY:4,SENSEI2_BINARY:5,SENSEI2_SOFT:6}),s.CutoutMaskSize=u.defineEnum("CutoutMaskSize",{ORIGINAL:0,SMALL:500,MEDIUM:1e3,LARGE:2e3}),s.CutoutStyle=(r=function(e){this.mode=e,d.CoreObject.call(this)},u.defineClass({name:"CutoutStyle",ctor:r,superName:"CoreObject",props:{equals:function(e){return this.mode==e.mode}}}),r),s.CutoutMaskMetadata=(n=function(e,t,o){this.model=e,this.maskSize=t,this.modelVersion=o,d.CoreObject.call(this)},u.defineClass({name:"CutoutMaskMetadata",ctor:n,superName:"CoreObject",statics:{decode:function(e){if(null!=(e=e)){var t=e.split(":");if(3==t.length){var o,r,i,a;if(null!=(o=u.toInt(t[0]))&&null!=(r=u.toInt(t[1]))&&null!=(i=s.CutoutModel.toCaseValue(o))&&null!=(a=s.CutoutMaskSize.toCaseValue(r))){var l=u.toString(t[2]);return new n(i,a,u.isEmpty(l)?null:l)}u.opt(g.Host.logging,(function(e){return e.warning("[ImageCutoutModelLibrary] Unexpected model or maskSize value found in document")}))}}return null}},props:{equals:function(e){return this.model==e.model&&this.maskSize==e.maskSize&&this.modelVersion==e.modelVersion},encode:function(){var e;return this.model+":"+this.maskSize+":"+((e=this.modelVersion)||null!=e?e:"")}}}),n),s.ImageCutoutLibrary=(i=function(){d.CoreObject.call(this)},a={},u.defineClass({name:"ImageCutoutLibrary",ctor:i,superName:"CoreObject",statics:{imageCutouts_:{get:function(){return void 0===a.imageCutouts_&&(a.imageCutouts_=[new s.CutoutStyle(s.CutoutMode.Off),new s.CutoutStyle(s.CutoutMode.BackgroundRemoval),new s.CutoutStyle(s.CutoutMode.ForegroundRemoval)]),a.imageCutouts_}},getImageCutouts:function(){return i.imageCutouts_},getImageCutout:function(e){return i.imageCutouts_.find((function(t){return t.mode==e}),this)},getCutoutModeString:function(e){switch(e){case 1:return"background";case 2:return"foreground";case 0:return"off";default:return m.LegacyCoreAssert.fail("Unknown cutout mode.",{mode:e},"ImageCutoutLibrary.getCutoutModeString","ImageCutoutLibrary.swift",169),"off"}}},props:{getNextImageCutoutOfSameType:function(e){var t;switch(e.mode){case 0:t=i.getImageCutout(s.CutoutMode.Off);break;case 1:t=i.getImageCutout(s.CutoutMode.BackgroundRemoval);break;case 2:t=i.getImageCutout(s.CutoutMode.ForegroundRemoval);break;default:t=i.getImageCutout(s.CutoutMode.Off)}return t},hasNextCutoutOfSameType:function(e){var t;return!!(t=this.getNextImageCutoutOfSameType(e))&&!e.equals(t)}}}),i),s.ImageCutoutModelLibrary=function(){var e=function(){this.modelVersion=null,d.CoreObject.call(this)},t={};return u.defineClass({name:"ImageCutoutModelLibrary",ctor:e,superName:"CoreObject",statics:{CURRENT_MODEL:{get:function(){return void 0===t.CURRENT_MODEL&&(t.CURRENT_MODEL=s.CutoutModel.SENSEI2_SOFT),t.CURRENT_MODEL}},DEFAULT_MASK_SIZE:{get:function(){return void 0===t.DEFAULT_MASK_SIZE&&(t.DEFAULT_MASK_SIZE=s.CutoutMaskSize.MEDIUM),t.DEFAULT_MASK_SIZE}},DEFAULT_TIMEOUT:15,instance:{get:function(){return void 0===t.instance&&(t.instance=new e),t.instance}},isMaskUptodateWithCurrentModel:function(t){return(t=t)&&t.model==e.CURRENT_MODEL?e.instance.getModelVersion(e.CURRENT_MODEL).then((function(e){var o;return null!=(o=u.as(e,"String"))&&t.modelVersion==o})).fail((function(e){return g.Host.logging.error("Failed to get mask version from API"),!1})):h.CorePromise.resolve(!1)},getModelString:function(e){switch(e){case 2:return"malabi";case 3:return"remove.bg";case 4:return"cloudinary";case 5:return"sensei2-binary";case 6:return"sensei2-soft";case 0:case 1:return c.CoreAssert.fail("Invalid use of discontinued model value.",{model:e},"ImageCutoutModelLibrary.getModelString","ImageCutoutLibrary.swift",275),"sensei2-soft";default:return m.LegacyCoreAssert.fail("Unknown model value.",{model:e},"ImageCutoutModelLibrary.getModelString","ImageCutoutLibrary.swift",280),"sensei2-soft"}},buildMaskNetworkRequestForConfig:function(t,o,r,n){var i,a;return(i=g.Host.network)&&(a=g.Host.imageAnalysis)?h.CorePromise.all([i.getAuthToken(),a.getSaliencyAPIEndpoint(),a.getSaliencyAPIKey()]).then((function(i){var a,l,s,c,d=u.clone(u.as(i,["Array","Any"]));if(m.LegacyCoreAssert.isTrue(u.opt(d,(function(e){return 3==e.length})),"Expected three CorePromise results.",void 0,"ImageCutoutModelLibrary.buildMaskNetworkRequestForConfig","ImageCutoutLibrary.swift",296),(a=d)&&null!=(l=u.as(a[0],"String"))&&null!=(s=u.as(a[1],"String"))&&null!=(c=u.as(a[2],"String"))){var g=new C.HostNetworkRequest(s+o);return g.timeout=n,g.method=r,g.headers["X-API-Key"]=c,g.headers.Authorization="Bearer "+l,g.headers["X-Model"]=e.getModelString(t.model),g}return h.CorePromise.reject("Invalid auth data")})):h.CorePromise.reject("Invalid Host instances")}},props:{setup:function(){this.getModelVersion(e.CURRENT_MODEL,!0)},getModelVersion:function(t,o,r){void 0===o&&(o=!1),void 0===r&&(r=10);var n,i=this;if(!o&&t==e.CURRENT_MODEL&&null!=this.modelVersion)return h.CorePromise.resolve(this.modelVersion);if(n=g.Host.network){var a=new s.CutoutMaskMetadata(t,s.CutoutMaskSize.ORIGINAL,null);return e.buildMaskNetworkRequestForConfig(a,s.VERSION_ENDPOINT,C.HostNetworkRequestMethod.get,r).then((function(e){var t;return(t=u.as(e,C.HostNetworkRequest))?n.request(t):h.CorePromise.reject("Invalid network request object")})).then((function(o){var r,n;return(r=u.as(o,C.HostNetworkResponse))&&(n=r.data)?n.asJSON().then((function(o){var r,n;return(r=u.as(o,["Dictionary","String","String"]))&&null!=(n=r.version)?(t==e.CURRENT_MODEL&&i.setModelVersion(n),h.CorePromise.resolve(n)):h.CorePromise.reject("[ImageCutoutModelLibrary] Failed to parse JSON response from `/version` call")})):h.CorePromise.reject("[ImageCutoutModelLibrary] Failed to get model version from API")}))}return h.CorePromise.reject("[ImageCutoutModelLibrary] Failed to get network impl")},setModelVersion:function(e){this.modelVersion=e}}}),e}(),s.ImageCutoutErrorLibrary=(l=function(){d.CoreObject.call(this)},u.defineClass({name:"ImageCutoutErrorLibrary",ctor:l,superName:"CoreObject",statics:{mapServerErrorToMaskError:function(e){if(e.type==C.HostNetworkErrorType.BadRequest)switch(u.as(e.message,"String")){case"unsupported-image":return new C.HostCutoutMaskError(C.HostCutoutMaskErrorType.UnsupportedImageFormat);case"image-too-small":return new C.HostCutoutMaskError(C.HostCutoutMaskErrorType.ImageTooSmall);case"image-too-large":return new C.HostCutoutMaskError(C.HostCutoutMaskErrorType.ImageTooLarge);case"invalid-file-upload":return new C.HostCutoutMaskError(C.HostCutoutMaskErrorType.InvalidImageUploaded);default:return new C.HostCutoutMaskError(C.HostCutoutMaskErrorType.Unknown)}return e}}}),l)},aO0D:function(e,t,o){var r,n,i,a,l,s=t,u=o("oAGj"),c=o("gXiO");s.CropAsset=(r=function(e,t){this.id=e,this.iconId=t},u.defineClass({name:"CropAsset",ctor:r,superName:"CoreObject"}),r),s.CropShape=(n=function(e,t,o){this.fixAspectRatio=o,s.CropAsset.call(this,e,t)},u.defineClass({name:"CropShape",ctor:n,superName:"CropAsset"}),n),s.RasterMask=(i=function(e,t,o,r,n){void 0===n&&(n="image/png"),this.width=o,this.height=r,this.mimeType=n,s.CropAsset.call(this,e,t)},u.defineClass({name:"RasterMask",ctor:i,superName:"CropAsset"}),i),s.CropAssetLibrary=(a=function(){c.CoreObject.call(this)},l={},u.defineClass({name:"CropAssetLibrary",ctor:a,superName:"CoreObject",statics:{shapes:{get:function(){return void 0===l.shapes&&(l.shapes=[new s.CropShape("circle","crop_shape_circle",!0),new s.CropShape("roundedRectangle","crop_shape_roundedRectangle",!1),new s.CropShape("equilateralTriangle","crop_shape_equilateralTriangle",!1),new s.CropShape("rightTriangle","crop_shape_rightTriangle",!1),new s.CropShape("oval","crop_shape_oval",!1),new s.CropShape("halfCircle","crop_shape_halfCircle",!0),new s.CropShape("diamond","crop_shape_diamond",!1),new s.CropShape("hexagon","crop_shape_hexagon",!1),new s.CropShape("parallelogram","crop_shape_parallelogram",!1),new s.CropShape("pentagon","crop_shape_pentagon",!1),new s.CropShape("heart","crop_shape_heart",!0),new s.CropShape("star","crop_shape_star",!0)]),l.shapes}},rasterMasks:{get:function(){return void 0===l.rasterMasks&&(l.rasterMasks=[new s.RasterMask("raster-01","raster-01",1418,1050),new s.RasterMask("raster-Brush-Frame-1","raster-Brush-Frame-1",1126,1050),new s.RasterMask("raster-Brush-Frame-2","raster-Brush-Frame-2",1126,1050),new s.RasterMask("raster-Brush-Frame-3","raster-Brush-Frame-3",1126,1050),new s.RasterMask("raster-Torn-Edge-1","raster-Torn-Edge-1",956,1050),new s.RasterMask("raster-Torn-Edge-2","raster-Torn-Edge-2",755,1050),new s.RasterMask("raster-Torn-Edge-3","raster-Torn-Edge-3",1400,2161),new s.RasterMask("raster-Torn-Edge-4","raster-Torn-Edge-4",956,1050),new s.RasterMask("raster-film-frame-2","raster-film-frame-2",616,1050),new s.RasterMask("raster-film-strip-frame-1","raster-film-strip-frame-1",850,782)]),l.rasterMasks}},getListOfShapes:function(){return a.shapes},getListOfRasterMasks:function(){return a.rasterMasks},getCropShapeFromID:function(e){return a.shapes.find((function(t){return t.id==e}),this)},getRasterMaskFromID:function(e){return a.rasterMasks.find((function(t){return t.id==e}),this)}}}),a)},"b/QB":function(e,t,o){var r,n=t,i=o("oAGj"),a=o("yhkb"),l=o("gXiO"),s=o("ascj"),u=o("4JYN"),c=o("SDdr"),d=o("uWOl"),h=o("fNpk"),g=o("Zifs");n.ImageFilterLibrary=(r=function(){this.styleMixes={Darken:[.1,.3,.5,.7]},this.duotonePresetCategories=["kPop","kBold","kSoft"],this.duotonePresets=[new u.DuotonePreset(g.SolidColor.fromHex(5082,1),g.SolidColor.fromHex(1114024,1),"kPop"),new u.DuotonePreset(g.SolidColor.fromHex(751854,1),g.SolidColor.fromHex(15789840,1),"kPop"),new u.DuotonePreset(g.SolidColor.fromHex(5082,1),g.SolidColor.fromHex(1110527,1),"kPop"),new u.DuotonePreset(g.SolidColor.fromHex(14883254,1),g.SolidColor.fromHex(16247874,1),"kPop"),new u.DuotonePreset(g.SolidColor.fromHex(4325517,1),g.SolidColor.fromHex(16752147,1),"kPop"),new u.DuotonePreset(g.SolidColor.fromHex(4135615,1),g.SolidColor.fromHex(16707312,1),"kPop"),new u.DuotonePreset(g.SolidColor.fromHex(0,1),g.SolidColor.fromHex(16771584,1),"kBold"),new u.DuotonePreset(g.SolidColor.fromHex(0,1),g.SolidColor.fromHex(65496,1),"kBold"),new u.DuotonePreset(g.SolidColor.fromHex(0,1),g.SolidColor.fromHex(16711680,1),"kBold"),new u.DuotonePreset(g.SolidColor.fromHex(0,1),g.SolidColor.fromHex(4849045,1),"kBold"),new u.DuotonePreset(g.SolidColor.fromHex(16735699,1),g.SolidColor.fromHex(16777215,1),"kBold"),new u.DuotonePreset(g.SolidColor.fromHex(58623,1),g.SolidColor.fromHex(16777215,1),"kBold"),new u.DuotonePreset(g.SolidColor.fromHex(9907339,1),g.SolidColor.fromHex(7789055,1),"kSoft"),new u.DuotonePreset(g.SolidColor.fromHex(28017,1),g.SolidColor.fromHex(16753128,1),"kSoft"),new u.DuotonePreset(g.SolidColor.fromHex(1973790,1),g.SolidColor.fromHex(16767731,1),"kSoft"),new u.DuotonePreset(g.SolidColor.fromHex(2038862,1),g.SolidColor.fromHex(16777215,1),"kSoft"),new u.DuotonePreset(g.SolidColor.fromHex(5709851,1),g.SolidColor.fromHex(16771003,1),"kSoft"),new u.DuotonePreset(g.SolidColor.fromHex(12865137,1),g.SolidColor.fromHex(15460804,1),"kSoft")],this._duotonePresetIndex=-1,this.imageStyles=[d.ImageStyle.init_1265(d.ImageStyle.NAME_NONE),d.ImageStyle.init_1265(d.ImageStyle.NAME_GREYSCALE,s.ColorTable.init_25f6([{key:s.ColorRole.FieldPrimary,value:"themeDerivedDark"},{key:s.ColorRole.FieldSecondary,value:"themeDerivedLight"}]),c.CompositeFilter.init_514f(void 0,"Duotone",1,"normal",void 0,void 0,"duotone")),d.ImageStyle.init_1265(d.ImageStyle.NAME_DARKEN,s.ColorTable.init_25f6([{key:s.ColorRole.FieldPrimary,value:"themeDerivedDark"},{key:s.ColorRole.FieldSecondary,value:"themeDerivedDark"}]),c.CompositeFilter.init_514f(void 0,"Duotone",.5,"normal",void 0,void 0,"duotone")),d.ImageStyle.init_1265(d.ImageStyle.NAME_BLUR,null,c.CompositeFilter.init_514f(void 0,"Blur",1,"none",void 0,void 0,"none")),d.ImageStyle.init_1265(d.ImageStyle.NAME_OVERLAY,s.ColorTable.init_25f6([{key:s.ColorRole.FieldPrimary,value:i.as(a.ColorLibraryController.FILTER_OVERLAY_KEYS[0],"String")}]),c.CompositeFilter.init_514f(void 0,"ReduceContrastOverlay",.25,"overlay",!1,.5,"offset",1,1)),d.ImageStyle.init_1265(d.ImageStyle.NAME_MULTIPLY,s.ColorTable.init_25f6([{key:s.ColorRole.FieldPrimary,value:a.ColorLibraryController.FILTER_MULTIPLY_KEYS[1]}]),c.CompositeFilter.init_514f(void 0,"DesaturateMultiply",.4,"multiply",!0,void 0,"offset",.5,1)),d.ImageStyle.init_1265(d.ImageStyle.NAME_BLEND,s.ColorTable.init_25f6([{key:s.ColorRole.FieldPrimary,value:a.ColorLibraryController.FILTER_BLEND_KEYS[2]}]),c.CompositeFilter.init_514f(void 0,"Blend",.3,"normal",!1,void 0,"none")),d.ImageStyle.init_1265(d.ImageStyle.NAME_DUOTONE,s.ColorTable.init_25f6([{key:s.ColorRole.FieldPrimary,value:i.as(a.ColorLibraryController.FILTER_DUOTONE_LOW_KEYS[2],"String")},{key:s.ColorRole.FieldSecondary,value:i.as(a.ColorLibraryController.FILTER_DUOTONE_HIGH_KEYS[0],"String")}]),c.CompositeFilter.init_514f(void 0,"Duotone",1,"normal",void 0,void 0,"duotone")),d.ImageStyle.init_1265(d.ImageStyle.NAME_SCREEN,s.ColorTable.init_25f6([{key:s.ColorRole.FieldPrimary,value:a.ColorLibraryController.FILTER_SCREEN_KEYS[0]}]),c.CompositeFilter.init_514f(void 0,"Screen",.4,"screen",!1,void 0,"none")),d.ImageStyle.init_1265(d.ImageStyle.NAME_NEWDUOTONE,s.ColorTable.init_2768(g.SolidColor.BLACK,g.SolidColor.WHITE),c.CompositeFilter.init_514f(void 0,"Duotone",1,"normal",void 0,void 0,"duotone"))],l.CoreObject.call(this)},i.defineClass({name:"ImageFilterLibrary",ctor:r,superName:"CoreObject",props:{getImageStyle:function(e){for(var t,o=i.iter(this.imageStyles);!o.done;o.next()){var r=o.value;if(e==r.name){t=r;break}}return t},getAllImageStyles:function(){return this.imageStyles},getDefaultDuotonePreset:function(e){var t=i.clone(this.getDuotonePresets());return-1==this._duotonePresetIndex?this._duotonePresetIndex=0:e&&(this._duotonePresetIndex=(this._duotonePresetIndex+1)%t.length),t[this._duotonePresetIndex]},getDuotonePresetCategories:function(){return this.duotonePresetCategories},getDuotonePresets:function(){return this.duotonePresets},getDuotonePresetAtIndex:function(e){var t=i.clone(this.getDuotonePresets());return e>=0&&e<t.length?t[e]:(h.LegacyCoreAssert.fail("Bad duotone preset index",void 0,"ImageFilterLibrary.getDuotonePresetAtIndex","ImageFilterLibrary.swift",296),u.DuotonePreset.DEFAULT)},getDuotonePresetIndex:function(e){for(var t=i.iter(i.toSequence(this.getDuotonePresets()));!t.done;t.next()){var o=t.value,r=o.offset,n=o.element;if(i.eq(u._equality_DuotonePreset_DuotonePreset,e,n)||i.eq(u._equality_DuotonePreset_DuotonePreset,e,n.swap()))return r}return-1},getNextImageStyleOfSameType:function(e,t){void 0===t&&(t=!0);var o,r,n,l,u=e.name,g=!0;switch(u){case"None":o=this.getImageStyle(d.ImageStyle.NAME_NONE);break;case"Greyscale":o=this.getImageStyle(d.ImageStyle.NAME_GREYSCALE);break;case"Blur":o=this.getImageStyle(d.ImageStyle.NAME_BLUR);break;case"Darken":(o=i.as(this.getImageStyle(d.ImageStyle.NAME_DARKEN).clone(),d.ImageStyle)).colorLibrary=e.colorLibrary;break;case"Overlay":case"Multiply":case"Blend":case"Screen":if((o=i.as(this.getImageStyle(u).clone(),d.ImageStyle)).colorLibrary=e.colorLibrary,null==(f=e.colors.colorID(s.ColorRole.FieldPrimary)))return h.LegacyCoreAssert.fail("Style missing FieldPrimary key",{styleName:u},"ImageFilterLibrary.getNextImageStyleOfSameType","ImageFilterLibrary.swift",348),null;var C=a.ColorLibraryController.getNextKeyInSet(f),m=C[0];g=E=C[1],o.colors.setColorId(s.ColorRole.FieldPrimary,m);break;case"DuoTone":var f;if((o=i.as(this.getImageStyle(d.ImageStyle.NAME_DUOTONE).clone(),d.ImageStyle)).colorLibrary=e.colorLibrary,null==(f=e.colors.colorID(s.ColorRole.FieldPrimary)))return h.LegacyCoreAssert.fail("Missing color key",void 0,"ImageFilterLibrary.getNextImageStyleOfSameType","ImageFilterLibrary.swift",363),null;var S,p=a.ColorLibraryController.getNextKeyInSet(f),T=p[0];if(p[1],o.colors.setColorId(s.ColorRole.FieldPrimary,T),null==(S=e.colors.colorID(s.ColorRole.FieldSecondary)))return h.LegacyCoreAssert.fail("Missing color key",void 0,"ImageFilterLibrary.getNextImageStyleOfSameType","ImageFilterLibrary.swift",377),null;var y=a.ColorLibraryController.getNextKeyInSet(S),_=y[0],E=y[1];o.colors.setColorId(s.ColorRole.FieldSecondary,_),g=E;break;case"NewDuoTone":(o=i.as(this.getImageStyle(u).clone(),d.ImageStyle)).colorLibrary=e.colorLibrary;var w=e.colors.fieldShadows;o.colors.fieldShadows=e.colors.fieldHighlights,o.colors.fieldHighlights=w;break;default:o=this.getImageStyle(d.ImageStyle.NAME_NONE)}if((r=this.styleMixes[u])&&null!=(n=i.opt(i.as(e.filter,c.CompositeFilter),(function(e){return e.mix})))&&t&&g&&null!=(l=i.indexOf(r,n))){var v=r[(l+1)%r.length];o.filter.mix=v}return i.opt(o,(function(t){return t.adjustments=e.adjustments})),i.opt(o,(function(t){return t.opacity=e.opacity})),o},getImageStyles:function(){return[this.getImageStyle(d.ImageStyle.NAME_NONE),this.getImageStyle(d.ImageStyle.NAME_NEWDUOTONE),this.getImageStyle(d.ImageStyle.NAME_GREYSCALE),this.getImageStyle(d.ImageStyle.NAME_DARKEN),this.getImageStyle(d.ImageStyle.NAME_OVERLAY),this.getImageStyle(d.ImageStyle.NAME_BLEND),this.getImageStyle(d.ImageStyle.NAME_SCREEN),this.getImageStyle(d.ImageStyle.NAME_DUOTONE),this.getImageStyle(d.ImageStyle.NAME_MULTIPLY)]},hasNextStyleOfSameType:function(e){var t;return!!(t=this.getNextImageStyleOfSameType(e,!0))&&!e.equals(t)}}}),r)},g8Fi:function(e,t,o){var r,n,i,a,l,s=t,u=o("oAGj"),c=o("gXiO"),d=o("iCxV"),h=o("fNpk"),g=o("90dd"),C=o("oKlP"),m=o("ZoS2");s.PointerTypeEnum=u.defineEnum("PointerTypeEnum",{Mouse:0,Touch:1}),s.PointerStatus=u.defineEnum("PointerStatus",{DragFree:0,DragHeld:1,DragActive:2,DragInactive:3}),s.PointerMark=(r=function(e,t){this.when=e,this.point=t},u.defineClass({name:"PointerMark",ctor:r,props:{div:function(e){return new r(this.when/e,{x:this.point.x/e,y:this.point.y/e})}}}),r),s._minus_PointerMark_PointerMark=function(e,t){return new s.PointerMark(e.when-t.when,{x:e.point.x-t.point.x,y:e.point.y-t.point.y})},s._plus_PointerMark_PointerMark=function(e,t){return new s.PointerMark(e.when+t.when,{x:e.point.x+t.point.x,y:e.point.y+t.point.y})},s.PointerState=(n=function(e,t,o,r,n){this.down=!1,this.cancelled=!1,this.tapCount=1,this.modifierKeys={},this.pointerStatus=s.PointerStatus.DragFree,this.slippage=C.TheoPoint.ZERO,this.id=e,this.type=t,this.currentPage=o,this.startLocation=r,this.currentLocation=r,this.startTime=n,this.currentTime=n,this.history=[],c.CoreObject.call(this),this.updateHistory(n,r)},u.defineClass({name:"PointerState",ctor:n,superName:"CoreObject",props:{updateState:function(e){h.LegacyCoreAssert.isTrue(e.type==this.type&&e.onPage===this.currentPage&&e.id==this.id,"pointer update type/page/id does not match",void 0,"PointerState.updateState","PointersState.swift",142),this.currentLocation=e.loc,this.currentTime=e.when,this.updateHistory(e.when,e.loc),this.tapCount=e.tapCount,this.cancelled=e.cancelled,this.viewportTransform=e.viewportTransform,this.modifierKeys=u.clone(e.modifierKeys)},updateHistory:function(e,t){var o=this.history.length-28;o>0&&this.history.splice(0,o),this.history.push(new s.PointerMark(e,{x:t.x,y:t.y}))},pointerVelocity:function(){for(var e=d.Host.async.getSystemUptimeInSeconds()-.2,t=[],o=this.history.length-1;o>=0&&!(this.history[o].when<e);)t.splice(0,0,this.history[o]),o-=1;for(var r=u.clone(function(e,t){var o=u.clone(e),r=t;if(r>e.length&&(r=e.length),r<=1)return o;for(var n=u.iter(u.range(1,r,!1));!n.done;n.next())for(var i=n.value,a=u.iter(u.range(0,e.length-i,!1));!a.done;a.next())o[i+(d=a.value)]=s._plus_PointerMark_PointerMark(o[i+d],e[d]);for(var l=u.iter(u.range(1,r,!1));!l.done;l.next())o[i=l.value]=o[i].div(u.toDouble(i+1));for(var c=u.iter(u.range(r,e.length,!1));!c.done;c.next()){var d;o[d=c.value]=o[d].div(u.toDouble(r))}return o}(t,3)),n=3,i=2,a=0,l=0;n<r.length;){var c=s._minus_PointerMark_PointerMark(r[n],r[i]);a+=c.when,l+=Math.sqrt(c.point.x*c.point.x+c.point.y*c.point.y),n+=1,i+=1}var h=l/a;return isNaN(h)?0:h}}}),n),s.PointerUpdate=(i=function(e,t,o,r,n){this.cancelled=!1,this.tapCount=1,this.id=e,this.type=t,this.onPage=o,this.loc=r,this.when=n,this.cancelled=!1,this.tapCount=1,this.modifierKeys={}},u.defineClass({name:"PointerUpdate",ctor:i,superName:"CoreObject"}),i),s.PointersState=(a=function(){this.LONG_PRESS_TIME_THRESHOLD=1.25,this.LONG_PRESS_DIST_THRESHOLD=50,this.pointers_=[],m.TheoPublishingObject.call(this)},u.defineClass({name:"PointersState",ctor:a,superName:"TheoPublishingObject",statics:{_implements:function(e){return"TheoMessagePublisher"==e}},props:{onPointersDown:function(e){for(var t=[],o=u.iter(e);!o.done;o.next()){var r,n=o.value;(r=this.pointerByID(n.id))&&(h.LegacyCoreAssert.isTrue(n.type==s.PointerTypeEnum.Mouse,"unexpected update type",{type:n.type},"PointersState.onPointersDown","PointersState.swift",326),u.remove(this.pointers_,r)),(r=new s.PointerState(n.id,n.type,n.onPage,n.loc,n.when)).viewportTransform=n.viewportTransform,r.down=!0,r.modifierKeys=u.clone(n.modifierKeys),this.pointers_.push(r),t.push(r)}this.publish(new s.PointersStateChangeMessage(this,s.PointersStateChangeTypeEnum.PointersDown,t))},onPointersMoved:function(e){for(var t=[],o=u.iter(e);!o.done;o.next()){var r=o.value,n=this.pointerByID(r.id);null==n&&((n=new s.PointerState(r.id,r.type,r.onPage,r.loc,r.when)).down=!1,h.LegacyCoreAssert.isTrue(r.type==s.PointerTypeEnum.Mouse,"unexpected update type",{type:r.type},"PointersState.onPointersMoved","PointersState.swift",355),this.pointers_.push(n)),n.updateState(r),t.push(n)}this.publish(new s.PointersStateChangeMessage(this,s.PointersStateChangeTypeEnum.PointersMoved,t))},onPointersUp:function(e){for(var t=[],o=u.iter(e);!o.done;o.next()){var r,n=o.value;(r=this.pointerByID(n.id))&&(r.type==s.PointerTypeEnum.Touch&&u.remove(this.pointers_,r),r.updateState(n),t.push(r))}var i=new s.PointersStateChangeMessage(this,s.PointersStateChangeTypeEnum.PointersUp,t);this.publish(i)},forEachPointer:function(e){for(var t=u.iter(this.pointers_);!t.done;t.next())e(t.value)},forEachPointerDown:function(e){for(var t=u.iter(this.pointers_);!t.done;t.next()){var o=t.value;o.down&&e(o)}},pointerCount:function(){return this.pointers_.length},pointerDownCount:function(){for(var e=0,t=u.iter(this.pointers_);!t.done;t.next())t.value.down&&(e+=1);return e},pointerByID:function(e){for(var t=u.iter(this.pointers_);!t.done;t.next()){var o=t.value;if(o.id==e)return o}return null}}}),a),s.PointersStateChangeTypeEnum=u.defineEnum("PointersStateChangeTypeEnum",{PointersDown:0,PointersMoved:1,PointersUp:2}),s.PointersStateChangeMessage=(l=function e(t,o,r){this.changeType=o,this.pointers=u.clone(r),g.TheoMessage.call(this,e.TYPE,t)},u.defineClass({name:"PointersStateChangeMessage",ctor:l,superName:"TheoMessage",statics:{TYPE:{get:function(){return"PointersStateChangeMessage"}}}}),l)},h67N:function(e,t,o){var r,n=t,i=o("oAGj"),a=o("gXiO"),l=o("6ZWm"),s=o("tQF8"),u=o("4mVB"),c=o("iCxV"),d=o("fdtz"),h=o("fNpk"),g=o("3v9D"),C=o("sIWg");n.GridLibrary=(r=function(){this.gridStyles=[u.GridStyle.init_bf40("Single","Simple",[new s.GridCell(new C.TheoRect(0,0,1,1))],void 0,void 0,void 0,l.CropType.PreserveFocus),u.GridStyle.init_bf40("Single-Overlap","Banner",[new s.GridCell(new C.TheoRect(0,0,1,1)),new s.GridCell(new C.TheoRect(.25,0,.75,1),null,.75)]),u.GridStyle.init_bf40("Single-Center-Overlap","Banner",[new s.GridCell(new C.TheoRect(0,0,1,1)),new s.GridCell(new C.TheoRect(.25,.25,.75,.75),null,.75)]),u.GridStyle.init_bf40("Half-2",void 0,[new s.GridCell(new C.TheoRect(0,0,.5001,1)),new s.GridCell(new C.TheoRect(.5001,0,1,1))]),u.GridStyle.init_bf40("Third-2",void 0,[new s.GridCell(new C.TheoRect(0,0,1/3,1)),new s.GridCell(new C.TheoRect(1/3,0,1,1))]),u.GridStyle.init_bf40("Half-2-1",void 0,[new s.GridCell(new C.TheoRect(0,0,.5001,.5001)),new s.GridCell(new C.TheoRect(0,.5001,.5001,1)),new s.GridCell(new C.TheoRect(.5001,0,1,1))]),u.GridStyle.init_bf40("Third-2-1",void 0,[new s.GridCell(new C.TheoRect(0,0,1/3,1)),new s.GridCell(new C.TheoRect(1/3,0,1,.5001)),new s.GridCell(new C.TheoRect(1/3,.5001,1,1))]),u.GridStyle.init_bf40("Third-3",void 0,[new s.GridCell(new C.TheoRect(0,0,1/3,1)),new s.GridCell(new C.TheoRect(1/3,0,2/3,1)),new s.GridCell(new C.TheoRect(2/3,0,1,1))]),u.GridStyle.init_bf40("Half-2-2",void 0,[new s.GridCell(new C.TheoRect(0,0,.5,.5)),new s.GridCell(new C.TheoRect(0,.5,.5,1)),new s.GridCell(new C.TheoRect(.5,0,1,.5)),new s.GridCell(new C.TheoRect(.5,.5,1,1))]),u.GridStyle.init_bf40("Half-3-1",void 0,[new s.GridCell(new C.TheoRect(0,0,1/3,1/3)),new s.GridCell(new C.TheoRect(0,1/3,1/3,2/3)),new s.GridCell(new C.TheoRect(0,2/3,1/3,1)),new s.GridCell(new C.TheoRect(1/3,0,1,1))]),u.GridStyle.init_bf40("Half-1-3",void 0,[new s.GridCell(new C.TheoRect(0,0,.5001,1)),new s.GridCell(new C.TheoRect(.5001,0,1,1/3)),new s.GridCell(new C.TheoRect(.5001,1/3,1,2/3)),new s.GridCell(new C.TheoRect(.5001,2/3,1,1))]),u.GridStyle.init_bf40("Third-1-2-1",void 0,[new s.GridCell(new C.TheoRect(0,0,1/3,1)),new s.GridCell(new C.TheoRect(1/3,0,2/3,.5001)),new s.GridCell(new C.TheoRect(1/3,.5001,2/3,1)),new s.GridCell(new C.TheoRect(2/3,0,1,1))]),u.GridStyle.init_bf40("Half-2-2-Offset",void 0,[new s.GridCell(new C.TheoRect(.5,0,1,.35)),new s.GridCell(new C.TheoRect(0,.65,.5,1)),new s.GridCell(new C.TheoRect(0,0,.5,.65)),new s.GridCell(new C.TheoRect(.5,.35,1,1))]),u.GridStyle.init_bf40("Fourth-1",void 0,[new s.GridCell(new C.TheoRect(0,0,1/4,1)),new s.GridCell(new C.TheoRect(1/4,0,.5001,1)),new s.GridCell(new C.TheoRect(.5001,0,3/4,1)),new s.GridCell(new C.TheoRect(3/4,0,1,1))]),u.GridStyle.init_bf40("Half-2-3",void 0,[new s.GridCell(new C.TheoRect(0,0,1,.5001)),new s.GridCell(new C.TheoRect(0,.5001,.5001,1)),new s.GridCell(new C.TheoRect(.5001,.5001,1,.75)),new s.GridCell(new C.TheoRect(.5001,.75,1,1))]),u.GridStyle.init_bf40("Half-1-3",void 0,[new s.GridCell(new C.TheoRect(0,0,.5001,1)),new s.GridCell(new C.TheoRect(.5001,0,3/4,.5001)),new s.GridCell(new C.TheoRect(3/4,0,1,.5001)),new s.GridCell(new C.TheoRect(.5001,.5001,1,1))]),u.GridStyle.init_bf40("Third-2-3-2",void 0,[new s.GridCell(new C.TheoRect(0,0,.75,.25)),new s.GridCell(new C.TheoRect(.75,0,1,.75)),new s.GridCell(new C.TheoRect(.25,.25,.75,.75)),new s.GridCell(new C.TheoRect(0,.25,.25,1)),new s.GridCell(new C.TheoRect(.25,.75,1,1))]),u.GridStyle.init_bf40("Third-1-3-1",void 0,[new s.GridCell(new C.TheoRect(0,0,1/3,1)),new s.GridCell(new C.TheoRect(1/3,0,2/3,1/3)),new s.GridCell(new C.TheoRect(1/3,1/3,2/3,2/3)),new s.GridCell(new C.TheoRect(1/3,2/3,2/3,1)),new s.GridCell(new C.TheoRect(2/3,0,1,1))]),u.GridStyle.init_bf40("Fifth-5",void 0,[new s.GridCell(new C.TheoRect(0,0,.2,1)),new s.GridCell(new C.TheoRect(.2,0,.4,1)),new s.GridCell(new C.TheoRect(.4,0,.6,1)),new s.GridCell(new C.TheoRect(.6,0,.8,1)),new s.GridCell(new C.TheoRect(.8,0,1,1))]),u.GridStyle.init_bf40("Third-2-1-2",void 0,[new s.GridCell(new C.TheoRect(0,0,1/3,2/3)),new s.GridCell(new C.TheoRect(0,2/3,1/3,1)),new s.GridCell(new C.TheoRect(1/3,0,2/3,1)),new s.GridCell(new C.TheoRect(2/3,0,1,1/3)),new s.GridCell(new C.TheoRect(2/3,1/3,1,1))]),u.GridStyle.init_bf40("Third-1-1-4",void 0,[new s.GridCell(new C.TheoRect(0,0,2/3,1)),new s.GridCell(new C.TheoRect(2/3,0,1,1/4)),new s.GridCell(new C.TheoRect(2/3,1/4,1,.5001)),new s.GridCell(new C.TheoRect(2/3,.5001,1,3/4)),new s.GridCell(new C.TheoRect(2/3,3/4,1,1))]),u.GridStyle.init_bf40("Split-3-2",void 0,[new s.GridCell(new C.TheoRect(0,0,1/3,.5001)),new s.GridCell(new C.TheoRect(0,.5001,.5001,1)),new s.GridCell(new C.TheoRect(1/3,0,2/3,.5001)),new s.GridCell(new C.TheoRect(2/3,0,1,.5001)),new s.GridCell(new C.TheoRect(.5001,.5001,1,1))]),u.GridStyle.init_bf40("Split-2-3",void 0,[new s.GridCell(new C.TheoRect(0,0,.5001,.5001)),new s.GridCell(new C.TheoRect(0,.5001,1/3,1)),new s.GridCell(new C.TheoRect(.5001,0,1,.5001)),new s.GridCell(new C.TheoRect(1/3,.5001,2/3,1)),new s.GridCell(new C.TheoRect(2/3,.5001,1,1))]),u.GridStyle.init_bf40("Half-3-3",void 0,[new s.GridCell(new C.TheoRect(0,0,.5,1/3)),new s.GridCell(new C.TheoRect(0,1/3,.5,2/3)),new s.GridCell(new C.TheoRect(0,2/3,.5,1)),new s.GridCell(new C.TheoRect(.5,0,1,1/3)),new s.GridCell(new C.TheoRect(.5,1/3,1,2/3)),new s.GridCell(new C.TheoRect(.5,2/3,1,1))]),u.GridStyle.init_bf40("Split-2-2-2",void 0,[new s.GridCell(new C.TheoRect(0,0,1/3,2/3)),new s.GridCell(new C.TheoRect(0,2/3,1/3,1)),new s.GridCell(new C.TheoRect(1/3,0,2/3,.5001)),new s.GridCell(new C.TheoRect(1/3,.5001,2/3,1)),new s.GridCell(new C.TheoRect(2/3,0,1,1/3)),new s.GridCell(new C.TheoRect(2/3,1/3,1,1))]),u.GridStyle.init_bf40("Quarter-2-2-2-2",void 0,[new s.GridCell(new C.TheoRect(0,0,.5001,2/3)),new s.GridCell(new C.TheoRect(0,2/3,1/4,1)),new s.GridCell(new C.TheoRect(1/4,2/3,.5001,1)),new s.GridCell(new C.TheoRect(.5001,0,3/4,1/3)),new s.GridCell(new C.TheoRect(3/4,0,1,1/3)),new s.GridCell(new C.TheoRect(.5001,1/3,1,1))]),u.GridStyle.init_bf40("Third-2-2-3",void 0,[new s.GridCell(new C.TheoRect(0,0,2/3,2/3)),new s.GridCell(new C.TheoRect(0,2/3,1/3,1)),new s.GridCell(new C.TheoRect(1/3,2/3,2/3,1)),new s.GridCell(new C.TheoRect(2/3,0,1,1/3)),new s.GridCell(new C.TheoRect(2/3,1/3,1,2/3)),new s.GridCell(new C.TheoRect(2/3,2/3,1,1))]),u.GridStyle.init_bf40("Third-3-2-2",void 0,[new s.GridCell(new C.TheoRect(0,0,1/3,1/3)),new s.GridCell(new C.TheoRect(0,1/3,1/3,2/3)),new s.GridCell(new C.TheoRect(0,2/3,1/3,1)),new s.GridCell(new C.TheoRect(1/3,0,1,2/3)),new s.GridCell(new C.TheoRect(1/3,2/3,2/3,1)),new s.GridCell(new C.TheoRect(2/3,2/3,1,1))]),u.GridStyle.init_bf40("Split-3-1-3",void 0,[new s.GridCell(new C.TheoRect(0,0,1/3,1/3)),new s.GridCell(new C.TheoRect(0,1/3,1,2/3)),new s.GridCell(new C.TheoRect(0,2/3,1/3,1)),new s.GridCell(new C.TheoRect(1/3,0,2/3,1/3)),new s.GridCell(new C.TheoRect(1/3,2/3,2/3,1)),new s.GridCell(new C.TheoRect(2/3,0,1,1/3)),new s.GridCell(new C.TheoRect(2/3,2/3,1,1))]),u.GridStyle.init_bf40("Split-2-3-2",void 0,[new s.GridCell(new C.TheoRect(0,0,.5001,1/3)),new s.GridCell(new C.TheoRect(0,1/3,1/3,2/3)),new s.GridCell(new C.TheoRect(0,2/3,.5001,1)),new s.GridCell(new C.TheoRect(1/3,1/3,2/3,2/3)),new s.GridCell(new C.TheoRect(.5001,0,1,1/3)),new s.GridCell(new C.TheoRect(2/3,1/3,1,2/3)),new s.GridCell(new C.TheoRect(.5001,2/3,1,1))]),u.GridStyle.init_bf40("Half-4-4",void 0,[new s.GridCell(new C.TheoRect(0,0,.5001,1/4)),new s.GridCell(new C.TheoRect(0,1/4,.5001,.5001)),new s.GridCell(new C.TheoRect(0,.5001,.5001,3/4)),new s.GridCell(new C.TheoRect(0,3/4,.5001,1)),new s.GridCell(new C.TheoRect(.5001,0,1,1/4)),new s.GridCell(new C.TheoRect(.5001,1/4,1,.5001)),new s.GridCell(new C.TheoRect(.5001,.5001,1,3/4)),new s.GridCell(new C.TheoRect(.5001,3/4,1,1))]),u.GridStyle.init_bf40("Split-3-2-3",void 0,[new s.GridCell(new C.TheoRect(0,0,1/3,1/3)),new s.GridCell(new C.TheoRect(0,1/3,.5001,2/3)),new s.GridCell(new C.TheoRect(0,2/3,1/3,1)),new s.GridCell(new C.TheoRect(1/3,0,2/3,1/3)),new s.GridCell(new C.TheoRect(1/3,2/3,2/3,1)),new s.GridCell(new C.TheoRect(2/3,0,1,1/3)),new s.GridCell(new C.TheoRect(.5001,1/3,1,2/3)),new s.GridCell(new C.TheoRect(2/3,2/3,1,1))]),u.GridStyle.init_bf40("Third-3-3-3",void 0,[new s.GridCell(new C.TheoRect(0,0,1/3,1/3)),new s.GridCell(new C.TheoRect(0,1/3,1/3,2/3)),new s.GridCell(new C.TheoRect(0,2/3,1/3,1)),new s.GridCell(new C.TheoRect(1/3,0,2/3,1/3)),new s.GridCell(new C.TheoRect(1/3,1/3,2/3,2/3)),new s.GridCell(new C.TheoRect(1/3,2/3,2/3,1)),new s.GridCell(new C.TheoRect(2/3,0,1,1/3)),new s.GridCell(new C.TheoRect(2/3,1/3,1,2/3)),new s.GridCell(new C.TheoRect(2/3,2/3,1,1))]),u.GridStyle.init_bf40("Third-4-1-4",void 0,[new s.GridCell(new C.TheoRect(0,0,1/3,1/4)),new s.GridCell(new C.TheoRect(0,1/4,1/3,.5001)),new s.GridCell(new C.TheoRect(0,.5001,1/3,3/4)),new s.GridCell(new C.TheoRect(0,3/4,1/3,1)),new s.GridCell(new C.TheoRect(1/3,0,2/3,1)),new s.GridCell(new C.TheoRect(2/3,0,1,1/4)),new s.GridCell(new C.TheoRect(2/3,1/4,1,.5001)),new s.GridCell(new C.TheoRect(2/3,.5001,1,3/4)),new s.GridCell(new C.TheoRect(2/3,3/4,1,1))]),u.GridStyle.init_bf40("Third-4-3-2",void 0,[new s.GridCell(new C.TheoRect(0,0,1/3,1/4)),new s.GridCell(new C.TheoRect(0,1/4,1/3,.5001)),new s.GridCell(new C.TheoRect(0,.5001,1/3,3/4)),new s.GridCell(new C.TheoRect(0,3/4,1/3,1)),new s.GridCell(new C.TheoRect(1/3,0,2/3,1/3)),new s.GridCell(new C.TheoRect(1/3,1/3,2/3,2/3)),new s.GridCell(new C.TheoRect(1/3,2/3,2/3,1)),new s.GridCell(new C.TheoRect(2/3,0,1,.5001)),new s.GridCell(new C.TheoRect(2/3,.5001,1,1))]),u.GridStyle.init_bf40("Split-2-3-4",void 0,[new s.GridCell(new C.TheoRect(0,0,.5001,1/3)),new s.GridCell(new C.TheoRect(0,1/3,1/3,2/3)),new s.GridCell(new C.TheoRect(0,2/3,1/4,1)),new s.GridCell(new C.TheoRect(.5001,0,1,1/3)),new s.GridCell(new C.TheoRect(1/3,1/3,2/3,2/3)),new s.GridCell(new C.TheoRect(1/4,2/3,.5001,1)),new s.GridCell(new C.TheoRect(2/3,1/3,1,2/3)),new s.GridCell(new C.TheoRect(.5001,2/3,3/4,1)),new s.GridCell(new C.TheoRect(3/4,2/3,1,1))])],a.CoreObject.call(this)},i.defineClass({name:"GridLibrary",ctor:r,superName:"CoreObject",props:{layoutSuggestionModel:{get:function(){return null==this.layoutSuggestionModel_&&(this.layoutSuggestionModel_=i.opt(c.Host.learning,(function(e){return e.loadLayoutSuggestionModel()}))),this.layoutSuggestionModel_},set:function(e){this.layoutSuggestionModel_=e}},canFlipStyle:function(e){return!["Single","Single-Center-Overlap","Half-2-2","Third-2-3-2","Third-2-3-2-Spaced","Third-3-3-3","Third-2-2-3","Half-2-3","Third-4-3-2","Half-1-3","Third-3-2-2","Split-2-3-4"].includes(e.name)},basicFullDesignGridStyle:function(){var e=this.getGridStyle("Single");return e.moveableShift=!1,e},getAllGrids:function(){for(var e=[],t=i.iter(this.gridStyles);!t.done;t.next()){var o=t.value;e.push(o),this.canFlipStyle(o)&&e.push(o.flipRegion())}return e},getLayoutsForRoot:function(e,t){void 0===t&&(t=null);var o,r=[],n=[];if(!(o=e.controller.getGridController()))return h.LegacyCoreAssert.fail("should always have a grid at this point",void 0,"GridLibrary.getLayoutsForRoot","GridLibrary.swift",558),[];for(var a=g.LayoutSuggester.init_abc1(o.forma,t),l=i.clone(e.filterWithCallback((function(e){return null!=e.controller&&e.controller.floating}))),s=i.clone(e.filterWithCallback((function(e){return null!=e.parent&&e.parent.isBackgroundImage()}))),u=s.length,c=!0,C=i.iter(s);!C.done;C.next()){var m=C.value;if(i.opt(i.opt(i.as(m,d.ImageForma),(function(e){return e.contentNode})),(function(e){return null==e.focusRegion}))){c=!1;break}}var f=[],S=1,p=c&&u>1?1:0,T=c?1:2,y=c?1:0;u>5&&(c?(S=0==l.length?2:1,p=0==l.length?2:1,T=0==l.length?0:1,y=0==l.length?0:1):(S=0==l.length?4:2,T=0==l.length?0:2));var _,E=i.clone(a.createSuggestions(!0,!1,!1,!1,S));(n=i.clone(a.createEqualSizeSuggestions(!1,10)),i.append(E,n),E.length>0&&i.append(f,E.slice(0,Math.min(S,E.length))),c&&(E=i.clone(a.createSuggestions(!0,!1,!1,!0,p))).length>0&&i.append(f,E.slice(0,Math.min(p,E.length))),0==!l.length)&&((_=i.clone(a.createSuggestions(!0,!1,!0,!1,T))).length>0&&i.append(f,_.slice(0,Math.min(T,_.length))),c&&(_=i.clone(a.createSuggestions(!0,!1,!0,!0,y))).length>0&&i.append(f,_.slice(0,Math.min(y,_.length))),i.append(n,a.createEqualSizeSuggestions(!0,10)));for(var w=i.iter(i.range(0,f.length,!1));!w.done;w.next())(G=f[L=w.value]).gridStyle.name="ContentAwareGrid-"+i.toString(L),G.gridStyle.category="Suggested",G.gridStyle.forma=o.forma,r.push(G.gridStyle);for(var v=i.clone(a.predictLayoutIds(3,r)),b=i.iter(v);!b.done;b.next()){var D=b.value;if(F=this.getGridStyle(D)){var R=F.clone();R.category="Suggested",r.push(R)}}for(var I=e.filterWithCallback((function(e){return e.isBackgroundImage()})).length,P=[],k=i.iter(this.gridStyles);!k.done;k.next()){var F;(F=k.value).nonOverlappingCells().length>=I&&(r.push(F),P.push(F),this.canFlipStyle(F)&&(r.push(F.flipRegion()),P.push(F.flipRegion())))}for(var M=i.iter(i.range(0,n.length,!1));!M.done;M.next()){for(var L,G,A=(G=n[L=M.value]).gridStyle,x=!1,O=i.iter(P);!O.done;O.next())if(O.value.geometricEquals(A)){x=!0;break}x||r.push(A)}return r},getGridsByCellNumber:function(e,t){if(void 0===t&&(t=!0),1==e&&0==t)return[this.getGridStyle("Single")];for(var o=[],r=i.iter(this.gridStyles);!r.done;r.next()){var n=r.value,a=n.nonOverlappingCells().length;(t?a>=e:a==e)&&!n.anyOverlap&&(o.push(n),this.canFlipStyle(n)&&o.push(n.flipRegion()))}return 0==o.length&&h.LegacyCoreAssert.fail("No matching grids in the library. Need to implement a generic grid creator.",void 0,"GridLibrary.getGridsByCellNumber","GridLibrary.swift",623),o},getGridStyle:function(e){for(var t,o=i.iter(this.gridStyles);!o.done;o.next()){var r=o.value;if(e==r.name){t=r;break}if(this.canFlipStyle(r)){var n=r.flipRegion();if(e==n.name){t=n;break}}}return t},getCategoryForStyle:function(e){var t;return null!=(t=e.category)?t:"Single"==e.name?"Simple":e.name.includes("Overlap")?"Banner":e.name.includes("ContentAwareGrid")?"Suggested":"Grid"}}}),r)},lqhW:function(e,t,o){var r,n,i,a,l=t,s=o("oAGj"),u=o("gXiO"),c=o("ylxa"),d=o("1NAc");l.DesignSize=(r=function(e,t,o,r,n,i,a){this.label=e,this.subLabel=t,this.id=o,this.iconId=r,this.category=n,this.aspectRatio=i,this.exportData=a},s.defineClass({name:"DesignSize",ctor:r,superName:"CoreObject"}),r),l.DesignSizeCategory=(n=function(e,t){this.id=e,this.label=t},s.defineClass({name:"DesignSizeCategory",ctor:n,superName:"CoreObject"}),n),l.DesignSizeCategories=(i=function(){u.CoreObject.call(this)},a={},s.defineClass({name:"DesignSizeCategories",ctor:i,superName:"CoreObject",statics:{SocialPost:{get:function(){return void 0===a.SocialPost&&(a.SocialPost=new l.DesignSizeCategory("socialPost","SOCIAL POST")),a.SocialPost}},Print:{get:function(){return void 0===a.Print&&(a.Print=new l.DesignSizeCategory("print","PRINT")),a.Print}},SocialProfile:{get:function(){return void 0===a.SocialProfile&&(a.SocialProfile=new l.DesignSizeCategory("socialProfile","SOCIAL PROFILE")),a.SocialProfile}},Standard:{get:function(){return void 0===a.Standard&&(a.Standard=new l.DesignSizeCategory("standard","STANDARD")),a.Standard}},Custom:{get:function(){return void 0===a.Custom&&(a.Custom=new l.DesignSizeCategory("Custom","Custom")),a.Custom}},Default:{get:function(){return void 0===a.Default&&(a.Default=new l.DesignSizeCategory("Default","Default")),a.Default}},getCategories:function(){return[i.SocialPost,i.Print,i.SocialProfile,i.Standard]}}}),i),l.DesignSizeLibrary=function(){var e=function(){u.CoreObject.call(this)},t={};return s.defineClass({name:"DesignSizeLibrary",ctor:e,superName:"CoreObject",statics:{MAX_EDGE:2560,designSizes:{get:function(){return void 0===t.designSizes&&(t.designSizes=[new l.DesignSize("k_Instagram_label","k_Instagram_subLabel","Instagram","instagram_icon",l.DesignSizeCategories.SocialPost,1,new c.FormaPageExportData(new d.TheoSize(1080,1080),c.PageExportFormat.PIXELS)),new l.DesignSize("k_InstagramStory_label","k_InstagramStory_subLabel","InstagramStory","instagram_icon",l.DesignSizeCategories.SocialPost,.5625,new c.FormaPageExportData(new d.TheoSize(1080,1920),c.PageExportFormat.PIXELS)),new l.DesignSize("k_InstagramPortrait_label","k_InstagramPortrait_subLabel","InstagramPortrait","instagram_icon",l.DesignSizeCategories.SocialPost,.8,new c.FormaPageExportData(new d.TheoSize(1080,1350),c.PageExportFormat.PIXELS)),new l.DesignSize("k_InstagramLandscape_label","k_InstagramLandscape_subLabel","InstagramLandscape","instagram_icon",l.DesignSizeCategories.SocialPost,1.91,new c.FormaPageExportData(new d.TheoSize(1080,566),c.PageExportFormat.PIXELS)),new l.DesignSize("k_Facebook_label","k_Facebook_subLabel","Facebook","facebook_icon",l.DesignSizeCategories.SocialPost,1.91,new c.FormaPageExportData(new d.TheoSize(1200,628),c.PageExportFormat.PIXELS)),new l.DesignSize("k_Pinterest_label","k_Pinterest_subLabel","Pinterest","pinterest_icon",l.DesignSizeCategories.SocialPost,.666969147,new c.FormaPageExportData(new d.TheoSize(735,1102),c.PageExportFormat.PIXELS)),new l.DesignSize("k_YouTubeThumbnail_label","k_YouTubeThumbnail_subLabel","YouTubeThumbnail","youtube_icon",l.DesignSizeCategories.SocialPost,1.77777777778,new c.FormaPageExportData(new d.TheoSize(1280,720),c.PageExportFormat.PIXELS)),new l.DesignSize("k_LinkedInBlogPost_label","k_LinkedInBlogPost_subLabel","LinkedInBlogPost","linkedin_icon",l.DesignSizeCategories.SocialPost,1.91082803,new c.FormaPageExportData(new d.TheoSize(1200,628),c.PageExportFormat.PIXELS)),new l.DesignSize("k_SnapchatStory_label","k_SnapchatStory_subLabel","SnapchatStory","snapchat_icon",l.DesignSizeCategories.SocialPost,.5625,new c.FormaPageExportData(new d.TheoSize(1080,1920),c.PageExportFormat.PIXELS)),new l.DesignSize("k_Twitter_label","k_Twitter_subLabel","Twitter","twitter_icon",l.DesignSizeCategories.SocialPost,1.79104477612,new c.FormaPageExportData(new d.TheoSize(1200,670),c.PageExportFormat.PIXELS)),new l.DesignSize("k_Letter_label","k_Letter_subLabel","Letter","",l.DesignSizeCategories.Print,.772727,new c.FormaPageExportData(new d.TheoSize(8.5,11),c.PageExportFormat.INCHES,c.FormaPageExportData.DEFAULT_PPI)),new l.DesignSize("k_Poster_label","k_Poster_subLabel","Poster","",l.DesignSizeCategories.Print,.647,new c.FormaPageExportData(new d.TheoSize(11,17),c.PageExportFormat.INCHES,c.FormaPageExportData.DEFAULT_PPI)),new l.DesignSize("k_Card_label","k_Card_subLabel","Card","",l.DesignSizeCategories.Print,.71428571,new c.FormaPageExportData(new d.TheoSize(5,7),c.PageExportFormat.INCHES,c.FormaPageExportData.DEFAULT_PPI)),new l.DesignSize("k_A5_label","k_A5_subLabel","A5","",l.DesignSizeCategories.Print,.70483871,new c.FormaPageExportData(new d.TheoSize(148,210),c.PageExportFormat.MILLIMETERS,c.FormaPageExportData.DEFAULT_PPI)),new l.DesignSize("k_A4_label","k_A4_subLabel","A4","",l.DesignSizeCategories.Print,.70695553,new c.FormaPageExportData(new d.TheoSize(210,297),c.PageExportFormat.MILLIMETERS,c.FormaPageExportData.DEFAULT_PPI)),new l.DesignSize("k_A3_label","k_A3_subLabel","A3","",l.DesignSizeCategories.Print,.7071155,new c.FormaPageExportData(new d.TheoSize(297,420),c.PageExportFormat.MILLIMETERS,c.FormaPageExportData.DEFAULT_PPI)),new l.DesignSize("k_FacebookProfileCover_label","k_FacebookProfileCover_subLabel","FacebookProfileCover","facebook_icon",l.DesignSizeCategories.SocialProfile,2.62820513,new c.FormaPageExportData(new d.TheoSize(1640,624),c.PageExportFormat.PIXELS)),new l.DesignSize("k_PageCover_label","k_PageCover_subLabel","FacebookPageCover","facebook_icon",l.DesignSizeCategories.SocialProfile,1.77777777778,new c.FormaPageExportData(new d.TheoSize(1200,675),c.PageExportFormat.PIXELS)),new l.DesignSize("k_EventCover_label","k_EventCover_subLabel","FacebookEventCover","facebook_icon",l.DesignSizeCategories.SocialProfile,1.91,new c.FormaPageExportData(new d.TheoSize(1920,1005),c.PageExportFormat.PIXELS)),new l.DesignSize("k_YouTubeChannelArt_label","k_YouTubeChannelArt_subLabel","YouTubeChannelArt","youtube_icon",l.DesignSizeCategories.SocialProfile,1.77777777778,new c.FormaPageExportData(new d.TheoSize(2560,1440),c.PageExportFormat.PIXELS)),new l.DesignSize("k_TwitchBanner_label","k_TwitchBanner_subLabel","TwitchBanner","twitch_icon",l.DesignSizeCategories.SocialProfile,4,new c.FormaPageExportData(new d.TheoSize(1920,480),c.PageExportFormat.PIXELS)),new l.DesignSize("k_TwitterHeader_label","k_TwitterHeader_subLabel","TwitterHeader","twitter_icon",l.DesignSizeCategories.SocialProfile,3,new c.FormaPageExportData(new d.TheoSize(1500,500),c.PageExportFormat.PIXELS)),new l.DesignSize("k_EtsyCover_label","k_EtsyCover_subLabel","EtsyCover","etsy_icon",l.DesignSizeCategories.SocialProfile,4,new c.FormaPageExportData(new d.TheoSize(3360,840),c.PageExportFormat.PIXELS)),new l.DesignSize("k_LinkedInProfileCover_label","k_LinkedInProfileCover_subLabel","LinkedInProfileCover","linkedin_icon",l.DesignSizeCategories.SocialProfile,3.878787878787879,new c.FormaPageExportData(new d.TheoSize(1536,396),c.PageExportFormat.PIXELS)),new l.DesignSize("k_EventbriteEventImage_label","k_EventbriteEventImage_subLabel","EventbriteEventImage","eventbrite_icon",l.DesignSizeCategories.SocialProfile,2,new c.FormaPageExportData(new d.TheoSize(2160,1080),c.PageExportFormat.PIXELS)),new l.DesignSize("k_Phone_label","k_Phone_subLabel","iPhone","phone_icon",l.DesignSizeCategories.Standard,.5625,new c.FormaPageExportData(new d.TheoSize(1080,1920),c.PageExportFormat.PIXELS)),new l.DesignSize("k_Square_label","k_Square_subLabel","Square","",l.DesignSizeCategories.Standard,1,new c.FormaPageExportData(new d.TheoSize(2560,2560),c.PageExportFormat.PIXELS)),new l.DesignSize("k_Landscape_label","k_Landscape_subLabel","3:2","",l.DesignSizeCategories.Standard,1.5,new c.FormaPageExportData(new d.TheoSize(2550,1700),c.PageExportFormat.PIXELS)),new l.DesignSize("k_Slide_label","k_Slide_subLabel","4:3","",l.DesignSizeCategories.Standard,1.33333333333,new c.FormaPageExportData(new d.TheoSize(2560,1920),c.PageExportFormat.PIXELS)),new l.DesignSize("k_Widescreen_label","k_Widescreen_subLabel","16:9","",l.DesignSizeCategories.Standard,1.77777777778,new c.FormaPageExportData(new d.TheoSize(2560,1440),c.PageExportFormat.PIXELS)),new l.DesignSize("k_Portrait_label","k_Portrait_subLabel","2:3","",l.DesignSizeCategories.Standard,.66666666666,new c.FormaPageExportData(new d.TheoSize(1700,2550),c.PageExportFormat.PIXELS)),new l.DesignSize("k_Banner_label","k_Banner_subLabel","3:1","",l.DesignSizeCategories.Standard,3,new c.FormaPageExportData(new d.TheoSize(2559,853),c.PageExportFormat.PIXELS)),new l.DesignSize("k_Wide_label","k_Wide_subLabel","2:1","",l.DesignSizeCategories.Standard,2,new c.FormaPageExportData(new d.TheoSize(2560,1280),c.PageExportFormat.PIXELS)),new l.DesignSize("k_Tall_label","k_Tall_subLabel","1:2","",l.DesignSizeCategories.Standard,.5,new c.FormaPageExportData(new d.TheoSize(1280,2560),c.PageExportFormat.PIXELS)),new l.DesignSize("k_SparkVideoSlide_label","k_SparkVideoSlide_subLabel","SparkVideoSlide","sparkvideo_icon",l.DesignSizeCategories.Standard,1.77777777778,new c.FormaPageExportData(new d.TheoSize(1280,720),c.PageExportFormat.PIXELS)),new l.DesignSize("k_SparkVideoSlideSquare_label","k_SparkVideoSlideSquare_subLabel","SparkVideoSlideSquare","sparkvideo_icon",l.DesignSizeCategories.Standard,1,new c.FormaPageExportData(new d.TheoSize(720,720),c.PageExportFormat.PIXELS)),new l.DesignSize("k_KindleCover_label","k_KindleCover_subLabel","KindleCover","kindle_icon",l.DesignSizeCategories.Standard,.625,new c.FormaPageExportData(new d.TheoSize(1600,2560),c.PageExportFormat.PIXELS)),new l.DesignSize("k_BlogPost_label","k_BlogPost_subLabel","BlogPost","blog_icon",l.DesignSizeCategories.Standard,1.78,new c.FormaPageExportData(new d.TheoSize(712,400),c.PageExportFormat.PIXELS))]),t.designSizes}},getListOfResizeShapes:function(){return e.designSizes},getById:function(t){for(var o=s.iter(e.designSizes);!o.done;o.next()){var r=o.value;if(r.id==t)return r}return null},getCustomSize:function(e,t,o,r){return new l.DesignSize("k_Custom_label","k_Custom_subLabel","Custom","custom_icon",l.DesignSizeCategories.Custom,e/t,new c.FormaPageExportData(new d.TheoSize(e,t),o,o==c.PageExportFormat.PIXELS?null:r))},getOriginalSize:function(e,t){return new l.DesignSize("k_OriginalSize_label","","Original","",l.DesignSizeCategories.Default,e/t,new c.FormaPageExportData(new d.TheoSize(e,t),c.PageExportFormat.PIXELS))},getByCategory:function(t){return e.designSizes.filter((function(e){return e.category.id==t}),this)}}}),e}()},oknb:function(e,t,o){var r,n,i=t,a=o("oAGj"),l=o("90dd"),s=o("ZoS2");i.ControllerSettingsState=(r=function(){s.TheoPublishingObject.call(this)},a.defineClass({name:"ControllerSettingsState",ctor:r,superName:"TheoPublishingObject",statics:{_implements:function(e){return"TheoMessagePublisher"==e}},props:{settings:{get:function(){return this.settings_},set:function(e){this.settings_=e,this.publish(new i.ControllerSettingsStateChangeMessage(this,this.settings))}}}}),r),i.ControllerSettingsStateChangeMessage=(n=function e(t,o){this.settings=o,l.TheoMessage.call(this,e.TYPE,t)},a.defineClass({name:"ControllerSettingsStateChangeMessage",ctor:n,superName:"TheoMessage",statics:{TYPE:{get:function(){return"ControllerSettingsStateChangeMessage"}}}}),n)},quOg:function(e,t,o){var r,n,i,a,l=t,s=o("oAGj"),u=o("0wFF"),c=o("oknb"),d=o("qUXk"),h=o("7S/6"),g=o("BbDD"),C=o("7siz"),m=o("waL6"),f=o("yHU1"),S=o("Pil/"),p=o("OdB2"),T=o("P83h"),y=o("iCxV"),_=o("g8Fi"),E=o("KIfs"),w=o("i5Hy"),v=o("n/CE"),b=o("cRpU"),D=o("9YN4"),R=o("90dd"),I=o("ZoS2"),P=o("rrhp");l.InteractionMode=s.defineEnum("InteractionMode",{DefaultInteraction:0,SelectionFocused:1,AutomaticGrid:2}),l.ClickMessage=(r=function e(t,o){this.state=t,R.TheoMessage.call(this,e.TYPE,o)},s.defineClass({name:"ClickMessage",ctor:r,superName:"TheoMessage",statics:{TYPE:{get:function(){return"ClickMessage"}}}}),r),l.DoubleClickMessage=(n=function e(t,o){this.state=t,R.TheoMessage.call(this,e.TYPE,o)},s.defineClass({name:"DoubleClickMessage",ctor:n,superName:"TheoMessage",statics:{TYPE:{get:function(){return"DoubleClickMessage"}}}}),n),l.DesignControllerPSMDelegate=(i=function(e){this.dc=e},s.defineClass({name:"DesignControllerPSMDelegate",ctor:i,statics:{_implements:function(e){return"IPSMDelegate"==e}},props:{handleEvent:function(e){var t,o,r,n;(t=s.as(e,S.PSMFormaDragControllerEvent))?this.dc.designControllerHandlesPointers?this.dc.designController.handles.handleFormaDragEvents(t):t.dragDelegate.dragController.onEvent(t):(o=s.as(e,S.BeginPointerTrackingEvent))?s.opt(o.forma.controller,(function(e){return e.onEvent(o)})):(r=s.as(e,S.FormaClickEvent))?this.dc.designControllerHandlesPointers?this.dc.designController.click.handleClick(r):s.opt(r.forma.controller,(function(e){return e.onEvent(r)})):(n=s.as(e,S.FormaDoubleClickEvent))&&(this.dc.designControllerHandlesPointers?this.dc.designController.click.handleDoubleClick(n):s.opt(n.forma.controller,(function(e){return e.onEvent(n)})))}}}),i),l.DocumentController=(a=function(){var e;this.blockNonSelectedUpdates_=!1,this.interactionMode_=l.InteractionMode.DefaultInteraction,this.pointerStateMachine_=null,this.viewScale_=1,this.designControllerHandlesPointers=!1,this.designControllerHandlesSwap=!0,this.enableMoveableChildren=!1,this.formaEventStackCounter=0,this.currentGestureActionsLogged=[],this.currentGestureScope="",this.controllerFactory_=new m.FormaControllerFactory(null),this.pointers_=new _.PointersState,this.selection_=new v.SelectionState,this.editorModel_=new C.EditorModel,this.designControllerFactory_=new h.DesignControllerFactory,this.controllerSettingsState_=new c.ControllerSettingsState,this.undoRedoMgr_=new P.UndoRedoManager(((e=s.opt(y.Host.platform,(function(e){return e.isMobile})))||null!=e)&&e?P.UndoRedoSelectionPolicyEnum.PreserveSelection:P.UndoRedoSelectionPolicyEnum.RestoreSelection),this.designController_=d.DesignController.NullController,this.saveMgr_=new w.SaveManager,I.TheoPublishingObject.call(this),this.controllerFactory_.owner=this,this.pointers_.owner=this,this.selection_.owner=this,this.editorModel_.owner=this,this.designControllerFactory_.owner=this,this.controllerSettingsState_.owner=this,this.undoRedoMgr_.owner=this,this.saveMgr_.owner=this,this.updateEditorModel(),this.selection_.subscribe(this,v.SelectionStateChangedMessage.TYPE),this.selection_.subscribe(this,v.SelectionStateModeChangedMessage.TYPE),this.pointers_.subscribe(this,_.PointersStateChangeMessage.TYPE),g.DocumentSingletonTracker.creatingDocumentSingleton(this)},s.defineClass({name:"DocumentController",ctor:a,superName:"TheoPublishingObject",statics:{_implements:function(e){return"TheoMessageSubscriber"==e||"TheoMessagePublisher"==e}},props:{controllerFactory:{get:function(){return this.controllerFactory_}},document:{get:function(){return this.doc_}},selection:{get:function(){return this.selection_}},model:{get:function(){return this.editorModel_}},designController:{get:function(){return this.designController_}},controllerSettingsState:{get:function(){return this.controllerSettingsState_}},pointers:{get:function(){return this.pointers_}},pointerStateMachine:{get:function(){return this.pointerStateMachine_}},undoRedoMgr:{get:function(){return this.undoRedoMgr_}},saveMgr:{get:function(){return this.saveMgr_}},updateEditorModel:function(){var e=this;this.designController_=this.designControllerFactory_.getNewDesignController(this.editorModel_),this.editorModel_.beginUpdates(),s.opt(this.designController_,(function(t){return t.configureEditorModel(e.editorModel_)})),this.editorModel_.updatesComplete()},onMessage:function(e){var t,o,r,n;if(e instanceof v.SelectionStateChangedMessage)this.formaEventStackCounter=0,this.updateEditorModel();else if(e instanceof v.SelectionStateModeChangedMessage)this.updateEditorModel();else if(t=s.as(e,_.PointersStateChangeMessage))null==this.pointerStateMachine_&&t.changeType==_.PointersStateChangeTypeEnum.PointersDown?(this.pointerStateMachine_=new E.PointerStateMachine(new f.FormaPagePointerStateMachineDelegate(new l.DesignControllerPSMDelegate(this))),this.pointerStateMachine_.attach(this,this.pointers),this.pointerStateMachine_.onMessage(t)):null!=this.pointerStateMachine_&&0==this.pointers.pointerDownCount()&&(this.pointerStateMachine_.onMessage(t),this.pointerStateMachine_.detach(),this.pointerStateMachine_=null);else if(o=s.as(e,p.FormaBeginUpdateMessage))this.selection.isSelected(o.event.forma)&&(this.formaEventStackCounter+=1);else if(r=s.as(e,p.FormaEndUpdateMessage))(r.event instanceof T.FormaGroupEvent||r.event instanceof T.FormaUngroupEvent)&&this.updateEditorModel(),this.selection.isSelected(r.event.forma)&&this.formaEventStackCounter>0&&(this.formaEventStackCounter-=1,0==this.formaEventStackCounter&&this.updateHandlesAndAnnotations());else if(n=s.as(e,D.TheoDocumentDidDecodeMessage)){var i;(i=s.opt(n.document,(function(e){return e.firstPage})))&&this.subscribeToPage(i),this.updateEditorModel()}else e instanceof p.BeginFormaResizeMessage?s.opt(this.formaPageView,(function(e){return e.beginUserResize()})):e instanceof p.EndFormaResizeMessage&&s.opt(this.formaPageView,(function(e){return e.endUserResize()}))},notifyClick:function(e){this.publish(new l.ClickMessage(e,this))},notifyDoubleClick:function(e){this.publish(new l.DoubleClickMessage(e,this))},formaUpdateSubscription:{get:function(){return this.formaUpdateSubscription_},set:function(e){var t;(t=this.formaUpdateSubscription_)&&t.unsubscribe(),this.formaUpdateSubscription_=e}},beginFormaResizeSubscription:{get:function(){return this.beginFormaResizeSubscription_},set:function(e){s.opt(this.beginFormaResizeSubscription_,(function(e){return e.unsubscribe()})),this.beginFormaResizeSubscription_=e}},endFormaResizeSubscription:{get:function(){return this.endFormaResizeSubscription_},set:function(e){s.opt(this.endFormaResizeSubscription_,(function(e){return e.unsubscribe()})),this.endFormaResizeSubscription_=e}},subscribeToPage:function(e){this.formaUpdateSubscription=e.subscribe(this,p.FormaEndUpdateMessage.TYPE),e.subscribe(this,p.FormaBeginUpdateMessage.TYPE),this.beginFormaResizeSubscription=e.subscribe(this,p.BeginFormaResizeMessage.TYPE),this.endFormaResizeSubscription=e.subscribe(this,p.EndFormaResizeMessage.TYPE)},attach:function(e){var t,o=this;this.doc_=e,this.updateEditorModel(),(t=s.opt(this.doc_,(function(e){return e.firstPage})))&&this.subscribeToPage(t),s.opt(e,(function(e){return e.subscribe(o,D.TheoDocumentDidDecodeMessage.TYPE)})),this.undoRedoMgr_.setup()},canDoAction:function(e){return this.designController.actions.canDoAction(e)},doAction:function(e){var t=!1;this.doActionWithCompletion(e,(function(e,o){t=!0})),t||s.opt(y.Host.logging,(function(e){return e.warning("You've called doAction() which may presume the action is synchronous, but it's not. Consider using doActionWithCompletion instead.")}))},doActionWithCompletion:function(e,t){var o=null!=this.undoRedoMgr_.gestureScope,r=!1;if(o&&(this.undoRedoMgr_.gestureScope!=this.currentGestureScope&&(this.currentGestureActionsLogged=[],this.currentGestureScope=this.undoRedoMgr_.gestureScope),(r=null!=s.indexOf(this.currentGestureActionsLogged,e.type))||this.currentGestureActionsLogged.push(e.type)),e.type!=b.SetTextCollapseAction.TYPE&&(!o||o&&!r)){var n=this.selection.asFormaArray().map((function(e){return e.kind}),this);s.opt(y.Host.logging,(function(t){return t.logToAnalytics(u.AnalyticsConstants.kAnalyticsDataActionPerformed,{contextualData2:e.type,contextualData3:"Formae Selected: ["+n.join(",")+"]"})})),s.opt(y.Host.logging,(function(t){return t.logBreadcrumbToNewRelic(e.type,{formaeInvolved:"["+n.join(",")+"]"})}))}this.designController.actions.doActionWithCallback(e,t)},allowSelectionChanges:{get:function(){return this.interactionMode_!=l.InteractionMode.SelectionFocused}},undoWithCompletion:function(e){this.undoRedoMgr.undo(e)},redoWithCompletion:function(e){this.undoRedoMgr.redo(e)},setSelectionFocusedInteraction:function(){this.interactionMode_=l.InteractionMode.SelectionFocused},inSelectionFocusedInteractionMode:{get:function(){return this.interactionMode_==l.InteractionMode.SelectionFocused}},setAutomaticLayoutInteractionMode:function(){this.interactionMode_=l.InteractionMode.AutomaticGrid},inAutomaticLayoutInteractionMode:{get:function(){return this.interactionMode_==l.InteractionMode.AutomaticGrid}},setDefaultInteractionMode:function(){this.interactionMode_=l.InteractionMode.DefaultInteraction},inDefaultInteractionMode:{get:function(){return this.interactionMode_==l.InteractionMode.DefaultInteraction}},interactionMode:{get:function(){return this.interactionMode_},set:function(e){this.interactionMode_=e}},viewScale:{get:function(){return this.viewScale_},set:function(e){this.viewScale_=e}},formaPageView:{get:function(){return s.opt(this.doc_,(function(e){return e.firstPage.view}))}},updateHandles:function(){var e=this;this.editorModel_.beginUpdates(),s.opt(this.designController_,(function(t){return t.handles.updateHandles(e.editorModel_.mutable.handles)})),this.editorModel_.updatesComplete()},updateAnnotations:function(){var e=this;this.editorModel_.beginUpdates(),s.opt(this.designController_,(function(t){return t.annotations.updateAnnotations(e.editorModel_.mutable.annotations)})),this.editorModel_.updatesComplete()},updateHandlesAndAnnotations:function(){var e=this;this.editorModel_.beginUpdates(),s.opt(this.designController_,(function(t){return t.handles.updateHandles(e.editorModel_.mutable.handles)})),s.opt(this.designController_,(function(t){return t.annotations.updateAnnotations(e.editorModel_.mutable.annotations)})),this.editorModel_.updatesComplete()}}}),a)},yhkb:function(e,t,o){var r,n,i=t,a=o("oAGj"),l=o("kYI4"),s=o("9WSY"),u=o("gXiO"),c=o("C42b"),d=o("ascj"),h=o("R0Y+"),g=o("dJuF"),C=o("FNB+"),m=o("9Lk3"),f=o("m404"),S=o("fdtz"),p=o("uWOl"),T=o("fNpk"),y=o("c+uM"),_=o("jcfx"),E=o("Zifs"),w=o("aN2p"),v=o("umUn");i.ColorLibraryController=(r=function e(t,o){this._themeKeys=null,this.DERIVED_LIGHT_BRIGHTNESS=.98,this.DERIVED_LIGHT_SATURATION=.03,this.DERIVED_DARK_BRIGHTNESS=.05;var r=this;u.CoreObject.call(this),this.library=t,this.document=o,this.librarySubscription_=a.opt(this.library,(function(e){return e.subscribe(r,s.ColorLibraryChangedMessage.TYPE)})),this.library.setColors({black:v.TheoColor.init_5344(E.SolidColor.BLACK,null,null),white:v.TheoColor.init_5344(E.SolidColor.WHITE,null,null)}),null==t.color("themeColor0")&&null==t.color("themeColor1")&&this.library.setColors({themeColor0:v.TheoColor.init_5344(e.defaultColor0,null,null),themeColor1:v.TheoColor.init_5344(e.defaultColor1,null,null),themeDerivedDark:v.TheoColor.init_5344(new E.SolidColor(.1,0,.1,1),null,null),themeDerivedLight:v.TheoColor.init_5344(new E.SolidColor(1,.9,1,1),null,null)})},n={},a.defineClass({name:"ColorLibraryController",ctor:r,superName:"CoreObject",statics:{kDefaultNumThemeColors:5,BLACK_KEY:"black",WHITE_KEY:"white",USER_KEY_PREFIX:"userColor",BW_KEYS:{get:function(){return void 0===n.BW_KEYS&&(n.BW_KEYS=[r.BLACK_KEY,r.WHITE_KEY]),n.BW_KEYS}},THEME_DERIVED_BW_KEYS:["themeDerivedLight","themeDerivedDark"],THEME_PROFILING_DERIVED_COLORS:["theme0Light","theme0Dark","theme1Light","theme1Dark","theme2Light","theme2Dark","theme3Light","theme3Dark","theme4Light","theme4Dark"],DERIVED_BASE_KEYS:["filterBase1","filterBase2","filterBase3"],FILTER_MULTIPLY_KEYS:["filterMultiply1","filterMultiply2","filterMultiply3"],FILTER_OVERLAY_KEYS:["filterOverlay1","filterOverlay2","filterOverlay3"],FILTER_BLEND_KEYS:["filterBlend1","filterBlend2","filterBlend3"],FILTER_SCREEN_KEYS:["filterScreen1","filterScreen2","filterScreen3"],FILTER_DUOTONE_LOW_KEYS:["filterDuotoneLow1","filterDuotoneLow2","filterDuotoneLow3"],FILTER_DUOTONE_HIGH_KEYS:["filterDuotoneHigh1","filterDuotoneHigh2","filterDuotoneHigh3"],IMAGE_KEYS:["imageColor0","imageColor1","imageColor2","imageColor3","imageColor4","imageColor5","imageColor6","imageColor7","imageColor8","imageColor9"],IMAGE_DERIVED_KEYS:["imageDerivedDominant","imageDerivedInteresting"],getLightnessContrastKey:function(e){return e+"LightnessContrast"},getBackgroundContrastKey:function(e){return e+"BackgroundContrast"},DERIVED_KEY_MAP:{filterOverlay1:"filterBase1",filterOverlay2:"filterBase2",filterOverlay3:"filterBase3",filterMultiply1:"filterBase1",filterMultiply2:"filterBase2",filterMultiply3:"filterBase3",filterScreen1:"filterBase1",filterScreen2:"filterBase2",filterScreen3:"filterBase3",filterBlend1:"filterBase1",filterBlend2:"filterBase2",filterBlend3:"filterBase3",filterDuotoneLow1:"filterBase1",filterDuotoneLow2:"filterBase2",filterDuotoneLow3:"filterBase3",filterDuotoneHigh1:"filterBase1",filterDuotoneHigh2:"filterBase2",filterDuotoneHigh3:"filterBase3"},ALL_DERIVED_KEYS:{get:function(){return void 0===n.ALL_DERIVED_KEYS&&(n.ALL_DERIVED_KEYS=r.makeAllKeys()),n.ALL_DERIVED_KEYS}},makeAllKeys:function(){var e=a.clone(r.THEME_DERIVED_BW_KEYS);return a.append(e,r.THEME_PROFILING_DERIVED_COLORS),a.append(e,r.DERIVED_BASE_KEYS),a.append(e,r.FILTER_MULTIPLY_KEYS),a.append(e,r.FILTER_OVERLAY_KEYS),a.append(e,r.FILTER_BLEND_KEYS),a.append(e,r.FILTER_SCREEN_KEYS),a.append(e,r.FILTER_DUOTONE_LOW_KEYS),a.append(e,r.FILTER_DUOTONE_HIGH_KEYS),a.append(e,r.THEME_PROFILING_DERIVED_COLORS),e},defaultColor0:{get:function(){return void 0===n.defaultColor0&&(n.defaultColor0=new E.SolidColor(.95,.05,.05,1)),n.defaultColor0}},defaultColor1:{get:function(){return void 0===n.defaultColor1&&(n.defaultColor1=new E.SolidColor(.95,.05,.95,1)),n.defaultColor1}},getNextKeyInSet:function(e){var t,o=e.substr(e.length-1,1);if(o>="0"&&o<="9"&&null!=(t=a.toInt(o))){var n=e.substr(0,e.length-1),i=n+a.toString(t+1);if(r.ALL_DERIVED_KEYS.includes(i))return[i,!1];if(i=n+"1",r.ALL_DERIVED_KEYS.includes(i))return[i,!0]}return[e,!1]},keyFromImage:function(e){return!(!r.IMAGE_KEYS.includes(e)&&!r.IMAGE_DERIVED_KEYS.includes(e))},toTheoColors:function(e){for(var t=[],o=a.iter(e);!o.done;o.next()){var r=o.value;t.push(v.TheoColor.init_5344(r.color))}return t},toThemeColorsWithRole:function(e,t){var o=[];T.LegacyCoreAssert.isTrue(e.length==t.length,"themeColors and colorsWithRole mismatch in count",void 0,"ColorLibraryController.toThemeColorsWithRole","ColorLibraryController.swift",1897);for(var r=a.iter(a.range(0,Math.min(e.length,t.length),!1));!r.done;r.next()){var n=r.value;o.push(new h.ThemeColorWithRole(t[n].role,e[n]))}return o},_implements:function(e){return"TheoMessageSubscriber"==e}},props:{randomDbl:function(){return a.toDouble(c.CoreRandom.nextInt)/a.toDouble(c.CoreRandom.randMax)},getNumThemeColorKeys:function(){return this.getThemeColorKeys().length},getThemeColorKeys:function(){var e=this,t=[];return null==this._themeKeys&&(this._themeKeys=[],this.library.forEachColor((function(t,o){t.includes("themeColor")&&!t.includes("Contrast")&&e.library.color(t)&&e._themeKeys.push(t)})),0==this._themeKeys.length&&(this._themeKeys.push("themeColor0"),this._themeKeys.push("themeColor1"))),a.append(t,a.sort(this._themeKeys)),t},getNumProfilingColorsKeys:function(){return this.getProfilingColorKeys().length},getProfilingColorKeys:function(){for(var e=[],t=2*this.getNumThemeColorKeys(),o=a.iter(a.range(0,Math.min(t,r.THEME_PROFILING_DERIVED_COLORS.length),!1));!o.done;o.next()){var n=o.value,i=r.THEME_PROFILING_DERIVED_COLORS[n];this.library.color(i)&&e.push(i)}return e},setLightnessContrastColorAndReturnKey:function(e,t){var o=r.getLightnessContrastKey(e);if(null==this.library.color(o)){var n=t.rgbColor.contrastWithSelf();this.setTheoColorToLibrary(v.TheoColor.init_5344(n,null,null),o)}return o},isSparkColorInUse:function(e){return this.areSparkColorsInUse([e])},areSparkColorsInUse:function(e){if(0==e.length)return!1;for(var t=a.iter(a.toSequence(this.getThemeColorKeys()));!t.done;t.next()){var o=t.value.element,r=this.library.color(o);if(null!=r.sparkElementID&&r.sparkElementID.length>0&&e.includes(r.sparkElementID))return!0}return!1},areAnySparkColorsInUse:function(){for(var e=a.iter(a.toSequence(this.getThemeColorKeys()));!e.done;e.next()){var t=e.value.element,o=this.library.color(t);if(a.opt(o,(function(e){return null!=e.sparkElementID&&o.sparkElementID.length>0})))return!0}return!1},getSparkColor:function(e){if(a.isEmpty(e))return null;for(var t=a.iter(a.toSequence(this.getThemeColorKeys()));!t.done;t.next()){var o=t.value.element,r=this.library.color(o);if(null!=r.sparkElementID&&r.sparkElementID==e)return r}return null},updateSparkColor:function(e){for(var t=a.iter(a.toSequence(this.getThemeColorKeys()));!t.done;t.next()){var o=t.value.element,n=this.library.color(o);if(null!=n.sparkElementID&&n.sparkElementID==e.sparkElementID){this.library.setColor(o,e);var i=r.getLightnessContrastKey(o);if(null!=this.library.color(i)){var l=e.rgbColor.contrastWithSelf();this.setTheoColorToLibrary(v.TheoColor.init_5344(l,null,null),i)}return void this.updateDerivedColors()}}T.LegacyCoreAssert.fail("asked to update spark color which isn't currently used.",void 0,"ColorLibraryController.updateSparkColor","ColorLibraryController.swift",382)},calculateShadeDelta:function(e){for(var t=a.iter(a.toSequence(this.getThemeColorKeys()));!t.done;t.next()){var o=t.value.element,r=this.library.color(o);if(r.isBrandkitColor()&&r.isBrandkitPrimaryColor())for(var n=a.iter(e);!n.done;n.next()){var i=n.value;if(i.isBrandkitPrimaryColor()){var l=r.getBrandkitShadeRole(),s=i.getBrandkitShadeRole();if(null!=l&&null!=s){var u=l.substr(v.SHADE_ROLE_PREFIX.length),c=s.substr(v.SHADE_ROLE_PREFIX.length),d=a.toInt(u),h=a.toInt(c);if(null!=d&&null!=h)return h-d}return 0}}}return 0},updateSparkColorsByRole:function(e){for(var t=[],o=e.concat(),r=this.calculateShadeDelta(e),n=a.iter(a.toSequence(this.getThemeColorKeys()));!n.done;n.next()){var i=n.value.element;if((l=this.library.color(i)).isBrandkitColor()){var l,s=(l=this.library.color(i)).getBrandkitShadeRole();if(null!=s&&0!=r){var u=s.substr(v.SHADE_ROLE_PREFIX.length),c=a.toInt(u);if(null!=c&&(T.LegacyCoreAssert.isTrue(c>=0&&c<=6,"Shade out of range",void 0,"ColorLibraryController.updateSparkColorsByRole","ColorLibraryController.swift",453),0!=c&&6!=c)){var d=c+r;d<=0?d+=5:d>=6&&(d-=5),T.LegacyCoreAssert.isTrue(d>=0&&d<=6,"Desired shade out of range",void 0,"ColorLibraryController.updateSparkColorsByRole","ColorLibraryController.swift",467),s=v.SHADE_ROLE_PREFIX+a.toString(d)}}for(var h=!1,g=a.iter(o);!g.done;g.next()){var C=g.value;if(null!=s){if(C.getBrandkitShadeRole()==s){this.library.setColor(i,C),t.push(C),a.remove(o,C),h=!0;break}}else if(l.isBrandkitPrimaryColor()&&C.isBrandkitPrimaryColor()||l.isBrandkitSecondaryColor()&&C.isBrandkitSecondaryColor()){this.library.setColor(i,C),t.push(C),a.remove(o,C),h=!0;break}}if(!h)for(var m=a.iter(t);!m.done;m.next())if((C=m.value).isBrandkitSecondaryColor()){this.library.setColor(i,C),h=!0;break}}}this.updateDerivedColors(),a.info("updateSparkColorsByRole given list of "+e.length+" new colors. Used "+t.length+" of them.")},addNewThemeColorKey:function(){for(var e=2,t=a.clone(this.getThemeColorKeys());t.includes("themeColor"+a.toString(e));)e+=1;var o="themeColor"+a.toString(e);return this._themeKeys.push(o),o},addNewThemeKeyWithColor:function(e){var t=this.addNewThemeColorKey();return this.library.setColor(t,e),t},ensureDerivedColorsAreSet:function(){if(0==this.library.hasEntries(r.ALL_DERIVED_KEYS)){for(var e=a.clone(this.getColorThemeAsArrayOfTheoColors()),t=a.clone(this.generateDerivedColorsForTheme(e)),o={},n=a.iter(t);!n.done;n.next()){var i=n.key,l=n.value;null==this.library.color(i)&&(o[i]=l)}a.opt(this.library,(function(e){return e.setColors(o)}))}},getTheoColorForSolidColor:function(e){for(var t=a.clone(this.getThemeColorKeys()),o=a.iter(t);!o.done;o.next()){var r=o.value,n=this.library.color(r);if(null!=n&&a.eq(E._equality_SolidColor_SolidColor,e,n.rgbColor))return n}return v.TheoColor.init_5344(e,null,null)},getKeyOfColorInTheme:function(e){for(var t,o=this.getThemeColorKeys().concat(r.THEME_DERIVED_BW_KEYS),n=a.iter(o);!n.done;n.next()){var i=n.value;if(a.eq(E._equality_SolidColor_SolidColor,e.rgbColor,a.opt(this.library.color(i),(function(e){return e.rgbColor})))){t=i;break}}return t},getCurrentThemeHexString:function(){for(var e="",t=a.iter(this.getThemeColorKeys());!t.done;t.next()){var o,r=t.value;(o=this.library.color(r))&&(e=e+o.rgbColor.hex+",")}return e},getBaseThemeKeyForDerivedKey:function(e){var t,o,n;return null!=(o=r.DERIVED_KEY_MAP[e])&&(n=this.library.color(o))&&(t=this.getKeyOfColorInTheme(n)),t},ensureUniqueColors:function(e){for(var t=a.sort(e,(function(e,t){return e.lightness<t.lightness})),o=[],r=a.iter(t);!r.done;r.next()){var n=r.value;(0==o.length||n.distanceTo(a.last(o).rgbColor)>2.3)&&o.push(v.TheoColor.init_5344(n,null,null))}if(o.length<e.length){for(var i=e.length-o.length,l=o[o.length-1].rgbColor.red,s=o[o.length-1].rgbColor.green,u=o[o.length-1].rgbColor.blue,c=o[o.length-1].rgbColor.alpha,d=a.iter(a.range(1,i,!0));!d.done;d.next()){var h=d.value,g=l+a.toDouble(h)*(1-l)/a.toDouble(i),C=s+a.toDouble(h)*(1-s)/a.toDouble(i),m=u+a.toDouble(h)*(1-u)/a.toDouble(i);o.push(v.TheoColor.init_5344(new E.SolidColor(g,C,m,c),null,null))}return o=a.reverse(o)}return o},generateDerivedColorsForTheme:function(e){if(e.length<this.getNumThemeColorKeys())return{};var t={},o=e[0].rgbColor.asHSB,n=new f.HSBColor(o.h,o.s,this.DERIVED_DARK_BRIGHTNESS,o.alpha),i=new f.HSBColor(o.h,this.DERIVED_LIGHT_SATURATION,this.DERIVED_LIGHT_BRIGHTNESS,o.alpha);t.themeDerivedDark=v.TheoColor.init_5344(n.asRGB,null,null),t.themeDerivedLight=v.TheoColor.init_5344(i.asRGB,null,null);for(var l=a.iter(a.range(0,e.length,!1));!l.done;l.next()){var s=(o=e[y=l.value].rgbColor.asHSB).b<.22?.03:o.b-.2,u=o.b>.78?.97:o.b+.2,c=o.s<.22?.03:o.s-.2,d=o.s>.78?.97:o.s+.2;n=new f.HSBColor(o.h,d,s,o.alpha),i=new f.HSBColor(o.h,c,u,o.alpha),t["theme"+a.toString(y)+"Dark"]=v.TheoColor.init_5344(n.asRGB,null,null),t["theme"+a.toString(y)+"Light"]=v.TheoColor.init_5344(i.asRGB,null,null)}for(var h=[],g=a.iter(a.range(0,2,!0));!g.done;g.next()){for(var C=g.value,m=0,S=0,p=a.iter(a.toSequence(e));!p.done;p.next()){var T=p.value,y=T.offset,_=T.element;if(!h.includes(y)){var E=_.rgbColor,w=0;E.asHSB.s>.1&&(w+=100+E.asHSB.s),E.asLAB.l>30&&(w+=100);for(var b=100,D=a.iter(h);!D.done;D.next()){var R=D.value;b=Math.min(b,E.asLAB.hueDistance(e[R].rgbColor.asLAB))}m<(w+=b)&&(m=w,S=y)}}h.push(S);var I=e[S];t[r.DERIVED_BASE_KEYS[C]]=I;var P=I.rgbColor.asHSB;t[r.FILTER_MULTIPLY_KEYS[C]]=v.TheoColor.init_5344(new f.HSBColor(P.h,(P.s+.5)/2,(P.b+1)/2,P.alpha).asRGB,null,null),t[r.FILTER_OVERLAY_KEYS[C]]=v.TheoColor.init_5344(new f.HSBColor(P.h,(P.s+1)/2,(P.b+1)/2,P.alpha).asRGB,null,null),t[r.FILTER_BLEND_KEYS[C]]=v.TheoColor.init_5344(new f.HSBColor(P.h,P.s,P.b,P.alpha).asRGB,null,null),t[r.FILTER_SCREEN_KEYS[C]]=v.TheoColor.init_5344(new f.HSBColor(P.h,P.s,P.b,P.alpha).asRGB,null,null),t[r.FILTER_DUOTONE_LOW_KEYS[C]]=v.TheoColor.init_5344(new f.HSBColor(P.h,Math.min(P.s,.8),Math.min(P.b,.2),P.alpha).asRGB,null,null),t[r.FILTER_DUOTONE_HIGH_KEYS[C]]=v.TheoColor.init_5344(new f.HSBColor(P.h,Math.min(P.s,.8),Math.max(P.b,.8),P.alpha).asRGB,null,null)}return t},updateDerivedColors:function(){var e=a.clone(this.getColorThemeAsArrayOfTheoColors()),t=a.clone(this.generateDerivedColorsForTheme(e));this.library.setColors(t)},setTheoColorToLibrary:function(e,t){var o=this.library.color(t);this.library.setColor(t,e),null!=e.sparkElementID?l.BrandingFacade.brandDocumentForElement(this.document,e.sparkElementID,l.AUTHORING_CONTEXT_TYPE_COLOR):a.opt(o,(function(e){return null!=e.sparkElementID}))&&l.BrandingFacade.unBrandDocumentIfNoBrandedElements(this.document)},getSolidColorForKey:function(e){var t=this.library.color(e);return a.opt(t,(function(e){return e.rgbColor}))},getTheoColorForKey:function(e){return this.library.color(e)},clearCache:function(){this._themeKeys=null},regenerateThemeKeyCache:function(){this.clearCache(),this.getThemeColorKeys()},onMessage:function(e){var t;if((t=a.as(e,s.ColorLibraryChangedMessage))&&null!=this._themeKeys&&t.isAfter){for(var o=!1,r=a.iter(t.affectedColorIDs);!r.done;r.next()){var n=r.value;if(a.opt(this.library,(function(e){return null!=e.color(n)}))){o=!0;break}}o&&this.clearCache()}},recordUndoState:function(){return this.library.recordUndoState()},restoreUndoState:function(e){var t;(t=a.as(e,["Dictionary","String",g.DBProperty]))&&(this.library.matchProperties(t),this.clearCache())},isDefaultInitialTheme:function(){var e,t,o=a.clone(this.getThemeColorKeys());return!(2!=o.length||!(e=a.opt(a.opt(this.library,(function(e){return e.color(o[0])})),(function(e){return e.rgbColor})))||!(t=a.opt(a.opt(this.library,(function(e){return e.color(o[1])})),(function(e){return e.rgbColor}))))&&(a.eq(E._equality_SolidColor_SolidColor,e,r.defaultColor0)&&a.eq(E._equality_SolidColor_SolidColor,t,r.defaultColor1))},getColorThemeAsArrayOfSolidColors:function(){for(var e=[],t=a.clone(this.getThemeColorKeys()),o=a.iter(t);!o.done;o.next()){var r,n=o.value;(r=this.library.color(n))&&e.push(r.rgbColor)}return a.sort(e,(function(e,t){return e.lightness<t.lightness}))},getColorThemeAsArrayOfTheoColors:function(){var e=[],t=a.clone(this.getThemeColorKeys());a.sortInPlace(t);for(var o=a.iter(t);!o.done;o.next()){var r,n=o.value;(r=this.library.color(n))&&e.push(r)}return a.sort(e,(function(e,t){return e.rgbColor.lightness<t.rgbColor.lightness}))},getThemeDerivedColorsAsArrayOfSolidColors:function(){for(var e=[],t=a.iter(a.toSequence(r.THEME_DERIVED_BW_KEYS));!t.done;t.next()){var o,n=t.value.element;(o=this.library.color(n))&&e.push(o.rgbColor)}return e},getThemeDerivedColorsAsArrayOfTheoColors:function(){for(var e=[],t=a.iter(a.toSequence(r.THEME_DERIVED_BW_KEYS));!t.done;t.next()){var o,n=t.value.element;(o=this.library.color(n))&&e.push(o)}return e},applyLegacyFilterColorsAndReturnKeys:function(e){var t,o,n,i;if((n=a.as(e,p.ImageStyle))&&n.name==p.ImageStyle.NAME_NEWDUOTONE)return{primaryKey:t,secondaryKey:o};if(i=e.filter){var l,s;switch(i.name){case"Greyscale":case"GreyscaleDark":t="themeDerivedDark",o="themeDerivedDark";break;case"Monochrome":t=r.FILTER_MULTIPLY_KEYS[0];break;case"Duotone":t=r.FILTER_DUOTONE_LOW_KEYS[0],o=r.FILTER_DUOTONE_HIGH_KEYS[1];break;case"DesaturateMultiply":t=r.FILTER_MULTIPLY_KEYS[0];break;case"ReduceContrastOverlay":t=r.FILTER_OVERLAY_KEYS[0];break;default:t=r.FILTER_MULTIPLY_KEYS[0]}(l=e.colors.color(d.ColorRole.FieldPrimary))&&this.library.setColor(t,v.TheoColor.init_5344(l,null,null)),(s=e.colors.color(d.ColorRole.FieldSecondary))&&null!=o&&this.library.setColor(o,v.TheoColor.init_5344(s,null,null))}return{primaryKey:t,secondaryKey:o}},mergeSolidColorDictionaries:function(e,t){for(var o=a.clone(e),r=a.iter(t);!r.done;r.next()){var n=r.key,i=r.value;o[n]=i}return o},mergeTheoColorDictionaries:function(e,t){for(var o=a.clone(e),r=a.iter(t);!r.done;r.next()){var n=r.key,i=r.value;o[n]=i}return o},applyLegacyColorThemeFromDocument:function(e){var t,o={},r=[];if(t=a.opt(e,(function(e){return e.colorTheme})))for(var n=a.iter(a.range(0,5,!1));!n.done;n.next()){var i,l=n.value;if(i=a.as(t.swatchByTag("theme",a.toString(l)),w.SimpleSwatch)){var s,u=this.getThemeColorKeys()[l];if(s=i.color){var c=v.TheoColor.init_5344(s,null,null);o[u]=c,r.push(c)}}}else for(var d=a.iter(a.range(0,this.getNumThemeColorKeys(),!1));!d.done;d.next()){l=d.value;var h=1/a.toDouble(l+1),g=(u=this.getThemeColorKeys()[l],new E.SolidColor(h,h,h,1));c=v.TheoColor.init_5344(g,null,null),o[u]=c,r.push(c)}var C=a.clone(this.generateDerivedColorsForTheme(r));this.library.setColors(this.mergeTheoColorDictionaries(o,C))},deleteThemeColorsFromDocument:function(e){for(var t=a.iter(e);!t.done;t.next()){var o=t.value;this.library.setColor(o,null)}this.document.firstPage.root.visitAll(C.FormaTraversal.PreOrder,(function(t){var o=t.style.colors.colorID(d.ColorRole.FieldPrimary);null!=o&&e.includes(o)&&t.style.colors.setColorId(d.ColorRole.FieldPrimary,"themeColor0");var r=t.style.colors.colorID(d.ColorRole.FieldSecondary);null!=r&&e.includes(r)&&t.style.colors.setColorId(d.ColorRole.FieldSecondary,"themeColor1");var n=t.style.colors.colorID(d.ColorRole.Border);null!=n&&e.includes(n)&&t.style.colors.setColorId(d.ColorRole.Border,"themeDerivedDark");var i=t.style.colors.colorID(d.ColorRole.Shadow);null!=i&&e.includes(i)&&t.style.colors.setColorId(d.ColorRole.Shadow,"themeDerivedDark")})),this.clearCache()},deleteExtraThemeColors:function(e){var t=[],o=a.clone(this.getThemeColorKeys()),n="themeColor".length;for(a.sortInPlace(o,(function(e,t){var o=e.substr(n),r=t.substr(n);return a.toInt(o)<a.toInt(r)}));o.length>e;){var i=o.pop();t.push(i),t.push(r.getLightnessContrastKey(i)),t.push(r.getBackgroundContrastKey(i))}this.deleteThemeColorsFromDocument(t)},applyColorTheme:function(e,t,o){if(void 0===o&&(o=!1),e.length<2)T.LegacyCoreAssert.fail("Color themes must have at least 2 colors",void 0,"ColorLibraryController.applyColorTheme","ColorLibraryController.swift",1300);else{if(o&&e.length==this.getNumThemeColorKeys()){function r(e,t){return e.rgbColor.print()<t.rgbColor.print()}var n=a.clone(this.getColorThemeAsArrayOfTheoColors());a.sortInPlace(n,r);for(var i=a.sort(e,r),s=!0,u=a.iter(a.range(0,i.length,!1));!u.done;u.next()){var c=u.value;if(!a.eq(v._equality_TheoColor_TheoColor,n[c],i[c])){s=!1;break}}if(s)return}var d,h={},g=[];this.getNumThemeColorKeys()>e.length&&this.deleteExtraThemeColors(e.length);for(var C=a.iter(a.toSequence(e));!C.done;C.next()){var m=C.value,f=m.offset,S=m.element;h[f<this.getNumThemeColorKeys()?this.getThemeColorKeys()[f]:this.addNewThemeColorKey()]=S,g.push(S),null==d&&null!=S.sparkElementID&&(d=S)}var p=a.clone(this.generateDerivedColorsForTheme(g));this.library.setColors(this.mergeTheoColorDictionaries(h,p)),this.library.paletteID=t,null!=d?l.BrandingFacade.brandDocumentForElement(this.document,d.sparkElementID,l.AUTHORING_CONTEXT_TYPE_COLOR):l.BrandingFacade.unBrandDocumentIfNoBrandedElements(this.document),(new _.ProfilingColorMap).updateRoleProfilingColorMap(this.document.firstPage)}},enteredPalettePicker:function(){(new _.ProfilingColorMap).setPaletteMappingForFormaWithSameRGBColor(this.document.firstPage)},returnCurrentPaletteMapping:function(){return(new _.ProfilingColorMap).getCurrentPaletteMapping()},getRandomBackgroundColor:function(){var e=a.clone(this.getThemeColorKeys());return l.BrandingFacade.isDocumentBranded(this.document,!1)||a.append(e,r.THEME_DERIVED_BW_KEYS),e[c.CoreRandom.nextIntUniform(e.length)]},shuffleColorAssignments:function(){this.document.firstPage.root.style.colors.setColorId(d.ColorRole.FieldPrimary,this.getRandomBackgroundColor()),(new _.ProfilingColorMap).updateRoleProfilingColorMap(this.document.firstPage),(new _.ProfilingColorMap).updateCurrentColorIndices(),this.document.firstPage.root.visitAll(C.FormaTraversal.PreOrder,(function(e){null==e.controller||m.GridController.isBackgroundColoredCell(e)||e.controller.shuffleColorAssignment()}))},createInitialThemeFromImage:function(){var e,t,o=null,n=a.clone(this.document.firstPage.root.filterWithCallback((function(e){return e instanceof S.ImageForma})));if(n.length>0&&(e=a.as(n[0],S.ImageForma))&&(o=a.opt(e.contentNode,(function(e){return e.image}))),t=o){var i=a.clone(t.getImageColors(r.kDefaultNumThemeColors)),l=a.clone(this.ensureUniqueColors(i));this.applyColorTheme(l,"image"),this.shuffleColorAssignments()}else T.LegacyCoreAssert.fail("createInitialThemeFromImage has no image to create a theme from",void 0,"ColorLibraryController.createInitialThemeFromImage","ColorLibraryController.swift",1481)},extractImageColors:function(){var e,t,o=[],n=[],i={},l=a.clone(this.document.firstPage.root.filterWithCallback((function(e){return e instanceof S.ImageForma&&!e.isLogo()&&e.parent.isBackgroundImage()})));l.length>0&&(e=a.as(l[l.length-1],S.ImageForma))&&(t=a.opt(e.contentNode,(function(e){return e.image})))&&(o=a.clone(t.getImageColors(r.kDefaultNumThemeColors)),n=a.clone(this.ensureUniqueColors(o)));for(var s=a.iter(a.toSequence(n));!s.done;s.next()){var u=s.value,c=u.offset,d=u.element;i[r.IMAGE_KEYS[c]]=d}this.library.setColors(i)},getSuggestedColorThemesAsArraysOfTheoColors:function(){var e=[],t=[];null==this.library.color(r.IMAGE_KEYS[0])&&this.extractImageColors();for(var o=a.iter(a.toSequence(r.IMAGE_KEYS));!o.done;o.next()){var n,i=o.value.element;(n=this.library.color(i))&&t.push(n)}if(t.length>0){var l=a.clone(this.removeSimilarColors(t));l.length>2&&e.push(l)}var s=a.clone(this.getTheoColorsUsedInDocument()),u=r.kDefaultNumThemeColors-s.length+1;if(s.length>1&&u>0){for(var c=0,d=[],h=[],g=a.iter(s);!g.done;g.next()){var C=g.value,m=C.rgbColor.lightness;m>4&&m<96&&(d.push(C),h.push(C),c<u&&(c+=1,d.push(v.TheoColor.init_5344(C.rgbColor.contrastWithSelf())),m>50?h.push(v.TheoColor.init_5344(C.rgbColor.darkenForTint())):h.push(v.TheoColor.init_5344(C.rgbColor.lightenForTint()))))}var f=a.clone(this.removeSimilarColors(h));f.length>2&&e.push(f);var S=a.clone(this.removeSimilarColors(d));S.length>2&&e.push(S)}return e},removeSimilarColors:function(e){for(var t=a.sort(e,(function(e,t){return e.rgbColor.lightness<t.rgbColor.lightness})),o=[],r=a.iter(t);!r.done;r.next()){var n=r.value;(0==o.length||n.rgbColor.distanceTo(a.last(o).rgbColor)>2.3)&&o.push(n)}return o},getSuggestedColorsAsArraysOfTheoColors:function(){for(var e=a.clone(this.getSuggestedColorThemesAsArraysOfTheoColors()),t=[],o=a.iter(e);!o.done;o.next())for(var r=o.value,n=a.iter(r);!n.done;n.next()){var i=n.value;t.push(i)}return t},addUnlinkedColor:function(e){for(var t=0,o="unlinked"+a.toString(t),r=this.library.color(o);null!=r;)t+=1,o="unlinked"+a.toString(t),r=this.library.color(o);return this.library.setColor(o,v.TheoColor.init_5344(e,null,null)),o},getTheoColorsUsedInDocument:function(){var e=[];this.document.firstPage.root.visitAll(C.FormaTraversal.PreOrder,(function(t){var o;null!=(o=t.style.colors.colorID(d.ColorRole.FieldPrimary))&&(e.includes(o)||e.push(o)),null!=(o=t.style.colors.colorID(d.ColorRole.FieldSecondary))&&(e.includes(o)||e.push(o)),null!=(o=t.style.colors.colorID(d.ColorRole.Border))&&(e.includes(o)||e.push(o)),null!=(o=t.style.colors.colorID(d.ColorRole.Shadow))&&(e.includes(o)||e.push(o))}));for(var t=[],o=a.iter(e);!o.done;o.next()){var r=o.value,n=this.library.color(r);null!=n&&t.push(n)}return t},unusedColorKeys:function(e,t){var o=this,r=a.clone(this.getThemeColorKeys());if(t){for(var n=a.iter(this.getThemeColorKeys());!n.done;n.next()){var i=n.value,l=this.library.color(i);null!=l&&l.isBrandkitColor()&&a.remove(r,i)}if(0==r.length)return r}return this.document.firstPage.root.visitAll(C.FormaTraversal.PreOrder,(function(t){var n;if(null!=e&&t.formaID==e.formaID||(null!=(l=t.style.colors.colorID(d.ColorRole.FieldPrimary))&&(a.remove(r,l),null!=(s=o.getBaseThemeKeyForDerivedKey(l))&&null!=(u=a.indexOf(r,s))&&r.splice(u,1)),null!=(l=t.style.colors.colorID(d.ColorRole.FieldSecondary))&&(a.remove(r,l),null!=(s=o.getBaseThemeKeyForDerivedKey(l))&&null!=(u=a.indexOf(r,s))&&r.splice(u,1)),null!=(l=t.style.colors.colorID(d.ColorRole.Border))&&(a.remove(r,l),null!=(s=o.getBaseThemeKeyForDerivedKey(l))&&null!=(u=a.indexOf(r,s))&&r.splice(u,1)),null!=(l=t.style.colors.colorID(d.ColorRole.Shadow))&&(a.remove(r,l),null!=(s=o.getBaseThemeKeyForDerivedKey(l))&&null!=(u=a.indexOf(r,s))&&r.splice(u,1))),n=a.as(t.style,y.LockupStyle))for(var i=a.iter(n.characterStyles);!i.done;i.next()){var l,s,u,c=i.value;null!=(l=c.colors.colorID(d.ColorRole.FieldPrimary))&&(a.remove(r,l),null!=(s=o.getBaseThemeKeyForDerivedKey(l))&&null!=(u=a.indexOf(r,s))&&r.splice(u,1)),null!=(l=c.colors.colorID(d.ColorRole.FieldSecondary))&&(a.remove(r,l),null!=(s=o.getBaseThemeKeyForDerivedKey(l))&&null!=(u=a.indexOf(r,s))&&r.splice(u,1)),null!=(l=c.colors.colorID(d.ColorRole.Border))&&(a.remove(r,l),null!=(s=o.getBaseThemeKeyForDerivedKey(l))&&null!=(u=a.indexOf(r,s))&&r.splice(u,1)),null!=(l=c.colors.colorID(d.ColorRole.Shadow))&&(a.remove(r,l),null!=(s=o.getBaseThemeKeyForDerivedKey(l))&&null!=(u=a.indexOf(r,s))&&r.splice(u,1))}})),r},addColorsToTheme:function(e,t){for(var o=a.clone(this.unusedColorKeys(t,!0)),n=[],i=a.iter(a.range(0,e.length,!1));!i.done;i.next()){var l,s,u,c=e[i.value];null!=(s=this.getKeyOfColorInTheme(c))?(l=s,o.includes(s)&&a.remove(o,s)):(l=o.length>0?o[0]:this.addNewThemeColorKey(),this.setTheoColorToLibrary(c,l),null!=(u=a.indexOf(o,l))&&o.splice(u,1),this.setTheoColorToLibrary(v.TheoColor.init_5344(c.rgbColor.contrastWithSelf(),null,null),r.getLightnessContrastKey(l))),n.push(l)}return T.LegacyCoreAssert.isTrue(n.length==e.length,"should return as many keys as added colors",void 0,"ColorLibraryController.addColorsToTheme","ColorLibraryController.swift",1858),n},addColorsWithRoleToTheme:function(e,t){var o=a.clone(r.toTheoColors(e)),n=a.clone(this.addColorsToTheme(o,t));return T.LegacyCoreAssert.isTrue(n.length==o.length,"themeColors and theoColors mismatch in count",void 0,"ColorLibraryController.addColorsWithRoleToTheme","ColorLibraryController.swift",1867),r.toThemeColorsWithRole(n,e)}}}),r)}}]);
//# sourceMappingURL=vendors_npm_spark_912d5847-ea83b454.js.map