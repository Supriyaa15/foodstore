(window.webpackJsonptheoWebApp=window.webpackJsonptheoWebApp||[]).push([[109,86,97],{"/TxD":function(e,t,a){"use strict";a.r(t),a.d(t,"default",(function(){return q}));var i=a("4zaV"),s=a.n(i),o=(a("ApVh"),a("3Jkv")),n=a.n(o),r=a("Uwho"),l=a.n(r),h=a("rjtT"),d=a.n(h),p=a("bBG2"),c=a("2ofD"),u=a.n(c),b=a("Avqh"),m=a.n(b),g=a("KFmL"),v=a.n(g),T=a("+VG/"),S=a.n(T),P=a("pEL3"),k=a.n(P),w=a("d/MO"),I=a.n(w),f=a("dO52"),C=a.n(f),B=a("rzDa"),D=a.n(B),A=a("2Fsf"),M=a.n(A),L=a("LGQi"),E=a("CCuV"),F=a("epRH"),y=a("3xm6"),x=a.n(y),W=a("65r0"),R=a("K7z8"),N=a("MGCh"),O=a.n(N),G=a("HetE"),z=a("GSfz"),H=a.n(z),U=a("yHoe"),j=a("LCEe");function V(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}const _=O.a.channel("TopBarUIModule"),$=Object(W.a)();class q{constructor({editingMode:e,coreWrapper:t,postFeatureController:a,events:i,waitForSaveToFinish:o,waitForQuietSaveToFinish:n,templateNode:r,includesPaidAdobeFonts:l,templatePublisherModalParent:h,assetSubmitterModalParent:d,getDocumentRendition:c}){if(V(this,"topColorStrip",void 0),V(this,"postTopBarLeft",void 0),V(this,"postTopBarMid",void 0),V(this,"postTopBarRight",void 0),V(this,"saveTemplateButton",void 0),V(this,"cancelTemplateButton",void 0),V(this,"hamburgerMenu",void 0),V(this,"homeButton",void 0),V(this,"postLogo",void 0),V(this,"navCrumbs",void 0),V(this,"backToProjects",void 0),V(this,"carrotOne",void 0),V(this,"docNameInput",void 0),V(this,"editNameButton",void 0),V(this,"savingIndicator",void 0),V(this,"undo",void 0),V(this,"redo",void 0),V(this,"debugMenu",void 0),V(this,"collabStatusButton",void 0),V(this,"downloadButton",void 0),V(this,"sharePostButton",void 0),V(this,"lmsCoachmark",void 0),V(this,"googleClassroomCoachmark",void 0),V(this,"googleDriveCoachmark",void 0),V(this,"templatePublisherModal",void 0),V(this,"assetSubmitModal",void 0),V(this,"sharePostButtonConfig",void 0),V(this,"editingMode",void 0),V(this,"waitForSaveToFinish",void 0),V(this,"waitForQuietSaveToFinish",void 0),V(this,"exportController",void 0),V(this,"coreWrapper",void 0),V(this,"postFeatureController",void 0),V(this,"events",void 0),V(this,"includesPaidAdobeFonts",void 0),V(this,"templatePublisherModalParent",void 0),V(this,"assetSubmitterModalParent",void 0),V(this,"getDocumentRendition",void 0),this.updateCollabStatusButton=this.updateCollabStatusButton.bind(this),this.onRefineCutoutModeChanged=this.onRefineCutoutModeChanged.bind(this),this.handleNameDocument=this.handleNameDocument.bind(this),this.handleDownloadImgButtonPress=this.handleDownloadImgButtonPress.bind(this),this.handleDownloadImgV2ButtonPress=this.handleDownloadImgV2ButtonPress.bind(this),this.handleDownloadMP4720pButtonPress=this.handleDownloadMP4720pButtonPress.bind(this),this.handleDownloadPDFButtonPress=this.handleDownloadPDFButtonPress.bind(this),this.handleShareMenuClick=this.handleShareMenuClick.bind(this),this.handlePublish=this.handlePublish.bind(this),this.handleInvite=this.handleInvite.bind(this),this.showTemplatePublisher=this.showTemplatePublisher.bind(this),this.resetTemplatePublisherForm=this.resetTemplatePublisherForm.bind(this),this.handleTemplatePublisherSaveButtonClicked=this.handleTemplatePublisherSaveButtonClicked.bind(this),this.handlePublishTemplate=this.handlePublishTemplate.bind(this),this.showAssetSubmitter=this.showAssetSubmitter.bind(this),this.handleAssetSubmitterSaveButtonClicked=this.handleAssetSubmitterSaveButtonClicked.bind(this),this.editingMode=e,this.EditingModes=G.EditingModes,this.coreWrapper=t,this.postFeatureController=a,this.events=i,this.waitForSaveToFinish=o,this.waitForQuietSaveToFinish=n,this.includesPaidAdobeFonts=l,this.getDocumentRendition=c,this.templateNode=r,this.topColorStrip=new m.a({parent:"PostTopBar",id:"colorStrip",tag:"DIV"}),this.postTopBarLeft=new M.a({parent:"PostTopBar",id:"PostTopBarLeft",class:"application-options",height:"auto",width:e===this.EditingModes.TEMPLATE?"auto":495}),this.postTopBarMid=new M.a({parent:"PostTopBar",id:"PostTopBarMid",class:"document-options",template:"",height:"auto",width:"auto"}),this.postTopBarRight=new M.a({parent:"PostTopBar",id:"PostTopBarRight",class:"editor-options",height:"auto",left:"auto",width:370}),e===this.EditingModes.TEMPLATE?(this.saveTemplateButton=new v.a({parent:"PostTopBarLeft",class:"pill pill-primary-on-light",hidden:!1,label:"i18n.common.kSave",onClick:()=>{this.events.publish("ui:saveTemplateChanges")}}),this.cancelTemplateButton=new v.a({parent:"PostTopBarLeft",class:"pill pill-secondary-on-light",hidden:!1,label:"i18n.common.kCancel",onClick:()=>{this.events.publish("ui:cancelTemplateChanges")}})):(this.hamburgerMenu=new v.a({parent:"PostTopBarLeft",class:"hamburgerButton mrvl-hamburger-menu",attributes:{"data-auto":"mrvl-hamburger-menu"},label:" ",tag:"div",onClick:()=>{window.marvel&&window.marvel.events.trigger("mrvl-show-global-nav")}}),this.homeButton=new v.a({parent:"PostTopBarLeft",class:"homeButton",id:"PostHomeButton",label:" ",tag:"div",onClick:e=>{this.events.publish("ui:returnToSpark",{skipSave:e,pathType:"home"})}}),this.postLogo=new M.a({parent:"PostTopBarLeft",id:"PostLogo",template:"i18n.app.kPost",class:"name"}),this.navCrumbs=new M.a({parent:"PostTopBarLeft",id:"PostTopBarNavCrumbs"}),this.backToProjects=new v.a({class:"post-top-bar-crumb",parent:this.navCrumbs,label:"i18n.app.kProjects",onClick:e=>{this.events.publish("ui:returnToSpark",{skipSave:e,pathType:"organizer"})}}),this.carrotOne=new m.a({class:"post-top-bar-carrot",parent:this.navCrumbs})),this.docNameInput=new D.a({parent:e===this.EditingModes.TEMPLATE?"PostTopBarLeft":this.navCrumbs,onFocusOut:()=>{let t=this.docNameInput.getText();if(t.trim().length<1){t="";const a=e===this.EditingModes.TEMPLATE?"app.kDefaultTemplateName":"app.kDefaultDocName",i=x.a.translate(a);this.docNameInput.setText(i),this.docNameInput.$el.addClass("placeholder"),this.docNameInput.$el.removeClass("named")}else{(e===this.EditingModes.TEMPLATE?R.default.getTemplateName(r):u.a.currentDoc.getProjectName())!==t?p.default.publish("renameDocument",{}):p.default.publish("renameDocumentCancelled",{}),this.docNameInput.$el.removeClass("placeholder"),this.docNameInput.$el.addClass("named")}this.handleNameDocument(t),this.editNameButton.$el.css("visibility","visible")},onFocus:()=>{p.default.publish("renameDocumentClicked",{}),this.coreWrapper.deselect(),this.editNameButton.$el.css("visibility","hidden"),this.docNameInput.$el.hasClass("placeholder")&&(this.docNameInput.setText(""),this.docNameInput.$el.removeClass("placeholder"),this.docNameInput.$el.addClass("named"))},attributes:{"data-i18n":"[aria-label]app.kPostNameInputLabel"}}),this.editNameButton=new S.a({parent:e===this.EditingModes.TEMPLATE?"PostTopBarLeft":this.navCrumbs,class:"edit-name-button",width:16,height:16,onClick:()=>{this.docNameInput.focus(),this.editNameButton.$el.css("visibility","hidden")}}),this.savingIndicator=new m.a({id:"PostSavingIndicator",parent:"PostTopBarLeft",template:"i18n.app.kSaving",hidden:!0}),this.undo=new v.a({parent:"PostTopBarMid",id:"PostUndoButton",tag:"div",hoverLabel:"i18n.app.kUndo",hoverLabelPosition:"below",label:"i18n.app.kUndo",onClick:()=>{this.events.publish("ui:handleUndo")}}),this.redo=new v.a({parent:"PostTopBarMid",id:"PostRedoButton",tag:"div",hoverLabel:"i18n.app.kRedo",hoverLabelPosition:"below",label:"i18n.app.kRedo",onClick:()=>{this.events.publish("ui:handleRedo")}}),a.featureEnabled("post-enable-debug-menu")&&(this.debugMenu=new v.a({parent:"PostTopBarMid",id:"PostDebugMenuButton",tag:"div",label:"Debug",onClick:()=>{this.events.publish("ui:handleDebugMenuButtonPress")}})),a.featureEnabled("enable-pre-ccx-abtest")&&(this.helpButton=new U.a,this.helpButton.moreTutorialVideosUrl="https://www.adobe.com/express/learn/tutorials",this.helpButton.supportUrl="https://adobespark.zendesk.com/hc/en-us/categories/202688167-Adobe-Spark",this.helpButton.optionVisibility={isOpenTutorialHidden:!0,isRestartHidden:!1,isMoreTutorialsHidden:!1,isGetSupportHidden:!1},this.postTopBarRight.el.append(this.helpButton)),e!==this.EditingModes.TEMPLATE){this.collabStatusButton=new S.a({parent:"PostTopBarRight",class:"collabStatusButton",width:50,height:63,onClick:()=>{this.handleInvite("projectHeader")}});const e=u.a.currentDoc.attributes.collaboration&&"NONE"!==u.a.currentDoc.attributes.collaboration;this.updateCollabStatusButton(e);const{downloadOptionsList:t,selectedOption:i,isImageV2Enabled:o}=this.getDownloadOptions(),n={selectedOption:i,parent:"PostTopBarRight",id:"downloadButton",name:"filetype",label:x.a.translate("app.kDownload"),submitButtonLabel:x.a.translate("app.kStartDownload"),optionsList:t,onIMGDownload:this.handleDownloadImgButtonPress,onIMGDownloadV2:o?this.handleDownloadImgV2ButtonPress:void 0,onMP4Download720p:G.WebAnimationEnabled?this.handleDownloadMP4720pButtonPress:void 0,onPDFDownload:this.handleDownloadPDFButtonPress,onOptionsShown:()=>{this.sharePostButton.el.hideMenuDropdown()}};this.downloadButton=new I.a(n);const r=[{icon:"/marvel-core/images/share/sp-editor-publish.svg",menuItemText:x.a.translate("app.shareMenuItems.publish.kMenuItemText"),tooltipMessage:x.a.translate("app.shareMenuItems.publish.kTooltip"),id:"sharemenu-publish"},{icon:"/marvel-core/images/share/sp-editor-invite.svg",menuItemText:x.a.translate("app.shareMenuItems.invite.kMenuItemText"),tooltipMessage:x.a.translate("app.shareMenuItems.invite.kTooltip"),id:"sharemenu-invite"},{icon:"/marvel-core/images/share/sp-editor-make-a-template.svg",menuItemText:x.a.translate("app.shareMenuItems.createTemplate.kMenuItemText"),tooltipMessage:x.a.translate("app.shareMenuItems.createTemplate.kTooltip"),id:"sharemenu-create-template",menuItemTag:x.a.translate("app.shareMenuItems.createTemplate.kMenuItemTag")}];a.featureEnabled("post-create-template-contentteam")&&(r.push({icon:"/marvel-core/images/share/sp-editor-publish-template.svg",menuItemText:x.a.translate("app.shareMenuItems.publishTemplate.kMenuItemText"),tooltipMessage:x.a.translate("app.shareMenuItems.publishTemplate.kTooltip"),id:"sharemenu-publish-template"}),r.push({icon:"/marvel-core/images/share/sp-editor-submit-asset.svg",menuItemText:x.a.translate("app.shareMenuItems.assetSubmit.kMenuItemText"),tooltipMessage:x.a.translate("app.shareMenuItems.assetSubmit.kTooltip"),id:"sharemenu-asset-submit"})),this.sharePostButtonConfig={parent:"PostTopBarRight",id:"postShareMenu",menutitle:x.a.translate("app.kShare"),onClick:this.handleShareMenuClick,icon:"/images/sp-editor-share.svg",menuitems:r,userSettingFlag:H.a.keys.POST_MAKE_A_TEMPLATE_COACHMARK_DISMISSED,shouldShowCoachmark:!1,coachmarkViewedTrackingEvent:"libraries:templateCoachmarkViewed",menuAriaLabel:x.a.translate("app.kMoreOptions.kAriaLabel"),tooltipMessage:x.a.translate("app.kMoreOptions.kTooltipMessage")},this.sharePostButton=new C.a(this.sharePostButtonConfig),this.enableLMS(),a.featureEnabled("google-drive-ui")&&(this.sharePostButtonConfig.menuitems.push({icon:"/marvel-core/images/share/sp-editor-google-drive.svg",menuItemText:x.a.translate("app.shareMenuItems.googleDrive.kMenuItemText"),id:"sharemenu-googleDrive",menuItemTag:x.a.translate("app.shareMenuItems.lms.kMenuItemTag")}),this.sharePostButton.update({menuitems:this.sharePostButtonConfig.menuitems,menutitle:this.sharePostButtonConfig.menutitle,icon:this.sharePostButtonConfig.icon,menuAriaLabel:this.sharePostButtonConfig.menuAriaLabel,tooltipMessage:this.sharePostButtonConfig.tooltipMessage}),s.a.showSaveCTA()&&!this.googleDriveCoachmark&&(this.googleDriveCoachmark=this.createCoachmark("googleDriveCoachmark","i18n.components.coachmarks.googleDrive.kMessage",100)),setTimeout(()=>{this.googleDriveCoachmark&&this.googleDriveCoachmark.show()},0))}const b={formTitle:x.a.translate("app.templatePublisher.formModal.kFormTitle"),templateNameFieldLabel:x.a.translate("app.templatePublisher.formModal.kTemplateNameFieldLabel"),associatedCategoriesSectionLabel:x.a.translate("app.templatePublisher.formModal.kAssociatedCategoriesSectionLabel"),selectedCategoriesSectionLabel:x.a.translate("app.templatePublisher.formModal.kSelectedCategoriesSectionLabel"),taskSectionLabel:x.a.translate("app.templatePublisher.formModal.kTaskSectionLabel"),keyTermsFieldLabel:x.a.translate("app.templatePublisher.formModal.kKeyTermsFieldLabel"),languageSectionLabel:x.a.translate("app.templatePublisher.formModal.kLanguageSectionLabel"),cancelButtonTitle:x.a.translate("app.templatePublisher.formModal.kCancelButtonTitle"),resetButtonTitle:x.a.translate("app.templatePublisher.formModal.kResetButtonTitle"),saveTemplateButtonTitle:x.a.translate("app.templatePublisher.formModal.kSaveTemplateButtonTitle"),loadingViewPrimaryText:x.a.translate("app.templatePublisher.formModal.kLoadingViewPrimaryText"),loadingViewSecondaryText:x.a.translate("app.templatePublisher.formModal.kLoadingViewSecondaryText"),templatePreviewAltText:x.a.translate("app.templatePublisher.formModal.kTemplatePreviewAltText"),xButtonAltText:x.a.translate("app.templatePublisher.formModal.kXButtonAltText")};this.templatePublisherModal=new E.a({id:"TemplatePublisher",parent:h,hidden:!0,onResetButtonClicked:this.resetTemplatePublisherForm,onSaveButtonClicked:this.handleTemplatePublisherSaveButtonClicked,localizedStrings:b}),a.featureEnabled("post-create-template-contentteam")&&(this.assetSubmitModal=new F.a({id:"AssetSubmitter",parent:d,hidden:!0,onSaveButtonClicked:this.handleAssetSubmitterSaveButtonClicked}))}async enableLMS(){let e="account type";try{const t=await n.a.getAccountType();e="visit counts for New badge";const a=await n.a.shouldShowNewBadge();e="permission for Google Classroom CTA";const i=await n.a.isEDUAccountWithoutPublish(u.a.currentDoc.getMyApp());let s=a?x.a.translate("app.shareMenuItems.lms.kMenuItemTag"):"";"teacher"===t&&this.sharePostButtonConfig.menuitems.push({icon:"/marvel-core/images/share/sp-editor-canvas-lms.svg",menuItemText:x.a.translate("app.shareMenuItems.lms.kAttachText"),id:"sharemenu-lms-attach",menuItemTag:s}),"student"===t&&this.sharePostButtonConfig.menuitems.push({icon:"/marvel-core/images/share/sp-editor-canvas-lms.svg",menuItemText:x.a.translate("app.shareMenuItems.lms.kTurninText"),id:"sharemenu-lms-attach",menuItemTag:s}),n.a.showGCAddonShare&&n.a.showGCAddonShare(u.a.currentDoc)&&this.sharePostButtonConfig.menuitems.push({icon:"/marvel-core/images/share/sp-editor-google-classroom.svg",menuItemText:x.a.translate("app.shareMenuItems.lms.kGCAddonText"),id:"sharemenu-gc-addon-attach",menuItemTag:s}),this.sharePostButton.update({menuitems:this.sharePostButtonConfig.menuitems,menutitle:this.sharePostButtonConfig.menutitle,icon:this.sharePostButtonConfig.icon}),a&&(this.lmsCoachmark||(this.lmsCoachmark=this.createCoachmark("lmsCoachmark","i18n.components.coachmarks.lms.kMessage",10)),setTimeout(()=>{this.lmsCoachmark.show()},0)),i&&(s=a?x.a.translate("app.shareMenuItems.googleClassroom.kMenuItemTag"):"",this.sharePostButtonConfig.menuitems.push({icon:"/marvel-core/images/share/sp-editor-google-classroom.svg",menuItemText:x.a.translate("app.shareMenuItems.googleClassroom.kMenuItemText"),tooltipMessage:x.a.translate("app.shareMenuItems.googleClassroom.kTooltip"),id:"sharemenu-googleClassroom",menuItemTag:s}),this.sharePostButton.update({menuitems:this.sharePostButtonConfig.menuitems,menutitle:this.sharePostButtonConfig.menutitle,icon:this.sharePostButtonConfig.icon}),a&&(this.googleClassroomCoachmark||(this.googleClassroomCoachmark=this.createCoachmark("googleClassroomCoachmark","i18n.components.coachmarks.googleClassroom.kMessage",11)),setTimeout(()=>{this.googleClassroomCoachmark.show()},0)),this.postFeatureController.featureEnabled("share-microsoft-teams-edu-workflow")&&this.sharePostButtonConfig.menuitems.push({icon:"/marvel-core/images/share/sp-editor-ms-teams.svg",menuItemText:x.a.translate("app.shareMenuItems.msteams.kPublish"),tooltipMessage:x.a.translate("app.shareMenuItems.msteams.kTooltip"),id:"sharemenu-lms-msteams-publish",menuItemTag:s}))}catch(t){_.error("Error getting "+e,t)}}createCoachmark(e,t,a){return new k.a({id:e,message:t,priority:a,parent:"PostTopBarRight",arrowDirection:"top-right",closeButtonType:"icon",height:52,width:330,top:66,hidden:!0,left:"calc(100% - 330px)",anchorElement:this.sharePostButton})}getDownloadOptions(){const e=this.coreWrapper.hasAnimationStyle(),t=this.postFeatureController.featureEnabled("post-enable-server-rendering")&&$,a={label:x.a.translate("app.downloadOptions.mp4Video720p.kButtonLabel"),filetype:"mp4_SEVEN_TWENTY_P",betaflag:!0,tooltipMessage:x.a.translate("app.downloadOptions.mp4Video.kTooltip")},i={label:x.a.translate("app.downloadOptions.pngImgV2.kButtonLabel"),filetype:"img_png_v2",betaflag:!0,tooltipMessage:x.a.translate("app.downloadOptions.pngImgV2.kTooltip")},s={label:x.a.translate("app.downloadOptions.jpgImgV2.kButtonLabel"),filetype:"img_jpeg_v2",betaflag:!0,tooltipMessage:x.a.translate("app.downloadOptions.jpgImgV2.kTooltip")};return{downloadOptionsList:[...G.WebAnimationEnabled&&e?[a]:[],{label:x.a.translate("app.downloadOptions.pngImg.kButtonLabel"),filetype:"img_png",tooltipMessage:x.a.translate("app.downloadOptions.pngImg.kTooltip")},{label:x.a.translate("app.downloadOptions.jpgImg.kButtonLabel"),filetype:"img_jpg",tooltipMessage:x.a.translate("app.downloadOptions.jpgImg.kTooltip")},...t?[i]:[],...t?[s]:[],{label:x.a.translate("app.downloadOptions.printPdf.kButtonLabel"),filetype:"pdf",betaflag:!0,tooltipMessage:x.a.translate("app.downloadOptions.printPdf.kTooltip")}],selectedOption:G.WebAnimationEnabled&&e?"mp4_SEVEN_TWENTY_P":"img_png",isImageV2Enabled:t}}updateCollabStatusButton(e){this.collabStatusButton.$el.toggleClass("shared-document",!!e)}onRefineCutoutModeChanged(e){this.postTopBarLeft.$el.toggleClass("hidden",e),this.postTopBarRight.$el.toggleClass("hidden",e)}setExportController(e){this.exportController=e}handleNameDocument(e){this.storeDocumentName(e),this.coreWrapper.requestSave(!1,!0)}handleDownloadImgButtonPress(e){const{coreWrapper:t,isWatermarkEnabled:a}=this,i=e.originalEvent.detail.mediaType.split("_")[1];p.default.publish("downloadButtonPressed"),"string"==typeof i&&p.default.publish("downloadImgButtonPressed: "+i),this.exportController.downloadImg({coreWrapper:t,mediaType:i,isWatermarkEnabled:a,MarvelSettings:l(),docName:this.docNameInput.getText(),requestSaveMethod:this.coreWrapper.requestSave})}handleDownloadImgV2ButtonPress(e){const t=e.originalEvent.detail.mediaType.split("_")[1];this.waitForSaveToFinish().then(()=>{this.exportController.downloadImgV2(u.a,l.a,t)})}handleDownloadMP4720pButtonPress(){this.waitForSaveToFinish().then(()=>{p.default.publish("downloadMP4_720pButtonPressed"),this.exportController.downloadMP4(u.a,l.a,this.coreWrapper,1280,this.coreWrapper.requestSave)})}handleDownloadPDFButtonPress(){this.waitForSaveToFinish().then(()=>{p.default.publish("downloadPDFButtonPressed"),this.exportController.downloadPDF(u.a,l.a,this.coreWrapper.requestSave)})}handleShareMenuClick(e){this.lmsCoachmark&&!this.lmsCoachmark.isHidden()&&this.lmsCoachmark.hide(),this.googleClassroomCoachmark&&!this.googleClassroomCoachmark.isHidden()&&this.googleClassroomCoachmark.hide(),this.googleDriveCoachmark&&!this.googleDriveCoachmark.isHidden()&&this.googleDriveCoachmark.hide(),this.waitForSaveToFinish().then(()=>{if("sharemenu-publish"===e)return this.handlePublish();if("sharemenu-invite"===e)return this.handleInvite("project");if("sharemenu-publish-template"===e){const e=u.a.currentDoc.isPublished();if(p.default.publish("project:spTemplatePressed",{contextualData1:"isRepublishing:"+e}),e)return _.warn("Failed to publish template: Republishing templates is currently not supported in Adobe Spark Post Web."),d.a.showAlert(x.a.translate("app.templatePublisher.templateRepublishFailure.kHeaderText"),x.a.translate("app.templatePublisher.templateRepublishFailure.kContentText")),null;if(this.coreWrapper.containsBrandedContent())return _.warn("Cannot publish template for a branded document."),d.a.showAlert(x.a.translate("app.templatePublisher.brandedDocumentFailure.kHeaderText"),x.a.translate("app.templatePublisher.brandedDocumentFailure.kContentText")),null;const{stockImages:t}=this.coreWrapper.getConstrainedImages();return t&&(t.extended.length>0||t.standard.length>0)?(_.warn("Cannot publish template with licensed Stock images."),d.a.showAlert(x.a.translate("app.templatePublisher.licensedImagesFailure.kHeaderText"),x.a.translate("app.templatePublisher.licensedImagesFailure.kContentText")),null):(this.showTemplatePublisher(),null)}return"sharemenu-asset-submit"===e?(this.showAssetSubmitter(),null):("sharemenu-googleDrive"===e&&L.default.sendToGoogleDrive(u.a.currentDoc),"sharemenu-lms-msteams-publish"===e?(n.a.showModal({type:"adobe-theo",id:u.a.currentDoc.id,target:"ms-teams"}),null):"sharemenu-lms-turnin"===e||"sharemenu-lms-attach"===e?(n.a.showModal({type:"adobe-theo",id:u.a.currentDoc.id,target:"canvas"},{syncInProgress:!1}),null):"sharemenu-googleClassroom"===e?(n.a.showWindow({type:"adobe-theo",id:u.a.currentDoc.id,target:"google-classroom"}),null):"sharemenu-gc-addon-attach"===e?(n.a.showGCAttachWindow(u.a.currentDoc),null):("sharemenu-create-template"===e&&L.default.createTemplate(u.a.currentDoc),""===e?(this.downloadButton.el.hideDownloadList(),null):(console.warn("handleShareMenuClick called with unrecognized menuItemId",e),null)))})}handlePublish(){p.default.publish("shareButtonPressed"),this.exportController.publish(l.a,this.coreWrapper.requestSave)}handleInvite(e){L.default.invite(u.a.currentDoc,e,"post:editor")}showTemplatePublisher(){const e=this.templatePublisherModal;e.el.templateName=u.a.currentDoc.getProjectName(),e.el.isAnimatedTemplate=this.coreWrapper.hasAnimationStyle(),e.el.isPremiumTemplate=this.includesPaidAdobeFonts(),e.el.isPublishing=!1,this.coreWrapper.deselectAll(),j.a.fetchConfig().then(t=>{t&&t.templates&&t.templates.tasks?(e.el.validTasksList=Object.keys(t.templates.tasks),e.show()):this.showAccessFailureModal()}),this.getDocumentRendition({width:300,asDataURL:!0}).then(t=>{e.el.templatePreviewImageURL=t})}resetTemplatePublisherForm(){const e=this.templatePublisherModal;e.el.resetForm(),e.el.templateName=u.a.currentDoc.getProjectName(),e.el.isPremiumTemplate=this.includesPaidAdobeFonts()}handleTemplatePublisherSaveButtonClicked({detail:e}){const t=e.keyTerms.split(",").filter(e=>e.length>0);t.length>0&&p.default.publish("project:contentTermsAdded",{contextualData1:"addedTerms:"+t.join(",")});const a={associatedCategories:[...e.associatedCategories],categories:[...e.selectedCategories],keyTerms:[...t],language:e.languageIdentifier,title:e.templateName,task:e.task};this.handleNameDocument(e.templateName),this.docNameInput.setText(e.templateName),this.templatePublisherModal.el.isPublishing=!0,this.handlePublishTemplate(a)}handlePublishTemplate(e){L.default.publishTemplate(e,this.coreWrapper,this.waitForQuietSaveToFinish,this.getDocumentRendition).then(e=>{p.default.publish("project:spTemplateExported",{contextualData1:"result:success"}),this.templatePublisherModal.hide();const{remixURL:t}=e;d.a.showConfirm(x.a.translate("app.templatePublisher.templatePublishSuccess.kHeaderText"),x.a.translate("app.templatePublisher.templatePublishSuccess.kContentText"),{cancelText:x.a.translate("app.templatePublisher.templatePublishSuccess.kCancelButtonLabel"),okText:x.a.translate("app.templatePublisher.templatePublishSuccess.kRemixButtonLabel")}).then(e=>{if(e)return window.navigator.clipboard.writeText(t)}).done()}).catch(e=>{const{errorMessage:t}=e;p.default.publish("project:spTemplateExported",{contextualData1:"result:failed",contextualData2:"errorMessage:"+t}),this.templatePublisherModal.hide(),t?d.a.showAlert(x.a.translate("app.templatePublisher.templatePublishFailure.kHeaderText"),t):d.a.showAlert(x.a.translate("app.templatePublisher.templatePublishFailure.kHeaderText"),x.a.translate("app.templatePublisher.templatePublishFailure.contentText.kDefaultFailure"))})}updateCoreWrapper(e){this.coreWrapper=e}storeDocumentName(e){this.editingMode===this.EditingModes.TEMPLATE?R.default.setTemplateName(this.templateNode,e):this.coreWrapper.setDocumentName(e)}getCurrentDocUrn(){return u.a.currentDoc.attributes.compositeObj._assetId}isPremiumAsset(){return this.includesPaidAdobeFonts()}showAccessFailureModal(){d.a.showAlert(x.a.translate("app.assetSubmitter.failure.kAccessDeniedHeaderText"),x.a.translate("app.assetSubmitter.failure.kAccessText"))}showAssetSubmitter(){const e=this.assetSubmitModal;j.a.fetchConfig().then(t=>{t&&t.tasks&&t.traits&&t.language&&t.applicableRegions&&t.applicableRegions.length>0?(e.el.assetTraits=new Set(t.traits.sort()),e.el.assetTasks=new Set(t.tasks.sort()),e.el.applicableRegions=new Set([t.applicableRegions[0].value]),e.el.assetLanguages=Object.values(t.language).map(e=>({identifier:e.value,displayName:e.label}))):this.showAccessFailureModal()});const t=u.a.currentDoc.getProjectName(),a=this.getCurrentDocUrn();e.el.title=t,e.el.filename=`${t}-${a.slice(-6)}`,e.el.firstScreen=!0,e.el.isAnimatedAsset=this.coreWrapper.hasAnimationStyle(),e.el.isPremiumAsset=this.isPremiumAsset(),e.el.isSubmitting=!1,e.el.language="i-default",e.el.task="",e.el.topics=new Set,e.el.traits=new Set,this.coreWrapper.deselectAll(),this.getDocumentRendition({width:300,asDataURL:!0}).then(t=>{e.el.previewImageURL=t}),j.a.getFolderTree("/submit").then(t=>{0!==t.length?(e.el.submitFolders=t,e.show()):this.showAccessFailureModal()})}handleAssetSubmitterSaveButtonClicked({detail:e}){const t=u.a.currentDoc.attributes.compositeObj._assetId;this.assetSubmitModal.el.isSubmitting=!0,j.a.submitAsset(t,e).then(e=>{this.assetSubmitModal.el.isSubmitting=!1,e&&this.assetSubmitModal.hide()})}}},"6Wo8":function(e,t,a){"use strict";var i=a("7gWt"),s=a("bBG2"),o=a("tpS0"),n=a.n(o),r=a("K7z8"),l=a("rJP3"),h=a("MGCh"),d=a.n(h),p=a("Mbmg"),c=a("hu6S"),u=a("HetE"),b=a("LU24");function m(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}let g;!function(e){e.UPDATE_CONFLICT="UPDATE_CONFLICT",e.VALIDATION_FAILED="VALIDATION_FAILED"}(g||(g={}));const v=d.a.channel("save-document");t.a=new class{constructor(){m(this,"isSaving",!1),m(this,"hasPending",!1)}async save({currentDoc:e,stateID:t,coreWrapper:a,saveDocumentDeferred:o,saveCorePromise:h,postFeatureController:d,operation:m,editingMode:T,topBarUI:S,poster:P,templateNode:k}){let w,I,f;function C(e){e&&e.hide(),c.a.reload(o,a)}function B(){C(w)}function D(){C(I)}function A(){C(f)}function M(){f&&f.hide(),a.requestSave(!0),c.a.waitForSaveDocumentToFinish(o,a).then(c.a.reloadIfNavigatedAway)}function L(e){"code"in e&&e.code===g.UPDATE_CONFLICT?w=new n.a({id:"UpdateConflictDialog",headerText:"i18n.dialogs.saveFailedMergeConflict.kHeaderText",contentText:"i18n.dialogs.saveFailedMergeConflict.kContentText",dismissable:!1,buttons:[{id:"UpdateConflictRefreshButton",class:"pill pill-primary-on-light",label:"i18n.dialogs.saveFailedMergeConflict.kRefresh",onClick:B}]}):"code"in e&&e.code===g.VALIDATION_FAILED?I=new n.a({id:"ValidationFailedDialog",headerText:"i18n.dialogs.saveFailed.kHeaderText",contentText:"i18n.dialogs.saveFailed.kContentText",dismissable:!0,buttons:[{id:"ValidationFailedRefreshButton",class:"pill pill-primary-on-light",label:"i18n.dialogs.saveFailed.kRefresh",onClick:D}]}):f=new n.a({id:"GenericSaveFailedDialog",headerText:"i18n.dialogs.saveFailed.kHeaderText",contentText:"i18n.dialogs.saveFailed.kContentText",dismissable:!0,buttons:[{id:"GenericSaveFailedRefreshButton",class:"pill pill-primary-on-light",label:"i18n.dialogs.saveFailed.kRefresh",onClick:A},{id:"GenericSaveFailedRetryButton",class:"pill pill-secondary-on-light",label:"i18n.dialogs.saveFailed.kTryAgain",onClick:M}]})}if(a.validateDoc("saveBegin"),c.a.verifyAndSetCurrentDocumentExportedState(e,a),!a.validateDBSaveState(t))return this.isSaving=!1,(null==S?void 0:S.savingIndicator)&&(null==S||S.savingIndicator.hide()),h.reject(null),void L({code:g.VALIDATION_FAILED});const E=t;null==S||S.savingIndicator.show(),this.isSaving&&(this.hasPending=!0),this.isSaving=!0,i.SparkPerformanceTracker.mark(b.PERFORMANCE_MARKERS.docSave),s.default.publish("saveDocumentBegin");const F=window.marvel.logger;e&&F.beginTrackingFlow("saveProjectFromEditor",{sparkFormat:"post",projectId:e.id,projectUrn:e.getDCXComposite().assetId}),c.a.checkImageFormaeForNull(a.imageFormas()),p.b.pageUnloadBlockingBegin();let y,x;try{if(P&&(m===u.EditorOperations.EDIT_TEMPLATE||m===u.EditorOperations.NEW_TEMPLATE_FROM_TEMPLATE||d.featureEnabled("post-preview-image-disabled2")||(y=await P.getRendition({imageQuality:.94,width:1200})),x=await P.getRendition({imageQuality:.94,width:500})),T===u.EditingModes.TEMPLATE&&l.default.currentBrandKit()&&k&&await r.default.setUsedBrandElementsData(l.default.currentBrandKit(),k,a,!1),null==S?void 0:S.docNameInput){const e=null==S?void 0:S.docNameInput.getText();e!==a.getDocumentName()&&(null==S||S.storeDocumentName(e))}await a.saveWithRenditions(y,x,E);const n=i.SparkPerformanceTracker.measure(b.PERFORMANCE_MARKERS.docSaveComplete,b.PERFORMANCE_MARKERS.docSave),p={saveTimeElapsedMs:n&&n.duration,docId:e.id,previewImageSize:y instanceof Blob?y.size:null};y||delete p.previewImageSize,s.default.publish("saveDocumentEnd",p),this.isSaving=!1,e&&F.endTrackingFlow("saveProjectFromEditor"),a.validateDoc("saveSuccess"),this.hasPending&&a.canSave()?(this.hasPending=!1,await this.save({currentDoc:e,stateID:t,coreWrapper:a,saveDocumentDeferred:o,saveCorePromise:h,poster:P,topBarUI:S,postFeatureController:d,operation:m,editingMode:T,templateNode:k})):((null==S?void 0:S.savingIndicator)&&(null==S||S.savingIndicator.hide()),h.resolve(null))}catch(e){this.isSaving=!1,W=e,(null==S?void 0:S.savingIndicator)&&(null==S||S.savingIndicator.hide()),v.error("Failed to save Post project",W),a.validateDoc("saveFail"),h.reject(W),L(W)}var W}}},"8rMV":function(e,t,a){"use strict";a.r(t),a.d(t,"FIRST_MILE_TOUR_STEPS",(function(){return h})),a.d(t,"default",(function(){return p}));var i=a("6BHl"),s=a("bCVW"),o=a("GCYt"),n=a("h+Ay"),r=a("bBG2");function l(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}const h={ADD:0,SELECTED:1,EDIT:2};let d=[];class p{constructor(e,t,a,h,d,p,c,u){l(this,"coreWrapper",void 0),l(this,"events",void 0),l(this,"postFeatureController",void 0),l(this,"spotlightTargets",void 0),l(this,"clickBlockingScrim",void 0),l(this,"tourWrapper",void 0),l(this,"tourFooter",void 0),l(this,"spotlight",void 0),l(this,"zoomPopUp",void 0),l(this,"actionLayer",void 0),l(this,"helpButton",void 0),l(this,"stepState",void 0),this.coreWrapper=e,this.events=t,this.postFeatureController=a,this.spotlightTargets=h,this.tourWrapper=d,this.tourFooter=new i.a,this.tourWrapper.innerHTML="",this.tourWrapper.appendChild(this.tourFooter),this.spotlight=new s.a,this.zoomPopUp=p,this.actionLayer=c,this.stepState=[],this.clickBlockingScrim=document.createElement("div"),this.clickBlockingScrim.classList.add("click-blocking-scrim"),this.startTour=this.startTour.bind(this),this.endTour=this.endTour.bind(this),this.updateStepState=this.updateStepState.bind(this),this.restartTour=this.restartTour.bind(this),a.featureEnabled("enable-pre-ccx-abtest")&&(this.helpButton=u,this.handleHelpButtonAnalytics=this.handleHelpButtonAnalytics.bind(this),this.helpButton.addEventListener(o.m,e=>{this.restartTour(),this.handleHelpButtonAnalytics(e)}),this.helpButton.addEventListener(o.b,e=>{this.helpButton.isCoachmarkVisible=!1,this.handleHelpButtonAnalytics(e)}),this.helpButton.addEventListener(n.e,e=>{r.default.publish("guidance:morePressed")}),this.helpButton.addEventListener(o.k,this.handleHelpButtonAnalytics),this.helpButton.addEventListener(o.h,this.handleHelpButtonAnalytics),this.helpButton.addEventListener(o.f,this.handleHelpButtonAnalytics),window.marvel.features.hasFeature("first-mile-tour-completed")||this.restartTour())}startTour(){window.marvel.features.hasFeature("first-mile-tour-completed")||(Object.keys(h).forEach(e=>{this.stepState[h[e]]=!1}),this.coreWrapper.tourIsActive=!0,this.bindListeners(),this.tourWrapper.classList.remove("hidden"),this.tourWrapper.classList.add("shown"),this.zoomPopUp.classList.add("moveUpForTour"),this.actionLayer.classList.add("moveUpForTour"),this.tourFooter.setAttribute("currentState",0),this.tourFooter.setAttribute("stepsState",JSON.stringify({hasAdded:!1,hasEdited:!1})),this.tourFooter.addEventListener("stop-tour",this.endTour),this.setupSpotlight(h.ADD))}endTour(){this.tourFooter.removeEventListener("stop-tour",this.endTour),this.events.publish("ui:tour-completed"),this.unbindListeners(),this.coreWrapper.tourIsActive=!1,this.tourWrapper.classList.add("hidden"),this.tourWrapper.classList.remove("shown"),this.zoomPopUp.classList.remove("moveUpForTour"),this.actionLayer.classList.remove("moveUpForTour"),this.hideSpotlight();const e=this.stepState.every(e=>e);r.default.publish("guidance:tourCancelled",{contextualData2:"method:stopTourButton",contextualData4:"tourCompleted:"+e}),window.marvel.features.setUserFlag("first-mile-tour-completed",!0),this.helpButton.isCoachmarkVisible=!0}updateStepState(e,t){if(this.stepState[e])return;e!==h.ADD||this.coreWrapper.getSelectedForma()||(this.coreWrapper.getSelectedForma()?this.stepState[h.SELECTED]=!0:d.push(this.coreWrapper.events.subscribe("forma-selected",e=>{e.id&&this.updateStepState(h.SELECTED)}))),this.stepState[e]=!0,this.stepState[h.ADD]&&this.stepState[h.EDIT]&&(this.stepState[h.SELECTED]=!0),this.tourFooter.setAttribute("stepsState",JSON.stringify({hasAdded:this.stepState[h.ADD],hasEdited:this.stepState[h.EDIT]})),e===h.ADD&&t&&t.contextualData2&&r.default.publish("guidance:stepCompleted",{contextualData2:"actionDescription:"+t.contextualData2,contextualData3:"stepName:firstAdd"}),e===h.EDIT&&t&&t.contextualData2&&r.default.publish("guidance:stepCompleted",{contextualData2:"actionDescription:"+t.contextualData2,contextualData3:"stepName:firstEdit"});this.stepState.every(e=>e)||(e===h.ADD?this.coreWrapper.getSelectedForma()?(this.tourFooter.setAttribute("currentState",h.EDIT),this.setupSpotlight(h.EDIT)):this.tourFooter.setAttribute("currentState",h.SELECTED):e===h.SELECTED?(this.tourFooter.setAttribute("currentState",h.EDIT),this.setupSpotlight(h.EDIT)):e===h.EDIT&&(this.stepState[h.ADD]||this.tourFooter.setAttribute("currentState",h.ADD)))}updateReferences(e,t,a){this.coreWrapper=e,this.events=t,this.postFeatureController=a}unbindListeners(){d.forEach(e=>{e.remove()}),d=[]}bindListeners(){d.push(this.coreWrapper.events.subscribe("edit-action-performed",e=>{this.updateStepState(h.EDIT,e)})),d.push(this.coreWrapper.events.subscribe("add-action-performed",e=>{this.updateStepState(h.ADD,e)}))}restartTour(){window.marvel.features.setUserFlag("first-mile-tour-completed",!1),this.coreWrapper.tourIsActive=!0,this.bindListeners(),Object.keys(h).forEach(e=>{this.stepState[h[e]]=!1}),this.startTour()}setupSpotlight(e){this.stepState.every(e=>e)||(e===h.ADD?(this.spotlight.translationId="firstMileTour.spotlightAddText",this.spotlight.target=this.spotlightTargets[0],this.spotlight.variant="right"):e===h.EDIT&&(this.spotlight.translationId="firstMileTour.spotlightEditText",this.spotlight.target=this.spotlightTargets[1],this.spotlight.variant="left"),this.spotlight.zindex=500,setTimeout(()=>{var e;this.clickBlockingScrim.addEventListener("click",this.preventClicks),document.body.appendChild(this.clickBlockingScrim),null===(e=document.getElementById("PostEditorContent"))||void 0===e||e.appendChild(this.spotlight),this.spotlight.classList.add("fade-in"),setTimeout(()=>{this.spotlight.classList.remove("fade-in"),this.hideSpotlight()},4500)},0))}hideSpotlight(){this.clickBlockingScrim.removeEventListener("click",this.preventClicks),this.spotlight.classList.add("fade-out"),setTimeout(()=>{this.spotlight.remove(),this.clickBlockingScrim.remove(),this.spotlight.classList.remove("fade-out")},1e3)}rightSidebarOpened(){window.marvel.features.hasFeature("first-mile-tour-completed")||this.stepState[h.ADD]||this.updateStepState(h.SELECTED)}preventClicks(e){e.stopPropagation(),e.preventDefault()}handleHelpButtonAnalytics(e){let t="ctaType:NA";switch(e.type){case o.m:t="ctaType:restartTour";break;case o.k:t="ctaType:watchTutorialVideo";break;case o.h:t="ctaType:moreTutorials";break;case o.f:t="ctaType:getSupport"}r.default.publish("guidance:ctaPressed",{contextualData1:t})}}},CXs4:function(e,t,a){"use strict";a.r(t),a.d(t,"default",(function(){return G}));var i=a("2ofD"),s=a.n(i),o=a("z4rR"),n=a.n(o),r=a("bBG2"),l=(a("jo99"),a("efk3")),h=a.n(l),d=a("FIWz"),p=a.n(d),c=a("HPKp"),u=a.n(c),b=a("7VrH"),m=a.n(b),g=a("mYMA"),v=a.n(g),T=a("GN+k"),S=a.n(T),P=a("W3p6"),k=a.n(P),w=a("mTyn"),I=a.n(w),f=a("wRAw"),C=a.n(f),B=a("vdJz"),D=a.n(B),A=a("UXma"),M=a.n(A),L=a("e8qH"),E=a.n(L),F=a("W1Jy"),y=a.n(F),x=a("NgGw"),W=a.n(x),R=a("HetE"),N=a("LGQi");function O(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class G{constructor({editingMode:e,previousSelectedFormaId:t,events:a,postFeatureController:i,coreWrapper:o,waitForSaveToFinish:r,waitForQuietSaveToFinish:l,colorPicker:d,designSurface:c}){O(this,"postControlStrip",void 0),O(this,"brandIndicator",void 0),O(this,"sidebarGlobal",void 0),O(this,"sidebarTheme",void 0),O(this,"sidebarPalette",void 0),O(this,"sidebarResize",void 0),O(this,"sidebarAnimation",void 0),O(this,"sidebarLayout",void 0),O(this,"sidebarText",void 0),O(this,"sidebarBackground",void 0),O(this,"sidebarLogo",void 0),O(this,"sidebarIcon",void 0),O(this,"sidebarMultiselect",void 0),O(this,"sidebarGroup",void 0),O(this,"addTextSidebar",void 0),O(this,"sidebarCrop",void 0),O(this,"changeImageModalPanel",void 0),O(this,"changeIconModalPanel",void 0),O(this,"changeImageModalPanelInserted",!1),O(this,"changeIconModalPanelInserted",!1),O(this,"selectedTabComponent",null),O(this,"selectedComponentName",""),O(this,"events",void 0),O(this,"coreWrapper",void 0),O(this,"waitForQuietSaveToFinish",void 0),O(this,"previousSelectedFormaId",void 0),O(this,"designSurface",void 0),this.events=a,this.previousSelectedFormaId=t,this.coreWrapper=o,this.waitForQuietSaveToFinish=l,this.designSurface=c,this.deletingCurrentDoc=this.deletingCurrentDoc.bind(this),this.getFormaSizeData=this.getFormaSizeData.bind(this),this.handleNavTabSelected=this.handleNavTabSelected.bind(this),this.handleImageModalInsert=this.handleImageModalInsert.bind(this),this.handleImageModalRemove=this.handleImageModalRemove.bind(this),this.handleSelectForma=this.handleSelectForma.bind(this),this.handleIconModalInsert=this.handleIconModalInsert.bind(this),this.handleIconModalRemove=this.handleIconModalRemove.bind(this),this.handleSelectThemeTab=this.handleSelectThemeTab.bind(this),this.handleSelectPaletteTab=this.handleSelectPaletteTab.bind(this),this.handleSelectLayoutTab=this.handleSelectLayoutTab.bind(this),this.handleSelectResizeTab=this.handleSelectResizeTab.bind(this),this.handleSelectAnimationTab=this.handleSelectAnimationTab.bind(this),this.handleSelectTextTab=this.handleSelectTextTab.bind(this),this.handleSelectBackgroundTab=this.handleSelectBackgroundTab.bind(this),this.handleSelectLogoTab=this.handleSelectLogoTab.bind(this),this.handleSelectIconTab=this.handleSelectIconTab.bind(this),this.handleSelectMultiselectTab=this.handleSelectMultiselectTab.bind(this),this.handleSelectGroupTab=this.handleSelectGroupTab.bind(this),this.updateCurrentPalette=this.updateCurrentPalette.bind(this),this.updateListOfDesigns=this.updateListOfDesigns.bind(this),this.updateSidebarAnimation=this.updateSidebarAnimation.bind(this),this.handleBrandInvite=this.handleBrandInvite.bind(this),this.events.subscribe("ui:handleSelectThemeTab",this.handleSelectThemeTab),this.events.subscribe("ui:handleSelectPaletteTab",this.handleSelectPaletteTab),this.events.subscribe("ui:handleSelectLayoutTab",this.handleSelectLayoutTab),this.events.subscribe("ui:handleSelectResizeTab",this.handleSelectResizeTab),this.events.subscribe("ui:handleSelectAnimationTab",this.handleSelectAnimationTab),this.events.subscribe("ui:handleSelectTextTab",this.handleSelectTextTab),this.events.subscribe("ui:handleSelectBackgroundTab",this.handleSelectBackgroundTab),this.events.subscribe("ui:handleSelectIconTab",this.handleSelectIconTab),this.events.subscribe("ui:handleSelectMultiselectTab",this.handleSelectMultiselectTab),this.events.subscribe("ui:handleSelectGroupTab",this.handleSelectGroupTab),this.events.subscribe("ui:handleNavTabSelected",this.handleNavTabSelected),this.events.subscribe("ui:updateCurrentPalette",this.updateCurrentPalette),this.events.subscribe("ui:updateListOfDesigns",this.updateListOfDesigns),this.events.subscribe("ui:updateSidebarAnimation",this.updateSidebarAnimation),this.events.subscribe("ui:previousSelectedFormaId",e=>{this.previousSelectedFormaId=e}),this.events.subscribe("ui:showHideComponent",({componentName:e,display:t})=>{this[e]&&(t?this[e].show():this[e].hide())}),e!==R.EditingModes.TEMPLATE?(this.postControlStrip=new y.a({layout:"rows",panels:[{id:"PostBrandIndicatorContainer",size:"54px"},{id:"PostSidebar",size:"auto"}],parent:"PostLegacySidebarContents"}),this.brandIndicator=new n.a({collaborationStatus:s.a.currentDoc.getCollaboration(),height:54,id:"PostBrandIndicator",isEntitled:i.featureEnabled("entitle-brand-kit"),parent:"PostBrandIndicatorContainer",navigateToCreateBrandMethod:e=>{this.events.publish("ui:returnToSpark",{skipSave:e,pathType:"create_brand"})},inviteToBrand:this.handleBrandInvite,width:280})):this.postControlStrip=new y.a({layout:"rows",panels:[{id:"PostBrandIndicatorContainer",size:"0px"},{id:"PostSidebar",size:"auto"}],parent:"PostLegacySidebarContents"}),this.sidebarGlobal=new W.a({parent:"PostSidebar",hidden:!1}),this.sidebarTheme=new E.a({parent:this.sidebarGlobal,hidden:!1,visibilityGroup:"main-sidebar",showMerchPopup:!i.featureEnabled("entitle-brand-kit")}),this.sidebarPalette=new C.a({parent:this.sidebarGlobal,hidden:!0,visibilityGroup:"main-sidebar",colorPicker:d}),this.sidebarResize=new D.a({parent:this.sidebarGlobal,hidden:!0,visibilityGroup:"main-sidebar"}),R.WebAnimationEnabled&&(this.sidebarAnimation=new h.a({parent:this.sidebarGlobal,hidden:!0,visibilityGroup:"main-sidebar",class:"post-panel-scrollable"})),this.sidebarLayout=new v.a({parent:this.sidebarGlobal,hidden:!0,visibilityGroup:"main-sidebar"}),this.sidebarGlobal.registerSidebarTabWithId(this.sidebarTheme,"theme"),this.sidebarGlobal.registerSidebarTabWithId(this.sidebarPalette,"palette"),this.sidebarGlobal.registerSidebarTabWithId(this.sidebarLayout,"layout"),this.sidebarGlobal.registerSidebarTabWithId(this.sidebarResize,"resize"),this.sidebarAnimation&&this.sidebarGlobal.registerSidebarTabWithId(this.sidebarAnimation,"animation"),this.sidebarText=new M.a({parent:"PostSidebar",hidden:!0,entitleBrandKit:i.featureEnabled("entitle-brand-kit"),advancedTextLayoutEnabled:!0,advancedTextLayoutWebEnabled:!0,advancedTextLayoutEnableBoundingBoxArea:i.featureEnabled("post-enable-bounding-box-area"),colorPicker:d}),this.sidebarBackground=new p.a({parent:"PostSidebar",hidden:!0,enablePixiRenderer:i.featureEnabled("post-pgm-poster"),colorPicker:d,disableImageFrames:!i.featureEnabled("post-pgm-poster"),cutoutEnabled:i.featureEnabled("post-enable-remove-background")}),this.sidebarLogo=new S.a({parent:"PostSidebar",hidden:!0,visibilityGroup:"local-sidebar"}),this.sidebarIcon=new k.a({parent:"PostSidebar",hidden:!0,visibilityGroup:"local-sidebar",colorPicker:d}),this.sidebarMultiselect=new I.a({parent:"PostSidebar",hidden:!0,visibilityGroup:"local-sidebar",alignmentTypes:this.coreWrapper.getAlignmentTypes(),distributeTypes:this.coreWrapper.getDistributeTypes()}),this.sidebarGroup=new m.a({parent:"PostSidebar",hidden:!0,visibilityGroup:"local-sidebar"}),this.sidebarCrop=new u.a({parent:"PostSidebar",hidden:!0,visibilityGroup:"local-sidebar"}),this.changeImageModalPanel=new y.a({layout:"rows",parent:"PostSidebar",hidden:!0,panels:[{id:"PostImagePicker",size:"auto"}]}),this.changeImageModalPanel.remove=this.handleImageModalRemove,this.changeImageModalPanel.insert=this.handleImageModalInsert,this.changeIconModalPanel=new y.a({layout:"rows",parent:"PostSidebar",hidden:!0,panels:[{id:"PostIconPicker",size:"auto"}]}),this.changeIconModalPanel.remove=this.handleIconModalRemove,this.changeIconModalPanel.insert=this.handleIconModalInsert,this.libImageModalPanel=new y.a({id:"ChangeImageModalPanel",layout:"rows",parent:"PostSidebar",hidden:!0,panels:[{id:"PostLibImagePicker",size:"auto"}]}),this.libImageModalPanel.remove=()=>{this.libImageModalPanel.$el.hide()},this.libImageModalPanel.insert=()=>{this.libImageModalPanelInserted?this.libImageModalPanel.$el.show():(this.libImageModalPanel.parent.$el.append(this.libImageModalPanel.$el),this.libImageModalPanelInserted=!0)}}deletingCurrentDoc(){return this.coreWrapper&&(this.coreWrapper.cancelPendingSaves(),this.coreWrapper.requestSave(!0)),this.events.publish("ui:closeIsFromReturnToSpark",!0),this.waitForQuietSaveToFinish()}getFormaSizeData(){const e=this.coreWrapper.getRootForma().page;return{sizeID:e.sizeID,pageSize:e.pageSize,exportData:e.exportData}}handleSelectForma(){!this.coreWrapper.getSelectedForma()&&this.previousSelectedFormaId.length?(this.coreWrapper.selectFormaById({formaId:this.previousSelectedFormaId}),this.events.publish("ui:previousSelectedFormaId","")):(this.coreWrapper.deselect(),this.events.publish("ui:returnToGlobalSidebarState"))}handleIconModalInsert(){this.changeIconModalPanelInserted?this.changeIconModalPanel.$el.show():(this.changeIconModalPanel.parent.$el.append(this.changeIconModalPanel.$el),this.changeIconModalPanelInserted=!0)}handleIconModalRemove(){this.changeIconModalPanel.$el.hide()}handleBrandInvite(e,t){N.default.inviteToBrand(e,t,"post:editor")}handleImageModalInsert(){this.changeImageModalPanelInserted?this.changeImageModalPanel.$el.show():(this.changeImageModalPanel.parent.$el.append(this.changeImageModalPanel.$el),this.changeImageModalPanelInserted=!0)}handleImageModalRemove(){this.changeImageModalPanel.$el.hide()}handleNavTabSelected(e){"tabButtonLibraries"===this.selectedComponentName&&this.libImageModalPanel.hide(),this.sidebarLayout.isHidden()&&this.coreWrapper.disableAutomaticLayoutMode(),e&&(this.selectedComponentName=e,this.selectedTabComponent=this[e],this.brandIndicator&&(this.brandIndicator.show(),this.postControlStrip.update({panels:[{id:"PostBrandIndicatorContainer",size:"54px"},{id:"PostSidebar",size:"auto"}]})))}handleSelectThemeTab(){this.events.publish("ui:handleNavTabSelected","sidebarTheme"),"theme"!==this.sidebarGlobal.activeSidebarId()&&(this.sidebarGlobal.showSidebarWithId("theme"),this.sidebarTheme.setDefaultSelection(),this.updateListOfDesigns(),r.default.publish("editor:designFilterPressed"))}handleSelectPaletteTab(){this.events.publish("ui:handleNavTabSelected","sidebarPalette"),"palette"!==this.sidebarGlobal.activeSidebarId()&&(this.sidebarGlobal.showSidebarWithId("palette"),this.updateCurrentPalette({updateSelection:!0}),r.default.publish("editor:colorPressed"),this.coreWrapper.triggerEnteredPalette())}handleSelectLayoutTab(){this.events.publish("ui:handleNavTabSelected","sidebarLayout"),"layout"!==this.sidebarGlobal.activeSidebarId()&&(this.sidebarGlobal.showSidebarWithId("layout"),r.default.publish("editor:layoutPressed"))}handleSelectResizeTab(){this.events.publish("ui:handleNavTabSelected","sidebarResize"),"resize"!==this.sidebarGlobal.activeSidebarId()&&(this.sidebarGlobal.showSidebarWithId("resize"),r.default.publish("editor:resizePressed"))}handleSelectAnimationTab(){this.sidebarAnimation&&(this.events.publish("ui:handleNavTabSelected","sidebarAnimation"),"animation"!==this.sidebarGlobal.activeSidebarId()&&(this.updateSidebarAnimation(),this.sidebarGlobal.showSidebarWithId("animation"),r.default.publish("editor:animationPressed")))}handleSelectTextTab(e){const t=(e=e||{}).tabId||"type";this.sidebarText.showSidebarWithId(t),this.events.publish("ui:handleNavTabSelected","sidebarText"),this.designSurface.posterAdornments.handleTextTabSelected()}handleSelectBackgroundTab(e){e=e||{},this.sidebarBackground.isHiding()&&null==e.reselectWhenHiding?_.delay(()=>{e.reselectWhenHiding=!0,this.handleSelectBackgroundTab(e)},200):this.events.publish("ui:handleNavTabSelected","sidebarBackground")}handleSelectLogoTab(){r.default.publish("editor:logoSelected"),this.sidebarLogo.show()}handleSelectIconTab(e){e=e||{},r.default.publish("editor:iconSelected")}handleSelectMultiselectTab(e){const t=(e=e||{}).tabId||"multiple";this.sidebarMultiselect.showSidebarWithId(e.tabId),this.events.publish("ui:handleNavTabSelected","sidebarMultiselect"),"multiple"===t&&r.default.publish("editor:multiselectSelected")}handleSelectGroupTab(e){const t=(e=e||{}).tabId||"group";this.sidebarGroup.showSidebarWithId(e.tabId),this.events.publish("ui:handleNavTabSelected","sidebarGroup"),"group"===t&&r.default.publish("editor:groupSelected")}updateCurrentPalette(e){const t=this.coreWrapper.getColorPalette();this.sidebarPalette.setCurrentPalette(t,e)}updateListOfDesigns(e){var t=this.coreWrapper.getRetargetInfo();t.isInitialLoad=!!e,this.sidebarTheme.setDesigns(t)}updateSidebarAnimation(){this.sidebarAnimation&&this.sidebarAnimation.update()}updateCoreWrapper(e){this.coreWrapper=e}}},GKed:function(e,t,a){"use strict";a.r(t),a.d(t,"default",(function(){return M}));var i=a("Uwho"),s=a.n(i),o=a("8UVJ"),n=a.n(o),r=a("mpVL"),l=a("2ofD"),h=a.n(l),d=a("bBG2"),p=a("ZXGz"),c=a.n(p),u=a("jo99"),b=a.n(u),m=a("uZvm"),g=a.n(m),v=a("rJP3"),T=a("MGCh"),S=a.n(T),P=a("HetE"),k=a("tpS0"),w=a.n(k),I=a("3xm6"),f=a.n(I);function C(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,i)}return a}function B(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?C(Object(a),!0).forEach((function(t){D(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):C(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function D(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}const A=S.a.channel("AssetRailUIModule");class M{constructor({events:e,coreWrapper:t,controller:a,uiStateController:i,postFeatureController:o,entitlementController:l,ExperimentEngine:h,editingMode:d,postEditorView:p,waitForSaveToFinish:u,waitForQuietSaveToFinish:m,designSurface:v,premiumBadgeVariant:T,userIsPremium:S,dragAndDropEnabled:k}){D(this,"assetRail",void 0),D(this,"sidebarTemplates",void 0),D(this,"imagePicker",void 0),D(this,"iconPicker",void 0),D(this,"libImagePicker",void 0),D(this,"addTextSidebar",void 0),D(this,"designAssetsControllers",void 0),D(this,"controller",void 0),D(this,"coreWrapper",void 0),D(this,"uiStateController",void 0),D(this,"waitForQuietSaveToFinish",void 0),D(this,"postEditorView",void 0),D(this,"postFeatureController",void 0),D(this,"entitlementController",void 0),D(this,"ExperimentEngine",void 0),D(this,"designSurface",void 0),this.events=e,this.uiStateController=i,this.navWidth=80,this.panelLeft=this.navWidth,this.imagePickerPanelLeft=this.navWidth+1,this.panelWidth=312,this.coreWrapper=t,this.controller=a,this.postFeatureController=o,this.entitlementController=l,this.ExperimentEngine=h,this.postEditorView=p,this.waitForQuietSaveToFinish=m,this.designSurface=v,this.userIsPremium=S,this.premiumBadgeVariant=T,this.librariesLabel=f.a.translate("app.assetRailNav.libraries"),this.deletingCurrentDoc=this.deletingCurrentDoc.bind(this),this.getFormaSizeData=this.getFormaSizeData.bind(this),this.handleAddTextContentButtonPress=this.handleAddTextContentButtonPress.bind(this),this.handleSelectLogoTab=this.handleSelectLogoTab.bind(this),this.showImageWarningPopUp=this.showImageWarningPopUp.bind(this),this.handleSelectLibrariesTab=this.handleSelectLibrariesTab.bind(this),this.clickCallback=this.clickCallback.bind(this),this.showADesignAssetsPicker=this.showADesignAssetsPicker.bind(this),this.showDesignAssetsPicker=this.showDesignAssetsPicker.bind(this),this.showBackgroundAssetsPicker=this.showBackgroundAssetsPicker.bind(this),this.showImagePicker=this.showImagePicker.bind(this),this.showIconPicker=this.showIconPicker.bind(this),this.showLibImagePicker=this.showLibImagePicker.bind(this),this.closeActivePanel=this.closeActivePanel.bind(this),this.handleSelectTemplatesTab=this.handleSelectTemplatesTab.bind(this),this.events.subscribe("ui:handleSelectTemplatesTab",this.handleSelectTemplatesTab),this.events.subscribe("ui:handleSelectLibrariesTab",this.handleSelectLibrariesTab),this.events.subscribe("ui:showLibImagePickerLibraries",()=>{this.libImagePicker.showLibraries()}),this.events.subscribe("ui:showADesignAssetsPicker",this.showADesignAssetsPicker),this.events.subscribe("ui:showDesignAssetsPicker",this.showDesignAssetsPicker),this.events.subscribe("ui:showBackgroundAssetsPicker",this.showBackgroundAssetsPicker),this.events.subscribe("ui:showImagePicker",this.showImagePicker),this.events.subscribe("ui:showIconPicker",this.showIconPicker),this.events.subscribe("ui:showLibImagePicker",this.showLibImagePicker),this.events.subscribe("ui:handleSelectLogoTab",this.handleSelectLogoTab),this.events.subscribe("ui:closeActiveAssetPanel",this.closeActivePanel),this.events.subscribe("ui:showHideComponent",({componentName:e,display:t})=>{this[e]&&(t?this[e].show():this[e].hide())}),this.itemsList=["text","photos","icons","designAssets","backgrounds","logos","libraries"],d!==P.EditingModes.TEMPLATE&&this.itemsList.unshift("templates");const w={uiStateController:i,userIsPremium:S,premiumBadgeVariant:T,dragAndDropEnabled:k,searchHost:s.a.sparkContentAssetSearchHost,loaded:this.designAssetsDataControllerLoaded};this.designAssetsControllers={designAssets:new r.d(B(B({},w),{},{topL1:"designAssets"})),backgrounds:new r.d(B(B({},w),{},{topL1:"backgrounds"}))},this.assetRail=new n.a({parent:"PostAssetRailStrip",id:"PostAssetRailUI",navList:this.itemsList,height:"100%",width:this.navWidth,clickCb:this.clickCallback,panelCloseCb:e=>{this.panelClosed(e)},parentController:a,designAssetsControllers:this.designAssetsControllers}),this.assetRail.bind(),-1!==this.itemsList.indexOf("templates")&&(this.sidebarTemplates=new g.a({waitForSaveMethod:u,waitForQuietSaveMethod:m,deletingCurrentDoc:this.deletingCurrentDoc,imageWrapper:v.imageWrapper,parent:"PostAssetRailStrip",poster:v.poster,hidden:!0,width:this.panelWidth+1,left:this.panelLeft,showResizeOption:o.featureEnabled("post-templates-show-resize"),getDocSize:this.getFormaSizeData,onClose:()=>{this.panelClosed("templates")}})),this.imagePicker=new c.a({parent:"PostAssetRailStrip",waitForSaveMethod:u,hidden:!0,width:this.panelWidth,left:this.imagePickerPanelLeft,onClose:()=>{this.imagePicker.$el.detach(),this.panelClosed("photos")}}),this.iconPicker=new c.a({parent:"PostAssetRailStrip",waitForSaveMethod:u,hidden:!0,sources:[],assetType:"vector",image_filter:[".svg","image/svg+xml"],label:"Choose icon",width:this.panelWidth,left:this.imagePickerPanelLeft,onClose:()=>{this.iconPicker.$el.detach(),this.panelClosed("icons")}}),this.addTextSidebar=new b.a({parent:"PostAssetRailStrip",hidden:!0,width:this.panelWidth+1,left:this.panelLeft,onAddText:()=>{this.events.publish("ui:handleAddTextButtonPress")},advancedTextLayoutEnabled:!0,advancedTextLayoutWebEnabled:!0,onClose:()=>{this.panelClosed("text")}}),this.libImagePicker=new c.a({parent:"PostAssetRailStrip",id:"PostAssetRailLibrariesPicker",waitForSaveMethod:u,width:this.panelWidth,left:this.imagePickerPanelLeft,hidden:!0,label:this.librariesLabel,homeLabel:this.librariesLabel,standAlonePicker:!0,onClose:()=>{this.libImagePicker.$el.detach(),this.panelClosed("libraries")}})}setUiStateController(e){this.uiStateController=e,Object.values(this.designAssetsControllers).forEach(t=>{t.uiStateController=e})}getNavPanel(e){return this.assetRail.el.shadowRoot.getElementById("assetRailNavPanel."+e)}getNavButtonFromItem(e){if(e){const t=this.assetRail.el.shadowRoot.querySelector("theo-asset-rail-nav").shadowRoot.querySelector("theo-navbar").shadowRoot.querySelectorAll("theo-light-button");return Array.from(t).find(t=>t.iconName===e.iconName)}}panelAutoShown(e){this.panelId&&this.panelId!==e&&this.closePanel(this.panelId),this.panelOpened(e),this.setSelectedIdState(e)}resetDesignAssetsToTop(e){this.designAssetsControllers[e].resetToTop()}ifValidPanelId(e){return this.resetDesignAssetsToTop("designAssets"),this.resetDesignAssetsToTop("backgrounds"),-1===this.itemsList.indexOf(e)?(this.panelId&&(this.closePanel(this.panelId),this.panelId=void 0,this.setSelectedIdState("")),!1):(this.assetRail.bind(),!0)}panelClosed(e){this.panelId===e&&(this.setSelectedIdState(""),this.panelId=void 0,this.events.publish("ui:handleAssetRailPanelClosed",e),this.events.publish("ui:exitReplaceMode"))}panelOpened(e){this.panelId=e,this.events.publish("ui:handleAssetRailPanelOpened",e)}closePanel(e){switch(e){case"photos":this.imagePicker.hide(),this.imagePicker.$el.detach();break;case"icons":this.iconPicker.hide(),this.iconPicker.$el.detach();break;case"libraries":this.libImagePicker.hide(),this.libImagePicker.$el.detach();break;case"text":this.addTextSidebar.hide();break;case"templates":this.sidebarTemplates.hide()}}closeActivePanel(){this.panelId&&(this.closePanel(this.panelId),this.panelClosed(this.panelId))}triggerUpgradePopoverIfNeededByItem(e){let t=!1;if(this.userIsPremium||"logos"!==e.id||(t=!0),t){const t=this.getNavButtonFromItem(e);return this.events.publish("ui:handleAssetRailShowUpgradePopover",e.id,t),!0}return!1}clickCallback(e){if(e.id===this.panelId)return this.closePanel(e.id),void this.panelClosed(e.id);this.openPanel(e)}setSelectedIdState(e){this.uiStateController&&this.uiStateController.handleAssetRailNavChanged(e)}openPanel(e){if(this.triggerUpgradePopoverIfNeededByItem(e))return void this.setSelectedIdState(this.panelId||"");const t=this.panelId;e.id!==t&&t&&this.closePanel(t),d.default.publish(`editor:${e.id}Pressed`,{sparkFormat:"post"}),this.setSelectedIdState(e.id);let a=!0;switch(e.id){case"photos":this.showImagePicker();break;case"icons":this.showIconPicker();break;case"libraries":a=!1,this.handleSelectLibrariesTab();break;case"text":this.handleAddTextContentButtonPress();break;case"logos":this.logoTabSelected();break;case"templates":a=!1,this.handleSelectTemplatesTab();break;case"designAssets":this.showDesignAssetsPicker(e.appConfig,t);break;case"backgrounds":this.showBackgroundAssetsPicker(e.appConfig,t);break;default:a=!1}a&&this.panelOpened(e.id)}showADesignAssetsPicker(e){if(e&&e.context&&e.context.search_props)try{const t=JSON.parse(e.context.search_props);e.context.search_props=t;if("backgrounds"===(t.path&&t.path.split("/")[1]||"Design Assets").toLowerCase())return void this.showBackgroundAssetsPicker(e)}catch(t){A.warn("_showADesignAssetsPicker error parsing searchProps",{error:t,searchProps:e.context.search_props})}this.showDesignAssetsPicker(e)}showDesignAssetsPicker(e,t){e&&this.panelAutoShown("designAssets"),e=e||{keepPreviousState:!!t},this.designAssetsControllers.designAssets.showingFromSearchPropsEvent(e)}showBackgroundAssetsPicker(e,t){e&&this.panelAutoShown("backgrounds"),e=e||{keepPreviousState:!!t},this.designAssetsControllers.backgrounds.showingFromSearchPropsEvent(e)}_getRandomIconSearchTerm(){let e=["badge","fun","spark","circle","singer","arrow","heart","star","flower","rectangle","love","party","triangle","square","oval","phone","food","sun"];this.postFeatureController.featureEnabled("use-translation-service-for-icon-search")&&(e=["iconSearch.kBadge","iconSearch.kFun","iconSearch.kSpark","iconSearch.kCircle","iconSearch.kSinger","iconSearch.kArrow","iconSearch.kHeart","iconSearch.kStar","iconSearch.kFlower","iconSearch.kRectangle","iconSearch.kLove","iconSearch.kParty","iconSearch.kTriangle","iconSearch.kSquare","iconSearch.kOval","iconSearch.kPhone","iconSearch.kFood","iconSearch.kSun"]);var t=Math.floor(Math.random()*(e.length+1));return f.a.translate(e[t])}showIconPicker(e){e&&this.panelAutoShown("icons"),e=e||{},this.iconPicker.haveDoneDefaultSearch||(e.context=e.context||{class_name:"DooploImagePickerContext"},e.context.search_string||(e.context.search_string=this._getRandomIconSearchTerm(),this.iconPicker.haveDoneDefaultSearch=!0)),this.iconPicker.show(e),this.iconPicker.removeSelection(),e.label&&this.iconPicker.setTitle(e.label),e.setHome&&this.iconPicker.home(),this.iconPicker.setCloseButtonVisibility(!e.disallowClose)}showImagePicker(e){e&&this.panelAutoShown("photos"),"boolean"!=typeof(e=e||{}).disallowClose&&(e.disallowClose=!1),this.imagePicker.show(e),this.imagePicker.removeSelection(),e.label&&this.imagePicker.setTitle(e.label),e.setHome&&this.imagePicker.home(),this.imagePicker.setCloseButtonVisibility(!e.disallowClose)}showLibImagePicker(e){e&&this.panelAutoShown("libraries"),"boolean"!=typeof(e=e||{}).disallowClose&&(e.disallowClose=!1),this.libImagePicker.show(e),this.libImagePicker.removeSelection(),e.label&&this.libImagePicker.setTitle(e.label),e.setHome&&this.libImagePicker.home(),this.libImagePicker.setCloseButtonVisibility(!e.disallowClose)}deletingCurrentDoc(){return this.coreWrapper&&(this.coreWrapper.cancelPendingSaves(),this.coreWrapper.requestSave(!0)),this.events.publish("ui:closeIsFromReturnToSpark",!0),this.waitForQuietSaveToFinish()}getFormaSizeData(){const e=this.coreWrapper.getRootForma().page;return{sizeID:e.sizeID,pageSize:e.pageSize,exportData:e.exportData}}handleSelectTemplatesTab(){this.panelOpened("templates"),this.sidebarTemplates.handleParentResize({left:this.panelLeft,width:this.panelWidth+1}),this.sidebarTemplates.show()}handleSelectLogoTab(){this.panelAutoShown("logos"),this.logoTabSelected()}logoTabSelected(){d.default.publish("logoSidebarDisplayed")}updateListOfBrandKitLogos(e){const t={},{primaryLogoPromise:a,secondaryLogoPromises:i,belongsToUser:s}=e;if(t.disableAddLogo=!s,a?a.then(e=>{const a={id:e.id,url:e.fullResUrl};t.primaryLogo=a,this.uiStateController.handleLogoPanelChanged(t)},(function(e){A.warn("could not load primary logo",e)})):(t.primaryLogo=null,this.uiStateController.handleLogoPanelChanged(t)),i&&i.length){let e=[];i.forEach(a=>{a.then(a=>{const i={id:a.id,url:a.fullResUrl};e=[...e,i],t.secondaryLogos=e,this.uiStateController.handleLogoPanelChanged(t)},(function(e){A.warn("could not load a secondary logo",e)}))})}else t.secondaryLogos=[],this.uiStateController.handleLogoPanelChanged(t)}handleAddTextContentButtonPress(){this.coreWrapper.triggerTextSidebarDisplayed(),this.events.publish("ui:showHideComponent",{componentName:"addTextSidebar",display:!0})}handleSelectLibrariesTab(){const e={};this.coreWrapper.canAddMoreImages(1)?(this.panelOpened("libraries"),window.marvel.features.setUserFlag("post-user-has-used-libraries",!0),e.setHome=!1,e.label=this.librariesLabel,this.events.publish("ui:showLibImagePicker",e),this.events.publish("ui:showLibImagePickerLibraries")):this.showImageWarningPopUp()}showImageWarningPopUp(){const e=new w.a({headerText:"i18n.dialogs.tooManyImages.kHeaderText",contentText:"i18n.dialogs.tooManyImages.kContentText",dismissable:!0,buttons:[{class:"pill pill-primary-on-light",label:"OK",onClick:()=>{e.hide()}}]});e.show()}updateAddContentLogoButtonEnabledState(){let e=!0;if(!h.a.currentDoc.belongsToUser()){const t=v.default.currentBrandKit();t&&!1!==v.default.getCurrentBrandElements().showBrandInUI&&t.getLogosSync().length||(e=!1)}e?this.addContentLogoButton.enable():this.addContentLogoButton.disable()}}},JoFX:function(e,t,a){"use strict";a.r(t);var i=a("UzQk"),s=a("MGCh"),o=a.n(s),n=a("bBG2"),r=a("3xm6"),l=a.n(r),h=a("YLtl");function d(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}const p=o.a.channel("text-edit");class c{constructor(){d(this,"coreWrapper",null),d(this,"uiStateController",null),d(this,"active",!1),d(this,"focusSessionId",0),d(this,"charStyleRanges",null),d(this,"throttledTextSetter",void 0),this.throttledTextSetter=Object(h.throttle)(e=>{this.setText(e)},400,{leading:!0})}initialize(e,t){this.coreWrapper=e,this.uiStateController=t}handleTextChange(e,t,a,s){if(t>=0&&this.coreWrapper){var o;const e=new i.TextRange(t,a);this.charStyleRanges=null===(o=this.coreWrapper)||void 0===o?void 0:o.updateCharStyleRanges(e,s,this.charStyleRanges)}this.throttledTextSetter&&this.throttledTextSetter(e)}handleDoubleTapToEditText(e){var t;null===(t=this.uiStateController)||void 0===t||t.handleDoubleTapToEditText(e)}handleTextControlFocusedIn(e){this.active?p.warn("Got focus in twice."):(this.active=!0,e&&n.default.publish(i.AnalyticsConstants.kAnalyticsDataTextDoubleTapEnterTextEditor,{contextualData1:"method: textBox"}))}handleTextControlFocusedOut(e,t){var a;if(this.active||p.warn(`Got focus out without focus in. Text ${t?"was":"was not"} modified.`),this.active=!1,null===(a=this.throttledTextSetter)||void 0===a||a.flush(),this.charStyleRanges=null,t){var i;if(c.isEmptyString(e))this.setDefaultText();else this.logTextEditedEvent(),null===(i=this.coreWrapper)||void 0===i||i.events.publish("design-updated",{formaAdded:!1,undoRedo:!1});this.focusSessionId+=1}}onFocusTextRequestHandled(){var e;null===(e=this.uiStateController)||void 0===e||e.onFocusTextRequestHandled()}handleSelectionChanged(){this.active&&(p.warn("Kept focus though selection changed? Manually ending focus session."),this.active=!1)}static isEmptyString(e){return""===e||""===e.trim()}setDefaultText(){const e=l.a.translate("app.textPanel.addNewText");this.setText(e)}setText(e){var t,a;const s=null===(t=this.coreWrapper)||void 0===t?void 0:t.getSelectedForma();if(!s)return void p.error("Asked to set text when there is no selected forma");const o=null===(a=this.coreWrapper)||void 0===a?void 0:a.getTextForSelectedLockup(),n=`${s.formaID}-${this.focusSessionId}`;var r;if(c.isEmptyString(e))null===(r=this.coreWrapper)||void 0===r||r.setTextForLockup(s,i.TextFacade.kEmptyLockupString,this.charStyleRanges,n,!0);else if(e!==o){var l,h;const t=null===(l=this.coreWrapper)||void 0===l?void 0:l.getCurrentTimelineState(),a=t&&t.action&&"k_set_text"===t.action.description&&t.action.scope===n;null===(h=this.coreWrapper)||void 0===h||h.setTextForLockup(s,e,this.charStyleRanges,n,!!a)}}getShapeNameForAnalytics(e){switch(e.backing){case i.LockupBacking.None:return"none";case i.LockupBacking.Rows:return"row";case i.LockupBacking.BannerHorizontal:return"bannerHorizontal";case i.LockupBacking.BannerVertical:return"bannerVertical";case i.LockupBacking.Knockout:return"knockout";case i.LockupBacking.LegacyShadow:return"none";default:if(e.backingArtworkID)return e.backingArtworkID}return"none"}logTextEditedEvent(){var e,t;const a=null===(e=this.coreWrapper)||void 0===e?void 0:e.getSelectedForma(),s=null===(t=this.coreWrapper)||void 0===t?void 0:t.getTextForSelectedLockup();if(s){const e=s.length.toString(),t=null==a?void 0:a.source;if(t&&i.FormaSourceUtils.isDesignIngredient(t)){const a=i.BadgeFacade.getDesignIngredientIDAndType(t);this.logEvent("designIngredient:textEdited",{contextualData1:"id:"+a.id,contextualData2:"type:"+a.type,contextualData7:"lengthOfText:"+e})}else{var o;const t=null==a?void 0:a.style,i=null==t||null===(o=t.font)||void 0===o?void 0:o.fontData.postScriptName,s=this.getShapeNameForAnalytics(t);this.logEvent("editor:textEditCompleted",{contextualData7:"lengthOfText:"+e,contextualData10:"fontName:"+i,contextualData12:"shapeName:"+s})}}}logEvent(e,t){n.default.publish(e,t)}}const u=new c;t.default=u},Omfs:function(e,t,a){"use strict";a.r(t),a.d(t,"default",(function(){return l}));a("Uwho"),a("bBG2");var i=a("2Fsf"),s=a.n(i),o=a("65r0"),n=a("MGCh"),r=a.n(n);a("GSfz");r.a.channel("BottomBarUIModule"),Object(o.a)();class l{constructor(){var e,t,a;a=void 0,(t="tourWrapper")in(e=this)?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,this.tourWrapper=new s.a({parent:"PostBottomBar",id:"TourWrapper",class:"tour-wrapper",height:"66px",width:"100%"})}}},el3O:function(e,t,a){"use strict";a.r(t),a.d(t,"default",(function(){return g}));a("2ofD"),a("bBG2");var i=a("Avqh"),s=a.n(i),o=(a("+VG/"),a("WPh2")),n=a.n(o),r=a("sggK"),l=a.n(r),h=a("hSNs"),d=a.n(h),p=(a("2Fsf"),a("M1RA"),a("rJP3"),a("MGCh")),c=a.n(p),u=a("HetE");function b(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}const m=c.a.channel("NavStripUIModule");class g{constructor({events:e,coreWrapper:t,postFeatureController:a,entitlementController:i,ExperimentEngine:o,editingMode:r,postEditorView:h}){b(this,"navStripTabsWrapper",void 0),b(this,"globalTabsWrapper",void 0),b(this,"tabButtonTheme",void 0),b(this,"tabButtonPalette",void 0),b(this,"tabButtonLayout",void 0),b(this,"tabButtonResize",void 0),b(this,"tabButtonAnimation",void 0),b(this,"backgroundTabsWrapper",void 0),b(this,"tabButtonBackgroundImage",void 0),b(this,"logoTabsWrapper",void 0),b(this,"tabButtonLogo",void 0),b(this,"languageSwitcher",void 0),b(this,"iconTabsWrapper",void 0),b(this,"tabButtonIcon",void 0),b(this,"coreWrapper",void 0),b(this,"postEditorView",void 0),b(this,"postFeatureController",void 0),b(this,"entitlementController",void 0),b(this,"ExperimentEngine",void 0),this.events=e,this.coreWrapper=t,this.postFeatureController=a,this.entitlementController=i,this.ExperimentEngine=o,this.postEditorView=h,this.handleTrySelectResizeTab=this.handleTrySelectResizeTab.bind(this),this.navStripTabsWrapper=new s.a({parent:"PostNavStrip",id:"PostNavStripTabsWrapper"}),this.globalTabsWrapper=new l.a({parent:"PostNavStripTabsWrapper",id:"PostGlobalTabsWrapper",visibilityGroup:"nav-tabs",tabGroup:"global-tabs",defaultActive:!0,rememberLastTab:!0,onShown:()=>{this.coreWrapper.deselect()}}),this.tabButtonPalette=new n.a({parent:"PostGlobalTabsWrapper",label:"i18n.components.buttons.kColors",id:"sectionTabPalette",group:"global-sidebar-tabs",onSelect:()=>{this.events.publish("ui:handleSelectPaletteTab")},handleClickOnSelected:()=>{this.events.publish("ui:handleNavTabClosed")}}),this.globalTabsWrapper.registerTab(this.tabButtonPalette),u.WebAnimationEnabled&&(this.tabButtonAnimation=new n.a({parent:"PostGlobalTabsWrapper",label:"i18n.components.buttons.kAnimation",id:"sectionTabAnimation",group:"global-sidebar-tabs",defaultSelected:!1,onSelect:()=>{this.events.publish("ui:handleSelectAnimationTab")},handleClickOnSelected:()=>{this.events.publish("ui:handleNavTabClosed")}}),this.globalTabsWrapper.registerTab(this.tabButtonAnimation)),this.tabButtonLayout=new n.a({parent:"PostGlobalTabsWrapper",label:"i18n.components.buttons.kBackground",id:"sectionTabLayout",group:"global-sidebar-tabs",defaultSelected:!1,onSelect:()=>{this.events.publish("ui:handleSelectLayoutTab")},handleClickOnSelected:()=>{this.events.publish("ui:handleNavTabClosed")}}),this.globalTabsWrapper.registerTab(this.tabButtonLayout),this.tabButtonResize=new n.a({parent:"PostGlobalTabsWrapper",label:"i18n.components.buttons.kResize",id:"sectionTabResize",group:"global-sidebar-tabs",defaultSelected:!1,isPremium:this.postFeatureController.featureEnabled("post-resize-is-paid-feature")&&r!==u.EditingModes.TEMPLATE,isEntitled:this.entitlementController.isEntitledToFeature("postResizeButton"),onTrySelect:this.handleTrySelectResizeTab,onSelect:()=>{this.events.publish("ui:handleSelectResizeTab")},handleClickOnSelected:()=>{this.events.publish("ui:handleNavTabClosed")}}),this.globalTabsWrapper.registerTab(this.tabButtonResize),r!==u.EditingModes.TEMPLATE&&(this.tabButtonTheme=new n.a({parent:"PostGlobalTabsWrapper",label:"i18n.components.buttons.kDesign",id:"sectionTabTheme",group:"global-sidebar-tabs",defaultSelected:!0,onSelect:()=>{this.events.publish("ui:handleSelectThemeTab")},handleClickOnSelected:()=>{this.events.publish("ui:handleNavTabClosed")}}),this.globalTabsWrapper.registerTab(this.tabButtonTheme)),this.backgroundTabsWrapper=new l.a({parent:"PostNavStripTabsWrapper",id:"PostBackgroundTabsWrapper",visibilityGroup:"nav-tabs",tabGroup:"background-tabs",defaultActive:!1,onHidden:()=>{this.events.publish("ui:showHideComponent",{componentName:"sidebarBackground",display:!1})},onShown:()=>{this.events.publish("ui:onSwitchToAnyLocalTabSet")}}),this.tabButtonBackgroundImage=new n.a({parent:"PostBackgroundTabsWrapper",label:"i18n.components.buttons.kImage",id:"sectionTabBackground",group:"local-sidebar-tabs",onSelect:()=>{this.events.publish("ui:handleSelectBackgroundTab",{tabId:"image"});const e=this.coreWrapper.getSelectedForma();e&&!e.isImage()&&this.events.publish("ui:showImagePicker",{disallowClose:!0,setHome:!0})}}),this.backgroundTabsWrapper.registerTab(this.tabButtonBackgroundImage),this.logoTabsWrapper=new l.a({parent:"PostNavStripTabsWrapper",id:"PostLogoTabsWrapper",visibilityGroup:"nav-tabs",tabGroup:"logo-tabs",defaultActive:!1,onHidden:()=>{this.events.publish("ui:showHideComponent",{componentName:"sidebarLogo",display:!1})},onShown:()=>{this.events.publish("ui:onSwitchToAnyLocalTabSet")}}),this.tabButtonLogo=new n.a({parent:"PostLogoTabsWrapper",label:"i18n.components.buttons.kLogo",id:"sectionTabLogo",group:"local-sidebar-tabs",onSelect:()=>{this.events.publish("ui:handleSelectLogoTab")}}),this.logoTabsWrapper.registerTab(this.tabButtonLogo),this.iconTabsWrapper=new l.a({parent:"PostNavStripTabsWrapper",id:"PostIconTabsWrapper",visibilityGroup:"nav-tabs",tabGroup:"icon-tabs",defaultActive:!1,onHidden:()=>{this.events.publish("ui:showHideComponent",{componentName:"sidebarIcon",display:!1})},onShown:()=>{this.events.publish("ui:onSwitchToAnyLocalTabSet")}}),this.postFeatureController.featureEnabled("post-language-switcher")&&(this.languageSwitcher=new d.a({parent:"PostNavStrip",id:"PostLanguageSwitcher"}));let p="i18n.components.buttons.kIcon";this.ExperimentEngine.run("IconShapeExperiment",{shape_for_icon_label:()=>{p="i18n.components.buttons.kShape"},control:()=>{}}).then(()=>{this.tabButtonIcon=new n.a({parent:"PostIconTabsWrapper",label:p,id:"sectionTabIcon",group:"local-sidebar-tabs",onSelect:()=>{this.events.publish("ui:handleSelectIconTab",{tabId:"icon"})}}),this.iconTabsWrapper.registerTab(this.tabButtonIcon)}).done()}handleTrySelectResizeTab(){return this.events.publish("editor:resizePressed"),this.ExperimentEngine.run("PostResize").catch(e=>{m.error("Ran into error with PostResize experiment",e)}).done(),!this.postFeatureController.featureEnabled("post-resize-is-paid-feature")||this.entitlementController.tryPremiumFeature({$element:this.tabButtonResize.$el,position:"left",touchpointName:"postResizeButton"})}updateCoreWrapper(e){this.coreWrapper=e}deselectSelectedTabs(){this.globalTabsWrapper.deselectSelected()}}},hu6S:function(e,t,a){"use strict";var i=a("qcxC"),s=a("MGCh"),o=a.n(s),n=a("tpS0"),r=a.n(n),l=a("yiIM");const h=o.a.channel("save-utils");t.a=new class{verifyAndSetCurrentDocumentExportedState(e,t){const a=e.getDataFromRoot("cp#isExported"),i=t.getIsExported();"boolean"==typeof i&&i!==a&&t.setIsExported(a)}checkImageFormaeForNull(e){for(const t of e)null==t.contentNode?h.error("saving image with no contentNode"):null==t.contentNode.url&&h.error("saving image with no url")}reloadIfNavigatedAway(){l.a.getLocationPathname().includes("/design/post/")||l.a.reload()}reload(e,t,a){a&&t&&t.cancelPendingSaves(),Object(i.default)().resolve(),l.a.reload()}waitForSaveDocumentToFinish(e,t,a=!0,i){const s="string"==typeof i?i:"i18n.app.kSavingPost";let o;a&&(o=new r.a({id:"WaitForSaveOverlay",headerText:s,contentText:'<div class="postspinner postspinner-large"></div>',dismissable:!1}),o.show());const n=setTimeout(()=>{h.warn("Save timed out, manually resolving save promise to unblock user"),e.resolve()},12e4);return e.promise.finally(()=>{clearTimeout(n),o&&o.hide()}),e.promise}}}}]);
//# sourceMappingURL=theo-web-view_e504ac21-9dc0e1aa.js.map