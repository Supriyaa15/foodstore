(window.webpackJsonptheoWebApp=window.webpackJsonptheoWebApp||[]).push([[56],{"3xdQ":function(e,t,n){var o,r;function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){l(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const{CutoutMode:c}=n("UzQk"),{size:u}=n("YLtl"),{PixiJSRenderer:s}=n("wHG3");o=[n("YLtl"),n("UFvF"),n("MOGj"),n("MGCh"),n("rCSV"),n("bBG2"),n("a8ov"),n("r3b0"),n("U44B"),n("14LO"),n("UzQk"),n("mwMu"),n("qnb0"),n("TdwW"),n("9KYx"),n("ZLL8"),n("rJP3"),n("WpJZ"),n("hEO4"),n("KpqY"),n("6lgp"),n("2uFU"),n("+Ltv"),n("tWZ4"),n("FBIc"),n("LbXs"),n("wHG3"),n("yBTN"),n("7gWt"),n("LU24")],void 0===(r=function(e,t,n,o,r,a,l,u,s,d,g,m,f,p,h,S,F,y,C,v,k,T,b,A,I,L,w,P,M,x){const D=l.default,_=v.default,O=r.default,R=h.default,B=I.default,E=L.RefineCutoutBrushMode,N=M.SparkPerformanceTracker,U=x.PERFORMANCE_MARKERS,W=a.default,G=F.default,H=A.default,z=o.channel("core-wrapper"),V=P.default,{PixiJSRenderer:K}=w;return function(o){o=o||{};var r={};r.events=new O,r.ActionError=k.default,r.tourIsActive=!1,r.executingActionBarAction=!1;var a,l,h=null,F=!1,y=null,v=!1,A=null,I=null,L=null,w=null,P=[],M=null,x=0,j=g.TheoPoint.ZERO,Y=!1,Z=null,q=[],J=null,X=null,$=!1,Q=!1;r.monitorTransactions=function(){C.monitorTransactionsForDocument(h)},r.validateDoc=function(e){const t=g.TheoDocumentUtils.validateDoc(h,e);t&&z.error("validateDoc: "+t.errorMsg,t)},r.getManifestData=function(){return h.encodeToJSON()},r.getDocumentCCID=function(){return h.uuid||" "},r.bindToSaveManager=function(){h.controller.saveMgr.subscribeWithCallback((function(e){e.message===g.SaveMessage.SAVE_SCHEDULED?r.events.publish("update-save-promise",h.controller.saveMgr.pendingSave):e.message===g.SaveMessage.SAVE_COMPLETED&&r.events.publish("clean-up-after-save")}),g.SaveMessage.TYPE)};const ee=function(e,t){if(!e)return;let o;if(!!t){const r=(new n.AdobeDCXBranch).parse(JSON.stringify(e));r.compositeAssetId="temp";const a=n.newCompositeAsCopyOf(r),i=new d.DCXDocumentComposite({composite:a}),l=i.current;g.JSONDocumentDecoder.getRequiredSynchronousComponents(l).forEach(e=>{l.registerContentForComponent(e,t)}),o=g.TheoDocument.decodeDocument(i,null),l.releaseRegisteredContent()}else{const t=new u({makeComponentUrl:function(){return D.encodeDesignFilterComponentUrl()},trackAbsolutePath:!1,branch:e});o=g.TheoDocument.newDocumentFromDataObject(t,null)}return g.TheoDocumentUtils.createImageFeatures(o),o};r.getTemporaryDocumentWithFontsLoaded=function(e){var t=ee(e),n=t.missingFontList;return n.length?R.loadMissingFonts(n).then((function(){return ee(e)})):Promise.resolve(t)};var te=[];function ne(){te.forEach((function(e){e.unsubscribe()}));var t={};(te=[]).push(h.firstPage.subscribeWithCallback((function(n){0===--x&&(e.each(t,(function(e){(e.transform||e.geometry||e.style)&&r.events.publish("forma-dirty",e)})),r.events.publish("document-in-new-renderable-state"))}),g.FormaEndUpdateMessage.TYPE)),te.push(h.firstPage.subscribeWithCallback((function(e){if(0===x&&(t={}),e.event.forma){var n=e.event.forma.formaID,o=t[n];o||(t[n]=o={formaID:n}),e.event instanceof g.FormaTransformChangedEvent?o.transform=!0:e.event instanceof g.FormaGeometryChangedEvent?o.geometry=!0:e.event instanceof g.FormaStyleChangedEvent&&(o.style=!0)}x++}),g.FormaBeginUpdateMessage.TYPE)),te.push(h.controller.subscribeWithCallback((function(e){r.inCharStyleMode&&r.handleTapped({x:e.state.clickLocation.x,y:e.state.clickLocation.y,forma:e.state.forma})}),g.ClickMessage.TYPE)),te.push(h.controller.subscribeWithCallback((function(e){r.events.publish("layer-double-tapped")}),g.DoubleClickMessage.TYPE)),te.push(h.controller.model.subscribeWithCallback((function(e){e.changes.indexOf(g.EditorModelChangedMessage.CHG_SNAPLINES)>=0&&r.events.publish("update-snap-lines",{lines:h.controller.model.snapLines.getAll()}),e.changes.indexOf(g.EditorModelChangedMessage.CHG_HANDLES)>=0&&r.events.publish("update-handles"),e.changes.indexOf(g.EditorModelChangedMessage.CHG_SWAP_STATE)>=0&&r.events.publish("update-swap-state"),e.changes.indexOf(g.EditorModelChangedMessage.CHG_VIEW_STATE)>=0&&r.events.publish("update-view-state"),e.changes.indexOf(g.EditorModelChangedMessage.CHG_ACTION_FEEDBACK_STATE)>=0&&function(e){if(!e)return;switch(e.showWaiting){case g.ActionFeedbackWaitingType.Loading:r.events.publish("show-app-loading-indicator",H.ACTION_FEEDBACK);break;case g.ActionFeedbackWaitingType.None:r.events.publish("hide-app-loading-indicator",H.ACTION_FEEDBACK);break;default:g.LegacyCoreAssert.fail("Unknown value for showWaiting.")}null!=e.message&&r.events.publish("show-actionfeedback-message-modal",{messageType:e.messageType,messageObj:e.message})}(h.controller.model.actionFeedback.getActionFeedback()),e.changes.indexOf(g.EditorModelChangedMessage.CHG_ANNOTATIONS)>=0&&r.events.publish("update-annotations")}),g.EditorModelChangedMessage.TYPE))}function oe(e){return e?e.contentNode&&e.contentNode.url?D.decodeUrl(e.contentNode.url):(z.error("image forma has no contentNode or url"),null):(z.error("image forma is not defined"),null)}function re(){for(var e,t=h.controller.model.handles.getAll(),n=!1,o=null,a=[],i=null,l=null,c=null,u=null,s=null,d=!1,m=null,f=!1,p=0;p<t.length;p++){var S=t[p];if(S instanceof g.BoxTransformHandles){if(S instanceof g.BoxTransformMultipleFormae){o=[];for(var F=0;F<S.formaIDs.length;F++){var y=S.formaIDs[F],C=r.getFormaById(y);null!=C&&o.push({formaID:y,bounds:C.bounds,placement:C.totalPlacement,isGroup:!(!C.controller||!C.controller.userGroup)})}if(0===o.length&&(o=[{formaID:"group",placement:S.reference.placement,bounds:S.reference.bounds,isGroup:!0}]),d=S.displayHints.includes(g.BoxHandleDisplayHint.GroupOutlineColor),s=S.displayHints.includes(g.BoxHandleDisplayHint.WideOutline),null!=i)continue}u=S.displayHints.includes(g.BoxHandleDisplayHint.ThinOutline),d=S.displayHints.includes(g.BoxHandleDisplayHint.GroupOutlineColor),m=S.displayHints.includes(g.BoxHandleDisplayHint.TextFrame),f=S.displayHints.includes(g.BoxHandleDisplayHint.PreferLeftSideHandle);var v=r.inRefineCutoutMode()?[]:S.allowedTransforms;S.activeTransform===g.TransformType.Translate?(n=!0,v=[]):!m||S.activeTransform!==g.TransformType.LeftSideTranslate&&S.activeTransform!==g.TransformType.RightSideTranslate||(v=[]),v.forEach((function(e){var t=ge(e);t&&a.push(t)})),c=v.includes(g.TransformType.RotateAboutCenter)&&!S.displayHints.includes(g.BoxHandleDisplayHint.SuppressRotationHandle)&&(S.activeTransform===g.TransformType.None||S.activeTransform===g.TransformType.RotateAboutCenter),i=S.reference.placement,l=S.reference.bounds}}return null===i?null:(e=r.canNudge(),{matrix2d:i,bounds:l,enablePips:a.length>0,rotateable:c,nudgeable:e,handlePoints:a,thinOutline:u,wideOutline:s,transparentOutline:n,textFrame:m,preferLeftSideHandle:f,highlightRects:o,groupOutlineColor:d,inCropMode:r.inCropMode(),inCutoutMode:r.inRefineCutoutMode(),cutoutBrushMode:r.getCutoutBrushMode()})}function ae(e){if(e)return{forma:e,matrix2d:e.totalPlacement,bounds:e.bounds,showLeftLine:e.isRangeStart(),showRightLine:e.isRangeEnd()}}function ie(){var t=h.firstPage.colorLibraryController.getColorThemeAsArrayOfSolidColors();return e.map(t,(function(e){return e.red+":"+e.green+":"+e.blue})).join(":")}function le(t){return e.map(t,(function(e){var t=e.sprkElemId||e.id||null,n=e.sprkRoles||e.roles||null,o=p.rgb2SolidColor(e);return p.solidColor2TheoColor(o,t,n)}))}function ce(t){return e.map(t,(function(e){var t;return"string"==typeof e?(t=p.hex2SolidColor(e),p.solidColor2TheoColor(t,null,null)):(t=p.hex2SolidColor(e.color),p.solidColor2TheoColor(t,e.id,e.roles))}))}function ue(){return t.Promise((function(e){a.invalidatePatches(e)}))}var se=[{type:g.TransformType.TopLeftCornerTranslate,spot:new g.TheoPoint(0,0)},{type:g.TransformType.TopRightCornerTranslate,spot:new g.TheoPoint(1,0)},{type:g.TransformType.BottomLeftCornerTranslate,spot:new g.TheoPoint(0,1)},{type:g.TransformType.BottomRightCornerTranslate,spot:new g.TheoPoint(1,1)},{type:g.TransformType.TopSideTranslate,spot:new g.TheoPoint(.5,0)},{type:g.TransformType.BottomSideTranslate,spot:new g.TheoPoint(.5,1)},{type:g.TransformType.LeftSideTranslate,spot:new g.TheoPoint(0,.5)},{type:g.TransformType.RightSideTranslate,spot:new g.TheoPoint(1,.5)}];function de(e){const t=se.find(t=>t.spot.x===e.x&&t.spot.y===e.y);return t?t.type:null}function ge(e){const t=se.find(t=>t.type===e);return t?t.spot:null}function me(e){var t=e.getProperty("components"),n=t&&t.arrayValue&&t.arrayValue[0];return n&&n.dictionaryValue&&n.dictionaryValue.url&&n.dictionaryValue.url.stringValue}function fe(e){return e.catch((function(e){let t=e;t.isAllowedError||(e.errorMsg&&(t=e.errorMsg),z.error("doAction",t||"Unknown error!"),r.forceReloadEditor())}))}function pe(e,t){Se(e);let n=_.doAction(h,e);return!t&&r.shouldReloadOnActionFailure()&&(n=fe(n)),n}function he(e,t,n){Se(e);let o=_.doActionWithCompletion(h,e,t);return!n&&r.shouldReloadOnActionFailure()&&(o=fe(o)),o}function Se(e){if(r.tourIsActive){let n=!1,o=!1;const a=e.getUserAction(h.controller).description;switch(a){case"k_apply_template":case"k_set_color_palette":case"k_shuffle_color_palette":case"k_change_page_size":case"k_set_grid_layout":case"k_change_background_shape":case"k_set_text_look":case"k_set_text_effects":case"k_palette_change":case"k_branding_add":case"k_change_color":case"k_set_font":case"k_text_alignment":case"k_change_text_color":case"k_apply_char_style_without_ui":case"k_apply_filter":case"k_shuffle_filter":case"k_set_image_cutout":case"k_set_background_opacity":case"k_set_blendmode":case"k_replace_image_with_shape":case"k_image_adjustments":case"k_set_text":case"k_shuffle_background_shape":case"k_set_tracking":case"k_change_line_spacing":case"k_set_leading":case"k_padding":case"k_set_relative_font_scale":case"k_change_text_attributes":case"k_set_font_size":case"k_match_size":case"k_change_opacity":case"k_align_item":case"k_distribute_item":case"k_shuffle_color":case"k_replace_video_content":case"k_trim_video":case"k_fit_image":case"k_change_text_style":case"k_shuffle_grid_layout":case"k_set_layout_spacing":case"k_apply_text_style_wheel":case"k_apply_text_emphasis_suggestion":case"k_change_borders_margins":case"k_group":case"k_ungroup":case"k_flip_item":case"k_apply_animation_style":case"k_animation_style_for_playback":case"k_reset_animation":case"k_shuffle_animation":case"k_apply_and_prepare_animation":case"k_set_floating":case"k_set_background":case"k_update_cutout_mask":case"k_remove_cutout_mask_completely":case"k_invert_cutout_mask":case"k_applycutoutmask":case"k_applyrastermask":case"k_applyshapemask":case"k_crop_image_to_ratio":case"k_rotate_item":case"k_scale_item":case"k_video volume":case"k_video times":case"k_brandify":case"k_set_imagecrop_to_freeform":case"k_highlight_method":n=!0;break;case"k_enter_char_style":var t=r.getSelectedForma();t&&t.isTypeLockup()&&0===t.controller.charStyleRanges.length&&(n=!0);break;case"k_replace_image":case"k_replace_icon":r.executingActionBarAction||(n=!0);break;case"k_add_text":case"k_add_badge":case"k_add_image":case"k_add_icon":case"k_add_shape":case"k_add_video":o=!0;break;case"k_add_logo":r.executingActionBarAction||(e.replacing?n=!0:o=!0)}const i=a.substring(2).replaceAll("_","-").replaceAll(" ","-");n&&r.events.publish("edit-action-performed",{contextualData2:i}),o&&r.events.publish("add-action-performed",{contextualData2:i})}r.executingActionBarAction=!1}function Fe(){var e=r.getAllSelectedFormas();!1===h.controller.selection.inCharStyleMode&&!0===r.inCharStyleMode&&r.exitCharStyleMode(),0!==e.length&&e[0].isTypeLockup()||r.events.publish("text-forma-selected",{id:null,forma:null,selectionBoxes:[]}),e.length>0?r.events.publish("forma-selected",{id:e[0].formaID,forma:e[0],selectionBox:re()}):r.events.publish("forma-selected",{id:null,forma:null});X&&e&&e.length===X.length&&e.every((function(e,t){return e.id&&X[t].id&&e.id===X[t].id}))||r.events.publish("selection-changed",{}),X=e}function ye(e,t){e&&r.events.publish("forma-updated",{id:e.formaID,selected:r.getSelectedForma()&&e.formaID===r.getSelectedFormaId(),snapLines:t,selectionBox:re(),data:{forma:e}})}function Ce(e,t=!1){null==e&&(e=!0),r.events.publish("design-updated",{formaAdded:e,undoRedo:t})}function ve(e){return Math.atan2(e.transformValues.rotSine,e.transformValues.rotCosine)}function ke(e){for(var t=e.controller,n=[],o=1;o<t.owner.selection.selectedCount;o++){var a=t.owner.selection.formaAt(o);n.push(ae(a))}r.events.publish("text-forma-selected",{id:e.formaID,forma:e,selectionBoxes:n})}function Te(e){return!e||!(1!==e.length||!e[0]||"#NONE_COLOR"!==e[0].id)}function be(e,t){e&&t&&(e.selectCharStyleForma(),e.updateGroup(),Ce(!1),e.selectCharStyleForma(),ke(t))}function Ae(t){return t&&"image"===t.kind&&(!t.url||e.startsWith(t.url,"data:"))}function Ie(e,t,n){return(e-t.min)*(n.max-n.min)/(t.max-t.min)+n.min}return r.inCharStyleMode=!1,r.exitingCharStyleMode=!1,r.generateKeyFrames=function(){var e=r.beginTransaction("revertAnimationPlay"),t=g.MotionUtils.getCurrentAnimationStyle(h);g.AnimationFacade.applyAnimationStyle(t,h.firstPage),r.endTransactionAndMergeWithPrevious(e),Ce(!1)},r.getGraph=function(e,t){void 0===t&&(t=r.getWatermarkEnabledForDoc());const n=h.firstPage.pgm.getGraph(e?g.PGMExportSettings.DYNAMIC:g.PGMExportSettings.STATIC);return t?g.PGMWatermarkingUtils.addWatermark(n):n},r.validateDBSaveState=function(t){const n=h.database.getState(t);for(var o=0;o<q.length;o++){var r=n.getObjectStateByID(q[o]);if(r){var a=r.object;if("image"===a.kind){const t=me(r);if(!t||e.startsWith(t,"data:"))return!1}else if("vector"===a.kind){if("uploading svg"===me(r))return!1}}}return!0},r.saveWithRenditions=function(e,t,n){return w.saveWithRenditions(h,e,t,n)},r.saveCopyWithRenditions=function(e,t,n){return e.saveWithRenditions(h,t,n)},r.saveImageComponent=function(e,t,n,o,r){return w.saveImageComponent(e,t,n,o,r)},r.initializeNewPost=function(n){var o,a=g.TypeLockupUtils.fixUpQuotes(n.text,""),i=n.palette,l=r.imageFormas(),c=t.defer(),u=r.hostImages(),s=e.map(u,(function(e){return e.imgLoadedPromise}));if(l.length>=1)Promise.all(s).then((function(){const e=r.beginTransaction("create_initial_theme_from_image");h.firstPage.colorLibraryController.createInitialThemeFromImage(),c.resolve(),r.endTransaction(e)}));else{if(n.defaultBackgroundColor){var d=h.firstPage.root.filterByKind(g.ShapeForma.KIND),m=d&&d[0];m&&(o={shape:m,color:n.defaultBackgroundColor})}r.setColorPalette({colors:i,id:"0"},{shuffle:!o}).then(c.resolve)}return c.promise.then((function(){if(o){var e=r.beginTransaction("set_color_id");o.shape.style.colors.setColorId(g.ColorRole.FieldPrimary,o.color),r.endTransactionAndMergeWithPrevious(e,!0)}return 0===r.lockupFormas().length?a.length?(r.downloadNewLockupRandomFontsAsync(),r.addNewLockup(a,{silent:!0,select:!!n.selectText})):t.resolve():(z.error("initializeNewPost error. We shouldn't be adding multiple lockups. Probably git issue 2093."),t.resolve())})).then((function(){return l.length>1?pe(new g.CreatePaddedCollageAction).then((function(){Ce(!1)})):t.resolve()})).then((function(){return r.retrieveAndApplyASuggestedGridStyle()})).then((function(){r.requestSave()}))},r.resetUserActions=function(){a.reset()},r.undoToInitialState=function(){return t.Promise((function(e,t){a.setCurrentTimelineIndex(0,e)}))},r.beginBranch=function(){a.beginBranch()},r.endBranch=function(e){a.endBranch(e)},r.beginGesture=function(e){const t=r.getSelectedFormaPlacement();return J=t?t.placement:null,a.beginGesture(e),a.gestureScope},r.endGesture=function(e){J=null,a.endGesture(e)},r.gestureInProgress=function(){return null!==a.gestureScope},r.undo=function(){return t.Promise((function(e,t){a.undo((function(){r.events.publish("undo-finished"),r.inRefineCutoutMode()&&Z.handleUndoRedo(),e()}))}))},r.redo=function(){return t.Promise((function(e,t){a.redo((function(){r.events.publish("redo-finished"),r.inRefineCutoutMode()&&Z.handleUndoRedo(),e()}))}))},r.canUndo=function(){return a.getCurrentTimelineIndex()>0&&0===a.getActionDepth()&&!r.gestureInProgress()},r.canRedo=function(){return a.getCurrentTimelineIndex()<a.getTimelineLength()-1&&0===a.getActionDepth()&&!r.gestureInProgress()},r.getUndoDescription=function(){return a.getUndoDescription()},r.getRedoDescription=function(){return a.getRedoDescription()},r.getCurrentTimelineIndex=function(){return a.getCurrentTimelineIndex()},r.getCurrentTimelineState=function(){return a.getCurrentTimelineState()},r.documentId=function(){return w.documentId()||L.documentId()},r.backgroundColor=function(){return h.firstPage.root.style.colors.color(g.ColorRole.FieldPrimary)},r.getFormaBackgroundColor=function(e){var t=e.style.colors.fieldPrimary;return t?h.firstPage.colorLibraryController.getTheoColorForSolidColor(t):null},r.getImageFormaBackgroundColor=function(e){if(!(null!==e.controller.cutout))return null;const t=!e.controller.moveable,n=r.getFormaBackgroundColor(e);if(t){if(n)return n;{const t=g.TheoDocumentUtils.getCellBackgroundShape(e);return r.getFormaBackgroundColor(t)}}return n},r.triggerEnteredPalette=function(){h.firstPage.colorLibraryController.enteredPalettePicker()},r.triggerTextSidebarDisplayed=function(){h.firstPage.colorLibraryController.enteredPalettePicker()},r.isBackgroundVisible=function(){var e=r.getGridForma();return e?e.controller.isBackgroundVisible():0===r.imageFormas().length},r.getImageFormaForURL=function(e){for(var t=r.imageFormas(),n=0;n<t.length;n++){var o=t[n];if(null!=o.contentNode&&o.contentNode.url===e)return o}return null},r.getImagePreviewData=function(e){if(e&&e.isImage()){var t=g.ImageFacade.getImageFormaForForma(e);if(t&&t.contentNode)return z.info("image preview placement:",t.placement),{colorThemeKey:ie(),formaID:t.formaID,forma:t,url:oe(t),styleFilter:t.style,placement:t.placement,width:t.contentNode.pixelWidth,height:t.contentNode.pixelHeight}}return{}},r.getFormaRenderList=function(){var e=[];let t=!1;const n=ce(["FF0000"])[0];var o=h.firstPage.root.visitAsArray(g.FormaTraversal.PreOrder);const a=(t,n)=>e.push(i(i({},t),{},{type:n}));for(var l=0;l<o.length;l++){const i=o[l],{controller:c,formaID:u,kind:s}=i;if(c){const o={forma:i,formaID:u};if("Root"===s&&a(o,"background"),"Shape"===s&&a(o,"shape"),"Frame"===s)continue;if(i.isTypeLockup()&&a(o,"lockup"),s===g.ImageForma.KIND||s===g.VideoForma.KIND){const o=oe(i);null==o?(z.error("no image url, cleaning up the document",{docId:h.uuid,imageFormaId:i.uuid}),t=!0,r.replaceImagesWithColors([i],[n]).done()):e.push({forma:i.parent,type:"image",formaID:i.parent.formaID,url:o,logo:i.isLogo(),colorThemeKey:ie()})}}}return t&&(r.events.publish("show-image-forma-corrupted-modal",{backgroundColor:n.rgbColor.rgbHex}),r.validateDoc("missingContentCleanup")),e},r.imageFormas=function(){return h.firstPage.root.filterByKind(g.ImageForma.KIND)},r.canAddMoreImages=function(e){return r.imageFormas().length+e<=g.GridController.MAX_IMAGE_COUNT},r.hostImages=function(){var e=[];return r.imageFormas().forEach((function(t){void 0!==t.contentNode.image&&e.push(t.contentNode.image)})),e},r.iconFormas=function(){return h.firstPage.root.filterWithCallback((function(e){return e.hasIntent(g.Forma.INTENT_ICON)}))},r.lockupFormas=function(){return h.firstPage.root.filterByControllerKind(g.TypeLockupController.KIND)},r.logoFormas=function(){return r.imageFormas().filter((function(e){return e.isLogo()}))},r.backgroundImageFormas=function(){return h.firstPage.root.filterWithCallback((function(e){return e.kind===g.FrameForma.KIND&&e.isBackgroundImage()}))},r.backgroundFormas=function(){return h.firstPage.root.filterWithCallback((function(e){return e.kind===g.ShapeForma.KIND&&"grid-cell"===e.intent||e.kind===g.FrameForma.KIND&&e.isBackgroundImage()}))},r.getLockupWordCount=function(){for(var e=[],t=r.lockupFormas(),n=0;n<t.length;n++)e.push(t[n].controller.text.trim().split(/ |\n/).length);return e},r.getIconCount=function(){return r.iconFormas().length},r.getImageCount=function(){return r.imageFormas().length},r.getRetargetableImageCount=function(){return h.firstPage.root.filterWithCallback(e=>g.DesignFeatureUtils.isRetargetableImage(e)).length},r.documentSize=function(){return{width:h.firstPage.pageSize.width,height:h.firstPage.pageSize.height}},r.getDocumentSize=function(){return T.getDocumentSize(h)},r.getImageSizeIfFullBleed=function(){var e=r.imageFormas();if(1===e.length){var t=e[0],n=r.getDocumentSize(),o=t.parent;if(o.finalFrame.width===n.width&&o.finalFrame.height===n.height&&t.contentNode)return{width:t.contentNode.pixelWidth,height:t.contentNode.pixelHeight}}return null},r.forceReloadEditor=function(e){r.events.publish("force-reload-editor",e)},r.shouldReloadOnActionFailure=function(){return s.isFeatureEnabled("post-reload-on-action-failure")},r.doAction=pe,r.flipForma=function(e,t){pe(new g.FlipAction(e,[t])).then((function(){r.events.publish("forma-flipped",{id:t.formaID,isImage:t.isImage()})}))},r.canDuplicateFormae=function(e){return g.DuplicateAction.canAddImages(e)},r.duplicateFormae=function(e){return a.currentlyExecutingAction()?t.reject():pe(new g.DuplicateAction(e,!0,!0)).then((function(t){for(var n=!1,o=0;o<e.length;o++)if(e[o].isImage()){n=!0;break}return r.events.publish("formae-duplicated",{duplicatedImage:n}),t}))},r.inCropMode=function(){return h.controller.selection.inCropMode},r.enterCropMode=function(){return Y&&z.error("probable error. cropModeBranchStarted shouldn't be true"),Y||a.currentlyExecutingAction()||r.inCropMode()?t():(Y=!0,r.beginBranch(),pe(new g.EnterCropModeAction(r.getSelectedForma())))},r.exitCropMode=function(e){return"boolean"!=typeof e&&(e=!0),r.events.publish("exit-crop-mode"),a.currentlyExecutingAction()?t():pe(new g.ExitCropModeAction).then(()=>{Y&&(r.endBranch(e),Y=!1)})},r.inSpecialSelectionMode=function(){return!!r.inCropMode()||(!!r.inRefineCutoutMode()||!!r.inCharStyleMode)},r.exitSpecialSelectionMode=function(e){return!0===r.inCropMode()?r.exitCropMode(e):r.inRefineCutoutMode()?t(r.exitRefineCutoutMode(e)):(r.inCharStyleMode&&r.exitCharStyleMode(),t())},r.setImageAsBackground=function(){return a.currentlyExecutingAction()?t():pe(new g.SetImageAsBackgroundAction).then(e=>(r.events.publish("image-set-background",{}),e))},r.setImageAsForeground=function(){return a.currentlyExecutingAction()?t():pe(new g.SetImageAsFloatingAction).then(e=>(r.events.publish("image-set-foreground",{}),e))},r.deleteFormae=function(e){var t=[],n=r.getSelectedForma();r.inCharStyleMode&&null!=n&&n.isTypeLockup()&&(r.exitCharStyleMode(),e=e.filter(e=>e.controller&&e.controller.deleteable));for(var o=0;o<e.length;o++)"TextForma"!==e[o].className&&t.push(r.getFormaById(e[o].formaID));return e=t,r.deselect(),pe(new g.DeleteAction(e)).then((function(){for(var t=[],n=!1,o=0;o<e.length;o++)t.push(e[o].formaID),n||(n=e[o].isImage());r.events.publish("formae-deleted",{ids:t,deletedImage:n})}))},r.groupItems=function(e,t,n){return pe(new g.GroupAction(e,t,n))},r.ungroupItems=function(e,t,n){return pe(new g.UngroupAction(e,t,n))},r.cleanupInvalidImageSync=function(e,t){if(e){const n=g.ImageFacade.getFrameFormaForForma(r.getFormaById(e)),o=r.beginTransaction("CleanUpCorruptImage");n&&g.CreationFacade.deleteFormae([n]),r.removeContentForCorruptImageFrame(t),r.endTransactionAndMergeWithPrevious(o),r.events.publish("formae-deleted",{ids:[e],deletedImage:n&&n.isImage()})}},r.cleanupInvalidImageWithColorSync=function(e,t,n){if(e){const o=e&&r.getFormaById(e),a=r.beginTransaction("CleanUpCorruptImageWithColor");o&&g.ImageFacade.replaceImageWithColors(o,n),r.removeContentForCorruptImageFrame(t),r.endTransactionAndMergeWithPrevious(a)}},r.replaceImagesWithColors=function(e,t){return pe(new g.ReplaceImagesWithColorsAction(e,t))},r.getDeleteInfo=function(e){for(var t=r.getGridForma(),n=t&&1===t.style.numBackgroundCells,o=!1,a=!0,i=0;i<e.length;i++)if(e[i]&&e[i].isImage()&&e[i].isBackgroundImage()){o=!0,a=t.controller.canDeleteCellForForma(e[i])&&!n;break}return{isDeleteable:a,isBackgroundImage:o}},r.getFirstAnnotation=function(){return h.controller.model.annotations.getFirst()},r.getSelectedBoundingBox=function(){return re()},r.getSwapState=function(){return h.controller.model.activeSwap.getActive()},r.isMultiSelect=function(){return g.SelectionFacade.isMultiSelect(h.controller.selection)},r.isGroupSelect=function(){const e=h.controller.selection.asFormaArray(),t=1===e.length&&e[0];return t&&t.kind===g.GroupForma.KIND&&t.intent===g.Forma.INTENT_USER_GROUP},r.getSelectedForma=function(){const e=h.controller.selection.asFormaArray();return e.length?e[0]:null},r.getAllSelectedFormas=function(){return h.controller.selection.asFormaArray()},r.getSelectedFormaId=function(){var e=r.getSelectedForma();return e?e.formaID:null},r.formaAtPointInSelection=function(e){return h.firstPage.formaAtPointInSelection(e,h.controller.selection)},r.getSelectedFormaType=function(){var e=r.getSelectedForma();return null===e?"no-selection":r.isGroupSelect()?"group":r.isMultiSelect()?"multiselect":e.isTypeLockup&&e.isTypeLockup()||"text"===e.kind.toLowerCase()?"text":e.isLogo&&e.isLogo()?"logo":r.isIcon()?"icon":e.isImage&&e.isImage()?"image":e.isGridCell&&e.isGridCell()||"root"===e.kind.toLowerCase()?"cell":(z.error("unknown selection type:"+(e&&e.controller.kind)+", intent:"+(e&&e.intent)),"unknown")},r.getSelectableFormaeIntersectingRect=function(e){return h.firstPage.selectableFormaeIntersectingRect(e)},r.removeStaleSelections=function(){h.controller.selection.removeStaleSelections()},r.getRootForma=function(){return h.firstPage.root},r.getDocument=function(){return h},r.getFormaById=function(e){return h.firstPage.formaByID(e)},r.selectFormaById=function(e){if(e.forma=r.getFormaById(e.formaId),e.forma)return r.selectForma(e),e.forma},r.selectFormae=function(e){g.SelectionFacade.selectFormae(e)},r.marqueeSelectFormae=function(e,t){g.SelectionFacade.marqueeSelectFormae(e,t)},r.selectAll=function(){g.SelectionFacade.selectAllOnPage(h.firstPage)},r.deselectAll=function(){g.SelectionFacade.deselectAllOnPage(h.firstPage)},r.canSelectSibling=function(){return!r.inSpecialSelectionMode()&&g.SelectionFacade.canSelectSibling(h.firstPage)},r.selectSibling=function(e){g.SelectionFacade.selectSibling(h.firstPage,e)},r.canSelectParent=function(){return!r.inSpecialSelectionMode()&&g.SelectionFacade.canSelectParent(h.firstPage)},r.selectParent=function(){g.SelectionFacade.selectParent(h.firstPage)},r.canSelectChild=function(){return!r.inSpecialSelectionMode()&&g.SelectionFacade.canSelectChild(h.firstPage)},r.selectChild=function(){g.SelectionFacade.selectChild(h.firstPage)},r.getSelectedCount=function(){return h.controller.selection.selectedCount},r.getSelectionBounds=function(){return g.SelectionFacade.getSelectionBounds(h.firstPage)},r.deselect=function(e){e=e||{};var t=r.getSelectedForma();r.inCharStyleMode&&null!=t&&t.isTypeLockup()&&r.exitCharStyleMode(),r.inCropMode()?r.exitCropMode().done():r.inRefineCutoutMode()&&r.exitRefineCutoutMode(),e.closeAllPanels&&r.events.publish("close-all-panels"),h.controller.selection.clearSelection(!e.silent),X=null},r.deselectForma=function(e){h.controller.selection.deselectForma(e)},r.formaIsSelected=function(e){return h.controller.selection.isSelected(e)},r.formaIsGroupSelected=function(e){return h.controller.selection.isGroupSelected(e)},r.selectForma=function(e){var t=r.getSelectedForma(),n=e.forma,o=e.silent,a=!e.multiselect;if(n&&(e.multiselect||r.getSelectedFormaId()!==n.formaID))if(e.multiselect&&r.formaIsSelected(e.forma))r.deselectForma(e.forma);else{if(r.inCharStyleMode&&null!=t&&t.isTypeLockup()&&r.exitCharStyleMode(),"Root"===n.kind&&!r.isBackgroundVisible())return z.error("error in selection. background is not visible, so don't allow selection"),void r.deselect();a&&r.deselect({silent:!0}),e.layerStack&&(Q=!0),h.controller.selection.selectForma(n,!o),Q=!1}},r.ensureBackgroundFormaSelected=function(){var e=r.getSelectedForma(),t=e&&!e.isTypeLockup()&&!e.isLogo()&&e.controller.moveable;if(!e||!(e.isBackgroundImage()||e.isShape()||"Root"===e.kind||e.isGridCell()||t)){var n=r.backgroundImageFormas();if(n.length>0)r.selectForma({forma:n[0]});else{var o=h.firstPage.root.filterByControllerKind("shape");o.length>0?r.selectForma({forma:o[0]}):r.selectForma({forma:h.firstPage.root})}}},r.ensureLockupSelected=function(){var e=r.getSelectedForma();if(!e||!e.isTypeLockup()){var t=r.lockupFormas();t.length>0&&r.selectForma({forma:t[0]})}},r.canNudge=function(){if(r.inRefineCutoutMode())return!1;var e=r.getSelectedForma();return!!e&&e.controller.nudgeable},r.handleNudge=function(e){var t=e.translate;return pe(new g.NudgeAction(new g.TheoPoint(t.x,t.y)))},r.canRotateBox=function(){return!0===re().rotateable},r.handleHandleFeedback=function(e){for(var t=h.controller.model.handles.getAll(),n=null,o=0;o<t.length;o++)!(t[o]instanceof g.BoxTransformHandles)||n&&t[o]instanceof g.BoxTransformMultipleFormae||(n=t[o]);if(n){var a;switch(e.action){case"begin":a=g.HandleTransformStage.Begin;break;case"update":a=g.HandleTransformStage.Update;break;case"end":a=g.HandleTransformStage.End;break;default:return void z.error("handleHandleFeedback: params.action wasn't an expected value; it was "+e.action)}var i,l=null;switch(e.part){case"move":l=new g.MoveTransformEvent(n,a,new g.TheoPoint(e.location.totalX/h.controller.model.view.getScale(),e.location.totalY/h.controller.model.view.getScale()));break;case"rotate":if(r.canRotateBox){var c=!e.isShortcut;l=new g.RotateAboutCenterTransformEvent(n,a,e.totalDeltaRadians,c||0)}break;case"corner":i=de(e.spot),l=new g.CornerTranslateTransformEvent(n,a,i,new g.TheoPoint(e.location.x,e.location.y));break;case"side":i=de(e.spot),l=new g.SideTranslateTransformEvent(n,a,i,new g.TheoPoint(e.location.x,e.location.y));break;default:return void z.error("handleHandleFeedback: params.part wasn't an expected value; it was "+e.part)}l.viewportScale=r.getViewScale(),h.controller.designController.handles.handleTransformEvent(l)}},r.getSelectedFormaRotation=function(){var e=r.getSelectedForma();if(!e)return null;var t=e;return"Frame"===e.kind&&(t=t.childAt(0)),180*ve(t.placement)/Math.PI},r.getFormaRotation=function(e){return 180*ve(e.placement)/Math.PI},r.getFormaScaleX=function(e){return e?e.placement.transformValues.xscale:null},r.getFormaScaleY=function(e){return e?e.placement.transformValues.yscale:null},r.getSelectedFormaHasShapeMask=function(){return g.ImageFacade.formaHasShapeMask(r.getSelectedForma())},r.getSelectedFormaScale=function(){var e=r.getSelectedForma();if(!e)return null;var t=e;return"Frame"===e.kind&&(t=t.childAt(0)),t.placement.extractedScale.scale.x},r.getSelectedFormaPlacement=function(){var e=r.getSelectedForma();if(!e)return null;var t=e,n="";return"Frame"===e.kind&&(n=(t=t.childAt(0)).contentNode.pixelWidth+"_"+t.contentNode.pixelHeight),{placement:t.placement,id:n}},r.getSelectedFormaScaleRange=function(){var e={},t=r.getSelectedForma();if(t&&"Frame"===t.kind&&!t.controller.moveable){var n=t.childAt(0),o=.1;if(n.contentNode){var a=t.finalFrame.size,i=n.contentNode.pixelWidth,l=n.contentNode.pixelHeight,c=i/l,u=a.width/a.height,s=a.width/i,d=a.height/l;o=c>u?d:s}n.hasAlpha()?(e.min=.1,e.max=2):(e.min=o,e.max=10*o)}return e},r.hasReportedIcons=function(){return h.content.root.visitAll(e=>{if(e instanceof g.VectorContentNode&&e.isUsageReported())return!0}),!1},r.scaleSelectedForma=function(e,t){var n=r.getSelectedForma();"Frame"!==n.kind||n.controller.moveable&&!r.inCropMode()||(n=n.childAt(0));var o=e/n.placement.extractedScale.scale.x;return pe(new g.ScaleAction(o,[n]))},r.changeImageAdjustments=function(e){var t=r.getSelectedForma(),n=t;return t&&"Frame"===t.kind&&(n=t.childAt(0)),pe(g.ChangeImageAdjustmentsAction.ActionWithDictionary(e,[n]))},r.resetImageAdjustments=function(e){return r.changeImageAdjustments(e)},r.getImageAdjustments=function(e){var t=e||r.getSelectedForma();return t&&"Frame"===t.kind&&(t=t.childAt(0)),t.style.adjustments},r.rotateSelectedForma=function(e,t){var n=e/180*Math.PI,o=r.getSelectedForma();return"Frame"!==o.kind||o.controller.moveable&&!r.inCropMode()||(o=o.childAt(0)),pe(new g.RotateAction(n,t,[o],!0))},r.handleTextFormaBeginResize=function(e){if(e=e||r.getSelectedForma()){r.beginGesture("resize-text");null!=e&&e.isTypeLockup()&&(e.controller.beginTouches(null),I=null)}},r.handleTextFormaEndResize=function(e){(e=e||r.getSelectedForma())&&r.endGesture(!0)},r.handleTextFormaResize=function(e,n){if(e&&e.isTypeLockup()&&null!=n.startForma){var o=new g.TheoPoint(n.touchPoint.x,n.touchPoint.y),r=0===n.spot.x&&.5===n.spot.y;return pe(new g.CharRangeHandleAction(e,o,n.startForma,r,I)).then((function(){I=o,ke(e)}))}return t.resolve(!1)},r.formaAtPoint=function(e,t){return h.firstPage.formaAtPoint(e,0,null,t)},r.handleTapped=function(e){var t=e.forma||r.getFormaById(e.id);if(r.inCharStyleMode){null!=t&&t.isTypeLockup()&&t.controller.owner.selection.isSelected(t)&&t.controller.selectCharStyleForma();var n=new g.TheoPoint(e.x,e.y),o=h.firstPage.formaAtPointInSelection(n,h.controller.selection);if(null!=o&&null!=o.lockupForma)!function(e){if(!e||!e.lockupForma)return;pe(new g.ApplyCharStyleAction(e,g.TypeLockupController.HIGHLIGHT_STYLE,g.CharStyleApplyMode.Toggle,e.rangeInLockup)).done()}(o);else{var a=r.getSelectedForma();a.formaID&&e.forma.formaID!==a.formaID&&(r.exitCharStyleMode(),r.selectForma({forma:t}))}}else void 0!==t&&r.selectForma({forma:t});return!r.inCharStyleMode},r.getOriginalImageSize=function(){if(!r.inVisibleGridLayout()){var e=r.backgroundImageFormas();if(1===e.length){var t=e[0];return{width:t.childAt(0).contentNode.pixelWidth,height:t.childAt(0).contentNode.pixelHeight}}return null}},r.recordOriginalSize=function(){return pe(new g.RecordOriginalPageSizeAction(h.firstPage))},r.recordCreateFromRemix=function(){return pe(new g.RecordCreateFromRemixAction(h.firstPage))},r.setPageSizeFromDesignSize=function(e,t){return t=t||{},he(new g.ChangePageSizeAction(h.firstPage,e),(function(){var e=r.getDocumentSize(),n={width:e.width,height:e.height};return r.events.publish("document-size-changed",n),S.delay(t.delay||100)}))},r.getPageAspectRatio=function(){var e=r.getDocumentSize();return e.width/e.height},r.getDocumentSizeId=function(){return h.firstPage.sizeID},r.getDocumentOriginalSizeId=function(){return h.firstPage.originalSizeID},r.getPageCustomSizeFormat=function(){return h.firstPage.customSizeFormat},r.getPageCustomSizePPI=function(){return h.firstPage.customSizePPI},r.getPageExportData=function(){return h.firstPage.getPageExportData()},r.getExportData=function(){return h.firstPage.getExportData()},r.lockupFormaIDs=function(){var t=r.lockupFormas();return e.map(t,(function(e){return e.formaID}))},r.downloadNewLockupRandomFontsAsync=function(){if(!M){M=t.defer();R.loadMissingFonts(["Lato-Light","Lora-Regular","Montserrat-Regular","PlayfairDisplay-Regular","FuturaPT-Medium"]).then((function(){M.resolve()}))}},r.addNewLockup=function(e,n){z.assert(!!M,"Invalid random fonts loading promise."),n=n||{};var o=r.imageFormas();return(o.length>0?t(o[0].contentNode.image.getImageLoadedPromise()):t.resolve()).then((function(){return r.canPan()&&r.fitToView(),r.inCharStyleMode&&r.exitCharStyleMode(),pe(new g.AddTextContentAction(e))}))},r.addBadge=function(e,t){return r.canPan()&&r.fitToView(),r.getTemporaryDocumentWithFontsLoaded(e).then((function(e){return r.inCharStyleMode&&r.exitCharStyleMode(),pe(new g.AddBadgeAction(e,null,t))}))},r.applyDesignTheme=function(e,n,o,a){const i=t.defer(),l=e.then((function(e){return r.canPan()&&r.fitToView(),e})).catch((function(e){z.error("error in getTemporaryDocumentWithFontsLoaded",e),i.resolve()}));let c=null!=n?n:[],u=a?g.RetargetLayoutOption.EnableLayout:g.RetargetLayoutOption.DisableLayout;const s=h.firstPage.root;return pe(g.ApplyTemplateAction.createDesignTemplateActionFromPromise(S.toCorePromise(l),s,o||0,s,c,!0,u)).then((function(){S.delay(40).done(i.resolve)})),i.promise},r.applyRetargetSuggestion=function(e,t){return pe(g.ApplyTemplateAction.createDesignTemplateAction(g.CorePromise.resolve(e),h.firstPage.root,t,h.firstPage.root,!1,null)).then((function(){return S.delay(10)}))},r.getThemeId=function(){return h.content.root.getTag("theme:id")},r.getColorPalette=function(){var t=h.firstPage.colorLibraryController.getColorThemeAsArrayOfTheoColors();return e.map(t,(function(e){return{color:p.rgb2hex({r:255*e.rgbColor.red,g:255*e.rgbColor.green,b:255*e.rgbColor.blue}),roles:e.sparkRoles,id:e.sparkElementID}}))},r.getColorAnimationVariant=function(e){const t=h.firstPage.colorLibraryController.getThemeColorKeys();let n=0;for(let o=0;o<t.length;++o){const r=h.firstPage.colorLibraryController.getTheoColorForKey(t[o]);if(r){if(p.rgb2hex({r:255*r.rgbColor.red,g:255*r.rgbColor.green,b:255*r.rgbColor.blue})===e){n=o;break}}}return n},r.setColorPalette=function(e,t){if(!e||!e.colors)return;t=t||{};const n=ce(e.colors);return pe(new g.ApplyColorThemeAction(n,e.id,h.firstPage,!!t.shuffle))},r.applyAspectRatioCropToImage=function(e){var t=g.ImageFacade.getImageFormaForForma(r.getSelectedForma());if(e.id===g.CropRatioPresetLibrary.FREEFORM_ID)return pe(new g.SetImageCropToFreeformAction(t));var n=e.id===g.CropRatioPresetLibrary.ORIGINAL_ID?0:e.aspectRatio;return pe(new g.CropImageToRatioAction(t,n))},r.applyShapeMaskToImage=function(e){return pe(new g.ApplyShapeMaskToImageAction(r.getSelectedForma(),e.shapeId))},r.shuffleColorPalette=function(){return pe(new g.ShuffleColorThemeAction(h.firstPage))},r.getImageFilters=function(){for(var e=h.firstPage.imageFilterLibrary.getImageStyles(),t=e.length-1;t>=0;t--)e[t].colors.library=h.firstPage.colorLibrary;return e},r.setImageFilterForSelection=function(e,n,o,a){var i=r.getSelectedForma();if(i&&i.isImage()){const t=e.clone(),r=g.ImageFacade.getImageFormaForForma(i);if(r&&(t.opacity=r.style.opacity),0===n){var l=null,c=null;return null!==a&&(null!==a.shadowsColor&&(l=p.hex2SolidColor(a.shadowsColor)),null!==a.highlightsColor&&(c=p.hex2SolidColor(a.highlightsColor))),pe(new g.SetImageFilterAction(t,o,l,c))}return pe(new g.ShuffleImageFilterAction(t,h.firstPage,o))}return t.resolve(!1)},r.applyBlendModeByName=function(e,n){if(g.OpacityFacade.formaCanHaveBlendMode(e)){const t=g.ImageFacade.getFrameFormaForForma(e)||e;if(t){let e=g.FormaBlendMode.Normal;switch(n){case g.FormaStyle.BLEND_MODE_MULTIPLY:e=g.FormaBlendMode.Multiply;break;case g.FormaStyle.BLEND_MODE_SCREEN:e=g.FormaBlendMode.Screen}return W.publish("editor:blendModeSelected",{contextualData1:"blendModeType:"+n}),pe(new g.SetBlendModeAction(e,[t]))}}return t.resolve(!1)},r.canHaveBlendMode=function(e){return g.OpacityFacade.formaCanHaveBlendMode(e)},r.getAppliedBlendMode=function(e){let t=g.FormaBlendMode.Normal;if(g.OpacityFacade.formaCanHaveBlendMode(e)){const n=g.ImageFacade.getFrameFormaForForma(e)||e;n&&(t=g.OpacityFacade.getBlendModeForForma(n))}switch(t){case g.FormaBlendMode.Multiply:return g.FormaStyle.BLEND_MODE_MULTIPLY;case g.FormaBlendMode.Screen:return g.FormaStyle.BLEND_MODE_SCREEN;default:return g.FormaStyle.BLEND_MODE_NORMAL}},r.updateDuotoneFilterColor=function(e,n){var o=r.getSelectedForma();if(!o)return t.resolve();const a=r.getImageFilters().find(e=>e.name===g.ImageStyle.NAME_NEWDUOTONE),i=r.getImagePreviewData(o),l=p.rgb2hex({r:n.red,g:n.green,b:n.blue});let c,u;var s,d,m,f;e?(c=l,u=null==i||null===(s=i.styleFilter)||void 0===s||null===(d=s.colors)||void 0===d?void 0:d.fieldHighlights.rgbHex):(c=null==i||null===(m=i.styleFilter)||void 0===m||null===(f=m.colors)||void 0===f?void 0:f.fieldShadows.rgbHex,u=l);return r.setImageFilterForSelection(a,0,!1,{shadowsColor:c,highlightsColor:u})},r.getTextForSelectedLockup=function(){var e=r.getSelectedForma();if(e&&e.isTypeLockup()){var t=e.controller.contentNode;return t?t.text:null}},r.shouldSuggestTransparentBackground=function(){return h.firstPage.root.controller.suggestTransparentBackground()},r.setBackgroundTransparency=function(e){return pe(new g.SetBackgroundOpacityAction(e,h.firstPage))},r.getFullCanvasColor=function(){var e=g.TypeLockupUtils.getFullCanvasLockups(h.firstPage.root);return e.length>0&&1===e[0].lockupStyle.backingOpacity?e[0].lockupStyle.colors.fieldSecondary:null},r.setTextForLockup=function(e,t,n,o,a){const i=e.formaID;return he(new g.SetTextCollapseAction(t,e,o,n,a),(function(){const e=r.getFormaById(i);return r.events.publish("forma-text-updated",{forma:e}),S.delay(10)}))},r.getDominantColorRoleOfLockup=function(e){if(!e||!e.isTypeLockup())return g.ColorRole.FieldPrimary;var t=e.controller.styleController.targetedLockupStyle;return t.textLook===g.LockupTextLook.KnockoutOnly||t.textLook===g.LockupTextLook.OutlineOnly?g.ColorRole.FieldSecondary:g.ColorRole.FieldPrimary},r.setColorsForSelectedLockup=function(e,n,o){var a=o||r.getSelectedForma();if(a&&a.isTypeLockup()&&a.formaID){var i=le(e);return pe(new g.ApplyColorAction(null,i,r.inCharStyleMode,n))}return t.resolve(!1)},r.getShapeFormaTheoColor=function(e){if((e=e||r.getSelectedForma())&&e.isShape()){var t=e.style.colors.color(g.ColorRole.FieldPrimary);return h.firstPage.colorLibraryController.getTheoColorForSolidColor(t)}},r.getLockupFormaColors=function(e,t){if((e=e||r.getSelectedForma())&&e.isTypeLockup()){t="boolean"!=typeof t||t;var n=e.controller,o=t?n.styleController.targetedLockupStyle.colors:n.lockupStyle.colors,a=o.fieldPrimary||new g.SolidColor(1,1,1,1),i=o.fieldSecondary||new g.SolidColor(1,1,1,1),l=h.firstPage.colorLibraryController.getTheoColorForSolidColor(a),c=h.firstPage.colorLibraryController.getTheoColorForSolidColor(i),u=[{red:Math.round(255*l.rgbColor.red),green:Math.round(255*l.rgbColor.green),blue:Math.round(255*l.rgbColor.blue),alpha:1,id:l.sparkElementID,roles:l.sparkRoles},{red:Math.round(255*c.rgbColor.red),green:Math.round(255*c.rgbColor.green),blue:Math.round(255*c.rgbColor.blue),alpha:1,id:c.sparkElementID,roles:c.sparkRoles}];return r.selectedLockupHasOnlyOneColor(e)&&(r.getDominantColorRoleOfLockup(e)===g.ColorRole.FieldSecondary?u.splice(0,1):u.splice(1)),u}},r.selectedLockupHasOnlyOneColor=function(e){if(!(e=e||r.getSelectedForma())||!e.isTypeLockup())return!0;var t="none"!==r.getShapeOfSelectedLockup(e),n=e.controller.styleController.targetedLockupStyle.textLook;return t?n===g.LockupTextLook.KnockoutOnly||n===g.LockupTextLook.OutlineOnly:n===g.LockupTextLook.OutlineOnly||n===g.LockupTextLook.Fill||g.LockupTextLook.UNSET},r.setFontForSelectedLockup=function(e){var n=s.fontProvider.descriptorForPostScriptName(e.postScriptName);if(n.postScriptName===e.postScriptName){var o=R.getFontData(e.postScriptName),a=g.TheoFont.init_9e5c(n,o.sparkElementId,o.acRoles);return he(new g.SetFontAction(a,r.inCharStyleMode),(function(){var e=r.getSelectedForma();e&&ye(e)}))}return t.reject("cannot find font with PostScriptName: "+e.postScriptName)},r.updataDocForTypekitFontDeactivated=function(e){h&&e&&(g.TypeLockupUtils.replaceFontsInDocument(h,[e]),Ce(!1),r.requestSave())},r.replaceMissingFonts=function(){return he(new g.ReplaceMissingFontsAction,()=>{r.requestSave(!0)})},r.getLockupFontOfSelectedLockup=function(e,t){if((e=e||r.getSelectedForma())&&e.isTypeLockup()){t="boolean"!=typeof t||t;var n=e.controller;return t?n.styleController.targetedLockupStyle.font:n.lockupStyle.font}},r.setShapeForSelectedLockup=function(e){return r.getSelectedForma()?isNaN(e)?r.applyBackingToLockup(7,e,r.getSelectedFormaId()):r.applyBackingToLockup(e,null,r.getSelectedFormaId()):t.resolve()},r.getEffectForSelectedLockup=function(e){if((e=e||r.getSelectedForma())&&e.isTypeLockup())return e.controller.styleController.getTextLookForUI()},r.setEffectForSelectedLockup=function(e){return r.getSelectedForma()?pe(new g.SetTextLookAction(e,!1)):t.resolve()},r.getCorrectOutlineWithFillTextLook=function(){const e=r.getSelectedForma();if(!e||!e.isTypeLockup())return;return e.controller.styleController.targetedStrokeWeight>.12?g.LockupTextLook.FillAndOutline2:g.LockupTextLook.FillAndOutline},r.toggleFillOfSelectedLockup=function(){const e=r.getSelectedForma();if(!e||!e.isTypeLockup())return;var n=null;switch(e.controller.styleController.targetedTextLook){case g.LockupTextLook.KnockoutAndOutline:break;case g.LockupTextLook.OutlineOnly:n=r.getCorrectOutlineWithFillTextLook();break;case g.LockupTextLook.FillAndOutline:case g.LockupTextLook.FillAndOutline2:n=g.LockupTextLook.OutlineOnly;break;case g.LockupTextLook.ShadowAndOutline:n=g.LockupTextLook.ShadowOutlineTransparentText;break;case g.LockupTextLook.KnockoutShadowOutline:break;case g.LockupTextLook.ShadowOutlineTransparentText:n=g.LockupTextLook.ShadowAndOutline}return null===n?t.resolve():pe(new g.SetTextLookAction(n,!1))},r.isLockupOutlineOnly=function(e){if((e=e||r.getSelectedForma())&&e.isTypeLockup())return e.controller.styleController.targetedLockupStyle.textLook===g.LockupTextLook.OutlineOnly},r.getStrokeWeightOfSelectedLockupForUI=function(e){if((e=e||r.getSelectedForma())&&e.isTypeLockup())return Math.round(e.controller.styleController.getStrokeWeightPercentForUI())},r.setStrokeWeightSelectedLockup=function(e,t){t=t||r.getSelectedForma();var n=function(e){return(e-1)/99}(e);return pe(new g.SetTextEffectsAttributesAction(n,NaN,NaN))},r.getShadowOffsetOfSelectedLockupForUI=function(e){if((e=e||r.getSelectedForma())&&e.isTypeLockup())return Math.round(e.controller.styleController.getShadowOffsetPercentForUI())},r.setShadowOffsetOfSelectedLockup=function(e,t){t=t||r.getSelectedForma();var n=function(e){return(e-1)/99}(e);return pe(new g.SetTextEffectsAttributesAction(NaN,n,NaN))},r.getShadowAngleOfSelectedLockup=function(e){if((e=e||r.getSelectedForma())&&e.isTypeLockup()){var t=e.controller.styleController.targetedShadowAngle;return t>180?t-360:t}},r.setShadowAngleOfSelectedLockup=function(e,t){return t=t||r.getSelectedForma(),e=e<0?e+360:e,pe(new g.SetTextEffectsAttributesAction(NaN,NaN,e))},r.applyBackingToLockup=function(e,t,n){var o=r.getFormaById(n),a=e;if(9===e){var i=o.controller.size;a=i.width>i.height?9:8}return pe(new g.ChangeBackgroundShapeAction([o],a,t,r.inCharStyleMode))},r.getShapeOfSelectedLockup=function(e,t){if(!(e=e||r.getSelectedForma())||!e.isTypeLockup())return;let n=e.controller.styleController.targetedLockupStyle;t&&(n=e.style);var o=n.backing;return 7===o?n.backingArtworkID:o},r.setLetterSpacingForSelectedLockup=function(e){var n=r.getSelectedForma();return n&&n.isTypeLockup()?pe(new g.SetTrackingAction(e,j)):t.resolve(!1)},r.setCurrentPin=function(){if(j=g.TheoPoint.ZERO,r.getSelectedForma()&&r.getSelectedForma().isTypeLockup()){var e=r.getSelectedForma().controller.getPin(!0,!0);null!=e&&(j=e.pinPoint)}},r.setSpacingForSelectedLockup=function(e){var n=r.getSelectedForma();return n&&n.isTypeLockup()?pe(new g.SetLeadingAction(e,j)):t.resolve(!1)},r.setPaddingForSelectedLockup=function(e){var n=r.getSelectedForma();return n&&n.isTypeLockup()?pe(new g.SetPaddingAction(e,j)):t.resolve(!1)},r.getSpacingAndPaddingOfSelectedLockup=function(){var e=r.getSelectedForma();if(e&&e.isTypeLockup()){var t=e.controller.styleController,n=t.targetedLockupStyle.spacing,o=t.targetedLockupStyle.padding;return{spacing:"number"==typeof n?n:parseFloat(n),padding:"number"==typeof o?o:parseFloat(o)}}},r.getLetterSpacingSelectedLockup=function(){var e=r.getSelectedForma();if(e&&e.isTypeLockup())return e.controller.styleController.targetedLockupStyle.tracking},r.areSpacingAndPaddingAvailableForSelectedLockup=function(){var e=r.getSelectedForma();return!(!e||!e.isTypeLockup())&&e.controller.styleController.areSpacingAndPaddingOptionsAvailable()},r.isSpacingAvailableForSelectedLockup=function(){var e=r.getSelectedForma();return!(!e||!e.isTypeLockup())&&e.controller.styleController.hasSpacingOptions()},r.isPaddingAvailableForSelectedLockup=function(){var e=r.getSelectedForma();return!(!e||!e.isTypeLockup())&&e.controller.styleController.hasPaddingOptions()},r.setLayoutAndAlignmentForSelectedLockup=function(e,n,o){var a=r.getSelectedForma();return a&&a.isTypeLockup()&&a.formaID?(x++,pe(new g.ChangeTextLayoutAndAlignmentAction(e,n,!1,o)).then((function(){x--}))):t.resolve(!1)},r.getSuggestedColorsForLockup=function(t){if((t=t||r.getSelectedForma())&&t.isTypeLockup()){var n=t.controller.styleController.getSuggestableColors();return e.map(n,(function(t){return e.map(t,(function(e){return{red:255*e.rgbColor.red,green:255*e.rgbColor.green,blue:255*e.rgbColor.blue,id:e.sparkElementID,roles:e.sparkRoles}}))}))}},r.getSuggestedColors=function(t){if(t=t||r.getSelectedForma()){var n=t.controller.getSuggestableColors();return e.map(n,(function(t){return e.map(t,(function(e){return{red:255*e.rgbColor.red,green:255*e.rgbColor.green,blue:255*e.rgbColor.blue,id:e.sparkElementID,roles:e.sparkRoles}}))}))}},r.getBrandKitColorsPalettesForSelectedLockup=function(t){if(!r.getSelectedForma()||!r.getSelectedForma().isTypeLockup()||!t)return{colors:[]};var n=g.TheoBrandkitUtils.getBrandkitColorsForUI(t,r.getSelectedForma()),o=e.map(n,(function(t){return e.map(t,(function(e){return{red:255*e.rgbColor.red,green:255*e.rgbColor.green,blue:255*e.rgbColor.blue,id:e.sparkElementID,roles:e.sparkRoles}}))}));return{name:t.name,id:t.id,colors:o}},r.createFormaFromSVG=function(e,t,n){var o=e.original.link,a=new XMLHttpRequest;a.open("GET",o,!0),a.onload=function(i){var l=a.responseText,c=g.SVGParserUtils.theoArtworkFromSVGData(l,!0);s.pathUtils.cacheArtworkForURL(o,c),r.canPan()&&!n&&r.fitToView(),he(new g.AddIconContentAction(o,t,n),(function(t){var n="";if(!(t.formae&&t.formae.length&&t.formae[0]instanceof g.ShapeForma))throw new Error("AddIconContentAction did not return a shapeForma");{const e=t.formae[0];n=e.contentID,q.push(n);var o=r.beginTransaction("temp_svg_content_node_url");e.contentNode.url="uploading svg",r.suspendSave(),r.endTransactionAndMergeWithPrevious(o)}var a=new Blob([l],{type:e.mimeType});r.saveImageComponent(a,e.mimeType).then((function(e){var t={contentNodeID:n,url:e.encodedUrl,componentID:e.component.id};r.updateVectorContentNodeWithComponent(t)})).catch((function(e){r.resumeSave(),z.error("failed to upload SVG file",e)})).done()})).done()},a.onerror=function(){z.error("failed to download SVG icon file")},a.send()},r.getLayoutOfSelectedLockup=function(){var e=r.getSelectedForma();if(e&&e.isTypeLockup())return g.TextFacade.getLayoutForForma(e)},r.getAlignmentOfSelectedLockup=function(){var e=r.getSelectedForma();if(e&&e.isTypeLockup())return g.TextFacade.getAlignmentForForma(e)},r.getNextValidLetterGridAlignmentOfSelectedLockup=function(e){var t=r.getSelectedForma();return t&&t.isTypeLockup()?g.TextFacade.getNextValidGridAlignment(t,e):e},r.getNextValidPathOfSelectedLockup=function(e){var t=r.getSelectedForma();return t&&t.isTypeLockup()?g.TextFacade.getNextValidPathID(t,e):e},r.getNextValidAutoAlignmentOfSelectedLockup=function(e){var t=r.getSelectedForma();return t&&t.isTypeLockup()?g.TextFacade.getNextValidAutoAlignment(t,e):e},r.getNextValidAutoAlignmentByCategoryOfSelectedLockup=function(e,t){var n=r.getSelectedForma();return n&&n.isTypeLockup()?g.TextFacade.getNextValidAutoAlignmentByCategory(n,e,t):e},r.hasValidAutoAlignmentByCategory=function(e){var t=r.getSelectedForma();return!(!t||!t.isTypeLockup())&&g.TextFacade.hasValidAutoAlignmentsForCategory(t,e)},r.setSessionContainerSizeForSelectedLockup=function(){var e=r.getSelectedForma();e&&e.isTypeLockup()&&g.TextFacade.setSessionContainerSizeForForma(e)},r.getAllowedAlignmentStates=function(){var e=r.getSelectedForma();return e?e.controller.styleController.layoutSelector.values:[]},r.getUserFontSizesInDocument=function(){return g.TypeLockupUtils.sizesInDocument(h,void 0,!0).map(e=>g.TextFacade.toUserFontSize(e,h.firstPage))},r.getUserFontSizeOfSelectedForma=function(){var e,t=r.getSelectedForma();if(t&&t.isTypeLockup()){const n=t.controller.getCurrentFontSize();e=g.TextFacade.toUserFontSize(n,t.page)}return e},r.setFontSize=function(e){return pe(new g.SetFontSizeAction(e))},r.getOpacitySliderValueOfSelectedForma=function(){var e=r.getSelectedForma();return e&&e.controller?g.OpacityFacade.getOpacityForForma(e):1},r.setReordering=function(e){$=e},r.getSendForwardBackwardFormae=function(e){var t=h.controller.selection.asFormaArray();let n=t;if(t.length>1&&(n=g.LayerFacade.checkForContiguousChunk(e,t)),0===n.length)return[];for(var o=r.getNumLayers(),a=0;a<n.length;a++){var i=n[a];const t=i.controller.getZOrder();if(t<o+i.controller.getMinLayerIndex()-1&&("front"===e||"forward"===e))return n;if(t>i.controller.getMinLayerIndex()&&("back"===e||"backward"===e))return n}return[]},r.sendForwardBackward=function(e){var t=r.getSelectedForma(),n=r.getSendForwardBackwardFormae(e);return pe(new g.SendForwardBackwardAction(e,n)).then((function(){r.updateLayers(t)}))},r.setLayerForSelectedForma=function(e){var t=r.getSelectedForma(),n=t.controller.getMinLayerIndex()+e;return pe(new g.ChangeZOrderAction(n)).then((function(){r.updateLayers(t)}))},r.setLayerForForma=function(e,t){return pe(new g.ChangeZOrderAction(t)).then((function(){r.updateLayers(e)}))},r.getLayerSliderValueOfSelectedForma=function(){var e=r.getSelectedForma();if(e)return"Root"===e.kind?0:e.controller.getZOrder()-e.controller.getMinLayerIndex()},r.getNumLayers=function(){var e=r.getSelectedForma();if(e)return e.controller.getReorderableLayerCount()},r.updateLayers=function(){r.events.publish("forma-layer-changed")},r.canSave=function(){return v},r.setColorForSelection=function(e){var t=r.getSelectedForma(),n=e.length;0===n&&(e=null);for(var o=!1,a=0;a<n;a+=1)if(e[a].roles){o=!0;break}var i=G.currentBrandKit(),l=i?i.getTypeForAnalytics():null;if(t&&t.isTypeLockup())return o&&W.publish("usedBrandKitFontColor",{contextualData3:l}),r.setColorsForSelectedLockup(e,0,t);t&&t.isGridCell&&t.isGridCell()&&o&&W.publish("usedBrandKitBGColor",{contextualData3:l});const c=Te(e)?null:le(e);return pe(new g.ApplyColorAction(null,c))},r.setColorWithRolesForSelection=function(e){const t=function(e){return e.map(e=>({color:e,role:e.sparkRoles[0]||null}))}(Te(e)?null:le(e));return pe(new g.ApplyColorWithRoleAction(null,t))},r.addLogo=function(e,t){r.canPan()&&r.fitToView();var n=h.content.root.visit(t=>t instanceof g.URLBasedContentNode&&t.sparkElementID===e.id);return pe(n&&!t?new g.AddContentAction(n):new g.AddLogoContentAction(h.firstPage,e,t||null,null,e.componentId))},r.addOrReplaceImage=function(n){z.info("adding image. is low res? "+String(n.isLowResImage));var o=n.replacementForma;if(null!=n.replacementFrame&&null==o.parent)for(var a=h.firstPage.root.filterByKind(g.FrameForma.KIND),i=0;i<a.length;i++)a[i].finalFrame.equalWithAccuracy(n.replacementFrame,.001)&&(o=a[i],z.info("matched by frame"));o&&o.isShape()&&o.controller.moveable&&(z.error("Assertion fail. We shouldn't be asking to replace a moveable shape (at this point)."),o=null),s.imageAnalysis.updateHostImageCacheKey(n.metadata.sourceURL,n.url);var l=t.defer();r.canPan()&&!o&&r.fitToView();var u=n.floatingImageStrategy||g.FloatingImageStrategy.IfHasAlphaOrIsLogo,d=new g.AddFormaParams(g.ControllerSettingsBehaviorEnum.IgnoreControllerSettings,!0,o,u);const m=o&&g.ImageFacade.getCutoutModeForForma(o)!==c.Off;return m&&(N.mark(U.preserveImageAdjustmentsForCutout),r.suspendSave()),he(new g.AddImageContentAction(h.firstPage,n.url,n.mimeType,n.width,n.height,n.hasAlpha,n.metadata,null,null,d,g.ActionUndoability.useDefault,n.id,n.allowSelection),(function(t,o){if(m&&r.resumeSave(),o)l.reject(new r.ActionError(o));else{n.isLowResImage&&r.suspendSave();var a=r.getImageFormaForURL(n.url),i=a.parent.isBackgroundImage()?a.parent:a;n.formaId=i.formaID,n.contentNodeId=i.contentID,q.push(i.contentID),r.events.publish("forma-added",{id:i.contentID,isLowResImage:n.isLowResImage}),e.delay((function(){m&&N.measure(U.preserveImageAdjustmentsForCutoutComplete,U.preserveImageAdjustmentsForCutout),l.resolve(n)}),10)}})),l.promise},r.replaceImageWithHighRes=function(t){z.assert("string"==typeof t.contentNodeId,"can not patch content node with contentNodeId"),z.assert("string"==typeof t.lowResImageUrl,"can not patch content node without lowResImageUrl");P.push((function(){var n=h.content.nodeByID(t.contentNodeId);if(n&&n.url===t.lowResImageUrl){var o=g.Matrix2D.uniformScaling(t.width>t.height?n.pixelWidth/t.width:n.pixelHeight/t.height),i=!1;if(e.each(r.imageFormas(),(function(e){e.contentNode.id===t.contentNodeId&&(a.beginPatch(),n.id!==t.id&&(n.componentID=t.id),n.mediaMetadata=t.metadata,n.url=t.url,n.pixelWidth=t.width,n.pixelHeight=t.height,n.mimeType=t.mimeType,n.hasAlpha=t.hasAlpha,s.imageAnalysis.updateHostImageCacheKey(t.lowResImageUrl,t.url),e.placement=o.concat(e.placement),e.invalidateCachedBounds(),i=!0,a.endPatch())})),!i)h.firstPage.formaByID(t.id)||(a.beginPatch(),n.mediaMetadata=t.metadata,n.url=t.url,n.pixelWidth=t.width,n.pixelHeight=t.height,n.mimeType=t.mimeType,n.hasAlpha=t.hasAlpha,s.imageAnalysis.updateHostImageCacheKey(t.lowResImageUrl,t.url),i=!0,a.endPatch())}}));var n=ue();return r.resumeSave(),n},r.updateVectorContentNodeWithComponent=function(e){P.push((function(){var t=h.content.nodeByID(e.contentNodeID);t&&"uploading svg"===t.url&&"vector"===t.kind&&(a.beginPatch(),t.url=e.url,t.componentID=e.componentID,a.endPatch())}));var t=ue();return r.resumeSave(),t},r.textLockupHighlight=function(){const e=r.beginTransaction("apply_lockup_highlight_box");var t=r.getSelectedForma();(new g.FormaCalloutUtils).applyLockupHighlightBox(t),r.endTransaction(e)},r.getStyleServiceMetaDataString=function(e){var t=null;if(null!=e){const{controller:n}=e,{text:o,size:{width:r,height:a}}=n,{tracking:i,spacing:l}=n.lockupStyle,{width:c,height:u}=e.page.pageSize,s=o.replace(/^\W+|\W+$/g,"").split(/\W+/g).length,d=n.numLines();t=`trng:${i},spng:${l},w:${Math.round(r)},h:${Math.round(a)},page_w:${Math.round(c)},page_h:${Math.round(u)},words:${s},lines:${d}`}return t},r.getCurrentDocumentSynthesizedName=function(){return h.getSynthesizedTitle()},r.getCurrentDocumentDescription=function(){return h.getSynthesizedDescription()},r.getDesignVariationsMetadata=function(){const e=h.firstPage.root;return{documentMetadata:{retargetDocumentData:g.RetargetCompatibilitySuggester.createRetargetDocumentData(e).encodeJson(),rootFrame:e.frame.encodeJson()}}},r.getRetargetInfo=function(){return{aspectRatio:r.getPageAspectRatio(),wordCount:r.getLockupWordCount(),iconCount:r.getIconCount(),imageCount:r.getRetargetableImageCount(),metadata:r.getDesignVariationsMetadata(),attemptLayout:g.RetargetSuggester.shouldAttemptLayoutSuggestion(h.firstPage.root),docId:r.getDocumentCCID()}},r.getGridForma=function(e){var t=h.firstPage.root.filterByControllerKind(g.GridController.KIND);return t.length>0?t[0]:e?h.firstPage.root.controller.createGridControllerIfNone().forma:null},r.getAllGridStyles=function(){var e=t.defer();return setTimeout((function(){try{var t=h.firstPage.layoutLibrary.getLayoutsForRoot(h.firstPage.root);e.resolve(t)}catch(t){e.reject(t)}}),0),e.promise},r.retrieveAndApplyASuggestedGridStyle=function(){var e=g.LayoutSuggester.createContentAwareSuggestions(h.firstPage.root);return e.length?r.applyGridStyle({name:e[0].name,gridStyle:e[0].gridStyle,silent:!1},0):t.resolve()},r.applyGridStyle=function(e,t){return r.canPan()&&r.fitToView(),pe(new g.SetGridStyleAction(e.gridStyle,t))},r.inAutomaticLayoutMode=function(){return h.controller.inAutomaticLayoutInteractionMode},r.enableAutomaticLayoutMode=function(){h.controller.setAutomaticLayoutInteractionMode();var e=r.getGridForma();if(e){var t=r.beginTransaction("inferGridCellAssignment");e.controller.inferGridCellAssignment(),r.endTransactionAndMergeWithPrevious(t),e.style.moveableShift=!0}},r.disableAutomaticLayoutMode=function(){h.controller.setDefaultInteractionMode()},r.enterCharStyleMode=function(){var e=r.getSelectedForma();e&&e.isTypeLockup()&&(r.inCharStyleMode=!0,he(new g.EnterCharStyleModeAction(e),(function(){ke(e),r.events.publish("enter-char-style-mode")})).done())},r.exitCharStyleMode=function(){if(r.inCharStyleMode){var e=r.getSelectedForma();r.inCharStyleMode=!1,r.exitingCharStyleMode=!0,e&&he(new g.ExitCharStyleModeAction(e),(function(){r.events.publish("text-forma-selected",{id:e.formaID,forma:e,selectionBoxes:[]}),r.events.publish("exit-char-style-mode")})).done()}},r.exitCharStyleModeAndSelect=function(){if(r.inCharStyleMode){var e=r.getAllSelectedFormas();0!==e.length&&e[0].isTypeLockup()&&(r.exitCharStyleMode(),r.deselect({silent:!0}),r.selectForma({forma:e[0]}),r.events.publish("forma-selected",{id:e[0].formaID,forma:e[0],selectionBox:re()}))}},r.toggleCharStyleLinesMethods=function(){var e=r.getSelectedForma();if(e&&e.isTypeLockup()){var t=e.controller;switch(t.highlightMethod){case g.HighlightMethod.EvenRows:t.highlightMethod=g.HighlightMethod.OddRows;break;case g.HighlightMethod.OddRows:t.highlightMethod=g.HighlightMethod.Bracket;break;case g.HighlightMethod.Bracket:t.highlightMethod=g.HighlightMethod.InsideBracket;break;default:t.highlightMethod=g.HighlightMethod.EvenRows}be(t,e)}},r.toggleCharStyleWordsMethods=function(){var e=r.getSelectedForma();if(e&&e.isTypeLockup()){var t=e.controller;t.highlightMethod===g.HighlightMethod.EvenWords?t.highlightMethod=g.HighlightMethod.OddWords:t.highlightMethod=g.HighlightMethod.EvenWords,be(t,e)}},r.clearStyleRanges=function(){var e=r.getSelectedForma();if(e&&e.isTypeLockup())return pe(new g.SetHighlightMethodAction(g.HighlightMethod.Manual))},r.getLayoutMargin=function(){var e=r.getGridForma();return null!=e?e.controller.margin:0},r.getLayoutSpacing=function(){var e=r.getGridForma();return null!=e?e.controller.spacing:0},r.setLayoutSpacing=function(e){return pe(new g.SetGridParametersAction(e,NaN))},r.setLayoutMargin=function(e){return pe(new g.SetGridParametersAction(NaN,e))},r.setLayoutSpacingAndMargin=function(e,t){var n=NaN,o=NaN;return e>=0&&(n=e),t>=0&&(o=t),pe(new g.SetGridParametersAction(n,o))},r.prepareForGridLayouts=function(){pe(new g.EnterGridLayoutModeAction)},r.inVisibleGridLayout=function(){var e=r.getGridForma();return null!=e&&e.style.gridCells.length>1},r.spacingChangesVisible=function(){var e=r.getGridForma();return null!=e&&e.controller.spacingChangesVisible},r.allowFlip=function(e){return e.controller.flippable},r.allowDuplication=function(e){return e.controller.duplicatable},r.allowCrop=function(e){return g.ImageFacade.canCropImage(e)},r.allowSetForeground=function(e){return g.ImageFacade.canSetFloatingImage(e)},r.allowSetBackground=function(e){return g.ImageFacade.canSetBackgroundImage(e)},r.allowDeletion=function(e){for(var t=!0,n=0;n<e.length;n++)if(!e[n].controller||!e[n].controller.deleteable){t=!1;break}return t},r.hasImageAttribution=function(t){if((t=t||r.getSelectedForma()).hasIntent(g.Forma.INTENT_ICON)||t.isImage()&&!t.isLogo()){var n=r.getImageFormaAttributionInfo(t);if(e.isEmpty(n))return!1;var o=n.sourceName;if(o&&-1!==["unsplash","pixabay","flickr","adobe stock","the noun project","giphy"].indexOf(o.toLowerCase()))return!0}return!1},r.isIcon=function(e){return!!(e=e||r.getSelectedForma()).hasIntent(g.Forma.INTENT_ICON)},r.isGiphy=function(e){return r.getImageFormaAttributionInfo(e).sourceName===g.MediaMetadata.kMediaGiphySourceName},r.formaOpacityChangeable=function(){var e=r.getSelectedForma();return!!e&&e.controller.opacityChangeable},r.getFormaOpacity=function(){return r.getSelectedForma().style.opacity},r.setFormaOpacity=function(e){return pe(new g.SetOpacityAction(e))},r.isFormaSwappable=function(e){return!!r.getGridForma()&&(e.controller&&!e.controller.moveable&&"Root"!==e.kind)},r.getSwappableForma=function(){for(var e=[],t=h.firstPage.root.visitAsArray(g.FormaTraversal.PreOrder),n=0;n<t.length;n++){var o=t[n];if(r.isFormaSwappable(o)){var a={forma:o,formaID:o.formaID};"Shape"===o.kind&&(a.type="shape",e.push(a)),"Frame"===o.kind&&(a.type="frame",e.push(a))}}return e},r.setSwapMode=function(e,t){F=e;var n=r.getSelectedForma();if(n&&"Frame"===n.kind){var o=n.childAt(0);!F&&t&&y&&(z.info("disable swap mode ",y),o.placement=y,y=null)}},r.getPointInDocumentSpace=function(e,t){var n=r.getDocumentSize(),o=n.width*e,a=n.height*t;return new g.TheoPoint(o,a)},r.getDesignHeight=function(){return r.getSelectedForma().root.finalFrame.height},r.getDocumentMetadataEvents=function(){return g.TheoDocumentUtils.getMetadataEvents(h,!1)},r.getMaxGridCells=function(){return g.GridController.MAX_CELL_COUNT},r.setPersistSave=function(e){return(w=e).initialize()},r.whenInitialized=function(){return A},r.updateColorInTheme=function(e,t){var n=p.solidColor2TheoColor(p.hex2SolidColor(e.color),e.id,e.roles),o=p.solidColor2TheoColor(p.hex2SolidColor(t.color),t.id,t.roles),r=h.firstPage.colorLibraryController.getKeyOfColorInTheme(n);return pe(new g.ModifyColorThemeAction(o,r))},r.isSparkColorInUse=function(e){return h.firstPage.colorLibraryController.isSparkColorInUse(e)},r.updateSparkColor=function(e){if(h.firstPage.colorLibraryController.isSparkColorInUse(e.sparkElementID)){const t=r.beginTransaction("update_spark_color");h.firstPage.colorLibraryController.updateSparkColor(e),r.endTransaction(t)}},r.areSparkFontsInUse=function(e){return g.TheoBrandkitUtils.areSparkFontsInUse(h,e)},r.updateSparkFont=function(e){if(g.TheoBrandkitUtils.areSparkFontsInUse(h,[e.id])){const t=r.beginTransaction("update_spark_font");g.TheoBrandkitUtils.updateSparkFont(h,e),r.endTransaction(t)}},r.relinkSparkFont=function(e,t){if(g.TheoBrandkitUtils.areSparkFontsInUse(h,[e])){const n=r.beginTransaction("relink_spark_font");g.TheoBrandkitUtils.relinkSparkFont(h,e,t),r.endTransaction(n)}},r.areSparkLogosInUse=function(e){return g.TheoBrandkitUtils.areSparkLogosInUse(h,e)},r.updateSparkLogo=function(e){if(g.TheoBrandkitUtils.areSparkLogosInUse(h,[e.id])){const t=r.beginTransaction("update_spark_logo");g.TheoBrandkitUtils.updateSparkLogo(h,e),r.endTransaction(t)}},r.relinkSparkLogo=function(e,t){if(g.TheoBrandkitUtils.areSparkLogosInUse(h,e)){const n=r.beginTransaction("relink_spark_logo");g.TheoBrandkitUtils.relinkSparkLogo(h,e,t),r.endTransaction(n)}},r.brandDocument=function(e){r.canPan()&&r.fitToView();var t=!(!e.fonts||!e.fonts.length),n=!(!e.logos||!e.logos.length),o=!(!e.colors||!e.colors.length);return pe(new g.BrandifyAction(e,t,n,o))},r.changeBranding=function(e){const t=h.authoringContextID,n=g.MultiBrandFacade.activeBrandkitID;return pe(new g.ChangeBrandingAction(e,t,n))},r.handleCurrentBrandChanged=function(e){r.events.publish("current-brand-changed",e)},r.addBranding=function(e){return s.setCoreWrapper(this),pe(new g.AddBrandingAction(e))},r.stripBranding=function(){return pe(new g.RemoveBrandingAction)},r.getBrandedElementsUsage=function(){return g.TheoBrandkitUtils.getDocumentBrandedElementsUsage(h,!0,!1)},r.includesUploadedFonts=function(){return r.getBrandedElementsUsage().indexOf(g.TheoBrandkitUtils.kBrandUsageCustomFont)>-1},r.getFontsUsed=function(){return g.TheoDocumentUtils.getFontsUsed(h)},r.getDocFontSourceUsage=function(){return g.TheoDocumentUtils.getFontSourceUsage(h)},r.getWatermarkEnabledForDoc=function(){if(!h)return z.error("Attempting to set watermarkEnabled with no document loaded."),!1;const e=s.isFeatureEnabled("entitle-brand-kit"),t=!("watermarkEnabled"in h)||h.watermarkEnabled;return t&&e?(r.setWatermarkEnabledForDoc(!1),!1):t},r.setWatermarkEnabledForDoc=function(e){h?pe(new g.SetWatermarkAction(e)).done():z.error("Attempting to set watermarkEnabled with no document loaded.")},r.getImageFormaAttributionInfo=function(e){return e&&(t=e.kind===g.ImageForma.KIND||e.hasIntent(g.Forma.INTENT_ICON)?e.contentNode:e.childAt(0).contentNode)&&t.mediaMetadata||{};var t},r.setAuthoringContextThemeId=function(e){const t=r.beginTransaction("set branded template ID");h.authoringContextThemeID=e,r.endTransactionAndMergeWithPrevious(t)},r.getAuthoringContextThemeId=function(){return h.authoringContextThemeID},r.updateConstrainedImages=function(){g.TheoDocumentUtils.updateConstrainedImageInfo(h)},r.getConstrainedImages=function(){return h.constrainedImages},r.getHighlightMethodEnum=function(){return g.HighlightMethod},r.synthesizeEmptyImages=function(){h.content.root.visitAll((function(e){if("image"===e.kind&&null==e.url){var t=document.createElement("canvas"),n=t.getContext("2d");t.width=e.pixelWidth,t.height=e.pixelHeight;var o=n.createLinearGradient(0,0,t.width,t.height),r=e.imageColorData;r.sort((function(e,t){return e.coverage<t.coverage?1:e.coverage>t.coverage?-1:0})),r.length>1?(o.addColorStop(0,"#"+r[0].rgbColor.hex.substring(0,6)),o.addColorStop(1,"#"+r[1].rgbColor.hex.substring(0,6))):(o.addColorStop(0,"#000"),o.addColorStop(1,"#fff")),n.fillStyle=o,n.fillRect(0,0,t.width,t.height),e.componentID=g.GUIDUtils.makeGUID(),e.url=t.toDataURL()}}))},r.setRemixParentCpId=function(e){const t=r.beginTransaction("set-remix-parent");h.setRemixParentCpId(e),r.endTransactionAndMergeWithPrevious(t)},r.getRemixParentsCpIds=function(){return h.remixAncestorsCpAssetIDs},r.getRemixAncestorsIntoMachineTags=function(e){return T.getRemixAncestorsIntoMachineTags(e,h)},r.getEditorModelColorSelection=function(){var e=h.controller.model.attributes.find(g.ColorAttribute.KEY);return e?e.colors:[]},r.setDocumentName=function(e){const t=r.beginTransaction("set_document_name");h.documentName=e,r.endTransactionAndMergeWithPrevious(t)},r.getDocumentName=function(){return h.documentName},r.inRefineCutoutMode=function(){return h.controller.selection.inRefineCutoutMode},r.refineCutoutGestureInProgress=function(){return r.inRefineCutoutMode()&&!!Z.hasPendingBrushStroke},r.enterRefineCutoutMode=async function(e){const t=g.ImageFacade.getImageFormaForForma(r.getSelectedForma());if(t)return Z.enter(t,e).then(()=>{r.events.publish("force-ui-state-update")})},r.exitRefineCutoutMode=async function(e){if(r.inRefineCutoutMode())return r.events.publish("clear-refine-cutout-visualization"),Z.exit(e).finally(()=>r.events.publish("exit-refine-cutout-mode"))},r.isInvertCutoutEnabled=function(){return r.inRefineCutoutMode()&&Z.isInvertCutoutEnabled()},r.invertCutout=async function(){if(r.inRefineCutoutMode())return Z.invertCutout()},r.isClearCutoutEnabled=function(){return r.inRefineCutoutMode()&&Z.isClearCutoutEnabled()},r.clearCutout=async function(){if(r.inRefineCutoutMode())return Z.clearCutout()},r.isAutoCutoutEnabled=function(){return r.inRefineCutoutMode()&&Z.enableAutoCutout()},r.autoCutoutForRefineCutout=async function(){if(r.inRefineCutoutMode())return Z.autoCutoutForRefineCutout()},r.getCutoutBrushSize=function(){return Z.getBrushSize()},r.getCutoutEffectiveBrushSize=function(){return Z.getEffectiveBrushSize()},r.setCutoutBrushSize=function(e){if(r.inRefineCutoutMode()){const t=parseFloat(e);isNaN(t)||Z.setBrushSize(t)}},r.adjustCutoutBrushSize=function(e){if(r.inRefineCutoutMode()){const t=Z.getBrushSize(),n=Math.max(Math.min(t+e,B.MAX_BRUSH_SIZE),B.MIN_BRUSH_SIZE);t!==n&&Z.setBrushSize(n)&&r.events.publish("force-ui-state-update")}},r.getCutoutBrushMode=function(){return Z.getBrushMode()},r.setCutoutBrushMode=async function(e,t){if(r.inRefineCutoutMode())return Z.setBrushMode(e,t).then(()=>r.events.publish("force-ui-state-update"))},r.toggleRefineCutoutBrushMode=async function(e){if(r.inRefineCutoutMode())return Z.toggleBrushMode(e).then(()=>r.events.publish("force-ui-state-update"))},r.isCutoutPreviewVisible=function(){return r.inRefineCutoutMode()&&Z.isOriginalPreviewVisible()},r.toggleCutoutPreviewVisibility=function(){r.inRefineCutoutMode()&&Z.togglePreviewVisible().then(()=>r.events.publish("force-ui-state-update"))},r.tryPremiumCutoutFeature=function(e,t){r.inRefineCutoutMode()&&Z.showMerchPopover(e,t)},r.handlePointerChanged=function(e){var t=new g.TheoPoint(e.x,e.y);const n=r.getSelectedForma();if(n&&n.controller&&r.inRefineCutoutMode())!function(e,t,n){if(r.getCutoutBrushMode()===E.NONE)return;if("pointerUp"===n)return void Z.updateMask().then(()=>r.events.publish("clear-refine-cutout-visualization"));const o=g.ImageFacade.getFrameFormaForForma(e);if(!o)return;const a=o.bounds;if(!a)return;const i=o.page.root.bounds;if(!i)return;if(!i.containsPoint(t))return void Z.endBrushStroke();const l=o.totalPlacement.inverse;if(!l)return;const c=l.transformPoint(t);if(!a.containsPoint(c))return void Z.endBrushStroke();const u=g.ImageFacade.getImageFormaForForma(e);if(!u)return;const s=u.bounds;if(!s)return;const d=u.totalPlacement.inverse;if(!d)return;const m=d.transformPoint(t);var f=m.x/s.width,p=m.y/s.height;const S=!Z.hasPendingBrushStroke;if(Z.recordGesture(f,p)){f=c.x/a.width,p=c.y/a.height;const t=h.controller.model.view.getScale(),n={start:S,xRelative:f,yRelative:p,brushSize:Z.getEffectiveBrushSize()*t,isAdditive:Z.getBrushMode()===E.ADDITIVE,viewScale:t};if(S){const t=g.ImageFacade.getCutoutMaskFormaForForma(e);if(t){n.maskCTM=t.totalPlacement;const e=t.bounds;n.maskWidth=e.width,n.maskHeight=e.height;const o=t.contentNode;o&&(n.maskPixelWidth=o.pixelWidth,n.maskPixelHeight=o.pixelHeight)}}r.events.publish("update-refine-cutout-visualization",n)}}(n,t,e.updateType);else{var o="touch"===e.pointerType?1:0,a=s.async.getSystemUptimeInSeconds(),i=new g.PointerUpdate(""+e.pointerId,o,h.firstPage,t,a);i.tapCount=e.tapCount,i.modifierKeys=e.modifierKeys,"pointerDown"===e.updateType?h.controller.pointers.onPointersDown([i]):"pointerMove"===e.updateType?h.controller.pointers.onPointersMoved([i]):"pointerUp"===e.updateType&&h.controller.pointers.onPointersUp([i])}},r.getZoomLevels=function(e){var t=function(e){if(!0===e){const e=r.getMinZoom();return[r.getMaxZoom(),6,4,3,2,1.5,1.25,1,.75,.5,.33,.25,.16,.1,e]}return[4,2,1.5,1,.75,.5,.25,.1]}(e);if(!0===e){const e=r.getFitScale();-1===t.indexOf(e)&&t.push(e);const n=r.getFillScale();return-1===t.indexOf(n)&&t.push(n),t.sort((function(e,t){return t-e})),t}return t},r.getMinZoom=function(){return h.controller.designController.view.getMinScale()},r.getMaxZoom=function(){return h.controller.designController.view.getMaxScale()},r.getNextZoomLevel=function(e){const t=h.controller.model.view.getScale(),n=r.getZoomLevels(!0),o=n.length;var a;var i=t;if(e){const e=r.getMaxZoom();if(t>=e)return e;for(a=o-1;a>=0;a--){const e=n[a];if(e>=t+.05||0==a){i=e;break}}}else{const e=r.getMinZoom();if(t<=e)return e;for(a=0;a<o;a++){const e=n[a];if(e<=t-.05||a==o-1){i=e;break}}}return i},r.getFit=function(){return h.controller.model.view.getFit()},r.getFill=function(){return h.controller.model.view.getFill()},r.getFitScale=function(){return h.controller.designController.view.getFitScale()},r.getFillScale=function(){return h.controller.designController.view.getFillScale()},r.getViewScale=function(){return h.controller.model.view.getScale()},r.getViewSize=function(){return h.controller.model.view.getViewSize()},r.getMargin=function(){return h.controller.model.view.getMargin()},r.getViewToDocMatrix=function(){return h.controller.designController.view.getViewToDocMatrix()},r.getFullCanvasGraph=function(e,t){void 0===t&&(t=r.getWatermarkEnabledForDoc());return h.controller.designController.view.getFullCanvasGraph(e,t)},r.setViewSize=function(e){h.controller.designController.view.setViewSize(e)},r.fitToView=function(){h.controller.designController.view.fitToView()},r.fillToView=function(){h.controller.designController.view.fillToView()},r.zoomTo=function(e){h.controller.designController.view.zoomTo(e)},r.zoomToPoint=function(e,t,n){h.controller.designController.view.zoomToPoint(e,t,n)},r.canPan=function(){return h.controller.designController.view.canPan()},r.panBy=function(e){h.controller.designController.view.panBy(e)},r.getGroupFeatures=function(){var e=h.controller.model.featureSets.find(g.FormaEditFeature.KEY);return{canGroup:e&&e.canGroup,canUngroup:e&&e.canUngroup}},r.getSettableFeatures=function(){var e={},t=h.controller.model.featureSets.find(g.AlignSpacingAttributesFeature.KEY);e.canAlign=t&&t.canAlign,e.canDistribute=t&&t.canDistribute;var n=h.controller.model.featureSets.find(g.OpacityAttributesFeature.KEY);e.opacity=!!n;var o=h.controller.model.featureSets.find(g.ImageFeature.KEY);return e.imageFilter=!!o&&o.canApplyFilter,e},r.getAlignmentTypes=function(){return g.AlignmentType},r.getDistributeTypes=function(){return g.DistributeType},r.setOpacityForSelectedFormae=function(e){return pe(new g.SetOpacityAction(e))},r.getOpacityValuesForSelectedFormae=function(){return h.controller.model.attributes.find(g.OpacityAttribute.KEY).opacities},r.setAlignmentForSelectedFormae=function(e){return pe(new g.AlignFormaeAction(e))},r.distributeSelectedFormae=function(e){return pe(new g.DistributeFormaeAction(e))},r.animate=function(){r.events.publish("animate")},r.downloadAnimation=function(){r.events.publish("download-animation")},r.beginTransaction=function(e){if(e)return _.beginTransaction(h,e);z.error("no name provided for transaction.")},r.endTransactionAndMergeWithPrevious=function(e){_.endTransaction(e,!0)},r.endTransaction=function(e){_.endTransaction(e,!1)},r.containsBrandedContent=function(){return g.BrandingFacade.doesDocumentContainBrandedElements(h,!1)},r.updateCharStyleRanges=function(e,t,n){const o=r.getSelectedForma();if(o)return g.TextFacade.adjustCharStyleRanges(o,e,t,n);z.warn("updateCharStyleRanges called when there is no selection?")},r.missingFontListInDoc=function(){return h.missingFontList},r.setCPProjectID=function(e){if(h){const t=r.beginTransaction("setCPProjectID");h.publishedResourcePath=e,r.endTransactionAndMergeWithPrevious(t)}},r.setCommunityPlatformAlias=function(e){if(h){const t=r.beginTransaction("setCommunityPlatformAlias");h.communityPlatformAlias=e,r.endTransactionAndMergeWithPrevious(t)}},r.setCommunityPlatformAssetID=function(e){if(h){const t=r.beginTransaction("setCommunityPlatformAssetID");h.communityPlatformAssetID=e,r.endTransactionAndMergeWithPrevious(t)}},r.setPublishedEtag=function(e){if(h){const t=r.beginTransaction("setPublishedEtag");h.publishedEtag=e,r.endTransactionAndMergeWithPrevious(t)}},r.updatePublishData=function(e){const{cPProjectID:t,cPAlias:n,cPAssetID:o,cPublishedEtag:a}=e;if(h){const e=r.beginTransaction("updatePublishData");h.publishedResourcePath=t,h.communityPlatformAlias=n,h.communityPlatformAssetID=o,h.publishedEtag=a,r.endTransactionAndMergeWithPrevious(e)}},r.getIsExported=function(){return h?h.isExported:null},r.setIsExported=function(e){if(h){const t=r.beginTransaction("setIsExported");h.isExported=e,r.endTransactionAndMergeWithPrevious(t)}},r.getDisplayableAnimationStyles=function(){return g.AnimationLibrary.getDisplayableAnimationStyles(h.firstPage.root)},r.hasAnimationStyle=function(){const e=h.firstPage.animationController.animationStyle;return null!==e&&e.name!==g.AnimationStyle.NAME_NO_STYLE},r.getCurrentAnimationStyle=function(){return h.firstPage.animationController.animationStyle},r.getCoreAnimationStyle=function(){return g.AnimationStyle},r.setAnimationStyle=function(e,n){const o=h.firstPage.animationLibrary.getAnimationStyle(e);if(o){if(n>0){var a=o.clone();return a.variant=n,r.applyAnimationStyleAction(a)}return r.applyAnimationStyleAction(o)}return t.reject()},r.applyAnimationStyleAction=function(e){return pe(new g.ApplyAnimationStyleAction(e,h.firstPage))},r.removeContentForCorruptImageFrame=function(e){const t=h.content.root.nodeByID(e);if(Ae(t)){const e=r.beginTransaction("removeCorruptContentNode");t.parent&&t.parent.removeChild(t),t.releaseResources(),r.endTransactionAndMergeWithPrevious(e)}},r.replaceCorruptImageFrames=function(){const e=[];let t;h.content.root.visitAll(n=>{Ae(n)&&(t||(t=r.beginTransaction("removeCorruptContentNodes")),e.push(n.id),n.parent&&n.parent.removeChild(n),n.releaseResources())});const n=e.length>0;if(0===e.length)return n;const o=r.imageFormas().filter(t=>e.indexOf(t.contentID)>=0);if(o.length){const e=p.solidColor2TheoColor(p.hex2SolidColor("FF0000"),null,null);g.ImageFacade.replaceImagesWithColors(o,[e])}return t&&(t=r.endTransactionAndMergeWithPrevious(t)),n},r.willCloseDocument=function(){h.willCloseDocument(),s.imageAnalysis.tearDown()},r.requestSave=function(e,t){e=!!e,t=!!t,h.controller.saveMgr.requestSave(e,t)},r.triggerPlatformSave=function(e){var t=new g.DeferredPromise;return r.events.publish("trigger-save",{coreDeferred:t,stateID:e}),t.promise},r.cancelPendingSaves=function(){h.controller.saveMgr.cancelPendingSave()},r.executePendingSaves=function(){h.controller.saveMgr.flushPendingSave()},r.suspendSave=function(){h.controller.saveMgr.suspend()},r.resumeSave=function(){h.controller.saveMgr.resume()},r.pendingSave=function(){return h.controller.saveMgr.pendingSave},r.saveManager=function(){return h.controller.saveMgr},r.triggerAssert=function(e){g.LegacyCoreAssert.fail(e)},r.getLockupAlignments=function(){return g.LockupAlignment},r.getLockupLayouts=function(){return g.LockupLayout},r.getTextPathIDs=function(){return g.TextPathID},r.getSelectedFormaScaleAsScalar=function(){const e=r.getSelectedFormaScale(),t=r.getSelectedFormaScaleRange(),n=t.max-t.min;return(e-t.min)/n},r.setSelectedFormaScaleAsScalar=function(e){let t=r.getSelectedForma();"Frame"!==t.kind||t.controller.moveable&&!r.inCropMode()||(t=t.childAt(0));const n=r.getSelectedFormaScaleRange(),o=n.max-n.min,a=(n.min+e*o)/t.placement.extractedScale.scale.x;return pe(new g.ScaleAction(a,[t]))},r.getSelectedFormaRotationAsScalar=function(){return(((r.getSelectedFormaRotation()+179)%360+360)%360+1)/360},r.setSelectedFormaRotationAsScalar=function(e){const n=r.getSelectedForma(),o=360*(e-.5)*Math.PI/180,a=r.getSelectedFormaPlacement(),i=a&&a.placement;if(!i)return g.LegacyCoreAssert.fail("Trying to rotate image, but could not get current placement of image"),t.resolve();const l=o-ve(i),c=J||i;return pe(new g.RotateAction(l,c,[n],!0))},r.convertSliderValueToLogScale=function(e){return Math.log(4*e+1)/Math.log(5)},r.convertLogValueToSliderScale=function(e){return(Math.exp(e*Math.log(5))-1)/4},r.getOpacityValueOfSelectedFormaAsScalar=function(){var e=r.getSelectedForma();return e&&e.controller?r.convertLogValueToSliderScale(g.OpacityFacade.getOpacityForForma(e)):1},r.setOpacityValueOfSelectedFormaAsScalar=function(e){const t=r.convertSliderValueToLogScale(e);return r.setOpacityForSelectedFormae(t)},r.getOpacityValuesOfLockupAsScalars=function(){var e=r.getSelectedForma();return e&&e.controller?{text:r.convertLogValueToSliderScale(g.OpacityFacade.getOpacityForForma(e)),shape:r.convertLogValueToSliderScale(g.OpacityFacade.getShapeOpacityForForma(e))}:{text:1,shape:1}},r.setOpacityValueOfSelectedLockupAsScalar=function(e,t){let n;const o=r.convertSliderValueToLogScale(e);return n=t?new g.SetShapeOpacityAction(o):new g.SetTextOpacityAction(o),pe(n)},r.getSelectedFormaLetterSpacingAsScalar=function(){return r.getLetterSpacingSelectedLockup()||0},r.setSelectedFormaLetterSpacingAsScalar=function(e){return r.setLetterSpacingForSelectedLockup(e)},r.getSelectedFormaLineHeightAsScalar=function(){return r.getSpacingAndPaddingOfSelectedLockup().spacing},r.setSelectedFormaLineHeightAsScalar=function(e){return r.setSpacingForSelectedLockup(e)},r.getSelectedFormaShapePaddingAsScalar=function(){return r.getSpacingAndPaddingOfSelectedLockup().padding},r.setSelectedFormaShapePaddingAsScalar=function(e){return r.setPaddingForSelectedLockup(e)},r.getSelectedFormaShadowDistanceAsScalar=function(){return Ie(r.getShadowOffsetOfSelectedLockupForUI(),{min:1,max:100},{min:0,max:1})},r.setSelectedFormaShadowDistanceAsScalar=function(e){const t=Ie(e,{min:0,max:1},{min:1,max:100});return r.setShadowOffsetOfSelectedLockup(t)},r.getSelectedFormaShadowAngleAsScalar=function(){return Ie(r.getShadowAngleOfSelectedLockup(),{min:-179,max:180},{min:0,max:1})},r.setSelectedFormaShadowAngleAsScalar=function(e){const t=Ie(e,{min:0,max:1},{min:-179,max:180});return r.setShadowAngleOfSelectedLockup(t)},r.getSelectedFormaOutlineThicknessAsScalar=function(){return Ie(r.getStrokeWeightOfSelectedLockupForUI(),{min:1,max:100},{min:0,max:1})},r.setSelectedFormaOutlineThicknessAsScalar=function(e){const t=Ie(e,{min:0,max:1},{min:1,max:100});return r.setStrokeWeightSelectedLockup(t)},r.getSelectedFormaImageAdjustmentsAsScalars=function(){const e=r.getImageAdjustments(),t={min:-100,max:100},n={min:0,max:100},o={min:0,max:1};return{blur:Ie(e.blur,n,o),sharpness:Ie(e.sharpness,n,o),contrast:Ie(e.contrast,t,o),saturation:Ie(e.saturation,t,o),brightness:Ie(e.brightness,t,o),shadows:Ie(e.shadows,t,o),highlights:Ie(e.highlights,t,o),warmth:Ie(e.warmth,t,o)}},r.setSelectedFormaImageAdjustmentAsScalar=function(e,t){let n={min:-100,max:100};"sharpness"!==e&&"blur"!==e||(n={min:0,max:100});const o=Ie(t,{min:0,max:1},n),a={};return a[e]=o,r.changeImageAdjustments(a)},r.getMinFontSize=function(){var e=g.TextFacade.getStandardFontSizes(),t=r.getUserFontSizesInDocument(),n=g.TextFacade.getMinimumFontSize();return Math.min(...t,...e,n)},r.getMaxFontSize=function(){var e=g.TextFacade.getStandardFontSizes(),t=r.getUserFontSizesInDocument(),n=g.TextFacade.getMaximumFontSize();return Math.max(...t,...e,n)},r.onDoubleTap=function(){r.events.publish("layer-double-tapped")},r.isReordering=function(){return $},r.selectFromLayerStack=function(){return Q},r.imageQueue=function(){return l||(l=(new K).imageService.createQueue(new V(this))),l},function(){L=o.persistSource||m.fromDocument(o.dcxDoc),w=o.persistSave||f.toDocument(o.dcxDoc),Z=new B(r);var t=!1;A=L.open().then((function(e){return(t=e.hadMissingFontsWhenOpened)?R.loadMissingFonts(e.missingFontList):e})).then((function(e){return t?L.open():e})).then((function(e){return t=e.hadMissingFontsWhenOpened,h=e,r.suspendSave(),h.controller.selection.subscribeWithCallback(Fe,g.SelectionStateChangedMessage.TYPE),w.initialize()})).then((function(){const t=r.beginTransaction("create-grid-controller");return h.firstPage.root.controller.createGridControllerIfNone(),r.endTransactionAndMergeWithPrevious(t),a=h.controller.undoRedoMgr,h.controller.designControllerHandlesPointers=!0,h.controller.enableMoveableChildren=!0,a.subscribeWithCallback((function(e){if(e.changeType===g.UndoRedoMessage.UNDO_REDO_GESTURE_BEGIN?b.disableCustomKeyboardShortcuts=!0:e.changeType===g.UndoRedoMessage.UNDO_REDO_GESTURE_END&&(b.disableCustomKeyboardShortcuts=!1),e.changeType===g.UndoRedoMessage.UNDO_REDO_CHANGE||e.changeType===g.UndoRedoMessage.UNDO_REDO_STATE_CLEAN){if(!a.gestureScope){Ce(!r.inRefineCutoutMode(),!0);var t=r.getSelectedForma(),n=r.getSelectedFormaId();n&&(r.inCharStyleMode&&t.isTypeLockup()?(t.controller.selectCharStyleForma(),ke(t)):(r.exitCharStyleMode(),r.events.publish("forma-selected",{id:n,forma:t,selectionBox:re()}))),g.MultiBrandFacade.handleUndoRedoMessage(e),r.events.publish("undo-redo-state-changed",{changeType:e.changeType}),ne()}}else"state-updated"===e.changeType?Ce(!1):"timeline-changed"===e.changeType&&r.events.publish("undo-redo-state-changed",{changeType:e.changeType})}),g.UndoRedoMessage.TYPE),a.registerPatch((function(t){e.each(P,(function(e){e()})),t()})),r.events.publish("undo-redo-state-changed"),v=!0,ne(),!0}))}(),r}}.apply(t,o))||(e.exports=r)}}]);
//# sourceMappingURL=post-render-action-view_post-render-doc-view_theo-publish-impl_theo-web-controller_theo-web-headless_de6ea8b9-42c8012a.js.map