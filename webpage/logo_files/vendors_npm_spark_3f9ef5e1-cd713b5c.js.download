(window.webpackJsonptheoWebApp=window.webpackJsonptheoWebApp||[]).push([[20],{"6NRR":function(e,t,n){var o,i,a,r=t,l=n("oAGj"),s=n("VQVe"),m=n("gXiO"),u=n("ascj"),c=n("FNB+"),y=n("URxh"),d=n("6ZWm"),f=n("cmoc"),p=n("P83h"),v=n("pnSN"),T=n("SDdr"),A=n("lmwz"),h=n("fNpk"),F=n("c+uM"),S=n("tGKA"),g=n("K17h"),L=n("djAF"),I=n("enh0"),x=n("8t9B"),k=n("90dd"),D=n("RkYL"),C=n("xm77"),M=n("zjod");r.KeyFrameSet=(o=function(){},l.defineClass({name:"KeyFrameSet",ctor:o}),o),r.AnimationRequestStopMessage=(i=function e(t){k.TheoMessage.call(this,e.TYPE,t)},l.defineClass({name:"AnimationRequestStopMessage",ctor:i,superName:"TheoMessage",statics:{TYPE:{get:function(){return"AnimationRequestStopMessage"}}}}),i),r.AnimationController=(a=function(e){this.staticStateTransaction_=null,this.document_=e,this.staticState_={},this.playing_=!1,this.postAnimationCallbacks_=null,m.CoreObject.call(this)},l.defineClass({name:"AnimationController",ctor:a,superName:"CoreObject",props:{playing:{get:function(){return this.playing_},set:function(e){this.playing_=e}},hasVideos:{get:function(){var e;return!!(e=this.document_)&&e.firstPage.root.filterWithCallback((function(e){return e instanceof M.VideoForma})).length>0}},hasTrueVideos:{get:function(){var e;return!!(e=this.document_)&&e.firstPage.root.filterWithCallback((function(e){var t;return!!(t=l.as(e,M.VideoForma))&&!t.isSticker()})).length>0}},hasAnimation:{get:function(){return this.hasVideos||this.hasAnimatedFormae}},hasAnimatedFormae:{get:function(){return null!=this.animationStyle&&!this.animationStyle.isNoStyle()&&0==!l.clone(this.document_.firstPage.root.filterWithCallback((function(e){return null!=e.animation||e.isVideo()}))).length}},gifStartTimeIndex:{get:function(){var e;if(e=this.animationStyle){var t=l.clone(this.document_.firstPage.root.filterWithCallback((function(e){return e instanceof M.VideoForma&&e.videoContentNode.isGIF})));if(0==t.length)return 0;for(var n=e.startTime.seconds,o=l.iter(t);!o.done;o.next()){var i,a=o.value;(i=l.opt(a.animation,(function(e){return e.keyFrames})))&&i.length>1&&(n=Math.max(n,i[1].time.seconds))}for(var r=l.clone(this.times),s=l.iter(l.range(0,r.length-1,!1));!s.done;s.next()){var m=s.value;if(n>=r[m].seconds&&n<r[m+1].seconds)return m}}return 0}},animationStyle:{get:function(){return g.MotionUtils.getCurrentAnimationStyle(this.document_)},set:function(e){var t,n=e;if(null==n&&(n=s.AnimationStyle.init_b946(s.AnimationStyle.NAME_NO_STYLE)),t=this.document_){var o=new p.AnimationStyleChangedEvent(t.firstPage.root);t.firstPage.root.beginUpdate(o),t.firstPage.animationLibrary.modifyModelForAnimation(n,t.firstPage.root),t.firstPage.root.endUpdate(o)}}},isCurrentAnimationValid:{get:function(){return g.MotionUtils.isCurrentAnimationValid(this.document_)}},duration:{get:function(){return l.last(this.times)||D.TheoTime.Zero}},times:{get:function(){var e;if(e=this.animationStyle){for(var t=[],n=e.endTime.value,o=l.toInt(e.endTime.timescale/s.AnimationStyle.DEFAULT_TIMESCALE),i=l.iter(l.stride(0,n,o));!i.done;i.next()){var a=i.value;t.push(new D.TheoTime(a,e.endTime.timescale))}return 0==t.length&&this.document_.firstPage.root.visitAll(c.FormaTraversal.PreOrder,(function(e){var n,o;(n=l.as(e,M.VideoForma))&&(o=l.opt(n.videoContentNode,(function(e){return e.times})))&&(t=l.clone(o))})),t}return[]}},preAnimation:function(){h.LegacyCoreAssert.isTrue(null==this.staticStateTransaction_,"preAnimation called with outstanding animation transaction",void 0,"AnimationController.preAnimation","AnimationController.swift",193),this.staticStateTransaction_=this.document_.beginTransaction("Animation")},postAnimation:function(){l.opt(this.staticStateTransaction_,(function(e){return e.rollback()})),this.staticStateTransaction_=null},processStopAnimationCallbacks:function(){var e;if(e=this.postAnimationCallbacks_){for(var t=l.iter(e);!t.done;t.next())(0,t.value)();this.postAnimationCallbacks_=null}},saveStaticState:function(){var e=this;this.staticState_={},this.document_.firstPage.root.visitAll(c.FormaTraversal.PreOrder,(function(t){if(null!=t.animation){var n=t.style.clone(),o=new y.KeyFrame(D.TheoTime.Zero,C.TimingFunctionType.Linear,t.placement,t.bounds,n);null!=n&&t.kind==M.VideoForma.KIND&&0==n.opacity&&l.info("opacity is 0?"),e.staticState_[t.formaID]=o}}))},revertToStaticState:function(){var e;if(null!=this.document_){if(e=this.staticState_)for(var t=l.iter(e);!t.done;t.next()){var n,o,i=t.key,a=t.value;if((n=l.opt(this.document_,(function(e){return e.firstPage.root.formaByID(i)})))&&a.style&&(o=l.as(n,I.TextForma))){var r=new p.FormaStyleChangedEvent(o);o.beginUpdate(r),o.renderRuns.clear(),o.endUpdate(r)}}}else h.LegacyCoreAssert.fail("no document. really?",void 0,"AnimationController.revertToStaticState","AnimationController.swift",238)},determineKeyFrameSetForTime:function(e,t){var n=new r.KeyFrameSet,o=e.keyFrames.length;if(o>0){for(var i=t.seconds,a=l.iter(l.toSequence(e.keyFrames));!a.done;a.next()){var s=a.value,m=s.offset,u=s.element;if(u.time.seconds>=i){n.kfB=u,m>0&&(n.kfA=e.keyFrames[m-1]);break}}null==n.kfB&&(n.kfA=e.keyFrames[o-1])}return n},determineAlpha:function(e,t){var n=1;if(null!=e.kfB&&null!=e.kfA){var o=new C.TheoTimingFunction(e.kfB.timingFunction),i=(t.seconds-e.kfA.time.seconds)/(e.kfB.time.seconds-e.kfA.time.seconds);n=o.evalX(i)}return n},determinePlacementShift:function(e,t){var n,o,i=S.Matrix2D.Identity;return(n=l.opt(e.kfA,(function(e){return e.placement})))?i=(o=l.opt(e.kfB,(function(e){return e.placement})))?n.interpolateWith(o,t):n:(o=l.opt(e.kfB,(function(e){return e.placement})))&&(i=o),i},moveToTime:function(e){var t=this;if(null==this.document_)return h.LegacyCoreAssert.fail("no document. really?",void 0,"AnimationController.moveToTime","AnimationController.swift",321),!1;if(null==this.staticState_)return h.LegacyCoreAssert.fail("no static state defined",void 0,"AnimationController.moveToTime","AnimationController.swift",326),!1;var n,o=!1,i=new p.FormaStyleChangedEvent(this.document_.firstPage.root);if(l.opt(this.document_,(function(e){return e.firstPage.beginUpdate(i)})),l.opt(this.document_,(function(n){return n.firstPage.root.visitAll(c.FormaTraversal.PreOrder,(function(n){var i,a;if((i=n.animation)&&(a=t.staticState_[n.formaID])){var r=t.determineKeyFrameSetForTime(i,e);if(null!=r.kfA||null!=r.kfB){o=!0;var m,u,y,h=t.determineAlpha(r,e),S=a.placement,g=t.determinePlacementShift(r,h);n.placement=S.concat(g),(m=l.opt(r.kfA,(function(e){return e.bounds})))&&(u=l.opt(r.kfB,(function(e){return e.bounds})))&&(m.equalWithAccuracy(u,.01)||(n.bounds=m.interpolateWith(u,h),(y=l.as(n.controller,d.FrameController))&&y.fitChildrenToFrame()));var k=l.opt(r.kfA,(function(e){return e.style})),D=l.opt(r.kfB,(function(e){return e.style}));if(null==k&&null==D)return;null==k?k=D:null==D&&(D=k);var C,M,_,b=new p.FormaStyleChangedEvent(n);if(n.beginUpdate(b),t.setBlendedRoles(n.style.colors,k.colors,D.colors,h),(C=l.as(k,F.LockupStyle))&&(M=l.as(D,F.LockupStyle))&&(_=l.as(n.style,F.LockupStyle)))for(var R=l.keys(_.characterStyles),w=l.iter(R);!w.done;w.next()){var E,N,K,O=w.value;(E=C.characterStyles[O])&&(N=M.characterStyles[O])&&(K=_.characterStyles[O])&&t.setBlendedRoles(K.colors,E.colors,N.colors,h)}var P,U=(1-h)*k.opacity+h*D.opacity,V=l.as(l.opt(l.opt(l.as(n,I.TextForma),(function(e){return e.lockupForma})),(function(e){return e.controller})),x.TypeLockupController);if(n.isTypeLockup()||null!=V){var B,W,G,Y=U,j=U;if((B=l.as(k,F.LockupStyle))&&(W=l.as(D,F.LockupStyle))&&(Y=(1-h)*B.textOpacity+h*W.textOpacity,j=(1-h)*B.backingOpacity+h*W.backingOpacity),n.kind==L.ShapeForma.KIND)l.opt(n.parent,(function(e){return e.style.opacity=j}));else if(G=l.as(n,I.TextForma))if(i.animationStyle.modifiesFormaTree){n.style.opacity=Y;var q=(r.kfB||r.kfA).renderRuns;null!=r.kfB&&null!=r.kfA&&r.kfA.renderRuns.fillColors.runArrays.length>1&&0==q.fillColors.runArrays.length?G.renderRuns.setAlphaFromAnimation(r.kfA.renderRuns,q,h):G.renderRuns=q.clone()}else n.style.opacity=Y;else n.kind==v.GroupForma.KIND&&n.visitAll(c.FormaTraversal.PreOrder,(function(e){e instanceof I.TextForma&&l.opt(e.parent,(function(e){return e.style.opacity=Y})),e instanceof L.ShapeForma&&l.opt(e.parent,(function(e){return e.style.opacity=j}))}))}else if(n.kind==f.FrameForma.KIND){var Z;(Z=A.ImageFacade.getImageFormaForForma(n))&&(Z.style.opacity=U)}else n.style.opacity=U;if(null!=k.filter&&null!=D.filter)if(i.animationStyle.name==s.AnimationStyle.NAME_BLUR){if(P=k.clone()){P.colorLibrary=k.colorLibrary;var H=k.filter.blurRadius,z=D.filter.blurRadius;P.filter.blurRadius=(1-h)*H+h*z,n.applyStyle(P)}}else if(!l.opt(k.filter,(function(e){return e.equals(D.filter)}))){var X=T.AlphaBlendFilter.init_fa22(void 0,h,k.filter,D.filter);X.style=n.style,n.style.filter=X}n.endUpdate(b)}}}))})),n=l.opt(this.document_,(function(e){return e.firstPage.root}))){var a=new p.AnimationTimeChangedEvent(n,e);n.beginUpdate(a),n.endUpdate(a)}return l.opt(this.document_,(function(e){return e.firstPage.endUpdate(i)})),o},setBlendedRoles:function(e,t,n,o){var i,a;(i=t.fieldPrimary)&&(a=n.fieldPrimary)&&e.setBlendedColor(u.ColorRole.FieldPrimary,i,a,o),(i=t.fieldSecondary)&&(a=n.fieldSecondary)&&e.setBlendedColor(u.ColorRole.FieldSecondary,i,a,o)},stopWithCallback:function(e){var t;if(this.playing_){if(null==this.postAnimationCallbacks_?this.postAnimationCallbacks_=[e]:this.postAnimationCallbacks_.push(e),t=l.opt(this.document_,(function(e){return e.firstPage}))){var n=new r.AnimationRequestStopMessage(t);t.publish(n)}}else e()}}}),a)},KSe6:function(e,t,n){var o,i,a=t,r=n("oAGj"),l=n("VQVe"),s=n("gXiO"),m=n("C42b"),u=n("ascj"),c=n("FNB+"),y=n("URxh"),d=n("6ZWm"),f=n("cmoc"),p=n("P83h"),v=n("9Lk3"),T=n("pnSN"),A=n("53P9"),h=n("ZhwN"),F=n("iCxV"),S=n("NkBu"),g=n("fdtz"),L=n("SDdr"),I=n("lmwz"),x=n("uWOl"),k=n("fNpk"),D=n("c+uM"),C=n("tGKA"),M=n("pmb0"),_=n("K17h"),b=n("K0Rh"),R=n("Zifs"),w=n("djAF"),E=n("enh0"),N=n("8t9B"),K=n("3UhB"),O=n("oKlP"),P=n("uUew"),U=n("RkYL"),V=n("xm77"),B=n("zjod"),W=n("mxdD");a.AnimationLibrary=(o=function e(){s.CoreObject.call(this);for(var t=r.clone(M.MotionFacade.createAllAnimationStyles()),n=r.iter(t);!n.done;n.next()){var o=n.value;e.animationStyles.push(o)}},i={},r.defineClass({name:"AnimationLibrary",ctor:o,superName:"CoreObject",statics:{animationStyles:{get:function(){return void 0===i.animationStyles&&(i.animationStyles=[l.AnimationStyle.init_b946(l.AnimationStyle.NAME_NO_STYLE),l.AnimationStyle.init_e14f(l.AnimationStyle.NAME_TYPE,0,2,l.AnimationStyleCategory.Text),l.AnimationStyle.init_e14f(l.AnimationStyle.NAME_DYNAMIC,0,4,l.AnimationStyleCategory.Text),l.AnimationStyle.init_e14f(l.AnimationStyle.NAME_FLICKER,0,2,l.AnimationStyleCategory.Text),l.AnimationStyle.init_e14f(l.AnimationStyle.NAME_COLORSWAP,0,3,l.AnimationStyleCategory.Text),l.AnimationStyle.init_e14f(l.AnimationStyle.NAME_FADE,0,3,l.AnimationStyleCategory.Text),l.AnimationStyle.init_e14f(l.AnimationStyle.NAME_SLIDE,0,3,l.AnimationStyleCategory.Text),l.AnimationStyle.init_e14f(l.AnimationStyle.NAME_GROW,0,2,l.AnimationStyleCategory.Text),l.AnimationStyle.init_e14f(l.AnimationStyle.NAME_ZOOM,0,2,l.AnimationStyleCategory.Image),l.AnimationStyle.init_e14f(l.AnimationStyle.NAME_PAN,0,2,l.AnimationStyleCategory.Image),l.AnimationStyle.init_b946(l.AnimationStyle.NAME_GRAYSCALE,l.AnimationStyleCategory.Image),l.AnimationStyle.init_e14f(l.AnimationStyle.NAME_BLUR,0,1,l.AnimationStyleCategory.Image),l.AnimationStyle.init_e14f(l.AnimationStyle.NAME_COLOR,0,5,l.AnimationStyleCategory.Image),l.AnimationStyle.init_e14f(l.AnimationStyle.NAME_FILL,0,5,l.AnimationStyleCategory.Image)]),i.animationStyles},set:function(e){i.animationStyles=e}},determineAnalyticName:function(e){var t="";if(e=e){switch(e.name){case"Type":t="Typewriter";break;case"ColorSwap":t="ColorShuffle";break;default:t=e.name}t=(t+e.variant).toLowerCase()}else t=(l.AnimationStyle.NAME_NO_STYLE+0).toLowerCase();return t},getDisplayableAnimationStyles:function(e){var t=!1,n=!1,i=!1,a=!1,s=!1,m=!1,u=!1,y=!1,f=!1,p=0;e.visitAll(c.FormaTraversal.PreOrder,(function(e){var o,l,c,T,A;if((o=r.as(e.controller,d.FrameController))&&(s=s||!e.isLogo()&&!e.isSticker(),e.isGridCell()&&!o.floating&&o.hasCutout&&(u=!0)),null!=W.VideoFacade.getTrueVideoFormaForForma(e)&&(m=!0),v.GridController.isBackgroundColoredCell(e)&&(u=!0),y||(y=v.GridController.hasLayoutPadding(e)),e.kind==E.TextForma.KIND&&(t=!0),(l=I.ImageFacade.getImageFormaForForma(e))&&(c=r.as(l.style,x.ImageStyle))&&c.isColorizedFilter&&(f=!0),(T=r.as(e.style,D.LockupStyle))&&(A=r.as(e.controller,N.TypeLockupController))){T.backing==D.LockupBacking.Knockout&&(n=!0),!F.Host.textModelUtils.usePGMRenderer()&&D.LockupStyle.isKnockoutLook(T.textLook)||(i=!0);var h=A.getCurrentFontSize();!a&&p>0&&Math.abs(h-p)/Math.min(h,p)>=.05&&(a=!0),p=Math.max(p,h)}}));for(var T=[],A=r.iter(o.animationStyles);!A.done;A.next()){var h=A.value;if((t||h.name!=l.AnimationStyle.NAME_FLICKER&&h.name!=l.AnimationStyle.NAME_DYNAMIC&&h.name!=l.AnimationStyle.NAME_TYPE)&&(!h.imageStyle||s&&!m)&&(t||!h.textStyle)){var S=h.clone();h.name==l.AnimationStyle.NAME_GROW&&n?S.variantCount=3:(h.name!=l.AnimationStyle.NAME_GROW||i&&a)&&(h.name!=l.AnimationStyle.NAME_SLIDE||i)?h.name!=l.AnimationStyle.NAME_DYNAMIC||i?h.name!=l.AnimationStyle.NAME_COLORSWAP||u||f||y||(S.variantCount=2):S.variantCount=3:S.variantCount=1,T.push(S)}}return T},isPremiumAnimationStyle:function(e){return e.name==l.AnimationStyle.NAME_TYPE&&2==e.variant||e.name==l.AnimationStyle.NAME_FLICKER&&2==e.variant||e.name==l.AnimationStyle.NAME_DYNAMIC&&0==e.variant},isAnimationStyleApplicable:function(e,t){var n,i=!1;if(n=r.as(t.firstPage.root,b.RootForma))for(var a=r.clone(o.getDisplayableAnimationStyles(n)),l=r.iter(a);!l.done;l.next())if(l.value.name==e.name){i=!0;break}return i},extendToIntegralCount:function(e,t,n){k.LegacyCoreAssert.isTrue(0!=t,"sub-duration to loop should be non-zero",void 0,"AnimationLibrary.extendToIntegralCount","AnimationLibrary.swift",2846),k.LegacyCoreAssert.isTrue(0!=n,"time scale should be non-zero",void 0,"AnimationLibrary.extendToIntegralCount","AnimationLibrary.swift",2847);var o=e/t,i=Math.ceil(o),a=Math.floor(o);return o-a<1/r.toDouble(n)&&(i=a),U.TheoTime.fromSeconds(i*t,n)},updateCurrentStyle:function(e,t){var n,i,a;void 0===t&&(t=!1),(n=_.MotionUtils.getCurrentAnimationStyle(e))&&(n.isNoStyle()&&!t||((i=r.as(e.firstPage.root,b.RootForma))?(a=o.isAnimationStyleApplicable(n,e)?n:e.firstPage.animationLibrary.getAnimationStyle(l.AnimationStyle.NAME_NO_STYLE))&&e.firstPage.animationLibrary.setRootAnimationStyle(a,i):r.opt(F.Host.logging,(function(e){return e.warning("Missing root")}))))}},props:{getAnimationStyle:function(e){for(var t,n=r.iter(o.animationStyles);!n.done;n.next()){var i=n.value;if(e==i.name){t=i;break}}return t},getNextAnimationStyleOfSameType:function(e){var t=e.clone();return t.variantCount>0&&(t.variant=(t.variant+1)%t.variantCount),t},getNoneStyle:function(){return this.getAnimationStyle(l.AnimationStyle.NAME_NO_STYLE)},getAllAnimationStyles:function(){return o.animationStyles},setStillAnimation:function(e,t,n,o){void 0===n&&(n=null),void 0===o&&(o=null);var i=n||t.startTime,a=o||t.endTime,r=[];r.push(new y.KeyFrame(i,V.TimingFunctionType.Linear)),r.push(new y.KeyFrame(a,V.TimingFunctionType.Linear)),e.animation=y.FormaAnimation.init_9e82(t,i,a,r.concat())},setScaleForma:function(e,t,n,o,i,a,l){var s,m=new O.TheoPoint(1,1),u=e.style.clone(),c=e.style.clone();(s=r.as(e.style,D.LockupStyle))&&s.backing==D.LockupBacking.Knockout&&2==t.variant?(c=_.MotionUtils.createOpacityStyle(e,0),m=new O.TheoPoint(20,20)):u=_.MotionUtils.createOpacityStyle(e,0);var d=e.frame,f=e.placement.inverse.transformPoint(d.eval(o)),p=C.Matrix2D.scaling(n),v=e.placement.concat(p).transformPoint(f),T=d.center.subtract(v),A=C.Matrix2D.scaling(m),h=e.placement.concat(A).transformPoint(f),F=d.center.subtract(h),S=[],g=C.Matrix2D.scaling(n).translate(T),L=C.Matrix2D.scaling(m).translate(F),I=a,x=l;if(2==t.variant){S.push(new y.KeyFrame(a,i,g,null,u));var k=new U.TheoTime(t.endTime.timescale,t.endTime.timescale);I=a.add(k),x=l.add(k)}S.push(new y.KeyFrame(I,i,g,null,u)),S.push(new y.KeyFrame(x,i,L,null,c)),e.animation=y.FormaAnimation.init_9e82(t,a,x,S.concat())},setGrowAnimation:function(e,t,n){if(1==t.variant||1==t.variantCount){var o=t.endTime.multiply(2/3);this.setScaleForma(e,t,new O.TheoPoint(.8,.8),new O.TheoPoint(.5,.5),V.TimingFunctionType.EaseOut,t.startTime,o)}else if(0==t.variant){var i=t.endTime.subtract(l.AnimationStyle.FADE_DURATION);r.containsEq(n,e,c._equality_Forma_Forma)?this.setScaleForma(e,t,new O.TheoPoint(.75,.75),new O.TheoPoint(.5,.5),V.TimingFunctionType.EaseOut,t.startTime,i):this.setFormaFade(e,t,t.startTime,t.endTime,i)}else 2==t.variant&&this.setScaleForma(e,t,new O.TheoPoint(1,1),new O.TheoPoint(.5,.5),V.TimingFunctionType.EaseOut,t.startTime,t.endTime)},getCenteredTransform:function(e,t,n){var o=e.parent.frame.center.subtract(new O.TheoPoint(e.parent.frame.minX,e.parent.frame.minY)),i=e.placement.inverse.transformPoint(o),a=C.Matrix2D.scalingXY(t,t),r=e.placement.concat(a).transformPoint(i),l=o.subtract(r);return C.Matrix2D.scalingXY(t,t).translate(l.add(n))},setImageAnimation:function(e,t,n,o,i){var a=I.ImageFacade.getFrameFormaForForma(e);if(!e.isLogo()&&!e.isSticker()){for(var l=1,s=e.placement,m=r.iter(o);!m.done;m.next()){var u=m.value,c=u[1],f=u[2],p=this.getCenteredTransform(e,f,c);e.placement=s,e.move(p);var v,T=e.placement;(v=r.as(r.opt(a,(function(e){return e.controller})),d.FrameController))&&v.fitChildrenToFrame();var A=e.placement.transformValues.xscale-T.transformValues.xscale,h=new O.TheoPoint(e.placement.tx-T.tx,e.placement.ty-T.ty);if(e.placement=s,i&&(h.length()>1||A>0)){var F=e.frame;f*(l=Math.max(l,1+A+3*Math.max(Math.abs(h.x)/F.width,Math.abs(h.y)/F.height)))<1&&(l=1/f)}for(var S=[],g=r.iter(o);!g.done;g.next()){var L=g.value,x=L[0],k=(c=L[1],f=L[2],this.getCenteredTransform(e,f*l,c));S.push(new y.KeyFrame(x,n,k,null,null))}e.animation=y.FormaAnimation.init_9e82(t,t.startTime,t.endTime,S.concat())}S=[];for(var D=r.iter(o);!D.done;D.next()){var C=D.value;x=C[0],c=C[1],f=C[2],k=this.getCenteredTransform(e,f*l,c),S.push(new y.KeyFrame(x,n,k,null,null))}e.animation=y.FormaAnimation.init_9e82(t,t.startTime,t.endTime,S.concat())}},applyLineFadeIn:function(e,t,n,o,i){var a,l=o.subtract(n),s=i;s.seconds*r.toDouble(e.length)>l.seconds/2&&(s=l.multiply(1/r.toDouble(2*e.length)));for(var m=l.subtract(s.multiply(r.toDouble(e.length))),u=n,c=r.iter(e);!c.done;c.next()){var y=c.value,d=(u=u.add(s)).add(m);this.setFormaAnimations(y,t,0,(a=r.opt(r.first(y),(function(e){return e.style.opacity})))||null!=a?a:1,C.Matrix2D.Identity,V.TimingFunctionType.EaseInOut,n,u,d)}},setFadeAnimationTopDown:function(e,t){for(var n=[],o=r.iter(e);!o.done;o.next()){var i=o.value;i.isTypeLockup()&&n.push(i)}if(0==!n.length){for(var a=r.clone(_.MotionUtils.getTitleLockups(n)),s=r.clone(a[0]),m=r.clone(a[1]),u=[],c=[],y=r.iter(s);!y.done;y.next()){var d=y.value,f=r.clone(_.MotionUtils.findTextLines2(d));if(0==!f.length)for(var p=r.iter(f);!p.done;p.next()){var v=p.value;c.push(v)}}c=r.clone(_.MotionUtils.sortTextLines(c));for(var T=r.iter(c);!T.done;T.next())v=T.value,u.push(v.words);var A=new U.TheoTime(r.toInt(.25*r.toDouble(t.endTime.timescale)),t.endTime.timescale);this.applyLineFadeIn(u,t,t.startTime,t.endTime,A);for(var h=t.endTime.subtract(l.AnimationStyle.FADE_DURATION),F=r.iter(m);!F.done;F.next()){var S=F.value;this.setFormaFade(S,t,t.startTime,t.endTime,h)}}},setFadeAnimation:function(e,t,n){var o;if(2==t.variant||1==t.variantCount)if(r.as(e.controller,N.TypeLockupController))this.setFormaAnimations([e],t,.05,e.style.opacity,C.Matrix2D.Identity,V.TimingFunctionType.EaseOut,t.startTime,t.startTime,t.endTime);else{var i=[];e.visitAll(c.FormaTraversal.PreOrder,(function(e){(e instanceof E.TextForma||e instanceof w.ShapeForma)&&i.push(e)})),e.isImage()&&(i=[e]),this.setFormaAnimations(i,t,.05,e.style.opacity,C.Matrix2D.Identity,V.TimingFunctionType.EaseOut,t.startTime,t.startTime,t.endTime)}else{var a=t.endTime.subtract(l.AnimationStyle.FADE_DURATION);if(r.containsEq(n,e,c._equality_Forma_Forma)){var s,m=!1;if(F.Host.textModelUtils.usePGMRenderer()||(s=r.as(e.controller,N.TypeLockupController))&&r.opt(s.lockupStyle,(function(e){return e.textLook==D.LockupTextLook.KnockoutOnly}))&&(m=!0),0==t.variant)m&&(s=r.as(e.controller,N.TypeLockupController))&&this.modifyLockupForAnimation(s,m),this.setLineAnimation(e,t,C.Matrix2D.Identity,V.TimingFunctionType.EaseInOut,t.startTime,t.endTime,new U.TheoTime(r.toInt(.25*r.toDouble(t.endTime.timescale)),t.endTime.timescale)),this.setStillAnimation(e,t);if(1==t.variant&&(s=r.as(e.controller,N.TypeLockupController))){this.modifyLockupForAnimation(s,m);for(var u=[],d=r.iter(e.visitAsArray(c.FormaTraversal.PreOrder));!d.done;d.next()){var f,p=d.value;(f=r.as(p,E.TextForma))&&u.push(f)}for(var v=e.finalFrame,T=r.iter(u);!T.done;T.next()){var A=T.value,h=.8*(A.finalFrame.center.x-v.minX)/v.width+.1;k.LegacyCoreAssert.isTrue(h<=1,"Unexpected text forma position encountered when setting fade animation",void 0,"AnimationLibrary.setFadeAnimation","AnimationLibrary.swift",690);var S=_.MotionUtils.createOpacityStyle(A,0),g=A.style;if(m){var L=(o=r.opt(r.as(r.opt(A.lockupForma,(function(e){return e.style})),D.LockupStyle),(function(e){return e.backingOpacity})))||null!=o?o:A.style.opacity;g=_.MotionUtils.createOpacityStyle(A,L)}var I=[],x=a.subtract(t.startTime).seconds*h,M=t.startTime.addSeconds(x),b=M.addSeconds(1);m?(I.push(new y.KeyFrame(t.startTime,V.TimingFunctionType.Linear,C.Matrix2D.Identity,null,g)),I.push(new y.KeyFrame(M,V.TimingFunctionType.Linear,C.Matrix2D.Identity,null,g)),I.push(new y.KeyFrame(b,V.TimingFunctionType.Linear,C.Matrix2D.Identity,null,S))):(I.push(new y.KeyFrame(t.startTime,V.TimingFunctionType.Linear,C.Matrix2D.Identity,null,S)),I.push(new y.KeyFrame(M,V.TimingFunctionType.Linear,C.Matrix2D.Identity,null,S)),I.push(new y.KeyFrame(b,V.TimingFunctionType.Linear,C.Matrix2D.Identity,null,g))),A.animation=y.FormaAnimation.init_9e82(t,t.startTime,b,I.concat())}this.setStillAnimation(e,t,null,a)}}else this.setFormaFade(e,t,t.startTime,t.endTime,a)}},setLineAnimation:function(e,t,n,o,i,a,l){var s,m,u=(s=r.opt(r.as(e.style,D.LockupStyle),(function(e){return e.textLook})))||null!=s?s:D.LockupTextLook.Fill,c=!F.Host.textModelUtils.usePGMRenderer()&&u==D.LockupTextLook.KnockoutOnly,y=D.LockupStyle.isKnockoutLook(u)&&!c&&!F.Host.textModelUtils.usePGMRenderer(),d=r.clone(_.MotionUtils.findTextLines(e)),f=a.subtract(i),p=l;p.seconds*r.toDouble(d.length)>f.seconds/2&&(p=f.multiply(1/r.toDouble(2*d.length)));var v=f.subtract(p.multiply(r.toDouble(d.length))),T=0,A=c?0:e.style.opacity;c&&(T=(m=r.opt(r.as(e.style,D.LockupStyle),(function(e){return e.backingOpacity})))||null!=m?m:e.style.opacity);var h=i;if(!y)for(var S=r.iter(d);!S.done;S.next()){var g=S.value,L=(h=h.add(p)).add(v);this.setFormaAnimations(g,t,T,A,n,o,i,h,L)}var I=a.multiply(.5),x=r.clone(e.filterWithCallback((function(e){return e instanceof w.ShapeForma||e instanceof E.TextForma&&y})));c||this.setFormaAnimations(x,t,T,A,C.Matrix2D.Identity,o,i,i,I)},setColorSwapAnimation:function(e,t,n){var o,i,a,s;if(void 0===n&&(n=null),0!=e.length){var c=e[0].page,f=new p.FormaStyleChangedEvent(c.root);c.beginUpdate(f);for(var T=0==t.variant||1==t.variant,A=[],h=r.iter(e);!h.done;h.next()){var L,D,M,_=h.value;k.LegacyCoreAssert.isFalse(_ instanceof E.TextForma,"color swap animation: formae to color should not include text formae",void 0,"AnimationLibrary.setColorSwapAnimation","AnimationLibrary.swift",809),null!=_.controller&&_.kind!=b.RootForma.KIND&&((L=r.as(_.controller,v.GridController))?L.isBackgroundVisible()&&!T&&A.push(_.root):T&&!_.controller.moveable||((D=I.ImageFacade.getImageFormaForForma(_))?((M=r.as(D.style,x.ImageStyle))&&M.isColorizedFilter&&A.push(D),((o=r.opt(r.as(_.controller,d.FrameController),(function(e){return e.hasBackgroundColor})))||null!=o)&&o&&A.push(_)):A.push(_)))}A=r.sort(A,(function(e,t){return!(!(i=r.opt(e.controller,(function(e){return e.moveable})))&&null==i||!i)&&null!=(n=r.opt(e.parent,(function(t){return t.indexOfChild(e)})))&&null!=(o=r.opt(t.parent,(function(e){return e.indexOfChild(t)})))&&n<o;var n,o})),t.endTime=n||l.AnimationStyle.COLOR_SWAP_DURATION;for(var K=0==t.variant||2==t.variant?V.TimingFunctionType.Step1:V.TimingFunctionType.Linear,O=1==t.variant?.75:.5,P=r.toInt(r.toDouble(t.endTime.timescale)*O),B=r.toInt(r.toInt(t.endTime.value/P)),W={},G=t.startTime.value,Y={},j={},q=[],Z=r.iter(A);!Z.done;Z.next()){if(_=Z.value,(qe=[]).push(new y.KeyFrame(t.startTime,K,C.Matrix2D.Identity,null,_.style)),W[_.formaID]=qe,_.isTypeLockup()&&F.Host.textModelUtils.usePGMRenderer()){for(var H=r.clone(_.filterByKind(E.TextForma.KIND)),z=r.clone(_.filterByKind(w.ShapeForma.KIND)),X=r.iter(H);!X.done;X.next()){var J=X.value;(He=[]).push(new y.KeyFrame(t.startTime,K,C.Matrix2D.Identity,null,J.style)),W[J.formaID]=He}for(var Q=r.iter(z);!Q.done;Q.next()){var $=Q.value;(Xe=[]).push(new y.KeyFrame(t.startTime,K,C.Matrix2D.Identity,null,$.style)),W[$.formaID]=Xe}}if(_.kind!=g.ImageForma.KIND){for(var ee=_.style.colors.colorID(u.ColorRole.FieldPrimary),te=r.iter(_.page.colorLibraryController.getThemeColorKeys());!te.done;te.next()){var ne,oe=te.value;(ne=_.style.colors.fieldPrimary)&&(le=_.page.colorLibraryController.getSolidColorForKey(oe))&&ne.distanceTo(le)<2&&(ee=oe)}null==Y[ee=(a=ee)||null!=a?a:"missing"+r.toString(q.length)]&&(Y[ee]=[],q.includes(ee)||q.push(ee)),Y[ee].push(_);for(var ie=_.style.colors.colorID(u.ColorRole.FieldSecondary),ae=r.iter(_.page.colorLibraryController.getThemeColorKeys());!ae.done;ae.next()){var re,le;oe=ae.value,(re=_.style.colors.fieldSecondary)&&(le=_.page.colorLibraryController.getSolidColorForKey(oe))&&re.distanceTo(le)<2&&(ie=oe)}null==j[ie=(s=ie)||null!=s?s:"missing"+r.toString(q.length)]&&(j[ie]=[],q.includes(ie)||q.push(ie)),j[ie].push(_)}}var se=r.clone(r.shuffle(c.colorLibraryController.getThemeColorKeys())),me=[];if(A.length>0){for(var ue=e[0].database.beginTransaction("revert_transaction",null),ce=r.iter(r.range(0,B,!1));!ce.done;ce.next()){for(var ye={},de=r.iter(A);!de.done;de.next()){var fe,pe;(fe=(Pe=de.value).style.colors.fieldPrimary)&&(ye[Pe.formaID+"primary"]=fe.asString),(pe=Pe.style.colors.fieldSecondary)&&(ye[Pe.formaID+"secondary"]=pe.asString)}for(var ve=m.CoreRandom.nextIntUniform(se.length);me.length>0&&se.length>1&&ve==me[me.length-1];)ve=m.CoreRandom.nextIntUniform(se.length);me.push(ve);for(var Te=r.iter(r.range(0,2,!1));!Te.done;Te.next())for(var Ae=1==Te.value,he=r.clone(Ae?Y:j),Fe=r.iter(q);!Fe.done;Fe.next()){var Se,ge,Le=Fe.value;if((Se=he[Le])&&null!=(ge=r.indexOf(q,Le)))for(var Ie=r.iter(Se);!Ie.done;Ie.next())if((Pe=Ie.value).kind!=g.ImageForma.KIND)for(var xe=!1,ke=0;!xe&&ke<se.length;){var De=se[(ge+ve+ke)%se.length];ke+=1,xe=!0;var Ce,Me,_e=Ae?u.ColorRole.FieldPrimary:u.ColorRole.FieldSecondary;if(Pe.style.colorTableSupportsRole(_e))if(Pe.style.colors.setColorId(_e,De),(Ce=Pe.style.colors.color(_e))&&null!=(Me=ye[Pe.formaID+(_e==u.ColorRole.FieldPrimary?"primary":"secondary")])&&Me==Ce.asString&&(xe=!1),null!=Pe.controller&&Pe.controller.moveable){var be,Re=r.opt(Pe.controller,(function(e){return e.getBackingContrastRole()}));if(be=Pe.style.colors.color(_e)){var we=_e==u.ColorRole.FieldPrimary&&Re==u.ColorRole.FieldSecondary?Pe.style.colors.fieldSecondary:r.opt(Pe.controller,(function(e){return e.getBackgroundColor()})),Ee=Pe.isTypeLockup()?10:5,Ne=new R.SolidColor(be.red,be.green,be.blue,Pe.style.opacity);null!=we&&Ne.lightnessDifference(we)<Ee&&(xe=!1)}}}}for(var Ke=r.iter(A);!Ke.done;Ke.next()){var Oe,Pe=Ke.value;(Oe=r.as(Pe.controller,N.TypeLockupController))&&Oe.styleController.shuffleMultiStyleLockupColors()}G+=P;for(var Ue=new U.TheoTime(G,t.endTime.timescale),Ve=r.iter(A);!Ve.done;Ve.next())if((_=Ve.value).isImage()&&r.opt(r.as(_.controller,S.ImageController),(function(e){return e.shuffleColorAssignmentForAnimation()})),(_.isShape()||_.isTypeLockup())&&null==_.style.colors.color(u.ColorRole.FieldPrimary)&&k.LegacyCoreAssert.fail("error, can't be setting a nil colors",void 0,"AnimationLibrary.setColorSwapAnimation","AnimationLibrary.swift",1073),r.opt(W[_.formaID],(function(e){return e.push(new y.KeyFrame(Ue,K,C.Matrix2D.Identity,null,_.style))})),_.isTypeLockup()&&F.Host.textModelUtils.usePGMRenderer()){H=r.clone(_.filterByKind(E.TextForma.KIND)),z=r.clone(_.filterByKind(w.ShapeForma.KIND));for(var Be=r.iter(H);!Be.done;Be.next()){var We;J=Be.value,(We=J.style.clone())?(We.colors.owner=null,We.colors.setColor(u.ColorRole.FieldPrimary,J.fontColor),We.colors.setColor(u.ColorRole.FieldSecondary,J.fontStrokeColor),r.opt(W[J.formaID],(function(e){return e.push(new y.KeyFrame(Ue,K,C.Matrix2D.Identity,null,We))}))):k.LegacyCoreAssert.fail("fail to generate keyframe for color shuffle: missing style in text forma",void 0,"AnimationLibrary.setColorSwapAnimation","AnimationLibrary.swift",1092)}for(var Ge=r.iter(z);!Ge.done;Ge.next())$=Ge.value,r.opt(W[$.formaID],(function(e){return e.push(new y.KeyFrame(Ue,K,C.Matrix2D.Identity,null,$.style))}))}}ue.rollback()}for(var Ye=e.concat(A),je=r.iter(this.uniqueFormae(Ye));!je.done;je.next()){var qe;if(qe=W[(_=je.value).formaID]){if(_.animation=y.FormaAnimation.init_9e82(t,t.startTime,t.endTime,qe.concat()),_.isTypeLockup()&&F.Host.textModelUtils.usePGMRenderer()){H=r.clone(_.filterByKind(E.TextForma.KIND)),z=r.clone(_.filterByKind(w.ShapeForma.KIND));for(var Ze=r.iter(H);!Ze.done;Ze.next()){var He;(He=W[(J=Ze.value).formaID])&&(J.animation=y.FormaAnimation.init_9e82(t,t.startTime,t.endTime,He.concat()))}for(var ze=r.iter(z);!ze.done;ze.next()){var Xe;(Xe=W[($=ze.value).formaID])&&($.animation=y.FormaAnimation.init_9e82(t,t.startTime,t.endTime,Xe.concat()))}}}else _.kind==b.RootForma.KIND?this.setStillAnimation(e[0].root,t):_.animation=null}c.endUpdate(f)}},setFlickerAnimation:function(e,t){var n,o,i,a,s,m,u;if(0!=e.length){for(var d=[],f=r.iter(e);!f.done;f.next()){var p;null!=(S=f.value).controller&&S.controller.moveable&&!S.isGridCell()&&null==r.as(S,g.ImageForma)&&this.shouldAnimateShape(S)&&((p=I.ImageFacade.getImageFormaForForma(S))?d.push(p):d.push(S))}var v=r.clone(this.getTitleLockups(e[0].root));if(0!=v.length){for(var T=1==t.variant,A=2!=t.variant&&!F.Host.textModelUtils.usePGMRenderer(),h=r.iter(v);!h.done;h.next()){var S=h.value;r.remove(d,S),(b=r.as(S.controller,N.TypeLockupController))&&r.opt(b.lockupStyle,(function(e){return e.textLook!=D.LockupTextLook.KnockoutOnly}))&&(A=!1)}for(var L=[],x=[],M=r.iter(v);!M.done;M.next()){var b,O=M.value;if(b=r.as(O.controller,N.TypeLockupController))if(this.modifyLockupForAnimation(b,A),!T&&this.lockupDoesPerLetterLayout(O)){var B=r.clone(r.as(b.groupLetterFormaeByWord(),["Array",["Array",c.Forma]]));r.append(L,B),r.append(x,B)}else{for(var W=r.clone(b.getAllTextFormae()),G=r.iter(W);!G.done;G.next())S=G.value,L.push([S]);T&&(W=r.clone(K.TypeLockupUtils.sortTextFormae(W)),W=r.clone(K.TypeLockupUtils.padTextFormaeForLetterAnimation(W,!1)));for(var Y=r.iter(W);!Y.done;Y.next())S=Y.value,x.push([S])}}2==t.variant&&(x=[v]);var j=r.toInt(2*r.toDouble(t.endTime.timescale)),q=new U.TheoTime(j+1,t.endTime.timescale),Z=q.add(l.AnimationStyle.FADE_DURATION),H=V.TimingFunctionType.EaseOut,z=V.TimingFunctionType.Step,X=r.toInt(.15*r.toDouble(t.endTime.timescale)),J=r.toInt(r.toInt(j/X)),Q={},$=t.startTime.value;k.LegacyCoreAssert.isTrue(Z.value>q.value,"end fade time must exceed start fade time",void 0,"AnimationLibrary.setFlickerAnimation","AnimationLibrary.swift",1251);for(var ee=r.iter(L);!ee.done;ee.next()){e=ee.value;for(var te=r.iter(e);!te.done;te.next())S=te.value,(nt=[]).push(new y.KeyFrame(t.startTime,z,C.Matrix2D.Identity,null,S.style)),Q[S.formaID]=nt}for(var ne={},oe=r.iter(r.range(0,J,!1));!oe.done;oe.next()){$+=X;for(var ie=new U.TheoTime($,t.endTime.timescale),ae=0,re=null,le=r.iter(r.toSequence(x));!le.done;le.next()){for(var se=le.value,me=se.offset,ue=(e=se.element,(n=r.opt(e[0].controller,(function(e){return e.currentOpacity})))||null!=n?n:e[0].style.opacity),ce=2*(this.randomDbl()-.5)*ue,ye=0,de=!1;ye<5&&!de;){ye+=1;for(var fe=r.iter(e);!fe.done;fe.next()){S=fe.value;var pe=(o=r.opt(S.controller,(function(e){return e.currentOpacity})))||null!=o?o:S.style.opacity,ve=(i=ne[S.formaID])||null!=i?i:pe,Te=S.isTypeLockup()?pe:1;Math.abs(ve-Math.min(Math.max(ve+ce,0),Te))<.1?ce=2*(this.randomDbl()-.5):de=!0}}for(var Ae=r.iter(e);!Ae.done;Ae.next()){S=Ae.value,pe=(a=r.opt(S.controller,(function(e){return e.currentOpacity})))||null!=a?a:S.style.opacity,Te=S.isTypeLockup()?pe:1;var he=Math.min(Math.max(pe+ce,0),Te);if(ne[S.formaID]=he,T){if(Be=r.as(S,E.TextForma)){var Fe,Se,ge=Be.graphemeCount,Le=!1,Ie=Be.fontColor,xe=new R.SolidColor(Ie.red,Ie.green,Ie.blue,he),ke=Be.fontStrokeColor,De=new R.SolidColor(ke.red,ke.green,ke.blue,he);if(me-1>=0&&(Fe=r.as(r.opt(Be.lockupForma,(function(e){return e.style})),D.LockupStyle))&&(Se=r.as(r.first(x[me-1]),E.TextForma))&&D.LockupStyle.isDuplicateFormaLook(Fe.textLook)&&K.TypeLockupUtils.formaForSameTextRun(Be,Se)&&Se.formaID==r.opt(re,(function(e){return e.formaID}))&&S.formaID!=r.opt(re,(function(e){return e.formaID}))&&(Le=!0,xe=new R.SolidColor(Ie.red,Ie.green,Ie.blue,(s=ne[Se.formaID])||null!=s?s:he),De=new R.SolidColor(ke.red,ke.green,ke.blue,(m=ne[Se.formaID])||null!=m?m:he)),Le||(S===re?ae+=1:ae=0,re=S),ae<ge)if(0==ae){k.LegacyCoreAssert.isTrue(pe==S.style.opacity,"current opacity does not match first character's opacity",void 0,"AnimationLibrary.setFlickerAnimation","AnimationLibrary.swift",1345);var Ce=new y.KeyFrame(ie,z,C.Matrix2D.Identity,null,S.style);Ce.renderRuns.applyColors(xe,De,new P.TextRange(ae,ae+1)),r.opt(Q[S.formaID],(function(e){return e.push(Ce)}))}else{var Me=(u=r.opt(Q[S.formaID],(function(e){return e.length})))||null!=u?u:0;Me>0&&Q[S.formaID][Me-1].renderRuns.applyColors(xe,De,new P.TextRange(ae,ae+1))}}}else{var _e=_.MotionUtils.createOpacityStyle(S,he),be=new y.KeyFrame(ie,z,C.Matrix2D.Identity,null,_e);r.opt(Q[S.formaID],(function(e){return e.push(be)}))}}}}for(var Re=r.iter(L);!Re.done;Re.next()){e=Re.value;for(var we=r.iter(e);!we.done;we.next()){S=we.value;var Ee=A?_.MotionUtils.createOpacityStyle(S,0):S.style;Q[S.formaID].push(new y.KeyFrame(Z,H,C.Matrix2D.Identity,null,Ee))}}for(var Ne=r.iter(d);!Ne.done;Ne.next()){S=Ne.value;var Ke=_.MotionUtils.createOpacityStyle(S,0),Oe=S.style;if(null==Q[S.formaID]&&(Q[S.formaID]=[],Q[S.formaID].push(new y.KeyFrame(t.startTime,H,C.Matrix2D.Identity,null,Ke)),Q[S.formaID].push(new y.KeyFrame(q,H,C.Matrix2D.Identity,null,Ke)),Q[S.formaID].push(new y.KeyFrame(Z,H,C.Matrix2D.Identity,null,Oe)),Z.value<t.endTime.value&&Q[S.formaID].push(new y.KeyFrame(t.endTime,H,C.Matrix2D.Identity,null,Oe)),S.isTypeLockup()&&F.Host.textModelUtils.usePGMRenderer())){for(var Pe=r.clone(S.filterByKind(E.TextForma.KIND)),Ue=r.clone(S.filterByKind(w.ShapeForma.KIND)),Ve=r.iter(Pe);!Ve.done;Ve.next()){var Be=Ve.value,We=_.MotionUtils.createOpacityStyle(Be,0),Ge=Be.style,Ye=[];Ye.push(new y.KeyFrame(t.startTime,H,C.Matrix2D.Identity,null,We)),Ye.push(new y.KeyFrame(q,H,C.Matrix2D.Identity,null,We)),Ye.push(new y.KeyFrame(Z,H,C.Matrix2D.Identity,null,Ge)),Z.value<t.endTime.value&&Ye.push(new y.KeyFrame(t.endTime,H,C.Matrix2D.Identity,null,Ge)),Be.animation=y.FormaAnimation.init_9e82(t,t.startTime,t.endTime,Ye.concat())}for(var je=r.iter(Ue);!je.done;je.next()){var qe=je.value,Ze=_.MotionUtils.createOpacityStyle(qe,0),He=qe.style,ze=[];ze.push(new y.KeyFrame(t.startTime,H,C.Matrix2D.Identity,null,Ze)),ze.push(new y.KeyFrame(q,H,C.Matrix2D.Identity,null,Ze)),ze.push(new y.KeyFrame(Z,H,C.Matrix2D.Identity,null,He)),Z.value<t.endTime.value&&ze.push(new y.KeyFrame(t.endTime,H,C.Matrix2D.Identity,null,He)),qe.animation=y.FormaAnimation.init_9e82(t,t.startTime,t.endTime,ze.concat())}}}for(var Xe=[],Je=r.iter(x);!Je.done;Je.next()){e=Je.value;for(var Qe=r.iter(e);!Qe.done;Qe.next()){var $e=Qe.value;Xe.push($e)}}for(var et=e.concat(Xe),tt=r.iter(this.uniqueFormae(et));!tt.done;tt.next()){var nt,ot;if(nt=Q[(S=tt.value).formaID])S.animation=y.FormaAnimation.init_9e82(t,t.startTime,t.endTime,nt.concat()),S.kind==E.TextForma.KIND&&(ot=r.opt(r.opt(S.parent,(function(e){return e.parent})),(function(e){return e.parent})))&&ot.isTypeLockup()&&null==ot.animation&&this.setStillAnimation(ot,t),this.validateKeyFrames(nt.concat(),"flicker/setStillAnimation");else S.animation=null}}}},shouldAnimateShape:function(e){return!e.isShape()||(e.isGridCell()||null!=e.controller&&e.controller.moveable,!1)},modifyLockupForAnimation:function(e,t){var n,o;if(t){var i=(n=r.opt(e.lockupStyle,(function(e){return e.textLook})))||null!=n?n:D.LockupTextLook.Fill,a=r.opt(e.lockupStyle,(function(e){return e.colors.colorID(u.ColorRole.FieldPrimary)}));if(D.LockupStyle.isKnockoutLook(i)&&t){e.beginBlockedUpdate(),r.opt(e.lockupStyle,(function(e){return e.textLook=D.LockupTextLook.KnockoutAndFill}));var l=r.opt(e.lockupStyle,(function(e){return e.colors.colorID(u.ColorRole.FieldSecondary)}));r.opt(e.lockupStyle,(function(e){return e.colors.setColorId(u.ColorRole.FieldPrimary,l)})),e.endBlockedUpdate()}k.LegacyCoreAssert.isTrue(0==e.forceLetterFormaMode,"unexpectedly found forced letter forma mode when modifying lockup for animation",void 0,"AnimationLibrary.modifyLockupForAnimation","AnimationLibrary.swift",1542),e.updateGroup(),D.LockupStyle.isKnockoutLook(i)&&t&&(r.opt(e.forma,(function(t){return t.visitAll(c.FormaTraversal.PreOrder,(function(t){t.kind==E.TextForma.KIND&&(t.style.opacity=(o=r.opt(e.lockupStyle,(function(e){return e.backingOpacity})))||null!=o?o:t.style.opacity)}))})),e.beginBlockedUpdate(),r.opt(e.lockupStyle,(function(e){return e.textLook=i})),r.opt(e.lockupStyle,(function(e){return e.colors.setColorId(u.ColorRole.FieldPrimary,a)})),e.endBlockedUpdate())}},useKnockoutAnimation:function(e,t){var n;return!(F.Host.textModelUtils.usePGMRenderer()||!(n=e.lockupStyle)||!(n.textLook==D.LockupTextLook.KnockoutOnly||D.LockupStyle.isKnockoutLook(n.textLook)&&t==l.AnimationStyle.WORD_CENTERED_VARIANT))},getRandomLetterAppearKeyFrames:function(e,t,n,o,i,a,s,m){for(var u,c,d,f,p=s,v=r.iter(e);!v.done;v.next())for(var T=v.value,A=r.iter(T);!A.done;A.next()){var h=A.value,F=[],S=_.MotionUtils.createOpacityStyle(h,0),g=!1;if((O=r.as(r.opt(r.opt(r.as(h,E.TextForma),(function(e){return e.lockupForma})),(function(e){return e.controller})),N.TypeLockupController))&&(g=this.useKnockoutAnimation(O,t)),g){var L=(u=r.opt(r.as(r.opt(r.opt(r.as(h,E.TextForma),(function(e){return e.lockupForma})),(function(e){return e.style})),D.LockupStyle),(function(e){return e.backingOpacity})))||null!=u?u:h.style.opacity;S=_.MotionUtils.createOpacityStyle(h,L)}F.push(new y.KeyFrame(n.startTime,o,C.Matrix2D.Identity,null,S)),i[h.formaID]=F}for(var I=r.iter(a);!I.done;I.next()){var x=I.value,k=x.key,M=new U.TheoTime(r.toInt(Math.max(p-1,0)),n.endTime.timescale);M.value<=n.startTime.value&&(M=new U.TheoTime(r.toInt(n.startTime.value+1),n.endTime.timescale));var b=new U.TheoTime(r.toInt(p),n.endTime.timescale);b.value<=M.value&&(b=new U.TheoTime(M.value+1,n.endTime.timescale));for(var w=r.iter(x.value);!w.done;w.next()){var O,V=w.value,B=V.style,W=!1;(O=r.as(r.opt(V.lockupForma,(function(e){return e.controller})),N.TypeLockupController))&&(W=this.useKnockoutAnimation(O,t)),S=_.MotionUtils.createOpacityStyle(V,0),W&&t!=l.AnimationStyle.WORD_CENTERED_VARIANT&&(L=(c=r.opt(r.as(r.opt(V.lockupForma,(function(e){return e.style})),D.LockupStyle),(function(e){return e.backingOpacity})))||null!=c?c:V.style.opacity,S=_.MotionUtils.createOpacityStyle(V,L));var G=V.graphemeCount,Y=V.fontColor,j=V.fontStrokeColor,q=R.SolidColor.fromAlphaOverride(Y,0),Z=R.SolidColor.fromAlphaOverride(j,0);W&&(q=Y,Y=R.SolidColor.fromAlphaOverride(Y,0),Z=j,j=R.SolidColor.fromAlphaOverride(j,0));var H=new y.KeyFrame(M,o,C.Matrix2D.Identity,null,S),z=new y.KeyFrame(b,o,C.Matrix2D.Identity,null,B),X=(d=r.opt(i[V.formaID],(function(e){return e.length})))||null!=d?d:0;if(X>0){for(var J=i[V.formaID][X-1].renderRuns.fillColors,Q=r.iter(J.runArrays);!Q.done;Q.next()){var $=Q.value;z.renderRuns.fillColors.apply($.attr,$.range)}for(var ee=i[V.formaID][X-1].renderRuns.strokeColors,te=r.iter(ee.runArrays);!te.done;te.next())$=te.value,z.renderRuns.strokeColors.apply($.attr,$.range)}var ne=new P.TextRange(0,G);1==X&&(z.renderRuns.applyColors(q,Z,ne),r.opt(i[V.formaID],(function(e){return e.push(H)}))),z.renderRuns.applyColors(Y,j,k);for(var oe=[],ie=r.iter(z.renderRuns.fillColors.runArrays);!ie.done;ie.next())$=ie.value,r.eq(R._equality_SolidColor_SolidColor,$.attr,Y)&&oe.push($.range);r.sortInPlace(oe,(function(e,t){return e.start<t.start}));var ae=r.clone(K.TypeLockupUtils.cleanupAndMerge(oe));z.renderRuns.clear();var re=[ne];1==q.alpha&&(re=r.clone(K.TypeLockupUtils.invertRanges(ae,ne.end)));for(var le=r.iter(re);!le.done;le.next()){var se=le.value;z.renderRuns.applyColors(q,Z,se)}for(var me=r.iter(ae);!me.done;me.next()){var ue=me.value;z.renderRuns.applyColors(Y,j,ue)}if(W&&((f=r.opt(r.first(ae),(function(e){return e.length})))||null!=f?f:0)>=G){var ce=_.MotionUtils.createOpacityStyle(V,0),ye=new y.KeyFrame(b,o,C.Matrix2D.Identity,null,ce);r.opt(i[V.formaID],(function(e){return e.push(ye)}))}else r.opt(i[V.formaID],(function(e){return e.push(z)}))}p+=m}},lockupDoesPerLetterLayout:function(e){var t;return!!(t=r.as(e.style,D.LockupStyle))&&D.LockupStyle.doesPerLetterLayout(t.layout)},setDynamicWordAnimation:function(e,t){var n,o,i=this;if(0!=e.length){var a=t.variant,s=t.name==l.AnimationStyle.NAME_TYPE;s&&(a+=10);var m=r.clone(this.getTitleLockups(e[0].root));if(0!=m.length){var u=!0;if(a==l.AnimationStyle.WORD_CENTERED_VARIANT){var d=m.filter((function(e){return!i.lockupDoesPerLetterLayout(e)}),this);0==d.length?u=!1:m=r.clone(d)}for(var f=[],p=r.iter(e);!p.done;p.next()){var v;null!=(S=p.value).controller&&S.controller.moveable&&!S.isGridCell()&&null==r.as(S,g.ImageForma)&&this.shouldAnimateShape(S)&&((v=I.ImageFacade.getImageFormaForForma(S))?f.push(v):f.push(S))}for(var T=!1,h=!1,F=r.iter(m);!F.done;F.next()){var S=F.value;r.remove(f,S),!T&&S.controller instanceof N.TypeLockupController&&(T=this.useKnockoutAnimation(S.controller,a))}var L=[],x=[],M=0,b=0;if(T)for(var O=r.iter(m);!O.done;O.next()){var B=O.value;(St=r.as(B.controller,N.TypeLockupController))&&(h=this.useKnockoutAnimation(St,a),this.modifyLockupForAnimation(St,h))}for(var W=r.iter(m);!W.done;W.next())B=W.value,h=!1,(St=r.as(B.controller,N.TypeLockupController))&&(M+=A.GraphemeUtils.countGraphemes(St.text),b+=St.text.split(" ").length,h=this.useKnockoutAnimation(St,a)),B.visitAll(c.FormaTraversal.PreOrder,(function(e){var t,n;(t=r.as(e,E.TextForma))&&L.push(t),(n=r.as(e,w.ShapeForma))&&(a==l.AnimationStyle.WORD_APPEAR_VARIANT&&!h||a==l.AnimationStyle.WORD_ZOOM_IN_VARIANT||a==l.AnimationStyle.WORD_CENTERED_VARIANT)&&x.push(n)}));r.sortInPlace(x,(function(e,t){return e.frame.width>t.frame.width})),L=r.clone(K.TypeLockupUtils.sortTextFormae(L)),s&&a!=l.AnimationStyle.LETTER_RANDOM_FADE_VARIANT&&(L=r.clone(K.TypeLockupUtils.padTextFormaeForLetterAnimation(L,a==l.AnimationStyle.LETTER_APPEAR_VARIANT)));var G,Y=[];a==l.AnimationStyle.WORD_CENTERED_VARIANT?u?((G=r.first(x))&&Y.push([G]),f=f.concat(x)):Y.push(x):a!=l.AnimationStyle.WORD_APPEAR_VARIANT&&a!=l.AnimationStyle.WORD_ZOOM_IN_VARIANT||Y.push(x);var j=[],q=0;if(a==l.AnimationStyle.LETTER_RANDOM_FADE_VARIANT){for(var Z=[],H=null,z=r.iter(L);!z.done;z.next()){var X=z.value;null!=H&&K.TypeLockupUtils.formaForSameTextRun(X,H)&&D.LockupStyle.isDuplicateFormaLook(X.lockupForma.style.textLook)&&Z.push(X),H=X}for(var J=r.iter(Z);!J.done;J.next()){var Q=J.value;r.remove(L,Q)}for(var $=r.iter(L);!$.done;$.next()){S=$.value,Y.push([S]);for(var ee=null,te=r.iter(Z);!te.done;te.next())Q=te.value,K.TypeLockupUtils.formaForSameTextRun(S,Q)&&(Y.push([Q]),ee=Q);for(var ne=r.iter(r.range(0,S.graphemeCount,!1));!ne.done;ne.next()){var oe,ie=ne.value,ae=new P.TextRange(ie,ie+1),re=[];re.push(S),(oe=ee)&&re.push(oe),j.push({key:ae,value:re})}(oe=ee)&&r.remove(Z,oe)}j=r.clone(r.shuffle(j))}else for(var le=[],se=r.iter(L);!se.done;se.next()){S=se.value;var me,ue=!1;if(!s&&(me=S.lockupForma)&&(St=r.as(me.controller,N.TypeLockupController))&&this.lockupDoesPerLetterLayout(me)){var ce=me.id;if(!le.includes(ce)){var ye=r.clone(r.as(St.groupLetterFormaeByWord(),["Array",["Array",c.Forma]]));r.append(Y,ye),le.push(me.id)}ue=!0}ue||(!S.isDecorationTextForma()||!D.LockupStyle.isDuplicateFormaLook(S.textLook)||T&&a==l.AnimationStyle.WORD_CENTERED_VARIANT||(q+=1),Y.push([S]))}var de=V.TimingFunctionType.Step;a==l.AnimationStyle.WORD_ZOOM_IN_VARIANT?de=V.TimingFunctionType.EaseOut:a==l.AnimationStyle.LETTER_APPEAR_FADE_VARIANT&&(de=V.TimingFunctionType.Linear);var fe=V.TimingFunctionType.EaseOut,pe=s?1.5:1,ve=Math.max(Math.min(r.toDouble(M)/7,2),pe);!s&&b>10&&(ve+=.25*r.toDouble(b-10),ve=Math.min(15,ve));var Te=a==l.AnimationStyle.LETTER_APPEAR_VARIANT||a==l.AnimationStyle.LETTER_APPEAR_FADE_VARIANT?.15:0,Ae=a==l.AnimationStyle.LETTER_RANDOM_FADE_VARIANT?j.length:Y.length;Ae-=q;var he=ve/r.toDouble(Ae+2),Fe=r.toDouble(t.endTime.timescale)*he,Se=r.toInt(r.toDouble(t.endTime.timescale)*(ve+Te)),ge=new U.TheoTime(Se,t.endTime.timescale),Le=ge.add(s?l.AnimationStyle.FADE_DURATION:new U.TheoTime(2,t.endTime.timescale));0==f.length&&(Le=new U.TheoTime(ge.value+1,ge.timescale)),t.endTime=Le;var Ie=new U.TheoTime(t.endTime.timescale,t.endTime.timescale);a==l.AnimationStyle.LETTER_APPEAR_VARIANT&&(Ie=new U.TheoTime(0,t.endTime.timescale));var xe={},ke=r.toDouble(t.startTime.value)+Te*r.toDouble(t.endTime.timescale);if(a==l.AnimationStyle.LETTER_RANDOM_FADE_VARIANT)this.getRandomLetterAppearKeyFrames(Y,a,t,de,xe,j,ke,Fe);else for(var De=ke,Ce=De,Me=null,_e=0,be=1,Re=r.iter(Y);!Re.done;Re.next()){e=Re.value;for(var we=r.iter(e);!we.done;we.next()){var Ee;if(S=we.value,(Xe=r.as(S,E.TextForma))&&(H=r.as(Me,E.TextForma))&&(Ee=r.as(r.opt(Xe.lockupForma,(function(e){return e.style})),D.LockupStyle))&&K.TypeLockupUtils.formaForSameTextRun(Xe,H)&&D.LockupStyle.isDuplicateFormaLook(Ee.textLook)&&S!==Me){xe[S.formaID]=[];for(var Ne=r.iter(xe[H.formaID]);!Ne.done;Ne.next()){var Ke=Ne.value,Oe=r.opt(Ke.style,(function(e){return e.clone()}));r.opt(Oe,(function(e){return e.colors.fieldPrimary=Xe.style.colors.fieldPrimary})),r.opt(Oe,(function(e){return 0!=e.opacity}))&&r.opt(Oe,(function(e){return e.opacity=Xe.style.opacity}));var Pe=new y.KeyFrame(Ke.time,Ke.timingFunction,Ke.placement,Ke.bounds,Oe,Ke.relativePlacement);Pe.renderRuns.copyColorAlpha(Xe,Ke.renderRuns),xe[S.formaID].push(Pe)}De=Ce}else{s&&(S===Me?_e+=1:_e=0),Me=S;var Ue=new U.TheoTime(r.toInt(Math.max(De-be,0)),t.endTime.timescale);Fe<1&&(be=Fe),Ue.value<=t.startTime.value&&(Ue=new U.TheoTime(r.toInt(t.startTime.value+1),t.endTime.timescale));var Ve=new U.TheoTime(r.toInt(De),t.endTime.timescale);Ve.value<=Ue.value&&Fe>=1&&(Ve=new U.TheoTime(Ue.value+1,t.endTime.timescale));var Be=new U.TheoTime(r.toInt(De+Fe-1),t.endTime.timescale);Be.value<=Ve.value&&(Be=new U.TheoTime(Ve.value+1,t.endTime.timescale));var We,Ge,Ye=new U.TheoTime(Be.value+1,t.endTime.timescale),je=S.style;if(h=!1,(St=r.as(S.controller,N.TypeLockupController))&&(h=this.useKnockoutAnimation(St,a)),(We=r.as(r.opt(r.opt(r.as(S,E.TextForma),(function(e){return e.lockupForma})),(function(e){return e.controller})),N.TypeLockupController))&&(h=this.useKnockoutAnimation(We,a)),a==l.AnimationStyle.LETTER_APPEAR_VARIANT){var qe=h?0:1;Ge=_.MotionUtils.createOpacityStyle(S,qe)}else{var Ze=h?0:Math.min(Ve.seconds/Ie.seconds,.8);Ge=_.MotionUtils.createOpacityStyle(S,Ze)}var He=_.MotionUtils.createOpacityStyle(S,0);if(h&&a!=l.AnimationStyle.WORD_CENTERED_VARIANT){var ze=(n=r.opt(r.as(r.opt(r.opt(r.as(S,E.TextForma),(function(e){return e.lockupForma})),(function(e){return e.style})),D.LockupStyle),(function(e){return e.backingOpacity})))||null!=n?n:S.style.opacity;He=_.MotionUtils.createOpacityStyle(S,ze);var Xe,Je=!1;(Xe=r.as(S,E.TextForma))&&(Je=_e>=Xe.graphemeCount),s&&!Je||(je=_.MotionUtils.createOpacityStyle(S,0))}if(s&&0!=_e||(xe[S.formaID]=[],xe[S.formaID].push(new y.KeyFrame(t.startTime,de,C.Matrix2D.Identity,null,He))),a==l.AnimationStyle.WORD_CENTERED_VARIANT){var Qe=this.calculateWordCenteredDynamicShift(S);S.isShape()&&T?(xe[S.formaID].push(new y.KeyFrame(Ue,de,C.Matrix2D.Identity,null,He)),xe[S.formaID].push(new y.KeyFrame(Ve,de,C.Matrix2D.Identity,null,He))):(xe[S.formaID].push(new y.KeyFrame(Ue,de,Qe,null,He)),xe[S.formaID].push(new y.KeyFrame(Ve,de,Qe,null,je))),S.isShape()?T?(xe[S.formaID].push(new y.KeyFrame(ge.addVal(-10),fe,C.Matrix2D.Identity,null,He)),xe[S.formaID].push(new y.KeyFrame(ge.addVal(-9),de,C.Matrix2D.Identity,null,je))):(xe[S.formaID].push(new y.KeyFrame(ge.addVal(-10),fe,Qe,null,je)),xe[S.formaID].push(new y.KeyFrame(ge.addVal(-9),de,Qe,null,He))):(xe[S.formaID].push(new y.KeyFrame(Be,de,Qe,null,je)),xe[S.formaID].push(new y.KeyFrame(Ye,de,Qe,null,He))),S.isShape()&&T?xe[S.formaID].push(new y.KeyFrame(ge,de,C.Matrix2D.Identity,null,je)):xe[S.formaID].push(new y.KeyFrame(ge,de,C.Matrix2D.Identity,null,He))}else if(a==l.AnimationStyle.WORD_ZOOM_IN_VARIANT){var $e,et,tt=S.isFullCanvas?1:10;if(Qe=C.Matrix2D.Identity,($e=r.opt(r.opt(S.root,(function(e){return e.finalFrame})),(function(e){return e.center})))&&(et=S.totalPlacement.inverse)){var nt=et.transformPoint($e).subtract(S.bounds.center),ot=C.Matrix2D.scalingXYfromPoint(S.frame.center,tt,tt);Qe=ot.translate(nt)}r.opt(xe[S.formaID],(function(e){return e.push(new y.KeyFrame(Ue,de,Qe,null,He))})),r.opt(xe[S.formaID],(function(e){return e.push(new y.KeyFrame(Ve,de,Qe,null,je))})),r.opt(xe[S.formaID],(function(e){return e.push(new y.KeyFrame(Be,de,C.Matrix2D.Identity,null,je))}))}else if(a==l.AnimationStyle.LETTER_APPEAR_FADE_VARIANT){k.LegacyCoreAssert.fail("AnimationStyle.LETTER_APPEAR_FADE_VARIANT not updated for word forma",void 0,"AnimationLibrary.setDynamicWordAnimation","AnimationLibrary.swift",2138),r.opt(xe[S.formaID],(function(e){return e.push(new y.KeyFrame(Ue,de,C.Matrix2D.Identity,null,He))})),r.opt(xe[S.formaID],(function(e){return e.push(new y.KeyFrame(Ve,de,C.Matrix2D.Identity,null,Ge))}));var it=Ve.addSeconds(Ie.seconds),at=Le.seconds>it.seconds?it:Le.addVal(-1);r.opt(xe[S.formaID],(function(e){return e.push(new y.KeyFrame(at,de,C.Matrix2D.Identity,null,je))}))}else{var rt=new y.KeyFrame(Ue,de,C.Matrix2D.Identity,null,He),lt=new y.KeyFrame(Ve,de,C.Matrix2D.Identity,null,je);if(s){if(X=r.as(S,E.TextForma)){var st=X.graphemeCount,mt=_e<st?_e:st,ut=X.fontColor,ct=X.fontStrokeColor,yt=new R.SolidColor(ut.red,ut.green,ut.blue,0);h&&a!=l.AnimationStyle.WORD_CENTERED_VARIANT&&(yt=ut,ut=new R.SolidColor(ut.red,ut.green,ut.blue,0),ct=new R.SolidColor(ct.red,ct.green,ct.blue,0)),lt.renderRuns.applyColors(ut,ct,new P.TextRange(0,mt)),lt.renderRuns.applyColors(yt,yt,new P.TextRange(mt,st))}var dt=new y.KeyFrame(Ue,de,C.Matrix2D.Identity,null,je);dt.renderRuns=lt.renderRuns,r.opt(xe[S.formaID],(function(e){return e.push(dt)}))}else r.opt(xe[S.formaID],(function(e){return e.push(rt)}));r.opt(xe[S.formaID],(function(e){return e.push(lt)}))}this.validateKeyFrames(xe[S.formaID].concat(),"variants"),Ce=De}}De+=Fe}for(var ft=r.iter(f);!ft.done;ft.next())S=ft.value,He=_.MotionUtils.createOpacityStyle(S,0),h=!1,(St=r.as(r.opt(r.opt(r.as(S,E.TextForma),(function(e){return e.lockupForma})),(function(e){return e.controller})),N.TypeLockupController))&&(h=this.useKnockoutAnimation(St,a)),h&&S instanceof E.TextForma&&(ze=(o=r.opt(r.as(r.opt(r.opt(r.as(S,E.TextForma),(function(e){return e.lockupForma})),(function(e){return e.style})),D.LockupStyle),(function(e){return e.backingOpacity})))||null!=o?o:S.style.opacity,He=_.MotionUtils.createOpacityStyle(S,ze)),null==xe[S.formaID]&&((It=[]).push(new y.KeyFrame(t.startTime,fe,C.Matrix2D.Identity,null,He)),xe[S.formaID]=It,r.opt(xe[S.formaID],(function(e){return e.push(new y.KeyFrame(ge,fe,C.Matrix2D.Identity,null,He))})),this.validateKeyFrames(xe[S.formaID].concat(),"createOpacityStyle"));for(var pt=[],vt=r.iter(Y);!vt.done;vt.next()){e=vt.value;for(var Tt=r.iter(e);!Tt.done;Tt.next()){var At=Tt.value;pt.push(At)}}for(var ht=f.concat(pt),Ft=r.iter(this.uniqueFormae(ht));!Ft.done;Ft.next()){var St;je=(S=Ft.value).style,h=!1,(St=r.as(r.opt(r.opt(r.as(S,E.TextForma),(function(e){return e.lockupForma})),(function(e){return e.controller})),N.TypeLockupController))&&(h=this.useKnockoutAnimation(St,a)),h&&S instanceof E.TextForma&&(je=_.MotionUtils.createOpacityStyle(S,0)),(It=xe[S.formaID])&&It.length>0&&It[It.length-1].time.value>=Le.value&&r.info("error?"),xe[S.formaID].push(new y.KeyFrame(Le,fe,C.Matrix2D.Identity,null,je)),Le.value-15<t.endTime.value&&xe[S.formaID].push(new y.KeyFrame(t.endTime.addVal(15),fe,C.Matrix2D.Identity,null,je)),this.validateKeyFrames(xe[S.formaID].concat(),"fade time checks")}for(var gt=e.concat(pt).concat(f),Lt=r.iter(this.uniqueFormae(gt));!Lt.done;Lt.next()){var It,xt;if(It=xe[(S=Lt.value).formaID])S.animation=y.FormaAnimation.init_9e82(t,t.startTime,t.endTime,It.concat()),S.kind==E.TextForma.KIND&&(xt=r.opt(r.opt(S.parent,(function(e){return e.parent})),(function(e){return e.parent})))&&xt.isTypeLockup()&&null==xt.animation&&this.setStillAnimation(xt,t),this.validateKeyFrames(S.animation.keyFrames,"dynamicWord/setStillAnimation");else S.animation=null}}}},findLockupAncestor:function(e){return r.as(e.visit(c.FormaTraversal.NearestAncestor,(function(e,t,n){return e.isTypeLockup()})),T.GroupForma)},calculateWordCenteredDynamicShift:function(e){var t,n,o,i;if((t=this.findLockupAncestor(e))&&this.lockupDoesPerLetterLayout(t))return C.Matrix2D.Identity;if((n=r.opt(r.opt(e.root,(function(e){return e.finalFrame})),(function(e){return e.center})))&&(o=e.totalPlacement.inverse)&&(i=r.opt(e.bounds,(function(e){return e.center})))){var a,l,s,m;if((a=r.as(e,E.TextForma))&&(i=a.getBoundsCenter()),(l=e.placement.inverse)&&(s=e.bounds)&&(m=e.parent)){var u=n.subtract(m.totalPlacement.transformPoint(O.TheoPoint.ZERO));return l.translate(new O.TheoPoint(-s.width/2+u.x,-s.height/2+u.y))}var c=o.transformPoint(n);return C.Matrix2D.translation(c.subtract(i))}return C.Matrix2D.Identity},uniqueFormae:function(e){for(var t=[],n=r.iter(e);!n.done;n.next()){var o=n.value;r.containsEq(t,o,c._equality_Forma_Forma)||t.push(o)}return t},getTitleLockups:function(e){var t=r.clone(e.filterWithCallback((function(e){return e.isTypeLockup()})));if(0==t.length)return[];r.sortInPlace(t,(function(e,t){return e.controller.currentHeightScale>t.controller.currentHeightScale}));for(var n=t[0],o=[n],i=r.iter(t);!i.done;i.next()){var a,l,s=i.value;if(!r.eq(c._equality_Forma_Forma,s,n)&&(a=r.as(s.controller,N.TypeLockupController))&&(l=r.as(n.controller,N.TypeLockupController))){var m=a.getCurrentFontSize(),u=l.getCurrentFontSize();Math.abs(m-u)/Math.min(m,u)<.05&&o.push(s)}}return o},setSlideAnimation:function(e,t,n){var o,i=[],a=[],s=!1,m=!1;if(F.Host.textModelUtils.usePGMRenderer()||(o=r.opt(r.as(e.controller,N.TypeLockupController),(function(e){return e.lockupStyle})))&&(D.LockupStyle.isKnockoutLook(o.textLook)&&o.backing==D.LockupBacking.Knockout&&(s=!0),m=D.LockupStyle.isKnockoutLook(o.textLook)&&o.textLook!=D.LockupTextLook.KnockoutOnly),e.isTypeLockup()?e.visitAll(c.FormaTraversal.PreOrder,(function(e){m||e instanceof w.ShapeForma?a.push(e):e instanceof E.TextForma&&i.push(e)})):i.push(e),2==t.variant||1==t.variantCount||s){var u=75;s&&(u=2==t.variant||1==t.variantCount?-75:0==t.variant?-200:200);var d=C.Matrix2D.translation(new O.TheoPoint(-u,0)),f=C.Matrix2D.translation(new O.TheoPoint(u,0)),p=t.endTime.multiply(2/3);if(this.setFormaAnimations(i,t,0,e.style.opacity,d,V.TimingFunctionType.EaseInOut,t.startTime,t.startTime,p),this.setFormaAnimations(a,t,0,e.style.opacity,f,V.TimingFunctionType.EaseInOut,t.startTime,t.startTime,p),e.isTypeLockup()){var v=[];v.push(new y.KeyFrame(t.startTime,V.TimingFunctionType.Linear)),v.push(new y.KeyFrame(p,V.TimingFunctionType.Linear)),e.animation=y.FormaAnimation.init_9e82(t,t.startTime,t.endTime,v.concat()),e.animation=y.FormaAnimation.init_9e82(t,t.startTime,p,v.concat())}}else{var T=t.endTime.subtract(l.AnimationStyle.FADE_DURATION);r.containsEq(n,e,c._equality_Forma_Forma)?(d=C.Matrix2D.translation(new O.TheoPoint(0==t.variant?-200:200,0)),this.setLineAnimation(e,t,d,V.TimingFunctionType.EaseInOut,t.startTime,T,new U.TheoTime(r.toInt(.1*r.toDouble(t.endTime.timescale)),t.endTime.timescale)),this.setStillAnimation(e,t,t.startTime,T)):this.setFormaFade(e,t,t.startTime,t.endTime,T)}},setFormaFade:function(e,t,n,o,i){var a,r=e;(a=I.ImageFacade.getImageFormaForForma(e))&&(r=a);var l=r.style,s=_.MotionUtils.createOpacityStyle(r,0),m=[];m.push(new y.KeyFrame(n,V.TimingFunctionType.Linear,C.Matrix2D.Identity,null,s)),m.push(new y.KeyFrame(i,V.TimingFunctionType.Linear,C.Matrix2D.Identity,null,s)),m.push(new y.KeyFrame(o,V.TimingFunctionType.Linear,C.Matrix2D.Identity,null,l)),e.animation=y.FormaAnimation.init_9e82(t,n,o,m.concat())},getShiftingMatrix:function(e,t,n,o){var i,a=e.finalFrame,r=e.root.frame,l=e.root.placement.inverse.transformPoint(r.eval(n)),s=C.Matrix2D.scaling(t),m=e.root.placement.concat(s).transformPoint(l);return i=o?m.subtract(a.center):r.center.subtract(m),C.Matrix2D.scaling(t).translate(i)},setFormaAnimations:function(e,t,n,o,i,a,l,s,m){void 0===n&&(n=null),void 0===o&&(o=null),void 0===i&&(i=C.Matrix2D.Identity),void 0===a&&(a=V.TimingFunctionType.Linear);for(var u=r.iter(e);!u.done;u.next()){var c=u.value,d=c.style,f=null!=n?_.MotionUtils.createOpacityStyle(c,n):d,p=null!=o?_.MotionUtils.createOpacityStyle(c,o):d,v=[];l.value!=s.value&&v.push(new y.KeyFrame(l,a,i,null,f)),v.push(new y.KeyFrame(s,a,i,null,f)),v.push(new y.KeyFrame(m,a,C.Matrix2D.Identity,null,p)),c.animation=y.FormaAnimation.init_9e82(t,l,m,v.concat())}},setGreyscaleAnimation:function(e,t){var n=[],o=e.page.imageFilterLibrary.getImageStyle(x.ImageStyle.NAME_GREYSCALE).clone();o.colorLibrary=e.style.colorLibrary;var i=e.style.clone();null==i.filter&&(i.filter=L.CompositeFilter.init_514f(void 0,"None",0,"normal",void 0,void 0,"none")),k.LegacyCoreAssert.isTrue(o.colorLibrary==e.style.colorLibrary,"color library mismatch: forma style and greyscale image style",void 0,"AnimationLibrary.setGreyscaleAnimation","AnimationLibrary.swift",2562),k.LegacyCoreAssert.isTrue(i.colorLibrary==e.style.colorLibrary,"color library mismatch: forma style and clone",void 0,"AnimationLibrary.setGreyscaleAnimation","AnimationLibrary.swift",2563),o.adjustments=e.style.adjustments,i.adjustments=e.style.adjustments,n.push(new y.KeyFrame(t.startTime,V.TimingFunctionType.Linear,C.Matrix2D.Identity,null,o)),n.push(new y.KeyFrame(t.endTime,V.TimingFunctionType.Linear,C.Matrix2D.Identity,null,i)),e.animation=y.FormaAnimation.init_9e82(t,t.startTime,t.endTime,n.concat())},setBlurAnimation:function(e,t){t.endTime=l.AnimationStyle.DEFAULT_DURATION.subtract(new U.TheoTime(30,30));var n=[],o=e.style.clone(),i=e.style.clone();null!=o.filter&&o.filter instanceof L.CompositeFilter||((o=e.page.imageFilterLibrary.getImageStyle(x.ImageStyle.NAME_BLUR).clone()).colorLibrary=e.style.colorLibrary,(i=e.page.imageFilterLibrary.getImageStyle(x.ImageStyle.NAME_BLUR).clone()).colorLibrary=e.style.colorLibrary),k.LegacyCoreAssert.isTrue(o.colorLibrary==e.style.colorLibrary,"color library mismatch: forma style and first clone",void 0,"AnimationLibrary.setBlurAnimation","AnimationLibrary.swift",2595),k.LegacyCoreAssert.isTrue(i.colorLibrary==e.style.colorLibrary,"color library mismatch: forma style and second clone",void 0,"AnimationLibrary.setBlurAnimation","AnimationLibrary.swift",2596),o.adjustments=e.style.adjustments,i.adjustments=e.style.adjustments,o.filter.blurRadius=20,i.filter.blurRadius=0,n.push(new y.KeyFrame(t.startTime,V.TimingFunctionType.EaseOut,C.Matrix2D.Identity,null,o)),n.push(new y.KeyFrame(t.endTime,V.TimingFunctionType.EaseOut,C.Matrix2D.Identity,null,i)),e.animation=y.FormaAnimation.init_9e82(t,t.startTime,t.endTime,n.concat())},setFillAnimation:function(e,t){var n,o,i=[];if((n=e.style.clone())&&(o=e.style.clone())){n.filter=L.CompositeFilter.init_514f(void 0,"Fill",1,"normal",void 0,void 0,"none"),null==o.filter&&(o.filter=L.CompositeFilter.init_514f(void 0,"None",0,"normal",void 0,void 0,"none")),n.colorLibrary=e.style.colorLibrary,o.colorLibrary=e.style.colorLibrary,n.adjustments=e.style.adjustments,o.adjustments=e.style.adjustments;var a=r.clone(e.page.colorLibraryController.getThemeColorKeys());a.length>t.variant&&(n.colors.fieldPrimary=e.page.colorLibraryController.getSolidColorForKey(r.as(a[t.variant],"String")),n.colors.fieldSecondary=null,r.opt(n.filter,(function(e){return e.style=n})),r.opt(o.filter,(function(e){return e.style=o})),i.push(new y.KeyFrame(t.startTime,V.TimingFunctionType.EaseInOut,C.Matrix2D.Identity,null,n)),i.push(new y.KeyFrame(t.endTime,V.TimingFunctionType.EaseInOut,C.Matrix2D.Identity,null,o)),e.animation=y.FormaAnimation.init_9e82(t,t.startTime,t.endTime,i.concat()))}},setColorSwitchAnimation:function(e,t){var n,o,i=[];if((n=e.style.clone())&&(o=e.page.imageFilterLibrary.getImageStyle(x.ImageStyle.NAME_OVERLAY).clone())){var a;if(null==n.filter&&(n.filter=L.CompositeFilter.init_514f(void 0,"None",0,"normal",void 0,void 0,"none")),a=r.as(o.filter,L.CompositeFilter)){var l=r.clone(e.page.colorLibraryController.getThemeColorKeys());l.length>t.variant&&(o.colors.fieldPrimary=e.page.colorLibraryController.getSolidColorForKey(r.as(l[t.variant],"String"))),a.mix=Math.max(a.mix,1)}k.LegacyCoreAssert.isTrue(n.colorLibrary==e.style.colorLibrary,"color library mismatch: forma style and clone",void 0,"AnimationLibrary.setColorSwitchAnimation","AnimationLibrary.swift",2676),o.colorLibrary=e.style.colorLibrary,n.adjustments=e.style.adjustments,o.adjustments=e.style.adjustments,i.push(new y.KeyFrame(t.startTime,V.TimingFunctionType.EaseInOut,C.Matrix2D.Identity,null,n)),i.push(new y.KeyFrame(t.endTime,V.TimingFunctionType.EaseInOut,C.Matrix2D.Identity,null,o)),e.animation=y.FormaAnimation.init_9e82(t,t.startTime,t.endTime,i.concat())}},setZoomAnimation:function(e,t){var n=0==t.variant?.8:1.2;e instanceof f.FrameForma?this.setScaleForma(e,t,new O.TheoPoint(n,n),new O.TheoPoint(.5,.5),V.TimingFunctionType.EaseOut,t.startTime,t.endTime):this.setImageAnimation(e,t,V.TimingFunctionType.EaseOut,[[t.startTime,O.TheoPoint.ZERO,n],[t.endTime,O.TheoPoint.ZERO,1]],!0)},setPanningAnimation:function(e,t){var n,o,i,a=!(!(n=r.opt(r.as(e,g.ImageForma),(function(e){return e.hasAlpha()})))&&null==n)&&n;(o=I.ImageFacade.getFrameFormaForForma(e))&&(i=r.as(o.controller,d.FrameController))&&(a=a||i.hasCutout);var l=1==t.variant?-150:150;this.setImageAnimation(e,t,V.TimingFunctionType.EaseOut,[[t.startTime,new O.TheoPoint(l,0),1],[t.endTime,O.TheoPoint.ZERO,1]],!a)},randomDbl:function(){return r.toDouble(m.CoreRandom.nextInt)/r.toDouble(m.CoreRandom.randMax)},setAnimationStyleForFormae:function(e,t,n){if(void 0===n&&(n=null),t.name==l.AnimationStyle.NAME_COLORSWAP)this.setColorSwapAnimation(e,t,n);else if(t.name==l.AnimationStyle.NAME_FLICKER)this.setFlickerAnimation(e,t);else if(t.name==l.AnimationStyle.NAME_DYNAMIC||t.name==l.AnimationStyle.NAME_TYPE)this.setDynamicWordAnimation(e,t);else if(t.name==l.AnimationStyle.NAME_FADE&&0==t.variant)this.setFadeAnimationTopDown(e,t);else{for(var o=!1,i=r.as(r.opt(r.first(e),(function(e){return e.root})),b.RootForma),a=r.clone(null!=i?this.getTitleLockups(i):[]),s=r.iter(e);!s.done;s.next()){var m=s.value;o=o||!r.containsEq(a,m,c._equality_Forma_Forma)}t.name==l.AnimationStyle.NAME_SLIDE&&t.variantCount<2&&(t.endTime=t.endTime.addSeconds(-1));for(var u=U.TheoTime.Zero,y=r.iter(e);!y.done;y.next()){var d;if(null!=(m=y.value).controller){var p,v,T=m.hasIntent(c.Forma.INTENT_ICON)&&this.shouldAnimateShape(m),A=m.kind==f.FrameForma.KIND&&m.controller.moveable;if(T||m.isTypeLockup()||A)(v=r.as(m.controller,N.TypeLockupController))&&v.updateGroup(),t.name==l.AnimationStyle.NAME_NO_STYLE?m.animation=null:t.name==l.AnimationStyle.NAME_GROW?this.setGrowAnimation(m,t,a):t.name==l.AnimationStyle.NAME_FADE?this.setFadeAnimation(m,t,a):t.name==l.AnimationStyle.NAME_SLIDE&&this.setSlideAnimation(m,t,a);else if(p=I.ImageFacade.getImageFormaForForma(m)){var h;if((h=r.as(m,B.VideoForma))&&h.videoContentNode.isGIF){this.setStillAnimation(p,t);continue}if(t.name==l.AnimationStyle.NAME_NO_STYLE)p.animation=null;else if(t.name==l.AnimationStyle.NAME_BLUR)this.setBlurAnimation(p,t);else if(t.name==l.AnimationStyle.NAME_GRAYSCALE)this.setGreyscaleAnimation(p,t);else if(t.name==l.AnimationStyle.NAME_FILL)this.setFillAnimation(p,t);else if(t.name==l.AnimationStyle.NAME_COLOR)this.setColorSwitchAnimation(p,t);else if(t.name==l.AnimationStyle.NAME_PAN){var F=p.controller.floating?p.parent:p;this.setPanningAnimation(F,t)}else t.name==l.AnimationStyle.NAME_ZOOM&&(F=p.controller.floating?p.parent:p,this.setZoomAnimation(F,t))}}(d=m.animation)&&d.endTime.seconds>u.seconds&&(u=d.endTime)}u.seconds>0&&(t.endTime=u)}},setRootAnimationStyle:function(e,t){this.setStillAnimation(t,e),_.MotionUtils.invalidateAnimation(t.page.document)},modifyModelForAnimation:function(e,t){var n,i,a=this,s=r.as((e||t.page.animationLibrary.getNoneStyle()).forkToDatabase(h.GUIDUtils.makeGUID(),!1,t.database,null),l.AnimationStyle);if(i=s){var m=new p.FormaAnimationChangedEvent(t);if(t.beginUpdate(m),M.MotionFacade.canApplyStyle(i))return M.MotionFacade.applyStyle(t,i),void t.endUpdate(m);var u=i.name,v=u==l.AnimationStyle.NAME_NO_STYLE,T=u==l.AnimationStyle.NAME_COLORSWAP;i.endTime=v?l.AnimationStyle.NOOP_DURATION:l.AnimationStyle.DEFAULT_DURATION;var A=[],F=U.TheoTime.Zero,S=[],g=!1;t.visitAll(c.FormaTraversal.PreOrder,(function(e){var t,o,i;if((t=r.as(e,B.VideoForma))&&(o=r.opt(t.parent,(function(e){return e.controller})))){var a=W.VideoFacade.getDurationForVideo(t);a.isZero||(o.moveable?S.push(t):F.seconds<a.seconds&&(F=a))}if(e.animation=null,i=e.controller){if(i.userGroup)return;i.moveable&&!e.isVideo()&&(g=!0);var l=i.moveable&&e.isImage()&&!e.isSticker(),s=T&&l&&!(!(n=r.opt(r.as(i,d.FrameController),(function(e){return e.hasBackgroundColor})))&&null==n)&&n;l&&!s||e.isLogo()||A.push(e)}}));for(var L=r.iter(S);!L.done;L.next()){var x,D=L.value;r.remove(A,D),(x=D.parent)&&r.remove(A,x)}g||(i.endTime=l.AnimationStyle.NOOP_DURATION);var C=i.endTime.timescale,b=null;if(T&&!F.isZero){var R=F.seconds,w=l.AnimationStyle.COLOR_SWAP_DURATION.seconds;b=o.extendToIntegralCount(w,R,C)}this.setAnimationStyleForFormae(A,i,b);var E=i.endTime,N=E,K=U.TheoTime.fromTimeInTimescale(l.AnimationStyle.STILL_DURATION,C);if(S.length>0||!F.isZero){for(var O=l.AnimationStyle.GIF_DURATION,P=U.TheoTime.Zero,V=r.iter(S);!V.done;V.next()){var G=V.value,Y=W.VideoFacade.getDurationForVideo(G);Y.laterThan(P)&&(P=Y)}if(F.isZero){if(!T){var j=P.seconds,q=Math.max(j,O.seconds),Z=o.extendToIntegralCount(q,j,C);N=E.add(Z)}}else{var H=E.seconds;if(!T){var z=F.safeSubtract(E);!v&&z.earlierThan(K)&&(z=K),z.earlierThan(P)&&(z=P),v&&S.length>0&&z.earlierThan(O)&&(z=O),H+=z.seconds}R=F.seconds,N=o.extendToIntegralCount(H,R,C)}for(var X=T?i.startTime:i.endTime,J=r.iter(S);!J.done;J.next()){G=J.value;var Q=_.MotionUtils.createOpacityStyle(G,0),$=G.style,ee=[];v||T?ee.push(y.KeyFrame.makeFromTimeAndStyle(X,$)):(ee.push(y.KeyFrame.makeFromTimeAndStyle(i.startTime,Q)),ee.push(y.KeyFrame.makeFromTimeAndStyle(X,Q)),ee.push(y.KeyFrame.makeFromTimeAndStyle(X.addSeconds(.5),$))),ee.push(y.KeyFrame.makeFromTimeAndStyle(N,$)),G.animation=y.FormaAnimation.init_9e82(i,X,N,ee.concat())}}else T||(N=N.add(K));i.endTime=N;for(var te=r.iter(A);!te.done;te.next()){var ne,oe,ie=te.value;(ne=r.as(ie,B.VideoForma))&&(oe=r.opt(ne.parent,(function(e){return e.controller})))&&!oe.moveable&&v&&this.setStillAnimation(ie,i)}!T&&i.endTime.value>0&&this.setStillAnimation(t,i),t.visitAll(c.FormaTraversal.PreOrder,(function(e){var t,n;(t=e.animation)&&(e.kind==f.FrameForma.KIND&&(n=I.ImageFacade.getImageFormaForForma(e))&&null==n.animation&&a.setStillAnimation(n,i),a.validateKeyFrames(t.keyFrames,"applyStyle/setStillAnimation"))})),t.endUpdate(m)}else k.LegacyCoreAssert.fail("Unable to fall back on 'None' style while applying animation?!?",void 0,"AnimationLibrary.modifyModelForAnimation","AnimationLibrary.swift",3137),t.animation=null},validateKeyFrames:function(e,t){var n=e.length;if(!(n<=1))for(var o=r.iter(r.range(0,n-1,!1));!o.done;o.next()){var i=o.value,a=e[i],l=e[i+1];a.time.value>l.time.value&&l.time.value>0&&r.opt(F.Host.logging,(function(e){return e.error("keyframe time error on frames "+i+"/"+(i+1)+" with context "+t)}))}}}}),o)}}]);
//# sourceMappingURL=vendors_npm_spark_3f9ef5e1-cd713b5c.js.map