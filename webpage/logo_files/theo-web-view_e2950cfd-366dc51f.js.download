(window.webpackJsonptheoWebApp=window.webpackJsonptheoWebApp||[]).push([[108,85,96],{"3cgi":function(e,t,a){"use strict";a.r(t),a.d(t,"addLogoFromBrandkit",(function(){return c}));var n=a("bBG2"),o=a("J9tZ"),r=a("MGCh"),i=a.n(r),s=a("luSs"),l=a("rJP3");const d=i.a.channel("add-logo-from-brandkit");async function c({component:e,logoData:t,coreWrapper:a,replacementForma:r}){const i=l.default.currentBrandKit(),c=i?i.getTypeForAnalytics():null;n.default.publish("brandKitLogoApplied",{contextualData3:c}),Object(s.a)(e,"image-loading-begin");const[u]=await Object(o.a)(a.addLogo(t,r));u&&d.error("Failed to add logo from brandkit.",u),n.default.publish("editor:logoAdded")}t.default=c},"4AtL":function(e,t,a){"use strict";a.r(t),a.d(t,"addNewLogo",(function(){return w}));var n=a("7gWt"),o=a("I/Z9"),r=a("Pv/z"),i=a("qcxC"),s=a("luSs"),l=a("lulf"),d=a("MGCh"),c=a.n(d),u=a("tpS0"),p=a.n(u);function m({deferredObj:e,components:t}){const a=new p.a({headerText:"i18n.panels.addNewLogo.kSizeWarningHeader",contentText:"i18n.panels.addNewLogo.kSizeWarningContent",dismissable:!1,buttons:[{class:"pill pill-primary-on-light",label:"i18n.components.buttons.kContinue",onClick(){a.hide(),e.resolve(!0)}},{class:"pill pill-secondary-on-light",label:"i18n.common.kCancel",onClick(){Object(s.a)(t,"image-loading-end"),a.hide(),e.reject(!0)}}]});return a}var h=a("J9tZ"),g=a("rJP3");var f=a("LU24");const b=c.a.channel("add-new-logo");async function w({component:e,coreWrapper:t,uiStateController:a,data:d,docSavedDfd:c,replacingForma:u,refreshCurrentBrandElements:p}){n.SparkPerformanceTracker.mark(f.PERFORMANCE_MARKERS.logo),Object(s.a)(e,"image-loading-begin");const w=d.files[0],v=new l.default,S=Object(i.deferred)(),y=await Object(o.renderBlobToCanvas)(w),{width:k,height:P}=y;if(y&&(k<180||P<180)){m({deferredObj:S,components:e});const[t]=await Object(h.a)(S.promise);if(t)return c.resolve()}const I=y.getContext("2d"),C=Object(o.checkCanvasForAlpha)(I,k,P);let E=w;if(y&&C&&(Object(o.trimTransparentEdges)(y),E=await Object(o.canvasToBlob)(y)),v.featureEnabled("entitle-brand-kit")||"brandkit"!==d.source){const[e,t]=await Object(h.a)(async function({imageData:e,refreshCurrentBrandElements:t}){const a=g.default&&g.default.getCurrentBrandElements(),n=!a||!a.logos||a.logos.length<1,o=await g.default.addLogoToCurrentBrand(e,n);if(!o)return;return t(!0),{sparkElementId:o.getValue("id"),sparkRoles:o.getValue("ac#roles")}}({refreshCurrentBrandElements:p,imageData:E}));e&&b.error("Failed to add logo to current brand.",e),d.sparkElementId=null==t?void 0:t.sparkElementId,d.sparkRoles=null==t?void 0:t.sparkRoles}d.processedImgData=E,d.isLogo=!0,d.hasAlpha=C,await Object(r.addNewImage)({coreWrapper:t,uiStateController:a,data:d,replacingForma:u,docSavedDfd:c,component:e}),n.SparkPerformanceTracker.measure(f.PERFORMANCE_MARKERS.logoComplete,f.PERFORMANCE_MARKERS.logo)}t.default=w},"9RDl":function(e,t,a){"use strict";a.r(t);var n=a("MGCh"),o=a.n(n),r=a("hxdN"),i=a("vWh2");function s(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}const l={red:32,green:240,blue:130},d={red:238,green:72,blue:72},c=o.a.channel("refine-cutout");t.default=class{constructor(e,t){s(this,"canvas",void 0),s(this,"coreWrapper",void 0),s(this,"paintBrush",new r.a),s(this,"eventSubscriptionHandles",[]),s(this,"operationQueue",new i.a),this.canvas=e,this.coreWrapper=t,this.eventSubscriptionHandles.push(t.events.subscribe("update-refine-cutout-visualization",this.update.bind(this))),this.eventSubscriptionHandles.push(t.events.subscribe("clear-refine-cutout-visualization",this.clear.bind(this)))}destroy(){this.eventSubscriptionHandles.forEach(e=>{e.remove()}),this.eventSubscriptionHandles=[],this.paintBrush.destroy()}update(e){this.operationQueue.add(async()=>{const t=this.canvas.getContext("2d"),a=this.canvas.width,n=this.canvas.height,{start:o,xRelative:r,yRelative:i,brushSize:s,isAdditive:u}=e,p=u?l:d,m=Math.max(a,n),h=Math.max(Math.min(512/m,1),.1),g=Math.ceil(a*h),f=Math.ceil(n*h),b=s*h;if(o){const t=this.coreWrapper.getViewScale();c.info(`View scale at start: ${t} (params: ${e.viewScale})`),c.info(`Mask bounds: ${e.maskWidth} x ${e.maskHeight}, mask pixel bounds: ${e.maskPixelWidth} x ${e.maskPixelHeight} CTM: ${e.maskCTM.description}`)}let w=o;this.paintBrush.width===g&&this.paintBrush.height===f||(c.info(`Paint brush canvas resize: ${a} x ${n}, scale ${h}, scaled ${g} x ${f}`),w=await this.paintBrush.setSize(g,f)),this.paintBrush.setBrushSize(b),this.paintBrush.setBrushColor(p),w?await this.paintBrush.drawAt(g*r,f*i):await this.paintBrush.drawTo(g*r,f*i),await this.paintBrush.updateCanvas(t,a,n)})}clear(){const e=this.canvas.getContext("2d"),t=this.canvas.width,a=this.canvas.height;null==e||e.clearRect(0,0,t,a),this.paintBrush.clear()}}},BQ0V:function(e,t,a){"use strict";a.r(t),a.d(t,"default",(function(){return I}));var n=a("UzQk"),o=a("OI2j"),r=a.n(o),i=a("FpXA"),s=a.n(i),l=a("tWZ4"),d=a("ynbG"),c=a("+VG/"),u=a.n(c),p=a("C8IR"),m=a.n(p),h=a("0VUy"),g=a.n(h),f=a("2Fsf"),b=a.n(f),w=a("tQ0N"),v=a.n(w),S=a("L4yB"),y=a("65r0");function k(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function P(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class I{constructor(e,t,a,o,i){this.coreWrapper=e,this.isWatermarkEnabled=t,this.isWebAnimationEnabled=a,this.postFeatureController=o,this.dismissedWatermarkCoachmark=i,P(this,"poster",void 0),P(this,"canvasInteractionLayer",void 0),P(this,"actionLayer",void 0),P(this,"imageWrapper",void 0),P(this,"posterAdornments",void 0),P(this,"watermarkUI",void 0),P(this,"isAdobeInternalUser",void 0),P(this,"requestSaveMethod",void 0),P(this,"animationPlayButton",void 0),P(this,"feedbackButton",void 0),this.handleAnimationStart=this.handleAnimationStart.bind(this),this.handleAnimationPause=this.handleAnimationPause.bind(this),this.handleAnimationLoadingBegin=this.handleAnimationLoadingBegin.bind(this),this.handleAnimationLoadingEnd=this.handleAnimationLoadingEnd.bind(this),this.onPointerDown=this.onPointerDown.bind(this),this.onPointerUp=this.onPointerUp.bind(this),this.onPointerMove=this.onPointerMove.bind(this),this.handleZendeskWidgetClick=this.handleZendeskWidgetClick.bind(this),this.isAdobeInternalUser=Object(y.a)(),this.requestSaveMethod=this.coreWrapper.requestSave,this.canvasInteractionLayer=new g.a({id:"canvasInteractionLayer",parent:"PostCanvasSection",onPointerDown:this.onPointerDown,onPointerUp:this.onPointerUp,onPointerMove:this.onPointerMove}),this.actionLayer=new b.a({id:"PostActionLayer",parent:"PostCanvasSection"}),this.imageWrapper=new m.a({id:"PosterImageWrapper",parent:this.canvasInteractionLayer}),this.poster=new r.a({parent:this.imageWrapper,watermarkEnabled:this.isWatermarkEnabled}),n.Host.setPosterView(this.poster),this.posterAdornments=new s.a({poster:this.poster,designSurface:this}),this.postFeatureController.featureEnabled("post-enable-zendesk-widget")&&(S.default.loadZendeskWidget(),this.feedbackButton=new u.a({parent:this.canvasInteractionLayer,class:"feedback-button",width:40,height:40,onClick:this.handleZendeskWidgetClick})),this.isWebAnimationEnabled&&(this.animationPlayButton=new v.a({id:"PostPlaybackButton",parent:this.imageWrapper,class:"animation-playback-button",hidden:!this.coreWrapper.hasAnimationStyle(),poster:this.poster,playAnimation:this.handleAnimationStart,pauseAnimation:this.handleAnimationPause})),this.watermarkUI=new d.a(this.isWatermarkEnabled,this.dismissedWatermarkCoachmark,this.imageWrapper,this.poster,this.coreWrapper,this.requestSaveMethod)}initializeComponents(e,t){e&&(this.coreWrapper=e),this.poster.update({core:this.coreWrapper}),this.imageWrapper.update({core:this.coreWrapper}),this.requestSaveMethod=this.coreWrapper.requestSave,this.watermarkUI.requestSaveMethod=this.requestSaveMethod,"boolean"==typeof t&&(this.isWatermarkEnabled=t,this.watermarkUI.updateWatermarkStatus(this.isWatermarkEnabled)),this.posterAdornments.setCoreWrapper(this.coreWrapper),this.posterAdornments.enable(),this.watermarkUI.coreWrapper=this.coreWrapper}enable(){this.poster.enable()}disable(){this.poster.disable(),this.posterAdornments.hideSelectionBox()}beginImageLoading(){this.poster.events.publish("image-loading-begin")}endImageLoading(){this.poster.events.publish("image-loading-end")}beginBadgeLoading(){this.poster.events.publish("badge-loading-begin")}endBadgeLoading(){this.poster.events.publish("badge-loading-end")}handleZendeskWidgetClick(){window.zE&&window.zE.activate({hideOnClose:!0})}updatePlaybackButton(e){if(!this.animationPlayButton)return;const t=e.atShowEditor,a=e.changeType,n=this.coreWrapper.inRefineCutoutMode(),o=this.coreWrapper.hasAnimationStyle(),r=n||!o;if(this.animationPlayButton.update({hidden:r}),r)this.handleAnimationPause();else if(t)this.animationPlayButton.reset(),this.posterAdornments.events.subscribe("first-full-render",this.handleAnimationStart);else{const e=this.coreWrapper.getCurrentTimelineState();!e||e.action&&"k_apply_animation_style"===e.action.description?"state-changed"===a&&this.handleAnimationStart():this.handleAnimationPause()}}handleAnimationLoadingBegin(){this.posterAdornments.showLoadingSkrim(l.default.ANIMATION_LOADING)}handleAnimationLoadingEnd(){this.posterAdornments.hideLoadingSkrim(l.default.ANIMATION_LOADING)}handleAssetRailOpen(){this.animationPlayButton&&(this.animationPlayButton.el.style.left="333px")}handleAssetRailClose(){this.animationPlayButton&&(this.animationPlayButton.el.style.left="20px")}onPointerDown(e){document.activeElement.blur(),this.onPointerChanged("pointerDown",e)}onPointerUp(e){this.onPointerChanged("pointerUp",e)}onPointerMove(e){this.onPointerChanged("pointerMove",e)}onPointerChanged(e,t){const a=this.getDocumentRelativePoint(t.x,t.y);t.x=a.x,t.y=a.y,this.coreWrapper.handlePointerChanged(function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?k(Object(a),!0).forEach((function(t){P(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):k(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({updateType:e},t))}handleAnimationStart(e=!0){this.stopAnimation(e),this.startAnimation(e)}handleAnimationPause(e=!0){this.stopAnimation(e)}startAnimation(e=!0){this.coreWrapper.hasAnimationStyle()&&"function"==typeof this.poster.playAnimation&&(this.coreWrapper.generateKeyFrames(),e&&this.animationPlayButton&&this.animationPlayButton.startProgress(),this.poster.playAnimation())}stopAnimation(e=!0){"function"==typeof this.poster.stopAnimation&&this.poster.stopAnimation(),e&&this.animationPlayButton&&this.animationPlayButton.reset()}getDocumentRelativePoint(e,t){const a=this.poster.$el.offset(),n={x:e-a.left,y:t-a.top};return this.coreWrapper.getViewToDocMatrix().transformPoint(n)}}},CCuV:function(e,t,a){"use strict";a.d(t,"a",(function(){return u}));var n=a("Avqh"),o=a.n(n),r=a("SHyn"),i=a("+Ltv"),s=a.n(i);function l(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function d(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?l(Object(a),!0).forEach((function(t){c(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):l(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function c(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class u extends o.a{constructor(e){super(d(d({},e),{},{tag:r.a.elementName})),c(this,"typedEl",void 0),c(this,"baseUpdate",void 0),c(this,"baseShow",void 0),c(this,"baseHide",void 0),c(this,"overriddenUpdate",e=>{const t=e||{};"function"==typeof t.onResetButtonClicked&&this.typedEl.addEventListener("THEO-TEMPLATE-PUBLISHER-RESET-BUTTON-CLICKED",t.onResetButtonClicked),"function"==typeof t.onSaveButtonClicked&&this.typedEl.addEventListener("THEO-TEMPLATE-PUBLISHER-SAVE-BUTTON-CLICKED",t.onSaveButtonClicked),"object"==typeof t.localizedStrings&&(this.typedEl.localizedStrings=t.localizedStrings),this.baseUpdate(t)}),c(this,"overriddenShow",e=>{!1===e?this.overriddenHide():(s.a.disableCustomKeyboardShortcuts=!0,this.typedEl.show(),this.baseShow(e))}),c(this,"overriddenHide",()=>{s.a.disableCustomKeyboardShortcuts=!1,this.typedEl.hide(),this.baseHide()}),this.typedEl=this.el,this.typedEl.addEventListener("THEO-TEMPLATE-PUBLISHER-CLOSE-GESTURE-PERFORMED",this.overriddenHide),this.baseUpdate=this.update,this.update=this.overriddenUpdate,this.baseShow=this.show,this.show=this.overriddenShow,this.baseHide=this.hide,this.hide=this.overriddenHide,this.update(e)}}},CSmQ:function(e,t,a){"use strict";a.r(t),a.d(t,"default",(function(){return u}));var n=a("bBG2"),o=a("tpS0"),r=a.n(o),i=a("3xm6"),s=a.n(i),l=a("rJP3"),d=a("9KYx");async function c(e,t,a){const{fontMissingNoticeModal:o}=e.errorDialogs;o&&o.hide();const[i]=await Promise.all([a,t]),l=i.missingFontListInDoc();return!(l.length>0)||function(e,t){return new Promise(a=>{const o=t.join(", "),i=`${s.a.translate("dialogs.fontMissingNotice.kNoticeText")}<br><br>${s.a.translate("dialogs.fontMissingNotice.kActionText",{missingFontNames:o})}`,l=new r.a({contentText:i,headerText:"i18n.dialogs.fontMissingNotice.kHeaderText",buttons:[{class:"pill pill-primary-on-light ",label:"i18n.dialogs.fontMissingNotice.kCancelButtonLabel",onClick(){l.hide(),n.default.publish("missingFontsWhenOpenCancelButtonPressed"),a(!1)}},{class:"pill pill-secondary-on-light",label:"i18n.dialogs.fontMissingNotice.kEditButtonLabel",onClick(){l.hide(),n.default.publish("missingFontsWhenOpenReplaceButtonPressed"),a(!0)}}]});l.show(),e.errorDialogs.fontMissingNoticeModal=l})}(e,l)}function u(e,t){const a=async function(){d.default.resetLoadingTimes(),await d.default.load({loadForEditor:!0,authoringContext:l.default.currentBrandKit()}),d.default.logLoadingTimes()}();return[a,c(e,a,t)]}},GiJK:function(e,t,a){"use strict";a.r(t),a.d(t,"initBrandKit",(function(){return l}));var n=a("UzQk"),o=a.n(n),r=a("2ofD"),i=a.n(r),s=a("rJP3");async function l(e,t,a,n=(()=>{})){const r=e.contextId||i.a.currentDoc.getDCXRoot().getValue("authctx#ctxid"),l={skipReload:!0,belongsToUser:"INCOMING"!==i.a.currentDoc.getCollaboration(),isEntitledUser:t.featureEnabled("entitle-brand-kit")};await async function(e,t,a,n,r=(()=>{})){if(!t.isEntitledUser)return s.default.setBrandAsCurrent(null);const i=a.featureEnabled("entitle-brand-kit")?e:null,l=await s.default.loadBrandKit(i,t,r);n();const d=!!(t.belongsToUser||l&&!l.belongsToUser()),c=l&&d?l.getId():null;o.a.Host.brandkitManager&&o.a.Host.brandkitManager.activateBrand(c)}(r,l,t,a,n)}},HetE:function(e,t,a){"use strict";a.r(t),a.d(t,"RejectReason",(function(){return n})),a.d(t,"EditingModes",(function(){return o})),a.d(t,"EditorOperations",(function(){return r})),a.d(t,"WebAnimationEnabled",(function(){return i}));const n={STALE_SESSION:"Stale Session"};let o,r;!function(e){e[e.DOCUMENT=1]="DOCUMENT",e[e.TEMPLATE=2]="TEMPLATE"}(o||(o={})),function(e){e.NEW="new",e.EDIT="edit",e.REMIX="remix",e.EDIT_TEMPLATE="edit-template",e.NEW_FROM_TEMPLATE="new-from-template",e.NEW_TEMPLATE_FROM_TEMPLATE="new-template-from-template"}(r||(r={}));const i=!0},L4yB:function(e,t,a){"use strict";a.r(t),a.d(t,"default",(function(){return n}));class n{static hideZendeskWidget(){let e=0;if(window.zE.hide)return void window.zE.hide();const t=setInterval(()=>{if(e+=1,window.zE.hide)return window.zE.hide(),void clearInterval(t);e>=30&&clearInterval(t)},100)}static loadZendeskWidget(){if(n.widgetLoaded)return void n.hideZendeskWidget();window.zESettings={webWidget:{offset:{horizontal:"-15px",vertical:"-5px"},color:{button:"#DCE0E3",header:"#F2F4F5"},launcher:{label:{"*":""}}}};const e=document.createElement("script"),t=document.head||document.getElementsByTagName("head")[0];if(e.type="text/javascript",e.id="ze-snippet",e.readyState){const t=()=>{"loaded"!==e.readyState&&"complete"!==e.readyState||(e.onreadystatechange=null,n.hideZendeskWidget(),n.widgetLoaded=!0)};e.onreadystatechange=t}else{const t=()=>{n.hideZendeskWidget(),n.widgetLoaded=!0};e.onload=t}e.src="https://static.zdassets.com/ekr/snippet.js?key=ae0f493b-0b5f-4e96-9d92-24db87ce17a8",t.insertBefore(e,t.lastChild)}}var o,r,i;i=!1,(r="widgetLoaded")in(o=n)?Object.defineProperty(o,r,{value:i,enumerable:!0,configurable:!0,writable:!0}):o[r]=i},LCEe:function(e,t,a){"use strict";var n=a("ApVh"),o=a.n(n),r=a("Uwho"),i=a.n(r),s=a("rjtT"),l=a.n(s),d=a("3xm6"),c=a.n(d);function u(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function p(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?u(Object(a),!0).forEach((function(t){m(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):u(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function m(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}const h=new RegExp('[\\\\:*.?"/<>&|^]+|[ .]$');class g{constructor(){m(this,"authToken",o.a.getAccessToken()),m(this,"platformBase",i.a.platformBase),m(this,"repoId",i.a.acpContentRepoId),m(this,"publishBase",i.a.contentPublishServiceBase),m(this,"assetsFolderId",i.a.assetsFolderId),m(this,"PLATFORM_PATH",`${this.platformBase}/content/storage/path/${this.assetsFolderId}`),m(this,"SUBMIT_API",this.publishBase+"/content/assets/ops"),m(this,"cachedTrees",{}),m(this,"cachedConfig",{})}static getHeaders(e){return{"x-api-key":g.apiKey,"Content-Type":"application/json",Authorization:"Bearer "+e}}async fetchConfig(){return this.cachedConfig&&0===Object.keys(this.cachedConfig).length&&(this.cachedConfig=await this.resolvePath(this.PLATFORM_PATH+"/config/config.json")),this.cachedConfig}async resolvePath(e){const t=await this.authToken,a=g.getHeaders(t);try{const t=await window.fetch(e,{method:"GET",headers:new window.Headers(a)});if(200===t.status){const e=await t.text();if(e)try{return JSON.parse(e)}catch(e){return}}return}catch(e){throw e}}async headPath(e){const t=await this.authToken,a=g.getHeaders(t);try{return(await window.fetch(e,{method:"HEAD",headers:new window.Headers(a)})).ok}catch(e){throw e}}async getFolderTree(e,t=[]){const a=e.replace("/content/assets",""),n=`${this.PLATFORM_PATH}${a}`;if(this.cachedTrees[e])return this.cachedTrees[e];try{const a=await this.resolvePath(n);if(a&&a.children)for(const e of a.children)"directory"===e["repo:assetClass"]&&(t.push({name:e["repo:name"],path:e["repo:path"]}),await this.getFolderTree(e["repo:path"],t));return this.cachedTrees[e]=t,t}catch(e){throw e}}parseMetadata(e){let t,a;return 0!==e.topics.size&&(t={"dc:subject":[...e.topics].map(e=>e.trim().toLowerCase())}),0!==e.traits.size&&(a=[...e.traits]),{"light:publicationData":p(p({traits:a,tasks:[e.task]},t),{},{"dc:title":{"@type":"rdf:Alt","rdf:_1":{"@language":"en-US","@value":e.title}},language:e.language,applicableRegions:Array.from(e.applicableRegions),licensingCategory:e.entitlement,animated:"Animated"===e.animated})}}isValidFilename(e){return!h.test(e)}async submitAsset(e,t){if(!this.isValidFilename(t.filename))return l.a.showAlert(c.a.translate("app.assetSubmitter.failure.kHeaderText"),c.a.translate("app.assetSubmitter.failure.kFilenameText")),!1;const a=await this.authToken,n=g.getHeaders(a),o=t.folder.replace("/content/assets",""),r=`${this.PLATFORM_PATH}${o}/${t.filename}`;if(await this.headPath(r)){if(!await l.a.showConfirm(c.a.translate("app.assetSubmitter.failure.kHeaderText"),c.a.translate("app.assetSubmitter.failure.kOverrideText")))return!1}const i={ops:"SUBMIT",source:{metadata:this.parseMetadata(t),assetId:e},target:{repositoryId:this.repoId,path:`${t.folder}/${t.filename}`}};try{const e=await window.fetch(this.SUBMIT_API,{method:"POST",headers:new window.Headers(n),body:JSON.stringify(i)});if(e.ok)return window.marvel.events.trigger("show-app-toast-message",{message:t.filename+" has been submitted.",variant:"success",closeOnAction:!0}),!0;const a=await e.json();if(a)throw new Error(`${a.status} ${a.error}. If this error continues, contact the Content engineering team.`);throw new Error(`Submit API Response: ${e.status} ${e.statusText}`)}catch(e){return l.a.showAlert(c.a.translate("app.assetSubmitter.failure.kHeaderText"),e.toString()),!1}}}m(g,"apiKey",i.a.sparkContentSearchApiKey),t.a=new g},LGQi:function(e,t,a){"use strict";a.r(t),a.d(t,"MIME_TYPES",(function(){return A})),a.d(t,"default",(function(){return R}));var n=a("UzQk"),o=a("wHG3"),r=a("4zaV"),i=a.n(r),s=a("bBG2"),l=a("xX9p"),d=a("aOoP"),c=a("WPm+"),u=a("tpS0"),p=a.n(u),m=a("3xdQ"),h=a.n(m),g=a("I/Z9"),f=a("EUgP"),b=a("MGCh"),w=a.n(b),v=a("lQk0"),S=a("mwMu"),y=a.n(S),k=a("UNP3"),P=a("b2xK"),I=a.n(P),C=a("qcxC"),E=a("qywk"),T=a.n(E);function D(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}const O=w.a.channel("export-controller");Math.ceil(1945.6);let A;!function(e){e.jpg="image/jpeg",e.jpeg="image/jpeg",e.png="image/png"}(A||(A={}));class R{static invite(e,t,a){window.marvel.events.trigger("spark-invite-collaborators-to-current-doc",{source:t,page:a,composite:e})}static createTemplate(e){s.default.publish("libraries:templateCreatePressed",{contextualData10:"createLocation:editor"}),T.a.show({compositeDocModel:e,analyticsContext:{createLocation:"editor"}})}static inviteToBrand(e,t,a){window.marvel.events.trigger("spark-invite-collaborators-to-brandkit",{source:t,page:a,brandKit:e})}static publishTemplate(e,t,a,n){return new f.a({coreWrapper:t,waitForQuietSaveToFinish:a,getDocumentRendition:n}).publishDoc(e)}static uploadToFacebook(){window.marvel.events.trigger("upload-to-facebook-current-doc")}static uploadToTwitter(){window.marvel.events.trigger("upload-to-twitter-current-doc")}static downloadImageBlob(e,t="png",a){return new Promise(t=>{if(window.navigator.msSaveBlob)return window.navigator.msSaveBlob(e,a),t();const n=window.URL.createObjectURL(e),o=document.createElement("a");o.href=n,o.download=a,document.body.appendChild(o),o.onclick=()=>{document.body.removeChild(o),window.setTimeout(()=>(window.URL.revokeObjectURL(n),t()),0)},o.click()})}static getExportData(e){const t=e.firstPage.getExportData(null,null).pixelDimensions,a={width:t.width,height:t.height,imageQuality:1};return a}static getRenditionParams(e,t=A.jpg){const a=R.getExportData(e);return{width:a.width,height:a.height,imageQuality:a.imageQuality,outputFormat:t,renderType:o.PixiJSApp.TargetRenderTypeHint.ForFinalForm}}static sendToGoogleDrive(e){i.a.saveToDrive(e).then(e=>{O.debug("GoogleApiController saved success with Google Drive File ID",e)},e=>{O.error("Error with handleSaveToGoogleDrive",e)})}static generateImageBlobHeadless(e,t,a){let n;const o=t.getDCXRoot().getValue("authctx#ctxid");return v.default.getHeadless({authoringContextId:o}).then(e=>{const a=y.a.fromDocument(t),o=new I.a;return n=new h.a({persistSource:a,persistSave:o}),n.whenInitialized().then(()=>e)}).then(t=>{if(!t)return;let o=n.getDocument();Object(k.reportNounProjectIds)(o,a,n.requestSave);const r=R.getRenditionParams(o,e);return t.getRenditionBlobPromise(n,r)})}static handleExportImageBlob(e,t,a){s.default.publish("Sharing Action",{contextData:["projectId"],eventAction:"BeginDownload",slide:"publish"}),R.downloadImageBlob(e,t,a),s.default.publish("Sharing Action",{contextData:["projectId"],eventAction:"Download"})}constructor({doc:e,am:t,poster:a}){D(this,"document",void 0),D(this,"poster",void 0),D(this,"analyticsManager",void 0),this.document=e,this.poster=a,this.analyticsManager=t}async generateImageBlob(e,t){const a=await this.getDownloadImageBlobPromiseFromPoster(this.poster,e);let n=a.rendition;if(a.params.resampleTo&&(n=await this.resampleImage(n,a.params.resampleTo)),!n)throw new Error("failed to get image");if(t&&e===A.png){const e=window.URL.createObjectURL(n),a=document.createElement("canvas"),o=R.getExportData(this.document);return a.width=o.width,a.height=o.height,Object(g.setFullCanvasToTransparent)(a,e,t).finally(()=>{window.URL.revokeObjectURL(e)})}return n}async downloadImg({coreWrapper:e,mediaType:t,isWatermarkEnabled:a,docName:n,MarvelSettings:o,requestSaveMethod:r}){const i=await this.getSetTransparencySelection(t);if("boolean"==typeof i){const s=e.getFullCanvasColor(),l=!!s;!l&&i&&(await e.setBackgroundTransparency(0),a&&this.poster.setWatermark(!1)),await new Promise(e=>setTimeout(()=>e(),0));const d=!(i||t&&"jpg"!==t);await this.generateAndDownloadImage(d?"jpg":"png",l&&i?s:null,n),i&&(e.setBackgroundTransparency(1),this.poster.setWatermark(a)),this.analyticsManager.sendExportMetadataForDownload(this.document,o,r)}}async downloadImgV2(e,t,a){const n=await this.getSetTransparencySelection(a);"boolean"==typeof n&&await Object(c.a)(e,t,a,n)}downloadPDF(e,t,a){Object(d.a)(e,t,this.createDownloadCompleteAnalyticsHandler(this.document,t,a))}downloadMP4(e,t,a,n,o){Object(l.a)(e,t,a,n,this.createDownloadCompleteAnalyticsHandler(this.document,t,o))}publish(e,t){window.marvel.events.trigger("share-workflow-current-doc")}createDownloadCompleteAnalyticsHandler(e,t,a){return()=>{this.analyticsManager.sendExportMetadataForDownload(e,t,a)}}getSetTransparencySelection(e){let t;const a=this.document.firstPage.root.controller;if(a){const n=a.suggestTransparentBackground();t="png"===e&&n?this.transparentBackgroundOptionsModal("png"===e):t=Promise.resolve(!1)}else t=Promise.resolve(null),O.error("unable to getSetTransparencySelection: document has no root controller");return t}async getDownloadImageBlobPromiseFromPoster(e,t){const a=R.getRenditionParams(this.document,t),o=Math.max(a.width,a.height);o<1024&&(a.resampleTo=new n.TheoSize(a.width,a.height),a.width*=2,a.height*=2);return{params:a,rendition:await e.getRendition(a)}}transparentBackgroundOptionsModal(e){const t=Object(C.default)(),a=new p.a({headerText:"i18n.dialogs.transparentBackground.kHeaderText",id:"transparentBGAlertModal",contentText:"",dismissable:!1,buttons:[{id:"transparentBGAlertTransparent",class:"pill pill-primary-on-light",label:"i18n.dialogs.transparentBackground.kPNGButtonLabel",onClick:()=>{s.default.publish("transparentBackgroundButtonPressed"),a.hide(),t.resolve(!0)}},{id:"transparentBGAlertSolid",class:"pill pill-primary-on-light",label:e?"i18n.dialogs.transparentBackground.kPNGSolidButtonLabel":"i18n.dialogs.transparentBackground.kJPEGButtonlabel",onClick:()=>{s.default.publish("solidBackgroundButtonPressed"),a.hide(),t.resolve(!1)}},{id:"transparentBGAlertCancel",class:"pill pill-secondary-on-light",label:"i18n.common.kCancel",onClick:()=>{s.default.publish("backgroundCancelButtonPressed"),a.hide(),t.resolve(null)}}]});return t.promise}async generateAndDownloadImage(e,t,a){try{const n=await this.generateImageBlob("jpg"===e?A.jpg:A.png,t),o=`${a}.${e}`;if(!n)throw new Error("failed to get image");return await R.handleExportImageBlob(n,e,o)}catch(e){O.error("downloadImg error",e)}}resampleImage(e,t){const a=Object(C.default)(),n=window.URL.createObjectURL(e),o=new Image;return o.onload=()=>{const n=document.createElement("canvas");n.width=t.width,n.height=t.height;const r=n.getContext("2d");if(r){r.scale(n.width/o.width,n.height/o.height),r.drawImage(o,0,0);const t=n.toDataURL(e.type),[i,s]=t.split(","),l=i.indexOf("base64")>=0?atob(s):unescape(s),d=new Uint8Array(l.length);for(let e=0;e<l.length;e+=1)d[e]=l.charCodeAt(e);const c=new Blob([d],{type:e.type});a.resolve(c)}else a.reject(new Error("Hm"))},o.onerror=e=>{a.reject(e)},o.src=n,a.promise.finally(()=>{window.URL.revokeObjectURL(n)})}}},Mvsy:function(e,t,a){"use strict";a.r(t),a.d(t,"validateRemix",(function(){return s})),a.d(t,"validatePremiumRemix",(function(){return l}));var n=a("Na8G"),o=a.n(n),r=a("tpS0"),i=a.n(r);async function s(e,t,a){if("remix"!==t.operation&&"new-from-template"!==t.operation)return;0===a.getRootForma().childCount?await function(e){return new Promise((t,a)=>{e.errorDialogs.notRemixableOverlay=new i.a({headerText:"i18n.dialogs.remixFailed.kHeaderText",contentText:"i18n.dialogs.remixFailed.kContentText",dismissable:!1,buttons:[{class:"pill pill-primary-on-light",label:"i18n.dialogs.remixFailed.kButtonLabel",onClick(){e.errorDialogs.notRemixableOverlay.hide(),a()}}]}),window.marvel.events.trigger("hide-interstitial"),e.windowPanel.show(),e.errorDialogs.notRemixableOverlay.show()})}(e):a.requestSave()}async function l(e,t,a,n,r,i){const{operation:s,cpAssetId:l,cpServiceDomain:d,routeFragment:c}=t;if(a||"remix"!==s)return;const{tagNames:u,templateId:p,templateType:m,alias:h}=await r.getRemixParentCPMetadata(l,d||"cc-api-cp.adobe.io",!1,n);if(i(),m&&"paid"===m){const t=u&&u.includes("remixanimation");window.marvel.events.trigger("hide-interstitial"),e.windowPanel.show(),o.a.showMerchMessagingModal({workflow:"remixPremiumTemplate",destinationUrl:c,asset:{alias:h,animated:t,id:p,tags:u,isPremiumTemplate:!0,remixable:!0,remixpaid:!0,app:"post"},analyticsPage:"editor:post",analyticsFullTagNames:u}),i(!0)}}},OMxe:function(e,t,a){"use strict";a.r(t),a.d(t,"StartupPerformance",(function(){return f})),a.d(t,"publishProjectCreated",(function(){return b})),a.d(t,"publishEditorDisplayed",(function(){return w})),a.d(t,"publishPaidBranding",(function(){return v})),a.d(t,"publishProjectCreatedFromTemplate",(function(){return S}));var n=a("E+oP"),o=a.n(n),r=a("7gWt"),i=a("wHG3"),s=a("2ofD"),l=a.n(s),d=a("bBG2"),c=a("rJP3"),u=a("LU24");function p(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function m(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?p(Object(a),!0).forEach((function(t){h(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):p(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function h(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}const g={"create-from-asset":"createLocation:homeSelectBackground","create-from-scratch":"createLocation:homeCreateFromScratchTaskModule","create-from-project-menu":"createLocation:homeCreateFromScratchDropdown","create-from-template":"createLocation:homeSelectTemplate","editor-template":"createLocation:editorTemplate","editor-template-recommend":"createLocation:editorTemplateRecommend","search-template":"createLocation:homeTemplateSearch","search-template-recommend":"createLocation:homeTemplateSearchRecommend","search-template-fake-recommend":"createLocation:homeTemplateFakeRecommend","editor-template-fake-recommend":"createLocation:editorTemplateFakeRecommend"};class f{constructor(){h(this,"begin",0)}start(){this.begin=window.performance.now()}end(e,t,a){let n=window.performance.now()-this.begin;t&&(n-=t);const o=c.default&&c.default.getCurrentBrandElements()||{id:""};d.default.publish("post:editorStartupEnd",{contextualData1:"timeElapsedMs:"+n,contextualData2:"editorOperation:"+e.operation,contextualData3:"isFreshLoad:"+!a,contextualData4:"hasActivatedBrand:"+(!!o&&o.activated),contextualData5:"timeSpentInNpw:"+t})}}function b(e,t,a){d.default.publish("projectCreated",{projectId:l.a.currentDoc.id,aspectRatio:e.shapeData.aspectRatio,targetId:e.shapeData.id,id:e.id,textLength:e.text.length,workflow:t.workflow}),a&&d.default.publish("createdBrandedProject",{projectId:l.a.currentDoc.id})}function w(e,t,a){const n=["new","new-from-theme","new-from-template","remix"].includes(e.operation),s=c.default&&c.default.getCurrentBrandElements()||{id:""},p=t.remixParentAnalyticsMetadata;let h;e.createLocation&&(h=g[e.createLocation]);const f=l.a.currentDoc.getCollaborationForAnalytics(),b=!!a&&a.includesUploadedFonts(),w=!o()(l.a.currentDoc.getDCXRoot().getValue("authctx#ctxid")),v=a&&a.getDocFontSourceUsage()||[],S=v.includes(i.Core.describeFontSource(i.Core.FontSource.TYPEKIT_PREMIUM))||v.includes(i.Core.describeFontSource(i.Core.FontSource.TYPEKIT_FREE));d.default.publish("project:editorDisplayed",m(m({includesUploadedFonts:b,isBranded:w,contextualData23:s.isDefault?"":s.id,isNewProject:n,sparkFormat:"post",contextData:["projectId"],contextualData5:"tagNames:"+p.tagNames,contextualData6:"templateType:"+p.templateType},h&&{contextualData18:h}),{},{contextualData24:"collabStatus:"+f,templateId:p.templateId})),r.SparkPerformanceTracker.measure(u.PERFORMANCE_MARKERS.editorDisplayed,{detail:{collabStatus:f,includesTypekitFonts:S,includesUploadedFonts:b,isBranded:w,isNewProject:n,numImages:a&&a.getImageCount()},start:u.PERFORMANCE_MARKERS.startup})}function v(e){if(!("new"===e.operation))return;const t=c.default&&c.default.getCurrentBrandElements();if(!(t&&t.activated))return;"true"===e.branded?d.default.publish("paidProjectStartBranded"):d.default.publish("paidProjectStartUnbranded")}function S(e,t){d.default.publish("projectCreated",{projectId:l.a.currentDoc.id}),d.default.publish("createdBrandedProject",{projectId:l.a.currentDoc.id,templateName:t.getValue("theme#data").name,themeletId:e.templateId}),d.default.publish("createdProjectFromTemplate")}},"Pv/z":function(e,t,a){"use strict";a.r(t),a.d(t,"addNewImage",(function(){return A}));var n=a("UzQk"),o=a("7gWt"),r=a("tY4j"),i=a.n(r),s=a("bBG2"),l=a("J9tZ"),d=a("I/Z9"),c=a("qcxC"),u=a("2PxR"),p=a("l+ZV"),m=a("MGCh"),h=a.n(m),g=a("Mbmg"),f=a("a8ov"),b=a("luSs"),w=a("tpS0"),v=a.n(w),S=a("m5wp");function y(e,t){if(e)return;const a=new v.a({headerText:"i18n.dialogs.addOrReplaceImageFailed.kHeaderText",contentText:t,dismissable:!0,buttons:[{class:"pill pill-primary-on-light",label:"i18n.dialogs.addOrReplaceImageFailed.kOK",onClick(){a.hide()}}]})}function k({components:e,contentNodeId:t,coreWrapper:a,data:n,docSavedDfd:o,error:r,failSilent:i,formaId:s,log:l,readyForRenderDfd:d,saveIsSuspended:c}){if(c&&a.resumeSave(),r instanceof a.ActionError&&!r.isAllowedError&&a.shouldReloadOnActionFailure())return l.error("doAction",r.message),void Object(S.a)();!function({contentNodeId:e,coreWrapper:t,data:a,error:n,failSilent:o,formaId:r,log:i}){if(!a.replacementForma&&!a.replacementFrame)return i.error("failed to add image",n),t.cleanupInvalidImageSync(r,e),void y(o,"i18n.dialogs.addOrReplaceImageFailed.kContentText");i.error("failed to replace image",n),t.cleanupInvalidImageWithColorSync(r,e,[]),y(o,"i18n.dialogs.addOrReplaceImageFailed.kContentTextReplace")}({data:n,log:l,error:r,coreWrapper:a,formaId:s,contentNodeId:t,failSilent:i}),Object(b.a)(e,"image-loading-end"),a.updateConstrainedImages(),a.validateDoc("addImageFail"),o.reject(),d.reject()}const P=h.a.channel("add-new-image");var I=a("3xm6"),C=a.n(I),E=a("LU24");const T=h.a.channel("add-new-image");let D=0;let O=0;async function A({allowSelection:e=!0,component:t,coreWrapper:a,uiStateController:r,data:m,docSavedDfd:h=Object(c.deferred)(),failSilent:w=!1,isNewPostImage:v=!1,readyForRenderDfd:S=Object(c.deferred)(),replacingForma:y,performanceTrackerId:I}){const A=I?":"+I:"";a.validateDoc("addImageBegin"),o.SparkPerformanceTracker.mark(`${E.PERFORMANCE_MARKERS.addImage}:${I}`),g.a.beginTrackingPendingXhrRequests(),g.a.pageUnloadBlockingBegin();const R=m.processedImgData||m.files[0],F=m.isLogo;let x=R.type||R.mimeType||"image/jpeg";const M="dooplo"===R.source,j=M&&R.preview.link.includes(".png")&&"image/png"!==x;M&&j&&(x="image/png");const B=Object(u.getImageMediaMetadata)(m.info),L=B&&"Adobe Stock"===B.sourceName,U="google drive"===R.source,N=R instanceof Blob,W=!N&&!L&&!U,z=function(e){if(e.info){if(e.info.id)return e.info.id;if(e.info.image_id)return""+e.info.image_id;if(e.info.assetID)return e.info.assetID}return D+=1,"unknown_image:"+D}(m);let $,_=R.source;F?_="logo":N&&(_="localFile"),o.SparkPerformanceTracker.mark(`${E.PERFORMANCE_MARKERS.addImageStart}${A}`,{detail:{imageType:_}});let H,Z,G,K,q,V=null,Q=null,X=null,J=!1;if(r&&r.model._state.listOfLoadingAssets.includes(z))return S.resolve(),S.promise;0===O&&n.ImageFacade.getCutoutModeForForma(m.replacementForma)!==n.CutoutMode.Off&&(q={statusTitle:C.a.translate("dialogs.addOrReplaceImageStatus.kTitle"),statusMessage:C.a.translate("dialogs.addOrReplaceImageStatus.kMessage")}),Object(b.a)(t,"image-loading-begin",q),O+=1;try{r&&r.addLoadingAssetId(z);const n=await async function(){if(!W)return null;const n=R.thumbnail||R.small||R.preview;let o;o=n.blobPromise?await n.blobPromise:["dropbox","cc","lightroom","ccl","cclight"].includes(R.source)?n.link:"/api/post/v1/proxy?url="+encodeURIComponent(n.link);const[r,i]=await Object(l.a)(p.default.load(o));if(!i&&r)throw new Error("Failed to load low-res image. error detail: "+r);const s=Object(d.createCanvas)(i),c=s&&s.getContext("2d");if(V=c&&Object(d.checkCanvasForAlpha)(c,s.width,s.height)||null,V){if(y)return null;Object(d.trimTransparentEdges)(s)}X=s&&s.toDataURL();const u=await a.addOrReplaceImage({isNewPostImage:v,mimeType:x,hasAlpha:V,allowSelection:e,id:null,imageId:null,metadata:B,isLowResImage:!0,url:X,width:s.width,height:s.height,replacementForma:m.replacementForma,replacementFrame:m.replacementFrame,sparkRoles:m.sparkRoles,sparkElementId:m.sparkElementId,forceReplacement:y,floatingImageStrategy:m.floatingImageStrategy});return G=u.formaId,K=u.contentNodeId,function(e){return!W||y&&V||!t.poster||(S.resolve(),window.setTimeout(()=>Object(b.a)(t,"image-loading-end"),350)),e}(u)}();T.info("step1: low-res image loaded",n),o.SparkPerformanceTracker.measure(`${E.PERFORMANCE_MARKERS.addImageLoadLowResComplete}${A}`,`${E.PERFORMANCE_MARKERS.addImageStart}${A}`),W&&o.SparkPerformanceTracker.measure(`${E.PERFORMANCE_MARKERS.addImageComplete}${A}`,`${E.PERFORMANCE_MARKERS.addImageStart}${A}`);const c=await async function(e){const t=(e||{contentNodeId:null}).contentNodeId,n=t;if(N){const{width:e,height:t}=await p.default.loadImageFromBlob(R);return H=e,Z=t,await a.saveImageComponent(R,x)}const{width:o,height:r,source:s,assetId:l}=function({imgData:e,imgInfo:t}){if(e instanceof Blob)return e;const a=e.source,{width:n,height:o,link:r}=e.original;a||P.error("getBestRenditionForImageSaving source is falsy. imgData is:",e);let i=null;return"dooplo"===a&&n&&o&&(i=function(e,t,a){if(!(e*t>256e4))return null;const n=a._links.rendition.filter(e=>{const{href:t,width:a,height:n}=e;return!!(t&&a&&n)&&a*n<256e4}).sort((e,t)=>e.width-t.width).pop();if(!n)return null;const{width:o,height:r,href:i}=n;return{assetId:i,width:o,height:r,source:"dooplocdn"}}(n,o,t)),i||{source:a,assetId:r,width:n,height:o}}({imgData:R,imgInfo:m.info});H=o,Z=r;const d=i()(a.saveImageComponent,{maxAttempts:3});return await d({source:s,assetId:l},x,null,t,n)}(n);T.info("step2: save image",c),o.SparkPerformanceTracker.mark(`${E.PERFORMANCE_MARKERS.addImageLowResSave}:${I}`),o.SparkPerformanceTracker.measure(`${E.PERFORMANCE_MARKERS.addImageLowResSave}:${I}`,`${E.PERFORMANCE_MARKERS.addImage}:${I}`);const u=await function(e){if($=e,Q=f.default.decodeUrl($.encodedUrl),!Q)throw Error("Invalid hi-res image URL");return p.default.load(Q)}(c);T.info("step3: get hi-res image",u);const w=await function(e){let t;if(H=e.width,Z=e.height,null===V){t=Object(d.createCanvas)(e);const a=t.getContext("2d");V=Object(d.checkCanvasForAlpha)(a,t.width,t.height)||null}if(V&&!F)return t||(t=Object(d.createCanvas)(e)),Object(d.trimTransparentEdges)(t),H=t.width,Z=t.height,Object(d.canvasToBlob)(t);return e}(u);T.info("step4: check for transparent image",w);const k=await async function(e){if(!V||F)return e;if($=await a.saveImageComponent(e,x),Q=f.default.decodeUrl($.encodedUrl),!Q)throw Error("Invalid hi-res image URL");return p.default.load(Q)}(w);T.info("step5: load hi-res image",k);const C=F?await async function(e){const t={mimeType:x,acRoles:m.sparkRoles,componentId:$.component.id,id:m.sparkElementId,pixelHeight:e.height,pixelWidth:e.width,url:$.encodedUrl};return s.default.publish("editor:logoAdded"),a.addLogo(t)}(k):await async function(t){const n={isNewPostImage:v,mimeType:x,lowResImageUrl:X,hasAlpha:V,contentNodeId:K,allowSelection:e,id:$.component.id,imageId:null,metadata:B,isLowResImage:!1,url:$.encodedUrl,width:H||t.width,height:Z||t.height,replacementForma:m.replacementForma,replacementFrame:m.replacementFrame,forceReplacement:y,floatingImageStrategy:m.floatingImageStrategy};if(X){const[e,t]=await Object(l.a)(a.replaceImageWithHighRes(n));if(e&&!t)throw Error("Failed coreWrapper.replaceImageWithHighRes promise. error detail: "+e);return J=!1,t}const[o,r]=await Object(l.a)(a.addOrReplaceImage(n));if(o&&!r)throw Error("Failed coreWrapper.addOrReplaceImage promise. error detail: "+o);return r}(k);T.info("step6: add image to document",C),function(e){e&&e.formaId&&(G=e.formaId);a.updateConstrainedImages(),W||o.SparkPerformanceTracker.measure(`${E.PERFORMANCE_MARKERS.addImageComplete}${A}`,`${E.PERFORMANCE_MARKERS.addImageStart}${A}`);J=!0,S.resolve(),g.a.endTrackingPendingXhrRequests(),a.validateDoc("addImageSuccess"),h.resolve(),(N||y&&V)&&window.setTimeout(()=>Object(b.a)(t,"image-loading-end"),350)}(C),r&&r.removeLoadingAssetId(z),T.info("step7:finalized add or replace image")}catch(e){k({coreWrapper:a,log:T,data:m,formaId:G,contentNodeId:K,failSilent:w,components:t,docSavedDfd:h,readyForRenderDfd:S,saveIsSuspended:J,error:e})}finally{O-=1,o.SparkPerformanceTracker.measure(`${E.PERFORMANCE_MARKERS.addImageFullFlowComplete}${A}`,`${E.PERFORMANCE_MARKERS.addImageStart}${A}`)}return S.promise}t.default=A},XR60:function(e,t,a){"use strict";a.r(t);var n=a("+Ltv"),o=a.n(n),r=a("bBG2"),i=a("5d+0");function s(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}const l={selectAll:0,deselectAll:0,undo:0,redo:0},d={handleUndo(){},handleRedo(){},handleSelectAll(){},handleDeselectAll(){},handlePanOn(e){},handlePanOff(e){},handleZoomIn(){},handleZoomOut(){},handleZoomFit(){},handleZoomFill(){},handleZoomActualSize(){},handlePanView(e,t){},canHandleUndo:()=>!0,canUpdateSelection:()=>!0,canUpdateZoom:()=>!0};t.default=new class{constructor(){s(this,"methods",d),s(this,"spaceBarDown",!1),s(this,"handleKeyDown",e=>{if(o.a.disableCustomKeyboardShortcuts)return;const t=window.navigator.platform.includes("Mac"),a=e.ctrlKey&&!t||e.metaKey&&t,n=" "===e.key,s="PageUp"===e.key||"PageDown"===e.key||"ArrowLeft"===e.key||"ArrowRight"===e.key||"ArrowUp"===e.key||"ArrowDown"===e.key;if(!a&&!(n||s||this.spaceBarDown))return;let d=!1;const c=e.target.matches("input, textarea"),u=void 0!==e.composedPath().find(e=>e instanceof Element&&e.matches("input, textarea")),p=c||u,m=null!==e.target.closest("#PostLeftSidebar"),h=e.shiftKey,g=e.altKey;let f=String(e.key).toUpperCase();const b=String(e.code).toUpperCase(),{handleRedo:w,handleUndo:v,handleDeselectAll:S,handleSelectAll:y,handlePanOn:k,handleZoomIn:P,handleZoomOut:I,handleZoomFit:C,handleZoomFill:E,handleZoomActualSize:T,handlePanView:D,canHandleUndo:O,canUpdateSelection:A,canUpdateZoom:R}=this.methods;if("DIGIT0"===b&&(f="0"),this.spaceBarDown&&("Meta"===e.key&&t||"Control"===e.key&&!t||"Alt"===e.key))k(e);else{switch(f){case"A":p||(A()&&(h?(S(),l.deselectAll+=1,r.default.publish("keyboardShortcut",{contextualData1:`actionCountInSession: ${i.ShortcutConstants.kDeselectAll}_${l.deselectAll}`,contextualData2:"actionDescription: "+i.ShortcutConstants.kDeselectAll})):(y(),l.selectAll+=1,r.default.publish("keyboardShortcut",{contextualData1:`actionCountInSession: ${i.ShortcutConstants.kSelectAll}_${l.selectAll}`,contextualData2:"actionDescription: "+i.ShortcutConstants.kSelectAll}))),d=!0);break;case"S":d=!0;break;case"Z":p||(O()&&(h?(w(),l.redo+=1,r.default.publish("keyboardShortcut",{contextualData1:`actionCountInSession: ${i.ShortcutConstants.kRedo}_${l.redo}`,contextualData2:"actionDescription: "+i.ShortcutConstants.kRedo})):(v(),l.undo+=1,r.default.publish("keyboardShortcut",{contextualData1:`actionCountInSession: ${i.ShortcutConstants.kUndo}_${l.undo}`,contextualData2:"actionDescription: "+i.ShortcutConstants.kUndo}))),d=!0);break;case"Y":p||(O()&&w(),d=!0);break;case" ":p||(this.spaceBarDown=!0,k(e),d=!0);break;case"=":case"+":d=!0,!p&&R()&&P();break;case"-":d=!0,!p&&R()&&I();break;case"0":d=!0,!p&&R()&&(g?T():h?E():C());break;case"PAGEDOWN":case"PAGEUP":case"ARROWLEFT":case"ARROWRIGHT":case"ARROWUP":case"ARROWDOWN":p||m||(D(e.key,e.repeat),d=!0)}d&&e.preventDefault()}}),s(this,"handleKeyUp",e=>{if(o.a.disableCustomKeyboardShortcuts)return;let t=!1;const a=e.target.matches("input, textarea"),n=void 0!==e.composedPath().find(e=>e instanceof Element&&e.matches("input, textarea")),r=a||n,i=String(e.key).toUpperCase(),{handlePanOff:s}=this.methods,l=window.navigator.platform.includes("Mac");if(this.spaceBarDown&&("Meta"===e.key&&l||"Control"===e.key&&!l||"Alt"===e.key))return void s(e);if(" "===e.key){switch(i){case" ":r||(this.spaceBarDown=!1,s(e),t=!0)}t&&e.preventDefault()}})}startListening(e){this.stopListening(),this.methods=e,this.spaceBarDown=!1,document.addEventListener("keydown",this.handleKeyDown),document.addEventListener("keyup",this.handleKeyUp)}stopListening(){this.methods=d,document.removeEventListener("keydown",this.handleKeyDown),document.removeEventListener("keyup",this.handleKeyUp)}}},YC27:function(e,t,a){"use strict";a.r(t),a.d(t,"default",(function(){return y}));var n=a("2ofD"),o=a.n(n),r=a("bBG2"),i=a("3xdQ"),s=a.n(i),l=a("qnb0"),d=a.n(l),c=a("mwMu"),u=a.n(c),p=a("8VGm"),m=a("K7z8"),h=a("rJP3"),g=a("QX4k"),f=a("a8ov"),b=a("OMxe"),w=a("MGCh");const v=a.n(w).a.channel("init-core-wrapper");function S(e){const t="design/post/"+e;window.marvel.navigate(t,{trigger:!1,replace:!0})}async function y({appConfig:e,templateNode:t,validateSession:a,useCpCdn:n=!1}){let i=t,l={persistSource:null,persistSave:null};const c=h.default.currentBrandKit(),{operation:w,templateId:y,cpAssetId:k,cpServiceDomain:P}=e,{currentDoc:I}=o.a,C=I.id;function E(){i=c.getThemeById(y),l.persistSource=u.a.fromTemplate(c,i)}switch(w){case"new":Object(b.publishPaidBranding)(e);break;case"new-template-from-template":{E(),r.default.publish("createdTemplateFromTemplate");const t=await m.default.createEmptyPostTemplate(c);a(),l.persistSave=d.a.toTemplateLocal(c,i,d.a.CommitChanges.AUTO),e.newTemplateId=t.id;break}case"edit-template":E(),r.default.publish("editedTemplate"),l.persistSave=d.a.toTemplateLocal(c,i,d.a.CommitChanges.AUTO);break;case"new-from-template":E(),Object(b.publishProjectCreatedFromTemplate)(e,i),S(C),l.persistSave=d.a.toDocument(I);break;case"remix":f.default.setCPServiceDomain(P),S(C);new g.default({cpServiceDomain:P}).trackRepeatableActivity(k,"remix_count").catch(e=>{v.error("failed to update remix count",e)}),l={persistSource:new p.default({cpServiceDomain:P,useCpCdn:n,assetId:k}),persistSave:d.a.toDocument(I)};break;default:f.default.setCPServiceDomain(""),l={persistSource:u.a.fromDocument(I),persistSave:d.a.toDocument(I)}}const T=new s.a(l);return await T.whenInitialized(),a(),{coreWrapper:T,templateNode:i}}},bDzb:function(e,t,a){"use strict";a.r(t),a.d(t,"initDesign",(function(){return S})),a.d(t,"repairDesign",(function(){return y}));var n=a("UzQk"),o=a("qcxC"),r=a("MGCh"),i=a.n(r),s=a("tpS0"),l=a.n(s),d=a("OMxe"),c=a("GVGo"),u=a("ztCj");const p=i.a.channel("quick-action-utils");let m;!function(e){e.DB="ccl_qt_db",e.STORE="ccl_qt_image_store",e.KEY="IMAGE_QT"}(m||(m={}));function h(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function g(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?h(Object(a),!0).forEach((function(t){f(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):h(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function f(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}const b=i.a.channel("controller");async function w({image:e,replacingForma:t,coreWrapper:a,component:n,addNewImage:r,validateSession:i}){if(!e||Array.isArray(e)&&0===e.length)return!1;let s;const d=[],c={coreWrapper:a,component:n,replacingForma:t,isNewPostImage:!0,allowSelection:!1};return s=Array.isArray(e)?e.map(e=>{const t=Object(o.default)();return d.push(t.promise),r(g(g({},c),{},{data:e,docSavedDfd:t,failSilent:!0}))}):[r(g(g({},c),{},{data:e}))],Promise.all(d).catch(()=>{b.error("Add image errors in document during open"),function(e){const t=new l.a({headerText:"i18n.dialogs.addImageError.kHeaderText",contentText:"i18n.dialogs.addImageError.kContentText",dismissable:!0,buttons:[{class:"pill pill-primary-on-light",label:"i18n.dialogs.addImageError.kButtonLabel",onClick(){t.hide()}}]});e.errorDialogs.addImageErrorOverlay=t}(n)}),await Promise.allSettled(s),i(),!0}async function v(e,t){const a=g({},t);if(e===c.WorkflowType.QUICKACTION){const e=await class{static async retrieveQuickActionStoreData(){var e;const t=new u.a(m.DB,m.STORE),a=await Object(u.b)(m.KEY,t);if(!a)return void p.error("failed to retrieve data from the qaStore");if(!a.fileData||!a.fileData.blob)return void p.error("retrieved no image data from the qaStore");if(a.projectId||p.error("retrieved no project ID from the qaStore"),a.designData||p.warn("retrieved no design data from the qaStore"),a.sizeData||p.warn("retrieved no size data from the qaStore"),!a.sizeData&&!a.designData)return void p.error("retrieved no size data or design data from the qaStore");const o=(null===(e=a.designData)||void 0===e?void 0:e.useFloatingImage)?n.FloatingImageStrategy.Always:n.FloatingImageStrategy.Never;return{designData:a.designData,sizeData:a.sizeData,projectId:a.projectId,imgData:{floatingImageStrategy:o,files:[a.fileData.blob]}}}}.retrieveQuickActionStoreData();if(!e)return a;const{designData:o,imgData:r,sizeData:i}=e;let s;if(a.image=r,o){const{sizeId:e,width:r,height:i}=o;s="Custom"===e?n.DesignSizeLibrary.getCustomSize(r,i,0,300):n.DesignSizeLibrary.getById(e),a.shapeData=s||t.shapeData}else if(i){const{id:e,width:o,height:r}=i;s="Custom"===e?n.DesignSizeLibrary.getCustomSize(o,r,0,300):n.DesignSizeLibrary.getById(e),a.shapeData=s||t.shapeData}}return a}async function S({appConfig:e,newPostParams:t,queryParams:a,replacingForma:o,coreWrapper:r,component:i,addNewImage:s,brandDocument:l,validateSession:c}){switch(e.operation){case"remix":return await async function(e,t,a){const{aspectId:o,customSize:r}=e;let i;if(o||r)if(r){const e=r.split(":");if(4===e.length){const[t,a,o,r]=e.map(Number);i=n.DesignSizeLibrary.getCustomSize(t,a,o,r)}}else i=n.DesignSizeLibrary.getById(o);i&&(await t.setPageSizeFromDesignSize(i),a()),await t.recordOriginalSize(),await t.recordCreateFromRemix(),a()}(e,r,c),!1;case"new":return async function({appConfig:e,newPostParams:t,queryParams:a,replacingForma:n,coreWrapper:o,component:r,addNewImage:i,brandDocument:s,validateSession:l}){const c=await v(a.workflow,t),{shapeData:u,image:p}=c;await o.setPageSizeFromDesignSize(u),l(),await o.recordOriginalSize(),l();const m=await w({replacingForma:n,coreWrapper:o,component:r,addNewImage:i,validateSession:l,image:p});l(),await o.initializeNewPost(c),l();const h="true"===e.branded;return h&&(await s(!0),l()),Object(d.publishProjectCreated)(c,a,h),m}({appConfig:e,newPostParams:t,queryParams:a,replacingForma:o,coreWrapper:r,component:i,addNewImage:s,brandDocument:l,validateSession:c});default:return!1}}function y(e,t,a){if("new"!==e.operation){a.replaceCorruptImageFrames()&&(b.error("Replacing corrupt images in document during open"),function(e){let{replacedLowResImagesModal:t}=e.errorDialogs;t||(t=new l.a({headerText:'\n                <span class="error-modal-header">\n                <span>i18n.dialogs.corruptImageReplacement.kHeaderText</span>\n                <i class="error-modal-header__icon"></i>\n                </span>\n            ',contentText:'<div class="error-modal-content">\n                <span>i18n.dialogs.corruptImageReplacement.kContentText</span>\n                <span class="error-modal-content_placeholder-indicator" style="background-color: #FF0000;"></span>\n            </div>',dismissable:!0,buttons:[{class:"pill pill-primary-on-light",label:"i18n.dialogs.corruptImageReplacement.kButtonLabel",onClick(){t.hide()}}]}),e.errorDialogs.replacedLowResImagesModal=t),t.show()}(t))}}},iXON:function(e,t,a){"use strict";a.r(t),a.d(t,"checkWebGLSupport",(function(){return d}));var n=a("bBG2"),o=a("tpS0"),r=a.n(o),i=a("3xm6"),s=a.n(i),l=a("GnB6");async function d(e){const t=document.createElement("canvas").getContext("webgl");null!==t&&"undefined"!=typeof WebGLRenderingContext&&t instanceof WebGLRenderingContext?n.default.publish("webGLAvailable"):await new Promise((t,a)=>{const o=l.default.getWebGLSystemInfo();n.default.publish("webGLUnavailable",o),e.errorDialogs.webglWarningModal=function(e,t){const{vendor:a,renderer:n,platform:o,userAgent:i}=e,l=new r.a({headerText:"i18n.dialogs.webGLDisabled.kHeaderText",contentText:`${s.a.translate("dialogs.webGLDisabled.kContentText")}<br/>\n            <br/>\n            Vendor: ${a}<br/>\n            Renderer: ${n}<br/>\n            Platform: ${o}<br/>\n            UserAgent: ${i}`,dismissable:!1,buttons:[{class:"pill pill-primary-on-light",label:"i18n.dialogs.webGLDisabled.kOK",onClick(){l.hide(),t({isWebGLUnavailable:!0})}}]});return l}(o,a),window.marvel.events.trigger("hide-interstitial"),e.windowPanel.show(),e.errorDialogs.webglWarningModal.show()})}},luSs:function(e,t,a){"use strict";function n(e,t,a={}){var n,o,r,i;null==e||null===(n=e.designSurface)||void 0===n||null===(o=n.poster)||void 0===o||null===(r=o.events)||void 0===r||null===(i=r.publish)||void 0===i||i.call(r,t,a)}a.d(t,"a",(function(){return n}))},m5wp:function(e,t,a){"use strict";a.d(t,"b",(function(){return i}));var n=a("tpS0"),o=a.n(n),r=a("yiIM");function i(e,t,a,n,i){const s=[{id:"MustReloadEditorRefreshButton",class:"pill pill-primary-on-light",label:"i18n.dialogs.mustReloadEditor.kRefresh",onClick(){l.hide(),(a||r.a.reload)()}}];t&&(s.push({id:"MustReloadEditorIgnoreAllButton",class:"pill pill-secondary-on-light",label:"i18n.dialogs.mustReloadEditor.kIgnoreAllLabel",onClick(){l.hide(),i&&i()}}),s.push({id:"MustReloadEditorIgnoreOnceButton",class:"pill pill-secondary-on-light",label:"i18n.dialogs.mustReloadEditor.kIgnoreOnceLabel",onClick(){l.hide(),n&&n()}}));const l=new o.a({buttons:s,id:"MustReloadEditorDialog",headerText:"i18n.dialogs.mustReloadEditor.kHeaderText",contentText:e||"i18n.dialogs.mustReloadEditor.kContentText",dismissable:!1});l.show()}t.a=i},njsh:function(e,t,a){"use strict";a.r(t),a.d(t,"default",(function(){return m}));var n=a("UzQk"),o=a("UFvF"),r=a.n(o),i=a("bBG2"),s=a("QX4k"),l=a("MGCh"),d=a.n(l),c=a("UNP3");function u(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}const p=d.a.channel("export-analytics-manager");class m{constructor(){u(this,"document",void 0),u(this,"remixParentMetadataPromise",void 0),u(this,"remixParentAnalyticsMetadata",{})}static getCpAssetMetadata(e,t){if(!e||!t)return r()(null);const a=new s.default({cpServiceDomain:t});return r()(a.getAssetMetadataWithRetry(e))}static getRemixParentMetadataForAnalytics(e,t,a){return a?r()({tags:null,templateType:"brand",id:e}):e?m.getCpAssetMetadata(e,t):r()({})}static extractTemplateAnalyticsFromCpAssetMetadata(e){const t=e||{};let a;return a=t.tags?t.tags.includes("remixpaid")?"paid":"free":t.templateType||"none",{templateType:a,tagNames:t.tags?`[${t.tags.join(", ")}]`:"[]",templateId:t.id?t.id:"none",alias:t.alias}}static getDesignMetadataForExport(e){if(!e)return{originalSize:"unknown",exportSize:"unknown",hasResized:"unknown",designIngredientId:"unknown",color:"unknown",layout:"unknown",includesPaidAdobeFonts:"unknown",contentCountsString:"unknown",extendedContentCountsString:"unknown",designFilter:"unknown",hasVariationTemplate:"unknown",hasAnimation:"unknown",animationStyle:"unknown",fontSizeString:"unknown",textLayoutsString:"unknown"};const t=e.firstPage.originalSizeID.toLowerCase(),a=e.firstPage.sizeID.toLowerCase(),o=t===n.FormaPage.DEFAULT_ORIGINAL_SIZE_ID.toLowerCase()?"unknown":t!==a,r=n.TheoDocumentUtils.getAllDesignIngredientIDsAndTypes(e),i=r.length?r[0].id:void 0,s=e.firstPage.colorLibrary.paletteID||void 0,l=n.TheoDocumentUtils.getAppliedLayoutId(e)||void 0,d=n.TheoDocumentUtils.getFontSourceUsage(e).indexOf(Object(n.describeFontSource)(n.FontSource.TYPEKIT_PREMIUM))>-1,c=n.TheoDocumentUtils.getContentCountsString(e),u=n.TheoDocumentUtils.getExtendedContentCountsString(e),p=n.TheoDocumentUtils.getAppliedVariationTemplateId(e),h=n.TheoDocumentUtils.getTextLayoutsString(e),g=n.MotionUtils.getCurrentAnimationStyle(e);let f="false",b="unknown";g&&!g.isNoStyle()&&(b=n.AnimationLibrary.determineAnalyticName(g),f="true");const w=m.getFontSizeString(e),v=e.firstPage.root.filterWithCallback(e=>e.kind===n.FrameForma.KIND&&e.isBackgroundImage()),S=v.find(e=>{const t=n.ImageFacade.getImageContentForForma(e);return!(!t||!t.mediaMetadata)&&"premium"===t.mediaMetadata.licenseType});return{originalSize:t,exportSize:a,hasResized:o,designIngredientId:i,color:s,layout:l,includesPaidAdobeFonts:d,contentCountsString:c,extendedContentCountsString:u,fontSizeString:w,hasAnimation:f,animationStyle:b,textLayoutsString:h,backgroundType:v.length>0?S?"premium":"free":"none",designFilter:p||void 0,hasVariationTemplate:!!p}}static getSearchContextMetadataForExport(e,t){if(e&&e.search)return"string"==typeof e.search?e:{section:e.search.section||t&&t.search&&t.search.section,tagFilters:e.search.tagFilters,str:e.search.str}}static getFontSizeString(e){const t=n.TypeLockupUtils.sizesInDocument(e,void 0,!0).map(t=>n.TextFacade.toUserFontSize(t,e.firstPage));let a;if(t&&t.length){a=`fontSizeMin:${Math.min(...t).toFixed(1)};fontSizeMax:${Math.max(...t).toFixed(1)}`}return a}static sendExportAnalyticsAndMetadata(e,t,a){const o=e.firstPage.selectableFormaeIntersectingRect(n.TheoRect.Huge);i.default.publish("project:exportCompletedDNA",{contextualData13:"layerCount:"+(o?o.length+1:0)});const r=n.TheoDocumentUtils.getFontSourceUsage(e);i.default.publish("exportFontUsage",{contextualData1:`fontSource:[${r.join(", ")}]`}),n.TheoDocumentUtils.logExportDNAEvent(e),Object(c.reportNounProjectIds)(e,t,a);const s=n.TheoDocumentUtils.getMetadataEvents(e,!1);for(let e=0;e<s.length;e++){const t=s[e];i.default.publish("shareMetadata",{"document:metadata":t[0],"document:metadata2":t[1],"document:metadata3":t[2],"document:metadata4":t[3]})}}static finalizeAnalyticsForExportCompleted(e,t){const a=m.getDesignMetadataForExport(t);return Object.assign({},e,a)}setDocument(e){this.document=e}getRemixParentCPMetadata(e,t,a,n){if(this.remixParentMetadataPromise)return this.remixParentMetadataPromise;let o;return n&&(o=m.getSearchContextMetadataForExport(n)),this.remixParentMetadataPromise=m.getRemixParentMetadataForAnalytics(e,t,a).then(e=>{const t=m.extractTemplateAnalyticsFromCpAssetMetadata(e);return t.search=o,this.remixParentAnalyticsMetadata=t,t}).catch(e=>(p.warn("Failed to get parent CP metadata",e),this.remixParentAnalyticsMetadata=m.extractTemplateAnalyticsFromCpAssetMetadata(null),this.remixParentAnalyticsMetadata.search=o,r.a.reject(e)))}getMetadataForExportAnalytics(e,t,a){return this.getRemixParentCPMetadata(e,"cc-api-cp.adobe.io",t,a).then(e=>{const t=m.extractTemplateAnalyticsFromCpAssetMetadata(e);return t.search=m.getSearchContextMetadataForExport(a,e),m.finalizeAnalyticsForExportCompleted(t,this.document)}).catch(e=>(p.error("getMetadataForExportAnalytics: error while fetching metadata from CP",e),r()(!1)))}sendExportMetadataForDownload(e,t,a){m.sendExportAnalyticsAndMetadata(e,t,a);const n=m.finalizeAnalyticsForExportCompleted(this.remixParentAnalyticsMetadata,e);window.marvel.events.trigger("send-theo-editor-download-button-export-analytics",n)}}},ooew:function(e,t,a){"use strict";a.r(t),a.d(t,"default",(function(){return r}));var n=a("tpS0"),o=a.n(n);function r(e,t){const a=e.getRootForma();function n(e){return a.filterWithCallback(e).length>0}(n(e=>e.isSticker())||n(e=>e.isVideo())||!t&&n(e=>!!e.animation))&&function(){const e=new o.a({headerText:"i18n.dialogs.minisFeatureNotice.kHeaderText",contentText:"i18n.dialogs.minisFeatureNotice.kContentText",buttons:[{class:"pill pill-primary-on-light",label:"i18n.dialogs.minisFeatureNotice.kButtonLabel",onClick(){e.hide()}}]});e.show()}()}},pjwK:function(e,t,a){var n,o;n=[a("YLtl"),a("U1Jd"),a("Avqh")],void 0===(o=function(e,t,a){return function(n){(n=n||{}).tag=n.tag||t.TheoCombobox.elementName,n.zoomLevels=n.zoomLevels||[],n.currentZoom=isNaN(n.currentZoom)?1:n.currentZoom,n.currentZoomIsFit=n.currentZoomIsFit||!1,n.currentZoomIsFill=n.currentZoomIsFill||!1,n.pendingZoomIsFit=!1,n.pendingZoomIsFill=!1,n.formatter=n.formatter||(e=>e.toFixed(2));const o=new a(n),r=o.update,i=function(){o.el.value=n.formatter(n.currentZoom);const t=(a=n.zoomLevels,r=!1,i=!1,s="zoom",e.uniq(a.map(n.formatter)).map(e=>({value:e,id:`${s}${e}`,emphasized:r,selected:i})));var a,r,i,s;t.length&&(t[t.length-2].separatorBefore=!0);for(var l=0;l<t.length;l++){var d=t[l];if(l===t.length-2)d.emphasized=n.currentZoomIsFit,d.selected=n.currentZoomIsFit;else if(l===t.length-1)d.emphasized=n.currentZoomIsFill,d.selected=n.currentZoomIsFill;else{var c=parseInt(d.value,10);d.emphasized=c===n.currentZoom,d.selected=c===n.currentZoom}}o.el.items=t;o.el.sanitizers=[e=>{var a=parseInt(e,10);if(isNaN(a)){const a=t[t.length-2].value,n=t[t.length-1].value;return e===a?a:e===n?n:void 0}return isNaN(n.minZoom)||(a=Math.max(a,n.minZoom)),isNaN(n.maxZoom)||(a=Math.min(a,n.maxZoom)),a.toString()}];o.el.setAttribute("data-i18n","[value-aria-label]panels.textstyles.kFontSize;[show-options-aria-label]common.kShowOptions;[hide-options-aria-label]common.kHideOptions")},s=function(e){var t=e&&e.originalEvent&&e.originalEvent.detail;const{value:a,id:o}=t;if(n.pendingZoomIsFit){const e=n.zoomLevels[n.zoomLevels.length-2];t={value:e,id:"zoom"+e},n.pendingZoomIsFit=!1}else if(n.pendingZoomIsFill){const e=n.zoomLevels[n.zoomLevels.length-1];t={value:e,id:"zoom"+e},n.pendingZoomIsFill=!1}const r=o?"menu":"manual";"function"==typeof n.onSelected&&n.onSelected(t,r),n.pendingZoomIsFit=!1,n.pendingZoomIsFill=!1},l=function(e){const t=e&&e.originalEvent&&e.originalEvent.detail,{id:a}=t;"function"==typeof n.onChanging&&n.onChanging(t)},d=function(e){const t=e&&e.originalEvent&&e.originalEvent.detail,{isInteractive:a}=t;a&&(n.currentZoomIsFit?this.setState({selectedItemIndex:n.zoomLevels.length-2}):n.currentZoomIsFill&&this.setState({selectedItemIndex:n.zoomLevels.length-1}))};o.update=function(e){n.pendingZoomIsFit=e.pendingZoomIsFit||!1,n.pendingZoomIsFill=e.pendingZoomIsFill||!1,n.pendingZoomIsFit||n.pendingZoomIsFill||(n.zoomLevels=e.zoomLevels||n.zoomLevels,n.currentZoom=isNaN(e.currentZoom)?n.currentZoom:e.currentZoom,n.currentZoomIsFit=e.currentZoomIsFit||!1,n.currentZoomIsFill=e.currentZoomIsFill||!1,n.minZoom=isNaN(e.minZoom)?n.minZoom:e.minZoom,n.maxZoom=isNaN(e.maxZoom)?n.maxZoom:e.maxZoom,i(),r(e))};const c=function(){o.$el.off("THEO_COMBOBOX_VALUE_CHANGED",s),o.$el.off("THEO_COMBOBOX_VALUE_CHANGING",l),o.$el.off("THEO_COMBOBOX_STATE_CHANGED",d)},u=function(){o.$el.on("THEO_COMBOBOX_VALUE_CHANGED",s),o.$el.on("THEO_COMBOBOX_VALUE_CHANGING",l),o.$el.on("THEO_COMBOBOX_STATE_CHANGED",d)};return o.events.subscribe("shown",u),o.events.subscribe("hidden",c),o.isHidden()||u(),i(),o}}.apply(t,n))||(e.exports=o)},rquo:function(e,t,a){"use strict";a.r(t),a.d(t,"initWatermark",(function(){return c})),a.d(t,"checkWatermarkRemovalGrandfatherStatus",(function(){return u}));var n=a("GSfz"),o=a.n(n),r=a("MGCh"),i=a.n(r),s=a("8DU0"),l=a("HetE");const d=i.a.channel("controller");async function c(e,t,a,n,r){let i=!0,c=!1;const u=await e;r();const p=a.featureEnabled("entitle-brand-kit");i=!(a.featureEnabled("post-create-template-contentteam")||u||p)&&("remix"===t.operation||n.getWatermarkEnabledForDoc()),n.setWatermarkEnabledForDoc(i);try{c=await s.default.getSetting(o.a.keys.POST_WATERMARK_COACHMARK_DISMISSED),r()}catch(e){const t=e?e.message:"";if(t===l.RejectReason.STALE_SESSION)throw e;d.warn("Error fetching user settings for watermark coachmark.",t),c=!1}return{isWatermarkEnabled:i,dismissedWatermarkCoachmark:c}}function u(e){const t=s.default.getSetting(o.a.keys.POST_WATERMARK_UNLOCKED).catch(e=>{const t=e?e.message:"";return d.warn("Error fetching user settings for watermark status. Error: "+t,e),Promise.resolve(!1)}),a=e.loadFeatures();return Promise.all([t,a]).then(([t])=>{const a=e.featureEnabled("show-remove-branding-flow"),n=e.featureEnabled("remove-branding-enabled");return!t&&a&&n?(s.default.setSetting(o.a.keys.POST_WATERMARK_UNLOCKED,!0),!0):t})}},rx2z:function(e,t,a){"use strict";a.r(t);var n=a("2ofD"),o=a.n(n),r=a("3xm6"),i=a.n(r),s=a("Mbmg"),l=a("m5wp"),d=a("6Wo8"),c=a("qcxC"),u=a("hu6S");function p(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}t.default=class{constructor(e,t,a,n,o){this.coreWrapper=e,this.editingMode=t,this.operation=a,this.postFeatureController=n,this.templateNode=o,p(this,"saveDocumentDeferred",Object(c.default)()),p(this,"saveCorePromise",void 0),p(this,"topBarUI",void 0),p(this,"honorForceReload",!0),p(this,"poster",void 0),this.saveDocumentDeferred.resolve(),this.handleForceReloadRequest=this.handleForceReloadRequest.bind(this),this.handleUpdateSaveRequest=this.handleUpdateSaveRequest.bind(this),this.handlePlatformSaveTriggered=this.handlePlatformSaveTriggered.bind(this),this.cleanUpAfterSave=this.cleanUpAfterSave.bind(this),this.requestSave=this.requestSave.bind(this),this.waitForSaveToFinish=this.waitForSaveToFinish.bind(this),this.waitForQuietSaveToFinish=this.waitForQuietSaveToFinish.bind(this),this.resolveSaveDeferred=this.resolveSaveDeferred.bind(this),this.cancelPendingCoreSaves=this.cancelPendingCoreSaves.bind(this)}setComponents(e){this.poster=e.poster,this.topBarUI=e.topBarUI}handleForceReloadRequest(e){if(!this.honorForceReload)return;let t;this.honorForceReload=!1;const a=i.a.translate("dialogs.mustReloadEditor.kContentText");if(e){t=`<div class="error-modal-content">\n                <div><p><span>${a}</span></p>\n                <p><span>${i.a.translate("dialogs.mustReloadEditor.kFollowUpWithMessageText")}</span></p></div>\n                <div style="margin-top:1em"><span>${e}<span></div>\n                </div>`}else{t=`<div class="error-modal-content">\n                <p><span>${a}</span></p>\n                <p><span>${i.a.translate("dialogs.mustReloadEditor.kFollowUpGenericText")}</span></p></div>`}Object(l.b)(t,this.postFeatureController.featureEnabled("post-can-ignore-force-reload"),(()=>{s.b.pageUnloadBlockingEnd(),u.a.reload(this.saveDocumentDeferred,this.coreWrapper,!0)}).bind(this),(()=>{this.honorForceReload=!0}).bind(this))}handleUpdateSaveRequest(e){s.b.pageUnloadBlockingBegin();const t=Object(c.default)();e.finalized?t.resolve():e.then(t.resolve).fail(t.reject),this.saveDocumentDeferred=t}cleanUpAfterSave(){s.b.pageUnloadBlockingEnd()}handlePlatformSaveTriggered(e){this.saveCorePromise=e.coreDeferred;const{coreWrapper:t,saveDocumentDeferred:a,saveCorePromise:n,poster:r,topBarUI:i,postFeatureController:s,operation:l,editingMode:c,templateNode:u}=this;d.a.save({coreWrapper:t,saveDocumentDeferred:a,saveCorePromise:n,poster:r,postFeatureController:s,operation:l,editingMode:c,templateNode:u,topBarUI:i,currentDoc:o.a.currentDoc,stateID:e.stateID})}requestSave(e,t){this.coreWrapper.requestSave(e,t)}suspendSave(){this.coreWrapper.suspendSave()}resumeSave(){this.coreWrapper.resumeSave()}waitForSaveToFinish(e,t){return u.a.waitForSaveDocumentToFinish(this.saveDocumentDeferred,this.coreWrapper,e,t)}waitForQuietSaveToFinish(){const e=Object(c.default)();return this.saveDocumentDeferred.promise.finally(()=>{o.a.waitForQuiet().then(()=>e.resolve())}),e.promise}resolveSaveDeferred(){this.saveDocumentDeferred.resolve()}cancelPendingCoreSaves(){this.coreWrapper.cancelPendingSaves()}executePendingCoreSaves(){this.coreWrapper.executePendingSaves()}}},sjIh:function(e,t,a){"use strict";a.r(t);var n=a("2ofD"),o=a.n(n),r=a("pEL3"),i=a.n(r),s=a("+Ltv"),l=a.n(s);t.default=new class{constructor(){var e,t,a;a=void 0,(t="handlers")in(e=this)?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a}listenToMarvelEvents(e,t,a,n){this.unlistenToMarvelEvents(),this.createMarvelHandlers(e,t,n);const{events:o}=window.marvel,{onSaveTemplateRedirect:r,onTemplateRemoveEnterOnboarding:i,onCollabChangeUpdateStatus:s}=this.handlers;o.on("saved-composite-doc",r),o.on("document-collaboration-changed",s),a&&o.on("onboarding-premium-template-remove",i)}unlistenToMarvelEvents(){if(!this.handlers)return;const{events:e}=window.marvel,{onSaveTemplateRedirect:t,onTemplateRemoveEnterOnboarding:a,onCollabChangeUpdateStatus:n}=this.handlers;e.off("saved-composite-doc",t),e.off("onboarding-premium-template-remove",a),e.off("document-collaboration-changed",n),e.off("upgrade-view-closed")}createMarvelHandlers(e,t,a){this.handlers={onSaveTemplateRedirect(){if(e&&e.newTemplateId){const t=`design-edit-template/post/${e.contextId}/${e.newTemplateId}`;window.marvel.navigate(t,{trigger:!1,replace:!0})}},onTemplateRemoveEnterOnboarding:()=>{l.a.inPremiumTemplateOnboardingFlow=!0,function(e){e.premiumTemplateTextTooltip=new i.a({parent:"PostApp",id:"textTooltip",message:"i18n.components.coachmarks.premiumText.kMessage",arrowDirection:"left",showCloseButton:!1,anchorElement:e.designSurface.imageWrapper,height:"auto",width:130,offsetY:250,offsetX:5,priority:1,hidden:!0}),e.premiumTemplateTextTooltip.show()}(t)},onCollabChangeUpdateStatus(e){const n=o.a.currentDoc;if(n===e.composite){const{collaborators:o,invitations:r}=e.collab,i=o.length+r.length>0;i?n.setCollaboration("OUTGOING"):(n.setCollaboration(void 0),n.set("collaboration",void 0)),a(i),t&&t.postSideBarUI&&t.postSideBarUI.brandIndicator&&t.postSideBarUI.brandIndicator.update({collaborationStatus:n.getCollaboration()||"NONE"})}}}}}}}]);
//# sourceMappingURL=theo-web-view_e2950cfd-366dc51f.js.map