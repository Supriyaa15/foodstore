(window.webpackJsonptheoWebApp=window.webpackJsonptheoWebApp||[]).push([[11],{"9kak":function(t,e,o){var r,i,a,n=e,l=o("oAGj");n.LockupRowInfo=(r=function(t,e){if(this.aspectRatio=0,this.words=[],this.text="",this.appendable=!0,this.rowHeightAdjustRatio=1,this.colOffsetLeft=0,this.colOffsetRight=0,void 0===t&&(t=null),void 0===e&&(e=!0),null!=t)for(var o=l.iter(t);!o.done;o.next()){var r=o.value;this.addWord(r)}this.appendable=e},l.defineClass({name:"LockupRowInfo",ctor:r,props:{addWord:function(t){if(this.words.length>0){var e=this.words[this.words.length-1];this.aspectRatio+=e.spaceAspectRatio,this.text+=" "}this.text+=t.text,this.words.push(t),this.aspectRatio+=t.aspectRatio,1!=this.words.length&&t.characterHeightRatio!=this.rowHeightAdjustRatio?this.rowHeightAdjustRatio=1:this.rowHeightAdjustRatio=t.characterHeightRatio},removeLastWord:function(){var t;if(t=l.last(this.words)){var e;if(this.words.splice(this.words.length-1,1),this.aspectRatio-=t.aspectRatio,e=l.last(this.words)){this.aspectRatio-=e.spaceAspectRatio;var o,r=this.text.split(" ");r.pop(),this.text=r.join(" "),1==this.rowHeightAdjustRatio&&null!=(o=l.opt(l.first(this.words),(function(t){return t.characterHeightRatio})))&&1!=o&&null==this.words.find((function(t){return t.characterHeightRatio!=o}),this)&&(this.rowHeightAdjustRatio=o)}else this.text="",this.rowHeightAdjustRatio=1;return t}return null}}}),r),n.LockupRowsInfo=(i=function(t,e,o,r,i,a){this.rows=l.clone(t),this.widestRow=e,this.primaryFontSize=o,this.averageRowHeight=r,this.width=i,this.height=a},a={},l.defineClass({name:"LockupRowsInfo",ctor:i,statics:{EMPTY:{get:function(){return void 0===a.EMPTY&&(a.EMPTY=new i([],new n.LockupRowInfo,0,0,0,0)),a.EMPTY}}}}),i)},EDIN:function(t,e,o){var r,i=e,a=o("oAGj"),n=o("ascj"),l=o("JgVS"),s=o("cEEQ"),c=o("c+uM"),u=o("8t9B");i.NoDecorationStrategy=(r=function(){l.BaseDecorationStrategy.call(this)},a.defineClass({name:"NoDecorationStrategy",ctor:r,superName:"BaseDecorationStrategy",statics:{_implements:function(t){return"LockupDecorationStrategy"==t}},props:{supportsConfiguration:function(t){return t.style.backing==c.LockupBacking.None},decorate:function(t,e){var o,r=t.style,i=!1;if((o=t.style.characterStyles[u.TypeLockupController.HIGHLIGHT_STYLE])&&(i=o.textLook==c.LockupTextLook.FillAndOutline2),r.textLook!=c.LockupTextLook.FillAndOutline2&&!i)return new l.DecorationResults([]);for(var h=[],g=a.iter(a.range(0,e.items.length,!1));!g.done;g.next()){var p=g.value,d=e.items[p];if(d.type==s.LockupItemType.Text){var y,k,S=r.textLook==c.LockupTextLook.FillAndOutline2;null!=(y=d.characterStyle)&&(k=t.style.characterStyles[y])&&(S=k.textLook==c.LockupTextLook.FillAndOutline2||k.textLook==c.LockupTextLook.UNSET&&S),S&&((d=d.clone()).colorRole=n.ColorRole.FieldSecondary,h.push(d))}}return new l.DecorationResults(h)}}}),r)},GFAD:function(t,e,o){var r,i=e,a=o("oAGj");i.LockupUtils=(r=function(){},a.defineClass({name:"LockupUtils",ctor:r,statics:{percentageDiff:function(t,e){return 100*Math.abs((t-e)/((t+e)/2))}}}),r)},KdeS:function(t,e,o){var r,i=e,a=o("oAGj"),n=o("1NAc");i.LockupWordInfo=(r=function(t,e,o,r,i,a,l,s,c){this.complementaryStyleAspectRatio=null,this.complementaryStyleSpaceAspectRatio=null,void 0===c&&(c=n.TheoSize.Zero),this.text=t,this.aspectRatio=e,this.spaceAspectRatio=o,this.characterStyle=r,this.characterHeightRatio=i,this.isNewLine=a,this.canBreak=l,this.rangeInLockup=s,this.relativeMargins=c},a.defineClass({name:"LockupWordInfo",ctor:r}),r)},TkOd:function(t,e,o){var r,i,a,n,l,s,c,u,h,g,p,d,y,k=e,S=o("oAGj"),f=o("cZuM"),L=o("6h7+"),C=o("SpAV"),m=o("yhkb"),A=o("gXiO"),v=o("C42b"),b=o("YSlt"),D=o("Ohrj"),T=o("ascj"),w=o("FNB+"),x=o("QgZx"),O=o("lq1z"),B=o("QbzR"),F=o("iCxV"),_=o("3lr5"),E=o("fNpk"),I=o("c+uM"),P=o("hb8m"),R=o("tGKA"),W=o("3DEm"),K=o("jcfx"),U=o("Zifs"),N=o("35Q0"),V=o("p+tC"),G=o("UqVc"),M=o("EoOi"),H=o("umUn"),Y=o("T6jX"),z=o("Vm85"),j=o("8t9B"),q=o("3UhB"),J=o("oKlP"),Z=o("oKI3");k.kColorPairDistanceThreshold=10,S.gvar(k,"BACKING_SHAPES_BASIC",(function(){return N.ShapeLibrary.NonSvgBackingShapeIDs})),S.gvar(k,"BACKING_SHAPES_SVG",(function(){return N.ShapeLibrary.BrowsableBackingShapes})),S.gvar(k,"ALLOWED_BACKING_VALUES",(function(){return k.BACKING_SHAPES_BASIC.concat(k.BACKING_SHAPES_SVG)})),S.gvar(k,"BACKING_COUNT_SCALE",(function(){return S.toDouble(k.ALLOWED_BACKING_VALUES.length)})),S.gvar(k,"ALLOWED_LAYOUT_VALUES",(function(){return["left","right","center","fill"]})),S.gvar(k,"LAYOUT_COUNT_SCALE",(function(){return S.toDouble(k.ALLOWED_LAYOUT_VALUES.length)})),S.gvar(k,"ALLOWED_OPACITY_VALUES",(function(){return["full","mediumBacking","faintBacking","medium","faint"]})),S.gvar(k,"OPACITY_COUNT_SCALE",(function(){return S.toDouble(k.ALLOWED_OPACITY_VALUES.length)})),S.gvar(k,"ALLOWED_SHADOWANGLE_VALUES",(function(){return[45,135,225,315]})),S.gvar(k,"SHADOWANGLE_COUNT_SCALE",(function(){return S.toDouble(k.ALLOWED_SHADOWANGLE_VALUES.length)})),S.gvar(k,"ALLOWED_PADDING_VALUES",(function(){return[0,.33,.66,1]})),S.gvar(k,"PADDING_COUNT_SCALE",(function(){return S.toDouble(k.ALLOWED_PADDING_VALUES.length)})),S.gvar(k,"ALLOWED_SPACING_VALUES",(function(){return[0,.5,1]})),S.gvar(k,"SPACING_COUNT_SCALE",(function(){return S.toDouble(k.ALLOWED_SPACING_VALUES.length)})),S.gvar(k,"ALLOWED_TRACKING_VALUES",(function(){return[-.1,0,.5]})),k.LockupStyleAttributes=(r=function(){this.font=0,this.layout="fill",this.backing="none",this.textOpacity=B.FormaStyle.OPACITY_DEFAULT,this.backingOpacity=B.FormaStyle.OPACITY_DEFAULT,this.primaryColor="themeColor0",this.secondaryColor="themeColor1",this.borderColor="themeColor1",this.shadowColor="themeColor1",this.shadowAngle=135,this.spacing=.35,this.tracking=0,this.relativeFontScale=I.LockupStyle.DEFAULT_RELATIVE_FONT_SCALE,this.padding=.35,this.textLook="fill",this.shadowOffset=I.LockupStyle.DEFAULT_SHADOWOFFSET,this.strokeWeight=I.LockupStyle.DEFAULT_STROKEWEIGHT,this.wheelUsed=!1},S.defineClass({name:"LockupStyleAttributes",ctor:r,props:{clone:function(){var t=new r;return t.font=this.font,t.layout=this.layout,t.backing=this.backing,t.textOpacity=this.textOpacity,t.backingOpacity=this.backingOpacity,t.primaryColor=this.primaryColor,t.secondaryColor=this.secondaryColor,t.borderColor=this.borderColor,t.shadowColor=this.shadowColor,t.shadowAngle=this.shadowAngle,t.spacing=this.spacing,t.tracking=this.tracking,t.relativeFontScale=this.relativeFontScale,t.padding=this.padding,t.textLook=this.textLook,t.shadowOffset=this.shadowOffset,t.strokeWeight=this.strokeWeight,t.wheelUsed=this.wheelUsed,t}}}),r),k.getFontPairingMatrix=function(t){for(var e={},o=t.count,r=S.iter(S.range(0,o,!1));!r.done;r.next()){for(var i=r.value,a=t.fontAt(i),n=a.postScriptName,l={},s=S.iter(S.range(0,o,!1));!s.done;s.next()){var c=s.value,u=t.fontAt(c),h=u.postScriptName,g=i==c,p=1;p+=1+S.toDouble(10-W.MathUtils.absInt(a.formality-u.formality)),p+=1+S.toDouble(10-W.MathUtils.absInt(a.width-u.width)),p+=1+S.toDouble(W.MathUtils.absInt(a.blackness-u.blackness));var d=S.toDouble(a.drama-u.drama);p+=d,d<-1&&(p*=.1),a.square==u.square&&(p*=2),a.geometric==u.geometric&&(p*=2),a.italic==u.italic&&(p*=2),a.handdrawn&&u.handdrawn&&(p*=2);var y=a.slab&&u.slab,k=0==(a.slab||u.slab);y&&(p*=2);var f=a.serif&&u.serif;f&&k&&(p*=2),0==(a.serif||u.serif)&&(p*=2),f&&a.slab!=u.slab&&(p*=0);var L=a.decorative&&u.decorative;0==g&&L&&(p*=0),a.calligraphic&&u.calligraphic&&0==g&&(p*=0),l[h]=p}e[n]=S.clone(l)}return e},k.getFontPairScore=function(t,e,o){var r,i;if((r=t[e])&&null!=(i=r[o]))return i;return 0},k.hasSufficientLegibilityContrast=function(t,e){return t.contrasts(e,!1)},k.needsContrastingColor=function(t,e,o){return e!=I.LockupTextLook.Fill&&e!=I.LockupTextLook.KnockoutOnly||o},k.getTextOpacity=function(t){return t.textOpacity},k.getBackingOpacity=function(t){return t.backingOpacity},k.getTextLook=function(t){var e;switch(t.textLook){case"fill":e=I.LockupTextLook.Fill;break;case"knockoutOnly":e=I.LockupTextLook.KnockoutOnly;break;case"knockoutAndOutline":e=I.LockupTextLook.KnockoutAndOutline;break;case"outlineOnly":e=I.LockupTextLook.OutlineOnly;break;case"fillAndOutline":e=I.LockupTextLook.FillAndOutline;break;case"fillAndOutline2":e=I.LockupTextLook.FillAndOutline2;break;case"shadow":e=I.LockupTextLook.Shadow;break;case"shadowAndOutline":e=I.LockupTextLook.ShadowAndOutline;break;case"knockoutAndShadow":e=I.LockupTextLook.KnockoutAndShadow;break;case"shadowOutlineTransparentText":e=I.LockupTextLook.ShadowOutlineTransparentText;break;case"knockoutShadowOutline":e=I.LockupTextLook.KnockoutShadowOutline;break;default:e=I.LockupTextLook.Fill}return e},k.changeBorderAndShadowToSecondary=function(t){t.borderColor=t.secondaryColor,t.shadowColor=t.secondaryColor},k.InterestingLockupData=(i=function(t){var e,o,r,i,a,n,l,s,c,u,h,g,p,d,y,f,L,C,m,A,v,b,D;(v=S.as(t.style,I.LockupStyle))&&(g=k.lockupStyleToLockupStyleAttributes(v,t.page.document),u=S.opt(v.font,(function(t){return t.fontData.postScriptName})),(b=S.as(t.controller,j.TypeLockupController))&&(h=b.getCurrentFontSize()),A=k.lockupStyleToLockupStyleAttributes(v,t.page.document).backing),(b=S.as(t.controller,j.TypeLockupController))&&((D=b.size)&&(C=D.width,m=D.height,p=S.toDouble(D.width/D.height)),d=S.clone(t.totalPlacement.transformPoints(t.bounds.points)),y=b.text.length,f=b.text,L=b.wordCount()),this.id=t.formaID,this.width=(e=C)||null!=e?e:100,this.height=(o=m)||null!=o?o:100,this.font=(r=u)||null!=r?r:"BebasNeue",this.lineHeight=(i=h)||null!=i?i:1,this.styleAttributes=g||new k.LockupStyleAttributes,this.aspectRatio=(a=p)||null!=a?a:1,this.pts=S.clone(d||[]),this.wordCount=(n=L)||null!=n?n:1,this.charCount=(l=y)||null!=l?l:1,this.originalBacking=(s=A)||null!=s?s:"",this.lockupString=(c=f)||null!=c?c:""},S.defineClass({name:"InterestingLockupData",ctor:i}),i),k.InterestingPageData=(a=function(t){this.colorsBehindSelectedLockup=[],this.numImages=0,this.shapeCount=0,this.selectedLockup=new k.InterestingLockupData(t);var e=this.selectedLockup,o=[this.selectedLockup],r=10,i=1e3,a=1e3;if(t.page.hasRoot()){var n,l;i=t.page.pageSize.width,a=t.page.pageSize.height,(n=S.as(t.controller,j.TypeLockupController))&&(this.colorsBehindSelectedLockup=S.clone(n.getBackgroundColors()),r=n.getBackgroundLightnessSpread(this.colorsBehindSelectedLockup),this.shapeCount=n.shapeCount()),0==this.colorsBehindSelectedLockup.length&&(l=t.page.root.style.colors.fieldPrimary)&&this.colorsBehindSelectedLockup.push(l);for(var s=S.clone(t.page.root.filterWithCallback((function(t){return t.isTypeLockup()}))),c=S.iter(s);!c.done;c.next())if((t=c.value).formaID!=this.selectedLockup.id){var u=new k.InterestingLockupData(t);u.lineHeight>e.lineHeight&&(e=u),o.push(u)}}this.height=a,this.width=i,this.numImages=t.root.filterWithCallback((function(t){return t.isBackgroundImage()})).length,this.lockups=S.clone(o),this.largestLineHeightLockup=e,0==this.colorsBehindSelectedLockup.length&&this.colorsBehindSelectedLockup.push(U.SolidColor.BLACK),this.lightnessSpreadBehindSelectedLockup=r},S.defineClass({name:"InterestingPageData",ctor:a,props:{isColorVisibleAgainstBackground:function(t){for(var e=S.iter(this.colorsBehindSelectedLockup);!e.done;e.next()){var o=e.value;if(!k.hasSufficientLegibilityContrast(t,o))return!1}return!0},ensureCorrectBackgroundColors:function(t){var e,o,r=[];(e=S.as(t.controller,j.TypeLockupController))&&(r=S.clone(e.getBackgroundColors())),0==r.length&&(o=t.page.root.style.colors.fieldPrimary)&&r.push(o),r.length>0&&(this.colorsBehindSelectedLockup=S.clone(r))}}}),a),k.getBackingStringForBackingEnumAndArtworkId=function(t,e){var o="none";switch(t){case 0:o="none";break;case 2:o="row";break;case 9:o="bannerHorizontal";break;case 8:o="bannerVertical";break;case 11:o="knockout";break;case 4:o="none";break;default:null!=e&&(o=e)}return o},k.getBackingEnumAndArtworkIdForBackingString=function(t){var e,o=null;switch(t){case"none":e=I.LockupBacking.None;break;case"row":e=I.LockupBacking.Rows;break;case"bannerHorizontal":e=I.LockupBacking.BannerHorizontal;break;case"bannerVertical":e=I.LockupBacking.BannerVertical;break;case"knockout":e=I.LockupBacking.Knockout;break;default:e=I.LockupBacking.SVGBackground,o=t}return{backing:e,artworkID:o}},k.lockupStyleToLockupStyleAttributes=function(t,e){var o,r=new k.LockupStyleAttributes,i=F.Host.fontProvider.getIncludedFonts(e);r.shadowAngle=t.shadowAngle;var a,n,l,s,c,u,h=-1;(a=t.font)&&(h=(o=i.indexOf(a.fontData))||null!=o?o:-1),r.font=h,r.spacing=t.spacing,r.tracking=t.tracking,r.padding=t.padding,r.textLook=t.textLookAsString,r.shadowOffset=t.shadowOffset,r.strokeWeight=t.strokeWeight,null!=(n=t.colors.colorID(T.ColorRole.FieldPrimary))&&(r.primaryColor=n),null!=(l=t.colors.colorID(T.ColorRole.FieldSecondary))&&(r.secondaryColor=l),null!=(s=t.colors.colorID(T.ColorRole.Border))&&(r.borderColor=s),null!=(c=t.colors.colorID(T.ColorRole.Shadow))&&(r.shadowColor=c),r.textOpacity=t.textOpacity,r.backingOpacity=t.backingOpacity;var g=t.layout;if(I.LockupStyle.isLetterGrid(g)||g==I.LockupLayout.Standard){var p=I.LockupStyle.isLetterGrid(g)?"letter-grid-":"";switch(t.alignment){case 0:u=p+"left";break;case 1:u=p+"right";break;case 2:u=p+"center";break;default:E.LegacyCoreAssert.fail("Unexpected alignment",{alignment:t.alignment},"lockupStyleToLockupStyleAttributes","LockupStyleController.swift",638),u=p+"left"}}else if(I.LockupStyle.isAutoLayout(g)){u="auto"+t.alignment}else if(I.LockupStyle.isPath(g)){u="path"+t.pathID}else u="fill";return r.layout=u,r.backing=k.getBackingStringForBackingEnumAndArtworkId(t.backing,t.backingArtworkID),r.wheelUsed=t.wheelUsed,r},k.lockupStyleAttributesToLockupStyle=function(t,e,o){var r,i,a,n=null,l=t.font;(E.LegacyCoreAssert.isTrue(l>-1,"lockupStyleAttributesToLockupStyle called with no font. It is valid for a character style to have no font but this function doesn't work for character styles ",void 0,"lockupStyleAttributesToLockupStyle","LockupStyleController.swift",680),l>-1)&&((a=F.Host.fontProvider.getIncludedFonts(o).fontAt(l))&&(n=q.TypeLockupUtils.createTheoFont(a,F.Host.brandkitManager.brandkitForDocument(o))));var s,c,u,h=T.ColorTable.init_25f6([{key:T.ColorRole.FieldPrimary,value:t.primaryColor},{key:T.ColorRole.FieldSecondary,value:t.secondaryColor},{key:T.ColorRole.Border,value:t.borderColor},{key:T.ColorRole.Shadow,value:t.shadowColor}]),g=I.LockupAlignment.UNSET,p=Z.TextPathID.UNSET,d=null;if(t.layout.startsWith("path"))s=I.LockupLayout.Path,null!=(c=S.toInt(t.layout.substr("path".length)))&&(p=(r=Z.TextPathID.toCaseValue(c))||null!=r?r:Z.TextPathID.UNSET)==Z.TextPathID.Custom&&(u=e.customPath)&&(d=u);else if(t.layout.startsWith("auto")){var y;s=I.LockupLayout.Auto,null!=(y=S.toInt(t.layout.substr("auto".length)))&&(g=(i=I.LockupAlignment.toCaseValue(y))||null!=i?i:I.LockupAlignment.UNSET)}else switch(t.layout){case"left":s=I.LockupLayout.Standard,g=I.LockupAlignment.Left;break;case"right":s=I.LockupLayout.Standard,g=I.LockupAlignment.Right;break;case"center":s=I.LockupLayout.Standard,g=I.LockupAlignment.Center;break;case"letter-grid-left":s=I.LockupLayout.LetterGrid,g=I.LockupAlignment.Left;break;case"letter-grid-right":s=I.LockupLayout.LetterGrid,g=I.LockupAlignment.Right;break;case"letter-grid-center":s=I.LockupLayout.LetterGrid,g=I.LockupAlignment.Center;break;case"fill":default:s=I.LockupLayout.FitJustified}var f=k.getBackingEnumAndArtworkIdForBackingString(t.backing),L=k.getTextLook(t),C=t.wheelUsed,m=t.relativeFontScale,A=I.LockupStyle.init_f3fd(t.textOpacity,t.backingOpacity,h,n,t.spacing,t.tracking,t.padding,f.backing,f.artworkID,t.shadowAngle,s,g,L,t.shadowOffset,t.strokeWeight,p,d,C,m);return A.setCharacterStyles(e.characterStyles),A},k.randomDbl=function(){return S.toDouble(v.CoreRandom.nextInt)/S.toDouble(v.CoreRandom.randMax)},k.getWeightedIndex=function(t,e){for(var o=t.length,r=e*k.randomDbl(),i=0,a=0,n=S.iter(S.range(0,o,!1));!n.done;n.next()){var l=n.value;if((i+=t[l])>=r){a=l;break}}return a},k.selectWeightedValue=function(t,e,o,r,i){var a,n=r,l=S.clone(o);return null!=(a=S.indexOf(e,t))&&o[a]>0&&(l[a]+=n*i,n+=n*i),e[k.getWeightedIndex(l,n)]},k.WeightedAttributeSelector=S.defineProtocol("WeightedAttributeSelector",{inertiaRatio:"Double",forma:"Forma",pageData:"InterestingPageData",values:"Array<TypeAlias>",weights:"Array<Double>",weightSum:"Double",scoreValue:"(TypeAlias) -> Double",updateWeights:"(InterestingPageData) -> Void",select:"(LockupStyleAttributes, Boolean, Boolean, Boolean, Boolean) -> TypeAlias"}),k.WeightedFontSelector=(n=function t(e,o){this.inertiaRatio=1,this.weights=[],this.weightSum=0,this.machineRecommend=!0;var r=this;this.forma=e,this.pageData=o,this.listOfFonts=F.Host.fontProvider.getIncludedFonts(e.page.document),this.values=S.toArray(S.range(0,this.listOfFonts.count,!1));var i=this.listOfFonts.revisionNumber,a=this.listOfFonts.fontSetID;i==t.cacheRevisionNumber&&a==t.cacheFontSetID?this.fontPairingMatrix=S.clone(t.fontPairingMatrixCache):(this.fontPairingMatrix={},t.fontPairingMatrixCache={},S.each(k.getFontPairingMatrix(this.listOfFonts),(function(e,o){r.fontPairingMatrix[e]=S.clone(o),t.fontPairingMatrixCache[e]=S.clone(o)})),t.cacheRevisionNumber=i,t.cacheFontSetID=a)},S.defineClass({name:"WeightedFontSelector",ctor:n,statics:{cacheRevisionNumber:0,cacheFontSetID:"charlie",_implements:function(t){return"WeightedAttributeSelector"==t}},props:{updateWeights:function(t){this.pageData=t;var e=!1;if(this.values.length!=F.Host.fontProvider.getIncludedFonts(this.forma.page.document).count&&(this.listOfFonts=F.Host.fontProvider.getIncludedFonts(this.forma.page.document),this.values=S.toArray(S.range(0,this.listOfFonts.count,!1)),e=!0),this.machineRecommend){var o,r=new O.FontSuggester;(o=r.getFontFeatures(t,this.forma))?(e&&r.clearCache(),this.weights=S.clone(r.getScores(this.listOfFonts,o))):this.weights=this.values.map(this.scoreValue,this)}0!=this.machineRecommend&&1!=(new G.SuggestionUtils).weightsEqualNaNOrEmpty(this.weights)||(this.weights=this.values.map(this.scoreValue,this)),this.weightSum=this.weights.reduce((function(t,e){return t+e}),0)},getTopFonts:function(t){E.LegacyCoreAssert.isTrue(t<this.listOfFonts.count,"cannot get top fonts more than total number",void 0,"WeightedFontSelector.getTopFonts","LockupStyleController.swift",963);for(var e=[],o=S.iter(S.toSequence(this.weights));!o.done;o.next()){var r=o.value,i=r.offset,a=r.element;e.push([a,i])}e=S.sort(e,(function(t,e){return t[0]>e[0]}));for(var n=[],l=0,s=S.iter(e);!s.done;s.next()){var c=s.value;if(!(l<t))break;n.push(this.listOfFonts.fontAt(c[1])),l+=1}return n},scoreValue:function(t){return this.manuallyScoreValue(t)},manuallyScoreValue:function(t){var e=this.listOfFonts.fontAt(t),o=e.postScriptName,r=F.Host.fontProvider.descriptorForPostScriptName(o,_.ANY_DOCUMENT),i=this.pageData.selectedLockup.lineHeight;if(!F.Host.fontProvider.getSuggestableFonts(S.opt(this.forma,(function(t){return t.page.document}))).contains(e))return 0;for(var a=.1,n=S.iter(this.pageData.lockups);!n.done;n.next()){var l=n.value;if(l.id!=this.pageData.selectedLockup.id){var s=W.MathUtils.absDouble(i-l.lineHeight)/i,c=l.lineHeight>i,u=c?l.font:o,h=c?o:l.font;a+=k.getFontPairScore(this.fontPairingMatrix,u,h),o==l.font&&(a*=2,s<.5&&(a*=2))}}return a*=r.popularity,q.TypeLockupUtils.createTheoFont(e,F.Host.brandkitManager.brandkitForDocument(this.forma.page.document)).isSparkFont()&&(a*=2),i<40&&0==r.bodyAllowed&&(a=0),i>150&&0==r.displayAllowed&&(a=0),a},select:function(t,e,o,r,i){void 0===r&&(r=!1),void 0===i&&(i=!0);var a=t.font,n=o?this.inertiaRatio:0;return k.selectWeightedValue(a,this.values,this.weights,this.weightSum,n)}}}),n),k.WeightedLayoutSelector=(l=function(t,e){this.inertiaRatio=0,this.values=k.ALLOWED_LAYOUT_VALUES,this.weights=[],this.weightSum=0,this.forma=t,this.pageData=e},S.defineClass({name:"WeightedLayoutSelector",ctor:l,statics:{_implements:function(t){return"WeightedAttributeSelector"==t}},props:{updateWeights:function(t){this.pageData=t,this.weights=this.values.map(this.scoreValue,this),this.weightSum=this.weights.reduce((function(t,e){return t+e}),0)},scoreValue:function(t){var e=1,o=this.pageData.selectedLockup.aspectRatio,r=this.pageData.selectedLockup.wordCount,i=this.pageData.selectedLockup.id;"left"!=t&&"right"!=t||(r<=1||o>4?e=0:e*=.05),0==this.pageData.lockups.length&&("fill"==t&&(e*=5),"center"==t&&(e*=4)),"fill"==t&&this.pageData.selectedLockup.wordCount>10&&(e*=4/S.toDouble(this.pageData.selectedLockup.wordCount));var a=[];Y.TheoDocumentUtils.enableFastHeuristicsForComplexPage(this.forma.page)||(a=S.clone(f.AlignmentDetector.init_a05b(this.forma).detectFormaAlignments(20)));for(var n=!1,l=!1,s=S.iter(a);!s.done;s.next()){var c=s.value;c.line.type==f.AlignmentType.Left&&(n=!0),c.line.type==f.AlignmentType.Right&&(l=!0)}n&&!l&&"left"==t&&(e=2.5),l&&!n&&"right"==t&&(e=2.5);for(var u=S.iter(this.pageData.lockups);!u.done;u.next()){var h=u.value;h.id!=i&&t==h.styleAttributes.layout&&(e*=k.LAYOUT_COUNT_SCALE/2)}return e},select:function(t,e,o,r,i){void 0===r&&(r=!1),void 0===i&&(i=!0);var a=t.layout,n=o?this.inertiaRatio:0;return k.selectWeightedValue(a,this.values,this.weights,this.weightSum,n)}}}),l),k.WeightedBackingSelector=(s=function(t,e){this.inertiaRatio=1,this.values=k.ALLOWED_BACKING_VALUES,this.weights=[],this.weightSum=0,this.machineRecommend=!0,this.forma=t,this.pageData=e},S.defineClass({name:"WeightedBackingSelector",ctor:s,statics:{_implements:function(t){return"WeightedAttributeSelector"==t}},props:{updateWeights:function(t){if(this.pageData=t,C.CoreAssertDebugOnly.isTrue(null!=this.forma,"nil forma in WeightedBackingSelector.updateWeights",void 0,"WeightedBackingSelector.updateWeights","LockupStyleController.swift",1301),1==this.machineRecommend&&null!=this.forma){var e=new V.ShapeSuggester,o=S.clone(e.getShapeSuggesterFeatures(t,this.forma));this.weights=S.clone(e.getScores(this.values,o))}0!=this.machineRecommend&&1!=(new G.SuggestionUtils).weightsEqualNaNOrEmpty(this.weights)||(this.weights=this.values.map(this.scoreValue,this)),this.weightSum=this.weights.reduce((function(t,e){return t+e}),0)},scoreValue:function(t){var e=this.pageData.selectedLockup,o=this.pageData.largestLineHeightLockup,r=e.lineHeight,i=o.id==e.id,a=N.ShapeLibrary.shapeDictionary[t]||N.ShapeLibrary.shapeDictionary.none,n=1;if(a.premium)return 0;if(N.ShapeLibrary.NonSuggestableBackingShapes.includes(t))return 0;this.pageData.lockups.length>0&&k.BACKING_SHAPES_SVG.includes(t)&&(n*=.1);for(var l=S.iter(this.pageData.lockups);!l.done;l.next()){var s,c=l.value;c.id!=e.id&&(W.MathUtils.absDouble(r-c.lineHeight)/r<.4&&(n*=3),(s=N.ShapeLibrary.shapeDictionary[c.styleAttributes.backing])&&(n*=(11-S.toDouble(W.MathUtils.absInt(a.formality-s.formality)))/2,n*=(11-S.toDouble(W.MathUtils.absInt(a.drama-s.drama)))/2))}var u,h=W.MathUtils.maxDouble(e.width/this.pageData.width,e.height/this.pageData.height);if(a.maxScale<1&&h>a.maxScale&&(n=0),(a.maxAspect<e.aspectRatio||a.minAspect>e.aspectRatio)&&(n=0),0==i&&(u=N.ShapeLibrary.shapeDictionary[o.styleAttributes.backing])){var g=u.drama;a.drama<g&&(n*=2)}return"none"==t&&(n*=10),"row"==t&&(n*=10),this.pageData.lightnessSpreadBehindSelectedLockup>=20&&0==a.filled&&(n*=.01),n},select:function(t,e,o,r,i){void 0===r&&(r=!1),void 0===i&&(i=!0);var a=this.values.length,n=S.clone(this.weights),l=t.layout,s="center"==l||"fill"==l,c=!1,u=F.Host.fontProvider.getIncludedFonts(this.forma.page.document).fontAt(t.font),h=this.pageData.selectedLockup.width/this.pageData.selectedLockup.height,g=!0,p=this.pageData.selectedLockup.originalBacking;"none"!=p&&"shadow"!=p&&"row"!=p||(g=!1),"knockout"==t.backing&&(g=!1);for(var d=S.iter(this.pageData.lockups);!d.done;d.next()){var y,f=d.value,L=f.styleAttributes.backing;f.id!=this.pageData.selectedLockup.id&&("none"!=L&&(c=!0),t.font==f.styleAttributes.font&&null!=(y=S.indexOf(k.ALLOWED_BACKING_VALUES,L))&&(n[y]*=5))}for(var C=S.iter(S.range(0,a,!1));!C.done;C.next()){var m,A=C.value,v=this.values[A];if(m=N.ShapeLibrary.shapeDictionary[v]){s&&1==m.centered&&(n[A]*=5),h>4&&m.category==N.ShapeCategory.Circle&&(n[A]*=0),h<4&&m.category==N.ShapeCategory.Banner&&(n[A]*=0),m.category!=N.ShapeCategory.Cutout&&m.category!=N.ShapeCategory.Avoid||(n[A]*=0),"knockoutOnly"!=t.textLook||"none"!=v&&"shadow"!=v||(n[A]*=0);var b=S.toDouble(10-W.MathUtils.absInt(u.formality-m.formality));n[A]*=b/5;var D=S.toDouble(10-W.MathUtils.absInt(u.drama-m.drama));n[A]*=D/5,c&&"row"!=v&&"none"!=v&&(n[A]/=5)}}var T=t.backing,w=o?this.inertiaRatio:0,x=n.reduce((function(t,e){return t+e}),0);return T=1==g?k.selectWeightedValue(T,this.values,n,x,w):p}}}),s),k.WeightedShadowAngleSelector=(c=function(t,e){this.inertiaRatio=1,this.values=k.ALLOWED_SHADOWANGLE_VALUES,this.weights=[],this.weightSum=0,this.foo=4,this.forma=t,this.pageData=e},S.defineClass({name:"WeightedShadowAngleSelector",ctor:c,statics:{_implements:function(t){return"WeightedAttributeSelector"==t}},props:{updateWeights:function(t){this.pageData=t,this.weights=this.values.map(this.scoreValue,this),this.weightSum=this.weights.reduce((function(t,e){return t+e}),0)},scoreValue:function(t){return 1},select:function(t,e,o,r,i){void 0===r&&(r=!1),void 0===i&&(i=!0);var a=t.shadowAngle,n=o?this.inertiaRatio:0;return k.selectWeightedValue(a,this.values,this.weights,this.weightSum,n)}}}),c),k.WeightedPaddingSelector=(u=function(t,e){this.inertiaRatio=1,this.values=k.ALLOWED_PADDING_VALUES,this.weights=[],this.weightSum=0,this.forma=t,this.pageData=e},S.defineClass({name:"WeightedPaddingSelector",ctor:u,statics:{_implements:function(t){return"WeightedAttributeSelector"==t}},props:{updateWeights:function(t){this.pageData=t,this.weights=this.values.map(this.scoreValue,this),this.weightSum=this.weights.reduce((function(t,e){return t+e}),0)},scoreValue:function(t){var e=this.pageData.selectedLockup,o=1,r=1;if(0==this.pageData.lockups.length)r=W.MathUtils.absDouble(t-I.LockupStyle.DEFAULT_PADDING);else for(var i=S.iter(this.pageData.lockups);!i.done;i.next()){var a=i.value;r=W.MathUtils.minDouble(r,W.MathUtils.absDouble(t-a.styleAttributes.padding))}o*=W.MathUtils.maxDouble(1/(r+.1),.05);var n=W.MathUtils.maxDouble(e.width/this.pageData.width,e.height/this.pageData.height)+t;return o/=4*W.MathUtils.absDouble(n-1)},select:function(t,e,o,r,i){void 0===r&&(r=!1),void 0===i&&(i=!0);var a=t.padding,n=o?this.inertiaRatio:0;return k.selectWeightedValue(a,this.values,this.weights,this.weightSum,n)}}}),u),k.WeightedSpacingSelector=(h=function(t,e){this.inertiaRatio=1,this.values=k.ALLOWED_SPACING_VALUES,this.weights=[],this.weightSum=0,this.forma=t,this.pageData=e},S.defineClass({name:"WeightedSpacingSelector",ctor:h,statics:{_implements:function(t){return"WeightedAttributeSelector"==t}},props:{updateWeights:function(t){this.pageData=t,this.weights=this.values.map(this.scoreValue,this),this.weightSum=this.weights.reduce((function(t,e){return t+e}),0)},scoreValue:function(t){var e=1,o=1;if(0==this.pageData.lockups.length)o=W.MathUtils.absDouble(t-I.LockupStyle.DEFAULT_SPACING);else for(var r=S.iter(this.pageData.lockups);!r.done;r.next()){var i=r.value;o=W.MathUtils.minDouble(o,W.MathUtils.absDouble(t-i.styleAttributes.spacing))}return e*=W.MathUtils.maxDouble(1/(o+.1),.05)},select:function(t,e,o,r,i){void 0===r&&(r=!1),void 0===i&&(i=!0);var a=t.spacing,n=o?this.inertiaRatio:0;return k.selectWeightedValue(a,this.values,this.weights,this.weightSum,n)}}}),h),k.PrimaryColorSelector=(g=function t(e,o){this.inertiaRatio=1,this.weights=[],this.weightSum=0,this.forma=e,this.pageData=o,this.values=S.clone(t.updateColorValues(e))},S.defineClass({name:"PrimaryColorSelector",ctor:g,statics:{updateColorValues:function(t){var e;return(e=t)?e.page.colorLibraryController.getThemeColorKeys().concat(m.ColorLibraryController.THEME_DERIVED_BW_KEYS).concat(e.page.colorLibraryController.getProfilingColorKeys()):[]},_implements:function(t){return"WeightedAttributeSelector"==t}},props:{updateWeights:function(t){this.pageData=t,this.values=S.clone(g.updateColorValues(this.forma)),this.weights=this.values.map(this.scoreValue,this),this.weightSum=this.weights.reduce((function(t,e){return t+e}),0)},scoreValue:function(t){return"themeDerivedDark"==t?.1:1},select:function(t,e,o,r,i){void 0===r&&(r=!1),void 0===i&&(i=!0);var a=(N.ShapeLibrary.shapeDictionary[t.backing]||N.ShapeLibrary.shapeDictionary.none).filled||"fill"!=t.textLook;this.updateWeights(this.pageData);for(var n=this.values.length,l=t.primaryColor,s=S.clone(this.weights),c=new b.ColorRankSuggester,u=[],h=S.iter(S.range(0,n,!1));!h.done;h.next()){var g,p=h.value;(g=this.forma.page.colorLibraryController.getSolidColorForKey(this.values[p]))&&u.push(g)}if(E.LegacyCoreAssert.isTrue(n==u.length,"not all value colors were added.",void 0,"PrimaryColorSelector.select","LockupStyleController.swift",1932),n!=u.length)return l;var d=[];if(0==a){this.pageData.ensureCorrectBackgroundColors(this.forma);for(var y=S.iter(this.pageData.colorsBehindSelectedLockup);!y.done;y.next()){var f=y.value;d.push(b.ColorForComparison.init_c063(f,1))}}else{var L;(L=this.forma.page.colorLibraryController.getSolidColorForKey(t.secondaryColor))&&d.push(b.ColorForComparison.init_c063(L,1))}r&&(L=this.forma.page.colorLibraryController.getSolidColorForKey(t.primaryColor))&&d.push(b.ColorForComparison.init_c063(L,.33)),s=S.clone(c.weightedColorContrastRanker(d,u,i));var C=(s=S.clone((new G.SuggestionUtils).normalizedWeights(s))).reduce((function(t,e){return t+e}),0),m=o?this.inertiaRatio:0;return k.selectWeightedValue(l,this.values,s,C,m)}}}),g),k.SecondaryColorSelector=(p=function t(e,o){this.inertiaRatio=0,this.weights=[],this.weightSum=0,this.forma=e,this.pageData=o,this.values=S.clone(t.updateColorValues(e))},S.defineClass({name:"SecondaryColorSelector",ctor:p,statics:{updateColorValues:function(t){var e,o=[];if(e=t)for(var r=e.page.colorLibraryController.getThemeColorKeys().concat(m.ColorLibraryController.THEME_DERIVED_BW_KEYS),i=S.iter(r);!i.done;i.next()){var a=i.value;null!=e.page.colorLibraryController.getSolidColorForKey(a)?o.push(a):C.CoreAssertDebugOnly.fail("library has missing color",{key:a},"SecondaryColorSelector.updateColorValues","LockupStyleController.swift",2018)}return o},_implements:function(t){return"WeightedAttributeSelector"==t}},props:{updateWeights:function(t){this.pageData=t,this.values=S.clone(p.updateColorValues(this.forma)),this.weights=this.values.map(this.scoreValue,this),this.weightSum=this.weights.reduce((function(t,e){return t+e}),0)},scoreValue:function(t){return 1},select:function(t,e,o,r,i){void 0===r&&(r=!1),void 0===i&&(i=!0);var a=t.secondaryColor,n=(N.ShapeLibrary.shapeDictionary[t.backing]||N.ShapeLibrary.shapeDictionary.none).filled;this.updateWeights(this.pageData);for(var l=this.values.length,s=S.clone(this.weights),c=new b.ColorRankSuggester,u=[],h=S.iter(S.range(0,l,!1));!h.done;h.next()){var g,p=h.value;(g=this.forma.page.colorLibraryController.getSolidColorForKey(this.values[p]))?u.push(g):C.CoreAssertDebugOnly.fail("failed to get SolidColor",{key:this.values[p],colorCount:l,numColorKeys:this.forma.page.colorLibraryController.getNumThemeColorKeys()},"SecondaryColorSelector.select","LockupStyleController.swift",2066)}if(E.LegacyCoreAssert.isTrue(l==u.length,"not all value colors were added.",void 0,"SecondaryColorSelector.select","LockupStyleController.swift",2073),l!=u.length)return a;var d=[];if(r&&n){var y;(y=this.forma.page.colorLibraryController.getSolidColorForKey(t.secondaryColor))&&d.push(b.ColorForComparison.init_c063(y,1))}else{this.pageData.ensureCorrectBackgroundColors(this.forma);for(var f=S.iter(this.pageData.colorsBehindSelectedLockup);!f.done;f.next()){var L=f.value;d.push(b.ColorForComparison.init_c063(L,1))}}s=S.clone(c.weightedColorContrastRanker(d,u,i));var m=(s=S.clone((new G.SuggestionUtils).normalizedWeights(s))).reduce((function(t,e){return t+e}),0),A=o?this.inertiaRatio:0;return k.selectWeightedValue(a,this.values,s,m,A)}}}),p),k.LockupStyleController=(d=function(t){this._sessionAttrs=new k.SessionAttrs,this.hasScoresForAttributes=!1,this.forma=t,this.targetedLockupStyleName_="",this.pageData=new k.InterestingPageData(t),this.fontSelector=new k.WeightedFontSelector(t,this.pageData),this.layoutSelector=new k.WeightedLayoutSelector(t,this.pageData),this.backingSelector=new k.WeightedBackingSelector(t,this.pageData),this.primaryColorSelector=new k.PrimaryColorSelector(t,this.pageData),this.profilingBackgroundColorSelector=new D.ProfilingBackgroundColorSelector(t,!0),this.profilingPrimaryColorSelector=new D.ProfilingPrimaryColorSelector(t,!1),this.secondaryColorSelector=new k.SecondaryColorSelector(t,this.pageData),this.shadowAngleSelector=new k.WeightedShadowAngleSelector(t,this.pageData),this.spacingSelector=new k.WeightedSpacingSelector(t,this.pageData),this.paddingSelector=new k.WeightedPaddingSelector(t,this.pageData),A.CoreObject.call(this)},S.defineClass({name:"LockupStyleController",ctor:d,superName:"CoreObject",props:{targetedLockupStyleName:{get:function(){var t;return((t=S.opt(S.opt(S.opt(this.forma,(function(t){return t.page.document})),(function(t){return t.controller})),(function(t){return t.selection.inCharStyleMode})))||null!=t)&&t?j.TypeLockupController.HIGHLIGHT_STYLE:""}},targetedLockupStyle:{get:function(){return""!=this.targetedLockupStyleName?this.forma.controller.getCharacterStyle(this.targetedLockupStyleName):this.forma.style}},targetedFont:{get:function(){var t;return(t=this.targetedLockupStyle.font)?t:this.forma.style.font}},targetedShadowAngle:{get:function(){return this.forma.style.shadowAngle},set:function(t){this.forma.style.shadowAngle=t}},targetedShadowOffset:{get:function(){return this.forma.style.shadowOffset},set:function(t){this.forma.style.shadowOffset=t}},targetedStrokeWeight:{get:function(){return this.forma.style.strokeWeight},set:function(t){this.forma.style.strokeWeight=t}},targetedTextLook:{get:function(){return this.targetedLockupStyle.textLook!=I.LockupTextLook.UNSET?this.targetedLockupStyle.textLook:this.forma.style.textLook}},updateScoring:function(){this.pageData=new k.InterestingPageData(this.forma),this.fontSelector.updateWeights(this.pageData),this.layoutSelector.updateWeights(this.pageData),this.backingSelector.updateWeights(this.pageData),this.primaryColorSelector.updateWeights(this.pageData),this.secondaryColorSelector.updateWeights(this.pageData),this.shadowAngleSelector.updateWeights(this.pageData),this.spacingSelector.updateWeights(this.pageData),this.paddingSelector.updateWeights(this.pageData),this.profilingPrimaryColorSelector.updateBackgroundColors(this.pageData.colorsBehindSelectedLockup),this.profilingBackgroundColorSelector.updateBackgroundColors(this.pageData.colorsBehindSelectedLockup),this.hasScoresForAttributes=!0},getRecommendedFonts:function(){return this.fontSelector.getTopFonts(10)},onlineLearning:function(t){var e,o=new O.FontSuggester;(e=o.getFontFeatures(this.pageData,this.forma))&&o.onlineLearning(t,e)},getDominantColorRole:function(){var t,e=k.lockupStyleToLockupStyleAttributes(this.targetedLockupStyle,this.forma.page.document).backing,o=T.ColorRole.FieldPrimary;return(t=N.ShapeLibrary.shapeDictionary[e])&&1==t.filled&&(o=T.ColorRole.FieldSecondary),o},fixUpColors:function(){var t;if((t=S.as(this.forma.controller,j.TypeLockupController))&&t.secondaryColorVisible()&&this.targetedLockupStyle.textBacked&&this.targetedLockupStyle.backing!=I.LockupBacking.UNSET){var e=this.targetedLockupStyle.colors.colorID(T.ColorRole.FieldPrimary),o=this.targetedLockupStyle.colors.colorID(T.ColorRole.FieldSecondary),r=this.calculateContrastingSecondaryColorID();null!=r&&r!=o&&r!=e&&null!=this.forma.page.colorLibraryController.getSolidColorForKey(r)&&(o=r),q.TypeLockupUtils.fixUpColors(this.targetedLockupStyle,o)}},calculateContrastingSecondaryColorID:function(){var t,e=this.targetedLockupStyle.colors.colorID(T.ColorRole.FieldPrimary),o=this.targetedLockupStyle.colors.colorID(T.ColorRole.FieldSecondary);if(null!=e&&e==o&&(t=this.forma.page.colorLibraryController.getSolidColorForKey(e)))for(var r=S.iter(this.forma.page.colorLibraryController.getThemeColorKeys().concat(m.ColorLibraryController.THEME_DERIVED_BW_KEYS));!r.done;r.next()){var i,a=r.value;if(a!=e&&(i=this.forma.page.colorLibraryController.getSolidColorForKey(a))&&i.contrasts(t,!1)){o=a;break}}return o},fixUpBackingShape:function(){var t,e,o=this.forma.style;if((t=N.ShapeLibrary.shapeDictionary[k.getBackingStringForBackingEnumAndArtworkId(o.backing,o.backingArtworkID)])&&(e=N.ShapeLibrary.shapeDictionary[k.getBackingStringForBackingEnumAndArtworkId(this.targetedLockupStyle.backing,this.targetedLockupStyle.backingArtworkID)])){if(I.LockupStyle.isKnockoutLook(this.targetedLockupStyle.textLook)){(this.targetedLockupStyle===this.forma.style?t.filled:I.LockupStyle.isLetterGrid(o.layout)?(this.targetedLockupStyle.backing!=I.LockupBacking.None?e:t).filled:t.filled||e.filled)||(S.opt(S.as(this.forma.controller,j.TypeLockupController),(function(t){return t.beginBlockedUpdate()})),this.targetedLockupStyle.backing=I.LockupBacking.SVGBackground,this.targetedLockupStyle.backingArtworkID="square_001",S.opt(S.as(this.forma.controller,j.TypeLockupController),(function(t){return t.endBlockedUpdate()})),S.opt(S.as(this.forma.controller,j.TypeLockupController),(function(t){return t.styleChanged()})))}!e.filled||this.targetedLockupStyle.textLook!=I.LockupTextLook.Shadow&&this.targetedLockupStyle.textLook!=I.LockupTextLook.ShadowAndOutline&&this.targetedLockupStyle.textLook!=I.LockupTextLook.FillAndOutline&&this.targetedLockupStyle.textLook!=I.LockupTextLook.FillAndOutline2&&this.targetedLockupStyle.textLook!=I.LockupTextLook.OutlineOnly||1!=this.targetedLockupStyle.backingOpacity||(this.targetedLockupStyle.backingOpacity=.5)}},getKnockoutColor:function(){var t,e,o=this.forma.style;return this.targetedLockupStyle!==this.forma.style&&(t=N.ShapeLibrary.shapeDictionary[k.getBackingStringForBackingEnumAndArtworkId(o.backing,o.backingArtworkID)])&&(e=N.ShapeLibrary.shapeDictionary[k.getBackingStringForBackingEnumAndArtworkId(this.targetedLockupStyle.backing,this.targetedLockupStyle.backingArtworkID)])&&(e.filled||!t.filled)?this.targetedLockupStyle.colors.fieldSecondary:o.colors.fieldSecondary},getTextLookForUI:function(){return this.targetedTextLook==I.LockupTextLook.FillAndOutline2||this.targetedTextLook==I.LockupTextLook.OutlineOnly?I.LockupTextLook.FillAndOutline:this.targetedTextLook},getStrokeWeightPercentForUI:function(){return 99*this.targetedStrokeWeight+1},getShadowOffsetPercentForUI:function(){return 99*this.targetedShadowOffset+1},setTextLook:function(t,e){void 0===e&&(e=!0),this.targetedLockupStyle!==this.forma.style&&t==this.forma.style.textLook?this.targetedLockupStyle.textLook=I.LockupTextLook.UNSET:(this.targetedLockupStyle.textLook=t,e&&(this.targetedLockupStyle.textLook==I.LockupTextLook.KnockoutAndShadow&&(135==this.targetedShadowAngle&&225==this.targetedShadowAngle||(this.targetedShadowAngle=135)),this.targetedLockupStyle.textLook==I.LockupTextLook.ShadowAndOutline?this.targetedShadowOffset=I.LockupStyle.DEFAULT_SHADOWOFFSET/2:this.targetedShadowOffset=I.LockupStyle.DEFAULT_SHADOWOFFSET,this.targetedLockupStyle.textLook==I.LockupTextLook.KnockoutAndOutline?this.targetedStrokeWeight=0:this.targetedStrokeWeight=I.LockupStyle.DEFAULT_STROKEWEIGHT)),this.fixUpColors(),this.fixUpBackingShape(),this.forma.controller.styleChanged()},applyBacking:function(t,e){var o,r,i,a,n,l;if((o=this.forma)&&(r=o.parent)&&(i=o.root)&&(a=o.page.document)&&(n=S.as(o.style,I.LockupStyle))&&(l=S.as(o.controller,j.TypeLockupController))){l.beginBlockedUpdate();var s=k.getBackingStringForBackingEnumAndArtworkId(t,e);L.BadgeFacade.logBackingShapeChange(o.source,s);var c,u=k.lockupStyleToLockupStyleAttributes(this.targetedLockupStyle,a),h=!1,g=!1,p=this.targetedLockupStyle.textLook;if(t==I.LockupBacking.Knockout){I.LockupStyle.isKnockoutLook(p)||(p=I.LockupTextLook.KnockoutOnly,u.textLook="knockoutOnly"),i.visitAll(w.FormaTraversal.PreOrder,(function(t){var e;(e=S.as(t.style,I.LockupStyle))&&e.backing==I.LockupBacking.Knockout&&(e.backing=I.LockupBacking.None,e.textLook=I.LockupTextLook.Fill)}));var d=S.clone(r.filterWithCallback((function(t){return(t.isBackgroundImage()||t.isShape())&&S.opt(t.controller,(function(t){return 0==t.floating}))}),w.FormaTraversal.JustChildren));r.insertChildAt(o,d.length)}this.targetedLockupStyle!==n&&((F=this.targetedLockupStyle).backing==I.LockupBacking.UNSET&&(E.LegacyCoreAssert.isTrue(I.LockupStyle.isLetterGrid(n.layout),"LockupBacking.UNSET in secondary styles for non-letter-grid layouts?",void 0,"LockupStyleController.applyBacking","LockupStyleController.swift",2551),F.padding=n.padding),t==I.LockupBacking.None||t==I.LockupBacking.Rows||t==I.LockupBacking.SVGBackground?(F.backing=t,F.backingArtworkID=e):t==I.LockupBacking.Knockout&&(F.backing=I.LockupBacking.UNSET,p=I.LockupTextLook.KnockoutOnly),u=k.lockupStyleToLockupStyleAttributes(F,a),s=k.getBackingStringForBackingEnumAndArtworkId(F.backing,F.backingArtworkID),p=F.textLook),u.backing!=s&&(c=N.ShapeLibrary.shapeDictionary[s])&&u.secondaryColor==u.borderColor&&u.secondaryColor==u.shadowColor&&(h=k.needsContrastingColor(s,p,c.filled),c.filled||p==I.LockupTextLook.FillAndOutline||p==I.LockupTextLook.FillAndOutline2||(g=!0)),u.backing=s;var y=this.cloneOpacityAttributes(u);if(h&&(D=o.page.colorLibraryController.getSolidColorForKey(u.secondaryColor))&&(b=o.page.colorLibraryController.getSolidColorForKey(u.primaryColor))){var f=k.getBackingOpacity(u);f==B.FormaStyle.OPACITY_UNSET&&(f=k.getBackingOpacity(k.lockupStyleToLockupStyleAttributes(n,a)));for(var C=!0,m=S.iter(this.pageData.colorsBehindSelectedLockup);!m.done;m.next()){var A=m.value.blend(D,f);if(!k.hasSufficientLegibilityContrast(b,A)){C=!1;break}}if(!C){var v=this.getContrastingColorKey(u.secondaryColor,u.primaryColor);y.secondaryColor=v,u.secondaryColor==u.borderColor&&u.secondaryColor==u.shadowColor&&k.changeBorderAndShadowToSecondary(y)}}if(g){var b,D,T,x=u.primaryColor,O=u.secondaryColor;(b=o.page.colorLibraryController.getSolidColorForKey(x))&&(this.pageData.isColorVisibleAgainstBackground(b)||(D=o.page.colorLibraryController.getSolidColorForKey(O))&&(this.pageData.isColorVisibleAgainstBackground(D)&&!S.opt(N.ShapeLibrary.shapeDictionary[s],(function(t){return t.category==N.ShapeCategory.Cutout}))?(y.primaryColor=O,y.secondaryColor=x,k.changeBorderAndShadowToSecondary(y)):null!=(T=this.getThemeColorContrastingWithBackground())&&(y.primaryColor=T)))}if(this.targetedLockupStyle!==n){var F;(F=this.targetedLockupStyle).textOpacity!=B.FormaStyle.OPACITY_UNSET&&(F.textOpacity=y.textOpacity),F.shapeSupportsKnockout||n.shapeSupportsKnockout||I.LockupStyle.isKnockoutLook(F.textLook)&&(F.textLook=z.TextFacade.getNewTextLookForKnockoutChange(F.textLook,this,!0)),t==I.LockupBacking.None&&(F.backingOpacity=B.FormaStyle.OPACITY_DEFAULT),this.pickVisibleColorsForCharStyle()}else{var _=k.lockupStyleAttributesToLockupStyle(y,n,a);if(!_.shapeSupportsKnockout){I.LockupStyle.isKnockoutLook(_.textLook)&&(_.textLook=z.TextFacade.getNewTextLookForKnockoutChange(_.textLook,this,!0));for(var P=S.iter(_.characterStyles);!P.done;P.next()){var R=P.value;!R.shapeSupportsKnockout&&I.LockupStyle.isKnockoutLook(R.textLook)&&(R.textLook=z.TextFacade.getNewTextLookForKnockoutChange(R.textLook,this,!0))}}t==I.LockupBacking.None&&(_.backingOpacity=B.FormaStyle.OPACITY_DEFAULT),o.applyStyle(_)}l.endBlockedUpdate(),l.styleChanged(),this.onBackingShapeChanged()}},switchPrimaryColorAndSecondaryColor:function(){var t,e=!1;if(t=S.as(S.opt(this.forma,(function(t){return t.style})),I.LockupStyle)){var o=k.lockupStyleToLockupStyleAttributes(t,this.forma.page.document),r=this.forma.page.colorLibraryController.getSolidColorForKey(o.primaryColor),i=this.forma.page.colorLibraryController.getSolidColorForKey(o.secondaryColor);if(null!=r&&null!=i){var a=o.primaryColor;o.primaryColor=o.secondaryColor,o.secondaryColor=a,k.changeBorderAndShadowToSecondary(o);var n=k.lockupStyleAttributesToLockupStyle(o,this.forma.style,this.forma.page.document);this.forma.applyStyle(n),e=!0}}return e},getContrastingThemeColorBasedOnSolidColor:function(t,e){if(void 0===e&&(e=null),null==t)return null;for(var o=this.forma.page.colorLibraryController,r=S.iter(o.getThemeColorKeys().concat(m.ColorLibraryController.THEME_DERIVED_BW_KEYS));!r.done;r.next()){var i,a=r.value;if((i=o.getSolidColorForKey(a))&&i.contrasts(t,!1)&&!i.isEqual(e))return a}return null},getThemeColorContrastingWithBackground:function(t){void 0===t&&(t=null);for(var e=this.forma.page.colorLibraryController,o=S.iter(e.getThemeColorKeys().concat(m.ColorLibraryController.THEME_DERIVED_BW_KEYS));!o.done;o.next()){var r,i=o.value;if((r=e.getSolidColorForKey(i))&&(null==t||!r.isEqual(t))){for(var a=!0,n=S.iter(this.pageData.colorsBehindSelectedLockup);!n.done;n.next()){var l=n.value;if(!r.contrasts(l,!1)){a=!1;break}}if(a)return i}}return null},doesLockupContrastWithBackground:function(){var t,e=!0;if(t=S.as(S.opt(this.forma,(function(t){return t.style})),I.LockupStyle)){var o=k.lockupStyleToLockupStyleAttributes(t,this.forma.page.document),r=this.forma.page.colorLibraryController.getSolidColorForKey(o.primaryColor),i=this.forma.page.colorLibraryController.getSolidColorForKey(o.secondaryColor);t.secondaryColorVisible?t.textBacked?null!=r&&null!=i&&(e=this.pageData.isColorVisibleAgainstBackground(i)&&r.contrasts(i,!1)):null!=r&&null!=i&&(e=this.pageData.isColorVisibleAgainstBackground(r)&&this.pageData.isColorVisibleAgainstBackground(i)):null!=r&&(e=this.pageData.isColorVisibleAgainstBackground(r))}return e},pickVisibleColorsForLockup:function(){var t=this.pickVisibleColorsForTextAndShape(),e=this.pickVisibleColorsForCharStyle(),o=t||e;return o&&this.forma.controller.styleChanged(),o},pickVisibleColorsForTextAndShape:function(){if(this.doesLockupContrastWithBackground())return!1;if(this.switchPrimaryColorAndSecondaryColor()){if(this.doesLockupContrastWithBackground())return!0;this.switchPrimaryColorAndSecondaryColor()}var t,e=!1;if(t=S.as(S.opt(this.forma,(function(t){return t.style})),I.LockupStyle)){var o=k.lockupStyleToLockupStyleAttributes(t,this.forma.page.document),r=this.forma.page.colorLibraryController.getSolidColorForKey(o.primaryColor),i=this.forma.page.colorLibraryController.getSolidColorForKey(o.secondaryColor);if(t.secondaryColorVisible){if(t.textBacked){if(null!=r&&null!=i)if(this.pageData.isColorVisibleAgainstBackground(i))r.contrasts(i,!1)||null!=(a=this.getContrastingThemeColorBasedOnSolidColor(i))&&(o.primaryColor=a,e=!0);else if(null!=(l=this.getThemeColorContrastingWithBackground())){o.secondaryColor=l;var a,n=this.forma.page.colorLibraryController.getSolidColorForKey(o.secondaryColor);e=!0,k.hasSufficientLegibilityContrast(r,n)||null!=(a=this.getContrastingThemeColorBasedOnSolidColor(n))&&(o.primaryColor=a)}}else if(null!=r&&null!=i){var l;this.pageData.isColorVisibleAgainstBackground(r)||null!=(l=this.getThemeColorContrastingWithBackground())&&(o.primaryColor=l,e=!0),this.pageData.isColorVisibleAgainstBackground(i)||(r.isEqual(i)?(o.secondaryColor=o.primaryColor,e=!0):null!=(l=this.getThemeColorContrastingWithBackground(r))?(o.secondaryColor=l,e=!0):(o.secondaryColor=o.primaryColor,e=!0))}}else null!=r&&(this.pageData.isColorVisibleAgainstBackground(r)||null!=(l=this.getThemeColorContrastingWithBackground())&&(o.primaryColor=l,e=!0));if(e){k.changeBorderAndShadowToSecondary(o);var s=k.lockupStyleAttributesToLockupStyle(o,this.forma.style,this.forma.page.document);this.forma.applyStyle(s)}}return e},pickVisibleColorsForCharStyle:function(){var t,e=!1;if(t=S.as(S.opt(this.forma,(function(t){return t.style})),I.LockupStyle)){if(0==S.count(t.characterStyles))return e;for(var o=I.LockupStyle.isKnockoutLook(t.textLook)?"":t.colors.colorID(T.ColorRole.FieldPrimary),r=t.textBacked?t.colors.colorID(T.ColorRole.FieldSecondary):"",i=this.forma.page.colorLibraryController,a=[],n=S.iter(i.getThemeColorKeys().concat(m.ColorLibraryController.THEME_DERIVED_BW_KEYS));!n.done;n.next()){var l,s=n.value;(l=i.getSolidColorForKey(s))&&this.pageData.isColorVisibleAgainstBackground(l)&&a.push(s)}for(var c=S.iter(t.characterStyles);!c.done;c.next()){var u=c.value,h=u.colors.colorID(T.ColorRole.FieldPrimary),g=u.secondaryColorVisible?u.colors.colorID(T.ColorRole.FieldSecondary):"";if(u.secondaryColorVisible&&u.backing!=I.LockupBacking.UNSET){var p,d=!1;if(""==r&&(p=i.getSolidColorForKey(g))&&(this.pageData.isColorVisibleAgainstBackground(p)||(d=!0)),d)for(var y=S.iter(a);!y.done;y.next())(w=y.value)!=r&&(u.colors.setColorId(T.ColorRole.FieldSecondary,w),e=!0);else if(g==r)for(var k=S.iter(i.getThemeColorKeys().concat(m.ColorLibraryController.THEME_DERIVED_BW_KEYS));!k.done;k.next())(s=k.value)!=r&&(u.colors.setColorId(T.ColorRole.FieldSecondary,s),e=!0)}var f=!1,L=h!=o,C=i.getSolidColorForKey(t.colors.colorID(T.ColorRole.FieldPrimary));if(null==C)return e;if(!u.textBacked){var A=i.getSolidColorForKey(h);L&&""!=o&&(L=A.contrasts(C,!1)),""!=r||this.pageData.isColorVisibleAgainstBackground(A)||(f=!0)}if((u.backing!=I.LockupBacking.None&&u.backing!=I.LockupBacking.UNSET||L&&h!=r)&&!f){if(u.textBacked&&h==u.colors.colorID(T.ColorRole.FieldSecondary))for(var v=S.iter(i.getThemeColorKeys());!v.done;v.next())if((s=v.value)!=u.colors.colorID(T.ColorRole.FieldSecondary)){u.colors.setColorId(T.ColorRole.FieldPrimary,s),e=!0;break}}else for(var b=S.iter(a);!b.done;b.next()){var D=b.value,w=i.getSolidColorForKey(D),x=""==o||w.contrasts(C,!1);if(D!=o&&D!=r&&(!x&&e||u.colors.setColorId(T.ColorRole.FieldPrimary,D),e=!0,x))break}}}return e},getBrandkitColorsInUse:function(){for(var t=[],e=this.forma.page.colorLibraryController,o=S.iter(e.getColorThemeAsArrayOfTheoColors());!o.done;o.next()){var r=o.value;r.isBrandkitColor()&&t.push(r)}return t},getAllColorsFromDocumentBrandkit:function(){var t=[],e=F.Host.brandkitManager.brandkitForDocument(this.forma.page.document);if(null!=e)for(var o=S.iter(e.colors);!o.done;o.next()){var r=o.value,i=H.TheoColor.init_bb45(r);t.push(i)}return t},getBaseSuggestableColors:function(){for(var t=this.forma.page.colorLibraryController,e=S.clone(t.getColorThemeAsArrayOfTheoColors()),o=S.clone(t.getThemeDerivedColorsAsArrayOfTheoColors()),r=S.clone(t.getSuggestedColorsAsArraysOfTheoColors()),i=e.concat(r).concat(o),a=[],n=S.clone(this.getAllColorsFromDocumentBrandkit()),l=S.iter(i);!l.done;l.next()){var s=l.value;if(!s.isBrandkitColor()){for(var c=!0,u=S.iter(a);!u.done;u.next()){var h=u.value;if(s.rgbColor.distanceTo(h)<20){c=!1;break}}for(var g=S.iter(n);!g.done;g.next()){var p=g.value;if(s.rgbColor.distanceTo(p.rgbColor)<20){c=!1;break}}if(c&&a.push(s.rgbColor),a.length>=10)break}}return a},getSuggestableSingleColors:function(){for(var t=S.clone(this.getBaseSuggestableColors()),e=k.getTextOpacity(this.pageData.selectedLockup.styleAttributes),o=[],r=S.iter(t);!r.done;r.next()){for(var i=r.value,a=i.withAlphaOf(e),n=!0,l=S.iter(this.pageData.colorsBehindSelectedLockup);!l.done;l.next()){var s=l.value;if(!k.hasSufficientLegibilityContrast(a,s)){n=!1;break}}n&&o.push(i)}return o},getSuggestableColors:function(){var t=S.clone(this.getSuggestableColorPairs());if(0==t.length)for(var e=S.clone(this.getSuggestableSingleColors()),o=S.iter(e);!o.done;o.next()){var r=o.value;t.push([r])}for(var i=[],a=S.iter(t);!a.done;a.next()){for(var n=a.value,l=[],s=S.iter(n);!s.done;s.next()){var c=s.value;l.push(this.forma.page.colorLibraryController.getTheoColorForSolidColor(c))}i.push(l)}return i},isCurrentlyShowingMultipleColors:function(){var t;return!((t=S.as(this.forma.controller,j.TypeLockupController))&&(!t.secondaryColorVisible()||this.targetedLockupStyle.textLook==I.LockupTextLook.KnockoutOnly||this.targetedLockupStyle.textLook==I.LockupTextLook.OutlineOnly))},getSuggestableColorPairs:function(){var t=[];if(!this.isCurrentlyShowingMultipleColors())return t;var e=this.targetedLockupStyle,o=k.lockupStyleToLockupStyleAttributes(e,this.forma.page.document),r=(N.ShapeLibrary.shapeDictionary[o.backing]||N.ShapeLibrary.shapeDictionary.none).filled,i=k.getBackingOpacity(o);i==B.FormaStyle.OPACITY_UNSET&&(i=k.getBackingOpacity(k.lockupStyleToLockupStyleAttributes(this.forma.style,this.forma.page.document)));var a=S.clone(this.getBaseSuggestableColors()),n=a.length;if(0==n)return t;for(var l={},s=S.toArray(S.range(0,n,!1)),c=S.clone(S.shuffle(s)),u=S.iter(this.pageData.lockups);!u.done;u.next()){var h=u.value;if(h.id!=this.forma.formaID&&"none"!=h.styleAttributes.backing){var g=this.forma.page.colorLibraryController.getSolidColorForKey(h.styleAttributes.primaryColor),p=this.forma.page.colorLibraryController.getSolidColorForKey(h.styleAttributes.secondaryColor);if(null!=g&&null!=p&&k.hasSufficientLegibilityContrast(g,p)){for(var d=-1,y=-1,f=S.iter(S.range(0,a.length,!1));!f.done;f.next()){var L=f.value;a[L].distanceTo(g)<.1&&(d=L),a[L].distanceTo(p)<.1&&(y=L)}null==l[b=S.toString(W.MathUtils.maxInt(d,y))+" "+S.toString(W.MathUtils.minInt(d,y))]&&(t.push([g,p]),l[b]=!0)}}}for(var C=S.iter(S.range(0,2,!0));!C.done;C.next()){for(var m=S.iter(c);!m.done;m.next()){d=m.value;for(var A=S.clone(S.shuffle(s)),v=S.iter(A);!v.done;v.next()){var b;if(y=v.value,t.length>=10)break;if(null==l[b=S.toString(W.MathUtils.maxInt(d,y))+" "+S.toString(W.MathUtils.minInt(d,y))]){var D=a[d],T=a[y],w=D,x=T;D.lightness<T.lightness&&(w=T,x=D);var O=[];O=this.pageData.colorsBehindSelectedLockup[0].lightness>w.lightness?[x,w]:[w,x],r&&(O=S.reverse(O));for(var F=O[0],_=!0,E=S.iter(this.pageData.colorsBehindSelectedLockup);!E.done;E.next()){var I=E.value.blend(O[1],i),P=F.distanceTo(O[1]);if(!k.hasSufficientLegibilityContrast(F,I)||P<k.kColorPairDistanceThreshold){_=!1;break}}_&&(l[b]=!0,t.push(O))}}if(t.length>=10)break}if(t.length>=10)break}return t},applyColors:function(t,e){var o=this.targetedLockupStyle,r=this.forma.page.colorLibraryController;if(0!=t.length){L.BadgeFacade.logColorChange(S.opt(this.forma,(function(t){return t.source})));var i=S.clone(r.addColorsToTheme(t,this.targetedLockupStyle!==this.forma.style?null:this.forma));if(1==t.length)this.applyColor(e,i[0]);else{var a=e==T.ColorRole.FieldPrimary?T.ColorRole.FieldSecondary:T.ColorRole.FieldPrimary;o.colors.setColorIDs([{key:e,value:i[0]},{key:a,value:i[1]}])}this.targetedLockupStyle!==this.forma.style&&(this.forma.style.colorTableBeforeChanged(),this.forma.style.colorTableAfterChanged(),this.forma.controller.styleChanged())}},applyColorsWithRole:function(t){var e=this.targetedLockupStyle,o=this.forma.page.colorLibraryController;L.BadgeFacade.logColorChange(S.opt(this.forma,(function(t){return t.source})));for(var r=S.clone(o.addColorsWithRoleToTheme(t,this.targetedLockupStyle!==this.forma.style?null:this.forma)),i=[],a=S.iter(r);!a.done;a.next()){var n=a.value;i.push({key:n.role,value:n.color})}e.colors.setColorIDs(i),this.targetedLockupStyle!==this.forma.style&&(this.forma.style.colorTableBeforeChanged(),this.forma.style.colorTableAfterChanged(),this.forma.controller.styleChanged())},applyColor:function(t,e){var o=this.targetedLockupStyle,r=k.lockupStyleToLockupStyleAttributes(o,this.forma.page.document),i=(N.ShapeLibrary.shapeDictionary[r.backing]||N.ShapeLibrary.shapeDictionary.none).filled,a=k.needsContrastingColor(r.backing,o.textLook,i),n=this.getContrastingColorKey(e,null);switch(t){case 1:r.primaryColor=e,r.secondaryColor=a?n:e;break;case 2:r.secondaryColor=e,r.primaryColor=a?n:e;break;default:return}o.colors.setColorIDs([{key:T.ColorRole.FieldPrimary,value:r.primaryColor},{key:T.ColorRole.FieldSecondary,value:r.secondaryColor},{key:T.ColorRole.Border,value:r.secondaryColor},{key:T.ColorRole.Shadow,value:r.secondaryColor}])},getContrastingColorKey:function(t,e){var o,r=this.forma.page.colorLibraryController.getTheoColorForKey(t);if(null==r)return"";null!=e&&(o=this.forma.page.colorLibraryController.getTheoColorForKey(e));var i=this.forma.page.colorLibraryController,a="";if(r.isBrandkitColor())for(var n=S.clone(this.getBrandkitColorsInUse()),l=r.getBrandkitShadeRole(),s=S.iter(n);!s.done;s.next()){var c=s.value,u=c.getBrandkitShadeRole();if((null==l&&(u==H.TheoColor.SPARK_COLOR_ROLE_SHADE0||u==H.TheoColor.SPARK_COLOR_ROLE_SHADE6)||null!=l&&(u==H.TheoColor.SPARK_COLOR_ROLE_SHADE1||u==H.TheoColor.SPARK_COLOR_ROLE_SHADE5))&&c.rgbColor.distanceTo(r.rgbColor)>30&&(null==o||c.rgbColor.distanceTo(o.rgbColor)>30)){a=i.getKeyOfColorInTheme(c);break}}return""==a&&null!=r&&(a=i.setLightnessContrastColorAndReturnKey(t,r)),a},setContrastingColor:function(t,e,o,r,i){var a=t.contrastWithColor(e),n=m.ColorLibraryController.getBackgroundContrastKey(r);return this.forma.page.colorLibraryController.setTheoColorToLibrary(H.TheoColor.init_5344(a,null,null),n),i.colors.setColorIDs([{key:o,value:n}]),n},backgroundContrastCheck:function(t){void 0===t&&(t=!0),0==this.hasScoresForAttributes&&this.updateScoring();var e=this.targetedLockupStyle,o=k.lockupStyleToLockupStyleAttributes(e,this.forma.page.document),r=N.ShapeLibrary.shapeDictionary[o.backing],i=S.count(e.characterStyles)>0;if(null!=r){var a=r.filled;if(!a||e.textLook==I.LockupTextLook.KnockoutOnly||i){for(var n,l,s=e.textLook==I.LockupTextLook.KnockoutOnly,c=I.LockupStyle.isShadowLook(e.textLook),u=s||c?T.ColorRole.FieldSecondary:T.ColorRole.FieldPrimary,h=!1,g=S.iter(this.forma.style.characterStyles);!g.done;g.next())(L=g.value).colors.colorID(u)==e.colors.colorID(u)&&(h=!0);if((n=S.as(this.forma.controller,j.TypeLockupController))&&(l=n.getBackgroundColor())){var p=e.colors.color(u);if(null!=p&&!p.contrasts(l,t)){var d=this.getContrastingColorKey(e.colors.colorID(u),null);e.colors.setColorId(u,d),this.forma.controller.styleChanged()}if(i&&!h)for(var y=S.iter(this.forma.style.characterStyles);!y.done;y.next()){var f,L=y.value;if(f=a?e.colors.color(T.ColorRole.FieldSecondary):l){var C=L.colors.color(u);if(null!=C&&!C.contrasts(f,t)){var m=L.colors.colorID(u);d=this.getContrastingColorKey(m,null),L.colors.setColorId(u,d)}}}}}}else E.LegacyCoreAssert.fail("shape is not set up in ShapeLibrary.shapeDictionary",void 0,"LockupStyleController.backgroundContrastCheck","LockupStyleController.swift",3588)},shuffleColorAssignment:function(){this.updateScoring();var t=S.as(this.forma.controller,j.TypeLockupController);null!=t&&t.beginBlockedUpdate();var e=this.targetedLockupStyle,o=k.lockupStyleToLockupStyleAttributes(e,this.forma.page.document),r=I.LockupStyle.isOutlineLook(e.textLook)||I.LockupStyle.isShadowLook(e.textLook),i=!1;r||(i=N.ShapeLibrary.shapeDictionary[o.backing].filled),("none"!=o.backing||r)&&(o.secondaryColor=this.profilingBackgroundColorSelector.selectColorForGlobalRecolor(!0),k.changeBorderAndShadowToSecondary(o));var a,n=null;(i||r)&&(a=this.forma.page.colorLibraryController.getSolidColorForKey(o.secondaryColor))&&(n=S.clone(b.ColorForComparison.init_c063(a,r?.7:1)));var l=!i;l&&this.pageData.lockups.length<=2?o.primaryColor=this.profilingPrimaryColorSelector.selectColorForIndividualRecolor(l,n,!1):o.primaryColor=this.profilingPrimaryColorSelector.selectColorForGlobalRecolor(l,n,!0),this.setSecondaryMultiStyleLockupColors(e,o),e.colors.setColorIDs([{key:T.ColorRole.FieldPrimary,value:o.primaryColor},{key:T.ColorRole.FieldSecondary,value:o.secondaryColor},{key:T.ColorRole.Border,value:o.secondaryColor},{key:T.ColorRole.Shadow,value:o.secondaryColor}]),null!=t&&t.endBlockedUpdate(),this.forma.controller.styleChanged()},shuffleMultiStyleLockupColors:function(){this.pageData=new k.InterestingPageData(this.forma),this.profilingPrimaryColorSelector.updateBackgroundColors(this.pageData.colorsBehindSelectedLockup),this.profilingBackgroundColorSelector.updateBackgroundColors(this.pageData.colorsBehindSelectedLockup);var t=this.targetedLockupStyle,e=k.lockupStyleToLockupStyleAttributes(t,this.forma.page.document);this.setSecondaryMultiStyleLockupColors(t,e)},setSecondaryMultiStyleLockupColors:function(t,e,o){void 0===o&&(o=!0);for(var r=S.iter(t.characterStyles);!r.done;r.next()){var i=r.value,a=S.eq(U._equality_SolidColor_SolidColor,t.colors.fieldPrimary,t.colors.fieldSecondary);if(i.backing!=I.LockupBacking.None&&i.backing!=I.LockupBacking.UNSET&&!a&&S.eq(U._equality_SolidColor_SolidColor,i.colors.fieldPrimary,t.colors.fieldSecondary)&&S.eq(U._equality_SolidColor_SolidColor,i.colors.fieldSecondary,t.colors.fieldPrimary)&&o)i.colors.setColorIDs([{key:T.ColorRole.FieldPrimary,value:e.secondaryColor},{key:T.ColorRole.FieldSecondary,value:e.primaryColor}]);else{for(var n=S.clone(this.getStylePrimarySecondaryColorForMSL(e,i,!0)),l=S.iter(S.range(0,5,!0));!l.done&&n[0]==n[1];l.next())n=S.clone(this.getStylePrimarySecondaryColorForMSL(e,i,!0));i.colors.setColorIDs([{key:T.ColorRole.FieldPrimary,value:n[0]},{key:T.ColorRole.FieldSecondary,value:n[1]},{key:T.ColorRole.Border,value:n[1]},{key:T.ColorRole.Shadow,value:n[1]}])}}},getStylePrimarySecondaryColor:function(t){var e=t.clone();e.secondaryColor=this.secondaryColorSelector.select(e,!1,!0,!1,!1),e.primaryColor=this.primaryColorSelector.select(e,!1,!0,!1,!1);for(var o=S.iter(S.range(0,5,!0));!o.done&&e.primaryColor==e.secondaryColor;o.next())e.secondaryColor=this.secondaryColorSelector.select(e,!1,!0,!1,!1),e.primaryColor=this.primaryColorSelector.select(e,!1,!0,!1,!1);return[e.primaryColor,e.secondaryColor]},getStylePrimarySecondaryColorForMSL:function(t,e,o){var r,i=this.secondaryColorSelector.select(t,!0,!1,!0,o),a=!0;if(e.backing!=I.LockupBacking.None||I.LockupStyle.isOutlineLook(e.textLook)||I.LockupStyle.isShadowLook(e.textLook)){var n=k.lockupStyleToLockupStyleAttributes(e,this.forma.page.document);n.secondaryColor=i,r=this.primaryColorSelector.select(n,!0,!1,!1,o)}else a=!1,r=this.primaryColorSelector.select(t,!1,!1,!0,o);var l,s,c=(new K.ProfilingColorMap).overridePaletteMappingDueToContrast(i,this.forma.formaID+K.ProfilingColorMap.lockupMSLBackingColorKey),u=(new K.ProfilingColorMap).overridePaletteMappingDueToContrast(r,this.forma.formaID+K.ProfilingColorMap.lockupMSLPrimaryColorKey);return(l=this.forma.page.colorLibraryController.getSolidColorForKey(u))&&(s=this.forma.page.colorLibraryController.getSolidColorForKey(c))&&(a&&!s.contrasts(l)||(i=c,r=u)),[r,i]},generateAndApplyInitialStyleAttributes:function(){var t,e,o,r,i;if(0==this.hasScoresForAttributes&&this.updateScoring(),(t=this.forma)&&(e=t.page.document)&&(o=S.as(t.style,I.LockupStyle))&&(r=F.Host.fontProvider)&&(i=F.Host.textModelUtils)){var a,n=k.lockupStyleToLockupStyleAttributes(o,e),l=["Lato-Light","Lora-Regular","Montserrat-Regular","PlayfairDisplay-Regular","CantataOne-Regular","FuturaPT-Medium"].filter((function(t){return r.descriptorForPostScriptName(t,e).availability==x.FontAvailability.LOADED}),this);if(0==l.length)a=i.defaultFont().postScriptName;else{var s=v.CoreRandom.nextIntUniform(l.length);a=l[s]}for(var c=r.getIncludedFonts(e),u=S.iter(S.range(0,c.count,!1));!u.done;u.next()){var h=u.value;S.opt(c.fontAt(h),(function(t){return t.postScriptName==a}))&&(n.font=h)}n.layout=this.layoutSelector.select(n,!1,!1,!1,!1),"fill"!=n.layout&&"right"!=n.layout||(n.layout="center"),n.padding=0,n.textOpacity=1,n.backingOpacity=1,n=this.setNewStyleColors(n,o);var g=k.lockupStyleAttributesToLockupStyle(n,o,e);t.applyStyle(g)}},setNewStyleColors:function(t,e){var o,r=t.clone(),i=N.ShapeLibrary.shapeDictionary[r.backing].filled,a=I.LockupStyle.isOutlineLook(e.textLook)||I.LockupStyle.isShadowLook(e.textLook),n=null,l=!i;return("none"!=r.backing||a)&&(r.secondaryColor=this.profilingBackgroundColorSelector.selectColorForGlobalRecolor(!0,void 0,!0),k.changeBorderAndShadowToSecondary(r),(o=this.forma.page.colorLibraryController.getSolidColorForKey(r.secondaryColor))&&(n=S.clone(b.ColorForComparison.init_c063(o,a?.7:1)))),r.primaryColor=this.profilingPrimaryColorSelector.selectColorForIndividualRecolor(l,n,!0),r},getNewStyleAttributes:function(t,e,o){void 0===t&&(t=!0),0==this.hasScoresForAttributes&&this.updateScoring();var r,i,a=this.forma.style,n=k.lockupStyleToLockupStyleAttributes(a,this.forma.page.document);return n.font=this.fontSelector.select(n,!1,t,!1,!1),n.layout=this.layoutSelector.select(n,!1,t,!1,!1),n.backing=this.backingSelector.select(n,!1,t,!1,!1),o||(n.secondaryColor=this.secondaryColorSelector.select(n,!1,t,!1,!1),n.primaryColor=this.primaryColorSelector.select(n,!1,t,!1,!1),k.changeBorderAndShadowToSecondary(n),this.setSecondaryMultiStyleLockupColors(a,n,!1)),n.shadowAngle=this.shadowAngleSelector.select(n,!1,t,!1,!1),n.spacing=this.spacingSelector.select(n,!1,t,!1,!1),n.wheelUsed=!0,o?(r=k.lockupStyleAttributesToLockupStyle(n,a,this.forma.page.document),r=this.updateLockupStyleWithNewColors(r),(i=e)&&(r=i.lockupStyleEvaluator.styleEvaluatedWithReadability(r))):(r=k.lockupStyleAttributesToLockupStyle(n,a,this.forma.page.document),(i=e)&&i.lockupStyleEvaluator.initializeReadabilityInformation(r)),r},evaluateLockupStyleWithReadability:function(t){return new P.LockupStyleEvaluator(this.forma).styleEvaluatedWithReadability(t)},updateLockupStyleWithNewColors:function(t){(new K.ProfilingColorMap).eraseCurrentPaletteMappingDictionary();var e=k.lockupStyleToLockupStyleAttributes(t,this.forma.page.document),o=S.clone(this.getStylePrimarySecondaryColor(e));return e.primaryColor=o[0],e.secondaryColor=o[1],k.changeBorderAndShadowToSecondary(e),t.colors.setColorIDs([{key:T.ColorRole.FieldPrimary,value:o[0]},{key:T.ColorRole.FieldSecondary,value:o[1]},{key:T.ColorRole.Border,value:o[1]},{key:T.ColorRole.Shadow,value:o[1]}]),this.setSecondaryMultiStyleLockupColors(t,e,!1),t},cloneOpacityAttributes:function(t){var e=t.clone();return e.textOpacity=t.textOpacity,e.backingOpacity=t.backingOpacity,e},updateOpacityAttributesForNewBacking:function(t,e){var o=(N.ShapeLibrary.shapeDictionary[e.backing]||N.ShapeLibrary.shapeDictionary.none).filled,r=e.clone();return o?(k.getTextLook(r)==I.LockupTextLook.KnockoutAndOutline?r.textOpacity=t:r.textOpacity=1,r.backingOpacity=t):(r.textOpacity=t,r.backingOpacity=t),r},updateOpacityAttributes:function(t,e){var o=e.clone();return o.textOpacity=t,o.backingOpacity=t,o},updateTextOpacityAttributes:function(t,e){var o=e.clone();return o.textOpacity=t,o},updateShapeOpacityAttributes:function(t,e){var o=e.clone();return o.backingOpacity=t,o},setOpacity:function(t){var e=this.targetedLockupStyle,o=k.lockupStyleToLockupStyleAttributes(e,this.forma.page.document),r=this.updateOpacityAttributes(t,o);this.targetedLockupStyle===this.forma.style?this.forma.applyStyle(k.lockupStyleAttributesToLockupStyle(r,this.forma.style,this.forma.page.document)):(this.targetedLockupStyle.textOpacity=r.textOpacity,this.targetedLockupStyle.backingOpacity=r.backingOpacity,this.forma.controller.styleChanged())},getOpacityValue:function(){return this.targetedLockupStyle.currentTextOpacity},setTextOpacity:function(t){var e=this.targetedLockupStyle,o=k.lockupStyleToLockupStyleAttributes(e,this.forma.page.document),r=this.updateTextOpacityAttributes(t,o);this.targetedLockupStyle===this.forma.style?this.forma.applyStyle(k.lockupStyleAttributesToLockupStyle(r,this.forma.style,this.forma.page.document)):(this.targetedLockupStyle.textOpacity=r.textOpacity,this.forma.controller.styleChanged())},getTextOpacityValue:function(){return this.targetedLockupStyle.currentTextOpacity},setShapeOpacity:function(t){var e=this.targetedLockupStyle,o=k.lockupStyleToLockupStyleAttributes(e,this.forma.page.document),r=this.updateShapeOpacityAttributes(t,o);this.targetedLockupStyle===this.forma.style?this.forma.applyStyle(k.lockupStyleAttributesToLockupStyle(r,this.forma.style,this.forma.page.document)):(this.targetedLockupStyle.backingOpacity=r.backingOpacity,this.forma.controller.styleChanged())},getShapeOpacityValue:function(){return this.targetedLockupStyle.currentBackingOpacity},hasSpacingOptions:function(){var t,e;return!(!(t=S.opt(S.opt(this.forma,(function(t){return t.controller})),(function(t){return t.enableChildMove})))&&null==t||!t||this.targetedLockupStyle!==this.forma.style||!(e=S.as(this.forma.controller,j.TypeLockupController))||!(e.numLines()>1||0==e.numLines()))},hasPaddingOptions:function(){var t;if(!(t=S.opt(S.opt(this.forma,(function(t){return t.controller})),(function(t){return t.enableChildMove})))&&null==t||!t)return!1;var e=this.targetedLockupStyle;return e.backing!=I.LockupBacking.None&&e.backing!=I.LockupBacking.Knockout&&e.backing!=I.LockupBacking.UNSET},areSpacingAndPaddingOptionsAvailable:function(){return this.hasSpacingOptions()||this.hasPaddingOptions()},setNextSpacingAndPaddingOption:function(){var t,e;if(this.targetedLockupStyle===this.forma.style){var o=this.hasPaddingOptions(),r=this.hasSpacingOptions();if(o||r){var i=this.forma.style,a=k.lockupStyleToLockupStyleAttributes(i,this.forma.page.document),n=k.ALLOWED_PADDING_VALUES.length,l=k.ALLOWED_SPACING_VALUES.length,s=n*l,c=(t=S.indexOf(k.ALLOWED_PADDING_VALUES,a.padding))||null!=t?t:0,u=(e=S.indexOf(k.ALLOWED_SPACING_VALUES,a.spacing))||null!=e?e:0,h=(o?u*n+c:c*l+u)+1;h%=s;var g=o?S.toInt(h/n):h%l,p=o?h%n:S.toInt(h/l);a.padding=k.ALLOWED_PADDING_VALUES[p],a.spacing=k.ALLOWED_SPACING_VALUES[g],this.forma.applyStyle(k.lockupStyleAttributesToLockupStyle(a,this.forma.style,this.forma.page.document))}}else this.setNextPaddingOption()},setNextSpacingOption:function(){var t,e=this.forma.style,o=k.lockupStyleToLockupStyleAttributes(e,this.forma.page.document),r=((t=S.indexOf(k.ALLOWED_SPACING_VALUES,o.spacing))||null!=t?t:0)+1;r>=k.ALLOWED_SPACING_VALUES.length&&(r=0),o.spacing=k.ALLOWED_SPACING_VALUES[r],this.forma.applyStyle(k.lockupStyleAttributesToLockupStyle(o,this.forma.style,this.forma.page.document))},setSpacingFromSlider:function(t){this.setSpacing(Y.TheoDocumentUtils.sliderToSpacingPaddingMapping(t))},setSpacing:function(t){var e,o=this.forma.style,r=k.lockupStyleToLockupStyleAttributes(o,this.forma.page.document),i=((e=S.indexOf(k.ALLOWED_SPACING_VALUES,r.spacing))||null!=e?e:0)+1;i>=k.ALLOWED_SPACING_VALUES.length&&(i=0),r.spacing=t,this.forma.applyStyle(k.lockupStyleAttributesToLockupStyle(r,this.forma.style,this.forma.page.document))},supportsRelativeFontScale:function(){var t;if(!(t=S.opt(S.opt(this.forma,(function(t){return t.controller})),(function(t){return t.enableChildMove})))&&null==t||!t)return!1;var e=this.targetedLockupStyle;return e.layout==I.LockupLayout.Auto&&M.TypographyComposer.supportsRelativeFontScale(e.alignment)},setRelativeFontScale:function(t){var e,o=this.forma.style,r=k.lockupStyleToLockupStyleAttributes(o,this.forma.page.document);if(r.relativeFontScale=t,e=S.as(this.forma.controller,j.TypeLockupController)){var i;if(i=this.getSessionContainerSize()){var a=e.findInternalOffset(e.lockupStyle,e.size,i);e.move(R.Matrix2D.Identity.translate(a)),e.size=i}this.forma.applyStyle(k.lockupStyleAttributesToLockupStyle(r,this.forma.style,this.forma.page.document)),e.snapSizeToBounds()}},setNextPaddingOption:function(){var t;if(this.hasPaddingOptions()){var e=this.targetedLockupStyle;this.targetedLockupStyle!=this.forma.style&&this.targetedLockupStyle.backing==I.LockupBacking.Rows&&this.forma.style.backing==I.LockupBacking.Rows&&(e=this.forma.style);var o=k.lockupStyleToLockupStyleAttributes(e,this.forma.page.document),r=((t=S.indexOf(k.ALLOWED_PADDING_VALUES,o.padding))||null!=t?t:0)+1;r>=k.ALLOWED_PADDING_VALUES.length&&(r=0),o.padding=k.ALLOWED_PADDING_VALUES[r],e===this.forma.style?this.forma.applyStyle(k.lockupStyleAttributesToLockupStyle(o,this.forma.style,this.forma.page.document)):(this.targetedLockupStyle.padding=o.padding,this.forma.controller.styleChanged())}},setPaddingFromSlider:function(t){this.setPadding(Y.TheoDocumentUtils.sliderToSpacingPaddingMapping(t))},setPadding:function(t){if(this.hasPaddingOptions()){var e=this.targetedLockupStyle;this.targetedLockupStyle!=this.forma.style&&this.targetedLockupStyle.backing==I.LockupBacking.Rows&&this.forma.style.backing==I.LockupBacking.Rows&&(e=this.forma.style);var o=k.lockupStyleToLockupStyleAttributes(e,this.forma.page.document);o.padding=t,e===this.forma.style?this.forma.applyStyle(k.lockupStyleAttributesToLockupStyle(o,this.forma.style,this.forma.page.document)):(this.targetedLockupStyle.padding=o.padding,this.forma.controller.styleChanged())}},setNextTrackingOption:function(){var t=this.forma.style,e=k.lockupStyleToLockupStyleAttributes(t,this.forma.page.document);e.tracking+=.2,e.tracking>.9&&(e.tracking=0),this.forma.applyStyle(k.lockupStyleAttributesToLockupStyle(e,this.forma.style,this.forma.page.document))},setTrackingFromSlider:function(t){var e;if(e=S.as(S.opt(this.forma,(function(t){return t.controller})),j.TypeLockupController)){var o=e.getCurrentFontSize();this.targetedLockupStyle.tracking=t;var r=S.opt(e.getPin(!0,!0),(function(t){return t.pinPoint}))||J.TheoPoint.ZERO;e.setSizeSliderValue(o,[],r)}},setNextShadowAngle:function(){var t;if(I.LockupStyle.isShadowLook(this.targetedLockupStyle.textLook)){var e=this.forma.style,o=k.lockupStyleToLockupStyleAttributes(e,this.forma.page.document),r=((t=S.indexOf(k.ALLOWED_SHADOWANGLE_VALUES,o.shadowAngle))||null!=t?t:0)+1;r>=k.ALLOWED_SHADOWANGLE_VALUES.length&&(r=0),o.shadowAngle=k.ALLOWED_SHADOWANGLE_VALUES[r],this.forma.applyStyle(k.lockupStyleAttributesToLockupStyle(o,this.forma.style,this.forma.page.document))}},legacyColorConversion:function(){if(null!=this.forma){for(var t,e=this.forma.style,o=[T.ColorRole.FieldPrimary,T.ColorRole.FieldSecondary],r=S.iter(o);!r.done;r.next()){var i=r.value,a=e.colors.color(i),n=e.colors.colorID(i),l=null!=n&&m.ColorLibraryController.keyFromImage(n);if(null!=a&&null==n||l){var s=this.forma.page.colorLibraryController.addUnlinkedColor(a);e.colors.setColorId(i,s)}}q.TypeLockupUtils.fixUpColors(e),(t=e.characterStyles[j.TypeLockupController.HIGHLIGHT_STYLE])&&q.TypeLockupUtils.fixUpColors(t)}else E.LegacyCoreAssert.fail("forma has been de-alloc'd",void 0,"LockupStyleController.legacyColorConversion","LockupStyleController.swift",4435)},onTrackingChanged:function(){var t;(t=S.as(S.opt(this.forma,(function(t){return t.style})),I.LockupStyle))&&(this._sessionAttrs.setTracking(t.tracking,t.layout),this.resetSessionContainerSize(),this.resetSessionContainerCenter())},onSpacingChanged:function(){var t;(t=S.as(S.opt(this.forma,(function(t){return t.style})),I.LockupStyle))&&(this._sessionAttrs.setSpacing(t.spacing,t.layout),this.resetSessionContainerSize(),this.resetSessionContainerCenter())},onBackingShapeChanged:function(){var t;if(t=S.as(S.opt(this.forma,(function(t){return t.style})),I.LockupStyle)){var e=k.getBackingStringForBackingEnumAndArtworkId(t.backing,t.backingArtworkID);this._sessionAttrs.setBackingShape(e,t.layout,t.pathID)}},onLayoutChanged:function(t){var e=t.layout,o=t.pathID,r=this.forma.style,i=r.layout,a=r.pathID;if(this._sessionAttrs.needsUpdate(e,t.alignment,o,i,r.alignment,a)){var n,l;this._sessionAttrs.setTracking(r.tracking,e),this._sessionAttrs.setSpacing(r.spacing,e),null!=(n=this._sessionAttrs.getTracking(i))&&(r.tracking=n),null!=(l=this._sessionAttrs.getSpacing(i))&&(r.spacing=l);var s=k.getBackingStringForBackingEnumAndArtworkId(r.backing,r.backingArtworkID);this._sessionAttrs.recordInitialBackingShape(s,e,o);for(var c=!1,u=S.iter(this._sessionAttrs.getPotentialBackingShapes(i,a,s));!u.done;u.next()){var h=u.value,g=k.getBackingEnumAndArtworkIdForBackingString(h),p=g.backing,d=g.artworkID;if(N.ShapeLibrary.isBackingShapeStyleCompatible(r,p,d)){r.backing=p,r.backingArtworkID=d,c=!0;break}}c||(S.opt(N.ShapeLibrary.shapeDictionary[s],(function(t){return 1==t.filled}))?(r.backing=I.LockupBacking.SVGBackground,r.backingArtworkID="square_001"):(r.backing=I.LockupBacking.None,r.backingArtworkID=null))}},endSession:function(){this._sessionAttrs.reset()},getSessionContainerSize:function(){return this._sessionAttrs._containerSize},getSessionContainerCenter:function(){return this._sessionAttrs._containerCenter},setSessionContainerSize:function(t){null==this._sessionAttrs._containerSize&&(this._sessionAttrs._containerSize=t)},setSessionContainerCenter:function(t){null==this._sessionAttrs._containerCenter&&(this._sessionAttrs._containerCenter=t)},resetSessionContainerSize:function(){this._sessionAttrs._containerSize=null},resetSessionContainerCenter:function(){this._sessionAttrs._containerCenter=null}}}),d),k.SessionAttrs=(y=function(){this._attrsDict={},this._hasBackingShapeEntry=!1,this._containerSize=null,this._containerCenter=null,this.reset()},S.defineClass({name:"SessionAttrs",ctor:y,statics:{TRACKING_KEY:"tracking",SPACING_KEY:"spacing",BACKING_KEY:"backing"},props:{reset:function(){this._attrsDict={},this._hasBackingShapeEntry=!1,this._containerSize=null,this._containerCenter=null,this.setTracking(0,I.LockupLayout.Standard),this.setSpacing(.35,I.LockupLayout.Standard),this.setTracking(.35,I.LockupLayout.LetterGrid),this.setSpacing(.35,I.LockupLayout.LetterGrid),this.setTracking(.15,I.LockupLayout.Path),this.setSpacing(.35,I.LockupLayout.Path),this.setTracking(0,I.LockupLayout.Auto),this.setSpacing(.35,I.LockupLayout.Auto)},needsUpdate:function(t,e,o,r,i,a){return t==I.LockupLayout.Auto&&t==r&&e!=i||this.getLayoutClass("",t,o)!=this.getLayoutClass("",r,a)},getTracking:function(t){return S.as(this._attrsDict[this.getSessionAttrsKey(y.TRACKING_KEY,t)],"Double")},setTracking:function(t,e){this._attrsDict[this.getSessionAttrsKey(y.TRACKING_KEY,e)]=t},getSpacing:function(t){return S.as(this._attrsDict[this.getSessionAttrsKey(y.SPACING_KEY,t)],"Double")},setSpacing:function(t,e){this._attrsDict[this.getSessionAttrsKey(y.SPACING_KEY,e)]=t},getBackingShape:function(t,e,o){return void 0===o&&(o=null),S.as(this._attrsDict[this.getSessionAttrsKey(y.BACKING_KEY,e,o)],"String")},setBackingShape:function(t,e,o){void 0===o&&(o=null),this._attrsDict[this.getSessionAttrsKey(y.BACKING_KEY,e,o)]=t,this._hasBackingShapeEntry=!0},recordInitialBackingShape:function(t,e,o){void 0===o&&(o=null),this._hasBackingShapeEntry||this.setBackingShape(t,e,o)},getPotentialBackingShapes:function(t,e,o){void 0===e&&(e=null);for(var r=this,i=[],a=[],n=S.iter(this._attrsDict);!n.done;n.next()){var l=n.key,s=n.value;l.includes(y.BACKING_KEY)&&(S.as(s,"String")==o?i.push(o):a.push(l))}return S.sortInPlace(a,(function(o,i){return r.getBackingShapeKeyDistance(o,t,e)<r.getBackingShapeKeyDistance(i,t,e)})),i.concat(a.map((function(t){return r._attrsDict[t]}),this))},getBackingShapeKeyDistance:function(t,e,o){var r;if(void 0===o&&(o=null),null!=(r=this.extractLayoutClass(y.BACKING_KEY,t))){var i=this.getLayoutClass(y.BACKING_KEY,e,o);return r==i?0:r==k.LayoutClass.PathDefault&&i==k.LayoutClass.PathAsymmetric||r==k.LayoutClass.PathAsymmetric&&i==k.LayoutClass.PathDefault?1:r==k.LayoutClass.Default?2:3+i}return 1e4},getLayoutClass:function(t,e,o){var r;return void 0===o&&(o=null),I.LockupStyle.isLetterGrid(e)?k.LayoutClass.LetterGrid:I.LockupStyle.isAutoLayout(e)?k.LayoutClass.Auto:I.LockupStyle.isPath(e)?t==y.SPACING_KEY||t==y.TRACKING_KEY||Z.TextPathLibrary.isPathSymmetric((r=o)||null!=r?r:Z.TextPathID.Circle)?k.LayoutClass.PathDefault:k.LayoutClass.PathAsymmetric:k.LayoutClass.Default},extractLayoutClass:function(t,e){if(e.startsWith(t)){var o,r=e.substr(t.length);if(null!=(o=S.toInt(r)))return k.LayoutClass.toCaseValue(o)}return null},getSessionAttrsKey:function(t,e,o){return void 0===o&&(o=null),t+this.getLayoutClass(t,e,o)}}}),y),k.LayoutClass=S.defineEnum("LayoutClass",{Default:0,LetterGrid:1,PathDefault:2,PathAsymmetric:3,Auto:4})}}]);
//# sourceMappingURL=vendors_npm_spark_18b3417f-0ba6e089.js.map